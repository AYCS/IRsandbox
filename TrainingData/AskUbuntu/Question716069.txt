[{"id":716069,"title":"Trying to change the nameservers, I am stuck by the complexity I found","body":"<p>I am trying to change the nameservers being used by my Ubuntu machine (just my laptop, not a server).</p>\n\n<p>In the good old days in which I was using Slackware I just needed to edit <code>/etc/resolv.conf</code> and my job was done.</p>\n\n<p>After figuring out that <code>/etc/resolv.conf</code> is actually generated by <code>resolvconf</code> I edited <code>/etc/resolvconf/resolv.conf.d/head</code> as such:</p>\n\n<pre><code># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)\n#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN\nnameserver 8.8.8.8\nnameserver 8.8.4.4\n</code></pre>\n\n<p>But my job is not done. I see that an unwanted line is still added in <code>/etc/resolv.conf</code>:</p>\n\n<pre><code>nameserver 127.0.1.1\n</code></pre>\n\n<p>I don't like this because I want the name resolution to fail just after trying Google's nameservers.\nThis line isn't in any file in <code>/etc/resolvconf/resolv.conf.d/</code> and here my confusion begins. By <code>sudo netstat -ltnp</code> I see that I have a name server daemon running on my laptop:</p>\n\n<pre><code>tcp        0      0 127.0.1.1:53            0.0.0.0:*               LISTEN      4889/dnsmasq    \n</code></pre>\n\n<p>Why would I need that? I cannot remove the package containing <code>dnsmasq</code> (which is <code>dnsmasq-base</code>) because these packages depend on it:</p>\n\n<pre><code>  checkbox-gui checkbox-qt dnsmasq-base network-manager network-manager-gnome plainbox-provider-checkbox plainbox-provider-resource-generic ubuntu-desktop\n</code></pre>\n\n<p>Is this service running on port 53 really necessary to the well-being of my machine? How can I prevent it from running without using GUI tools and without compromising NetworkManager?</p>\n\n<h1>Attempt to a solution</h1>\n\n<p>Tried altering <code>/etc/NetworkManager/NetworkManager.conf</code> and restarting NetworkManager by commenting the line referring to <code>dnsmasq</code></p>\n\n<pre><code>[main]\nplugins=ifupdown,keyfile,ofono\n#dns=dnsmasq\n\n[ifupdown]\nmanaged=false\n</code></pre>\n\n<p>The aforementioned unwanted line in <code>resolv.conf</code> did indeed disappear. But, unfortunately it seems to be replaced to this line: </p>\n\n<pre><code>nameserver 192.168.0.1\n</code></pre>\n\n<p>Would be nice to have some elucidation on the meaning and purpose of such behavior.</p>\n\n<p>A temporary fix is to remove the link <code>/etc/resolv.conf -&gt; ../run/resolvconf/resolv.conf</code> and creating a new <code>/etc/resolv.conf</code> file from scratch. This would work.. somewhat. It would not add other useful name informations (such as the <code>search</code> directives) that come from the DHCP.\nSo, a definitive solution that allows <code>resolv.conf</code> to be generated by <code>resolvconf</code> or NetworkManager still needs to be found.</p>\n","related_questions":[{"id":689427,"title":"/var/run/dnsmasq/resolv.conf nameserver contents","body":"<p>Xubuntu 15.10 using Ethernet</p>\n\n<p>From my understanding, <code>/var/run/dnsmasq/resolv.conf</code> should contain the nameservers used by dnsmasq to resolve addresses and is configured by a script called by network-manager. In my case, the file contains only <code>nameserver 127.0.1.1</code> which doesn't seem right. My IPv4 address of the only network interface on my machine is static and the IPv6 auto-configured. In both cases my router is set as my DNS server. There are the contents <code>/etc/resolv.conf</code></p>\n\n<pre><code># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)\n#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN\nnameserver 127.0.0.1\n# Generated by NetworkManager\nnameserver 192.168.1.1\nnameserver fe80::1%eth0\n</code></pre>\n\n<p>dig command shows <code>;; SERVER: 127.0.0.1#53(127.0.0.1)</code> indicating it used dnsmasq for resolution but then what does dnsmasq use?</p>\n\n<p>Note that name resolution is working just fine my questions are whether this setup would break with a reboot and whether IPv6 name resolution works at all. Thanks.</p>\n"},{"id":657444,"title":"Why is a nameserver address not removed from resolv.conf when disconnecting from my work network?","body":"<p>Using networkmanager and dnsmasq.</p>\n\n<p>When I'm at work I have a wifi connection that is statically configured with IP, dns server, and domain search.</p>\n\n<p>When I connect, <code>resolv.conf</code> has both the server and the domain search, along with the <code>dnsmasq</code> entry of 127.0.1.1.</p>\n\n<p>When I go home and get on my dhcp wifi connection, the domain search is removed from <code>resolv.conf</code>, but the work dns server isn't removed. As a result all my browsing drags. I can manually remove the entry, but when <code>resolv.conf</code> gets rebuilt it's back in there again (I expect that).</p>\n\n<p>I think the real problem is that when NM connects to the work wifi it should hand the dns server to dnsmasq, not put it in resolv.conf, as a result when I disconnect it doesn't take it out.</p>\n"},{"id":627899,"title":"nameserver 127.0.1.1 in resolv.conf won&#39;t go away!","body":"<p>I've read that I should have <code>nameserver 127.0.1.1</code> in my <code>/etc/resolv.conf</code> file only if my machine has its own DNS server. Since it doesn't, having it causes problems. But no matter what I do I can not get rid of it!</p>\n\n<p>Here are the things I've done so far:</p>\n\n<ol>\n<li>Adding <code>nameserver 192.168.1.3</code> to <code>/etc/resolvconf/resolv.conf.d/base</code> file. (192.168.1.3 is our network's DNS).</li>\n<li>Running: <code>sudo resolvconf --enable-updates</code>.</li>\n<li>Running: <code>sudo resolvconf -u</code>.</li>\n<li>Running: <code>sudo service network-manager restart</code> (just to make sure).</li>\n</ol>\n\n<p>Yet when I open the <code>/etc/resolv.conf</code> file it says: <code>nameserver 127.0.1.1</code>! Does anyone have any idea what's wrong?</p>\n\n<p>Please note that it's actually <code>127.0.1.1</code>! And I have no idea why it's not <code>127.0.0.1</code>!</p>\n\n<p>Even when I update the <code>/etc/resolv.conf</code> manually and change it to anything else, the <code>sudo resolvconf -u</code> will revert it back to <code>127.0.1.1</code>! Where is this address coming from?</p>\n"},{"id":584823,"title":"Nslookup resolves search domain but ping does not (14.10)","body":"<p>At my company, many of our configuration scripts, etc use just the server name. For example, <code>http://server</code> rather than <code>http://server.company.com</code>. I have configured the search domain in the GUI Network Connections tool. I have also configured it in <code>/etc/resolvconf/resolv.conf.d/head</code>, but it is not working correctly.</p>\n\n<p>The strange thing is certain tools like nslookup or host resolve to the correct IP, but other tools like ssh, ping, git, and web browsers do not. I can connect if I use the FQDN. <strong>What could be preventing the search domain from resolving correctly?</strong></p>\n\n<p>Below, find the relevant output from some commands.</p>\n\n<p>Nslookup:</p>\n\n<pre><code>$ nslookup server\nServer:     192.168.200.53\nAddress:    192.168.200.53#53\n\nserver.company.com  canonical name = server001.company.com.\nName:   server001.company.com\nAddress: 192.168.200.103\n</code></pre>\n\n<p>Host:</p>\n\n<pre><code>$ host server\nserver.company.com is an alias for server001.company.com.\nserver001.company.com has address 192.168.200.103\n</code></pre>\n\n<p>Ping:</p>\n\n<pre><code>$ ping server\nping: unknown host server\n\n$ ping server.company.com\nPING server001.company.com (192.168.200.103) 56(84) bytes of data.\n64 bytes from server001.company.com (192.168.200.103): icmp_seq=1 ttl=64 time=4.61 ms\n</code></pre>\n\n<p>I use ping as an example because it's simple, but most of the other tools I need to use show the same results as ping.</p>\n\n<p>Let me know if you need any more config files or info.</p>\n\n<p>/etc/hosts has no info related to the server I'm trying to connect to.</p>\n\n<p>Here is /etc/resolv.conf, which was generated by resolvconf.</p>\n\n<pre><code># Add Company Nameservers and Domain\nnameserver 192.168.200.53\nnameserver 192.168.200.65\nsearch company.com\nnameserver 127.0.1.1\nsearch company.com\n# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)\n#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN\nnameserver 127.0.1.1\nsearch hsd1.co.comcast.net\n</code></pre>\n\n<p>And /etc/network/interfaces:</p>\n\n<pre><code># interfaces(5) file used by ifup(8) and ifdown(8)\nauto lo\niface lo inet loopback\n</code></pre>\n"},{"id":536791,"title":"How to configure Ubuntu to use all nameservers detected by dnsmasq?","body":"<p>I am having trouble resolving DNS names on an internal VPN network, even though dnsmasq successfully detects nameservers on the VPN. The following is relevant output from <code>/var/log/syslog</code>:</p>\n\n<pre><code>/var/log/syslog.1:Oct 13 19:07:58 snowman NetworkManager[840]: &lt;info&gt; DNS: starting dnsmasq...\n/var/log/syslog.1:Oct 13 19:07:58 snowman NetworkManager[840]: &lt;warn&gt; dnsmasq not available on the bus, can't update servers.\n/var/log/syslog.1:Oct 13 19:07:58 snowman NetworkManager[840]: &lt;error&gt; [1413241678.445577] [nm-dns-dnsmasq.c:396] update(): dnsmasq owner not found on bus: Could not get owner of name 'org.freedesktop.NetworkManager.dnsmasq': no such name\n/var/log/syslog.1:Oct 13 19:07:58 snowman NetworkManager[840]: &lt;warn&gt; DNS: plugin dnsmasq update failed\n/var/log/syslog.1:Oct 13 19:07:58 snowman dnsmasq[1052]: started, version 2.68 cache disabled\n/var/log/syslog.1:Oct 13 19:07:58 snowman dnsmasq[1052]: compile time options: IPv6 GNU-getopt DBus i18n IDN DHCP DHCPv6 no-Lua TFTP conntrack ipset auth\n/var/log/syslog.1:Oct 13 19:07:58 snowman dnsmasq[1052]: DBus support enabled: connected to system bus\n/var/log/syslog.1:Oct 13 19:07:58 snowman dnsmasq[1052]: warning: no upstream servers configured\n/var/log/syslog.1:Oct 13 19:07:59 snowman NetworkManager[840]: &lt;warn&gt; dnsmasq appeared on DBus: :1.13\n/var/log/syslog.1:Oct 13 19:07:59 snowman dnsmasq[1052]: setting upstream servers from DBus\n/var/log/syslog.1:Oct 13 19:07:59 snowman dnsmasq[1052]: using nameserver 192.168.1.1#53\n/var/log/syslog.1:Oct 13 19:07:59 snowman dnsmasq[1052]: using nameserver 10.1.90.6#53\n/var/log/syslog.1:Oct 13 19:07:59 snowman dnsmasq[1052]: using nameserver 10.4.4.9#53\n</code></pre>\n\n<p>Evidently, dnsmasq was able to correctly automatically detect all upstream nameservers for my connection. However, my system is somehow unable to query all systems for DNS resolutions.</p>\n\n<pre><code>ping: unknown host source\n</code></pre>\n\n<p>Relevant <code>nslookup</code> output:</p>\n\n<pre><code>&gt; server\nDefault server: 127.0.1.1\nAddress: 127.0.1.1#53\n&gt; source\nServer:     127.0.1.1\nAddress:    127.0.1.1#53\n\n** server can't find source: NXDOMAIN\n&gt; server 10.1.90.6\nDefault server: 10.1.90.6\nAddress: 10.1.90.6#53\n&gt; source\nServer:     10.1.90.6\nAddress:    10.1.90.6#53\n\nName:   source.&lt;REDACTED&gt;\nAddress: 10.4.4.44\n</code></pre>\n\n<p>Here's the full dnsmasq command run on my system:</p>\n\n<pre><code>1052 ?        S      0:00 /usr/sbin/dnsmasq --no-resolv --keep-in-foreground --no-hosts --bind-interfaces --pid-file=/run/sendsigs.omit.d/network-manager.dnsmasq.pid --listen-address=127.0.1.1 --conf-file=/var/run/NetworkManager/dnsmasq.conf --cache-size=0 --proxy-dnssec --enable-dbus=org.freedesktop.NetworkManager.dnsmasq --conf-dir=/etc/NetworkManager/dnsmasq.d\n</code></pre>\n"},{"id":516587,"title":"Unable to use Internet (hosts unknown) after upgrade from 12.04 to 14.04 - DNS Resolv.conf problem","body":"<p>I upgraded my PC two days ago from 12.04 (desktop) to 14.04 (desktop).  Since then, I am unable to surf on the internet.  More exactly, I have the connection (wired) but not host resolving. I have tried several things without succes: static and dynamic IP, dnsmasq commented out,...\nIf I use DHCP on other computers on the same network, I have no problem.  On my Ubuntu, I see no error but I am unable to surf nor to resolve any host name.<br>\nFor instance, I can ping to 192.168.2.1 and 8.8.8.8 (configured as names servers) but not to www.google.com nor google.com.  nslookup fails as well ('host unreachable').\nAfter long searches, I found a problem in the '/etc/resolv.conf': If I do a 'cat /etc/resolv.conf', nothing is shown although it correctly points to '../run/resolvconf/resolv.conf'.  I then copied that regular file to '/etc/resolv/conf' (not recommended, I know) and -bingo - everything runs fine.</p>\n\n<p>Now the question is 'why does the symlink not work properly'?</p>\n"},{"id":382020,"title":"How do I remove localhost nameserver from resolv.conf","body":"<p>Currently my /etc/resolv.conf reads:</p>\n\n<blockquote>\n  <p>nameserver 127.0.0.1<br>\n  nameserver 10.255.0.101<br>\n  nameserver 10.255.0.11  </p>\n</blockquote>\n\n<p>and I want it to instead read:</p>\n\n<blockquote>\n  <p>search [my domain]<br>\n  nameserver 10.255.0.101<br>\n  nameserver 10.255.0.11<br>\n  nameserver 208.67.222.222<br>\n  nameserver 208.67.220.220  </p>\n</blockquote>\n\n<p>As both /etc/resolv.conf and /etc/resolv.conf.d/head can't be edited by hand, how can I make this change?</p>\n"},{"id":424466,"title":"How to add two IPv6 dns-nameservers into /etc/network/interfaces?","body":"<p>With IPv4, I can add two DNS Name Servers without any problem, like this:</p>\n\n<pre><code>\"dns-nameservers 8.8.4.4 8.8.8.8\"\n</code></pre>\n\n<p>Then on my resolv.conf I got:</p>\n\n<pre><code>   nameserver 8.8.4.4\n   nameserver 8.8.8.8\n</code></pre>\n\n<p>BUT, it does not work for IPv6, only the first IPv6 DNS Server appear at my resolv.conf, look:</p>\n\n<pre><code>\"dns-nameservers 2001:4860:4860::8844 2001:4860:4860::8888\"\n</code></pre>\n\n<p>But then, my resolv.conf remain only with the first one:</p>\n\n<pre><code>   nameserver 2001:4860:4860::8844\n</code></pre>\n\n<p>Apparently, Ubuntu (resolvconf / ifupdown) is ignoring the second DNS Name Server, so, how to fix it?!</p>\n\n<p>EDITED:</p>\n\n<p>Here is my /etc/network/interfaces file:</p>\n\n<pre><code>auto lo\niface lo inet loopback\niface lo inet6 loopback\n\nauto eth0\niface eth0 inet6 static\n        address 2800:210:0:4::2\n        netmask 64\n        gateway 2800:210:0:4::1\n        dns-nameservers 2001:4860:4860::8844 2001:4860:4860::8888\n</code></pre>\n\n<p>Tks!\nThiago</p>\n"},{"id":155716,"title":"Configuring the dnsmasq instance started by connection sharing in NetworkManager","body":"<p>I've got a laptop running Ubuntu 12.04 that is sharing its wifi connection to another machine through the eth0 interface using NetworkManager. This seems to be done by dnsmasq.</p>\n\n<p>Now I need to set up PXE/TFTP booting on the other machine, so I'd like to configure the dnsmasq instance that is spawned through NetworkManager to add a couple of lines for PXE/TFTP. How is this done? It seems to ignore /etc/dnsmasq.conf.</p>\n\n<p>Previous answers seem to indicate that the configuration is hardcoded into NetworkManager. Is this still the case? If so, is there an easy way to achieve what I'm trying to do here? I suppose I could just disable the network sharing in NetworkManager and set it up manually, but I'd rather keep this all managed in one place if it all possible.</p>\n\n<p>edit: Indeed, it seems the dnsmasq configuration is still hardcoded in NetworkManager. See <a href=\"http://cgit.freedesktop.org/NetworkManager/NetworkManager/tree/src/dnsmasq-manager/nm-dnsmasq-manager.c\">source here</a>. It seems to me that it would be a much better solution to simply specify an alternate dnsmasq.conf file here, but I'm sure there are issues I haven't considered.</p>\n"},{"id":262510,"title":"DNS suddenly broken in Ubuntu VirtualBox","body":"<p>My Ubuntu 12.04 VirtualBox (Windows 7 host) suddenly stopped connecting to remote servers unless I refer to them by their IP addresses.</p>\n\n<p>I'm looking for a way to fix this problem (or at least to troubleshoot it).</p>\n\n<hr>\n\n<p><strong>NOTE</strong>: <em>Neither restarting the VB nor restarting the host machine fixed the problem.</em></p>\n\n<p><strong>IMPORTANT</strong>: The VB has been operating flawlessly since it was set up several months ago.  Furthermore, I did not make any changes to the configurations, settings, etc. of either the guest or the host machine in the last several days.  (AFAICT, the loss of DNS just happened out-of-the-blue.)  Since the configurations of the guest and host machines have been so successful until now, in general I want to stay clear of solutions that would involve changing them.  (Of course, this does not apply to configuration files that get modified frequently by automated process, such as <code>resolv.conf</code>, since it is not unusual for such a file to become corrupted during normal operation.)</p>\n\n<p>FWIW:</p>\n\n<p>My <code>/etc/network/interfaces</code> file consists of only the following two lines:</p>\n\n<pre><code>auto lo\niface lo inet loopback\n</code></pre>\n\n<p>Furthermore, my <code>/etc/resolv.conf</code> file (which is <strong><em>not</em></strong> a symlink to <code>../run/resolvconf/resolv.conf</code>) has one <code>search</code> line, showing my workplace's network's domain, followed by two <code>nameserver</code> lines; the hosts corresponding to the IP addresses mentioned in these two lines are both up, according to <code>ping</code>.</p>\n\n<p>Just to be clear, I did not create or edit either of these files.</p>\n\n<pre><code>% ifconfig -a\neth0      Link encap:Ethernet  HWaddr 61:39:ba:21:c7:cc  \n          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0\n          inet6 addr: 2fd1::f92:2c24:7735:e9ac/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:946 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:995 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000 \n          RX bytes:122625 (122.6 KB)  TX bytes:96928 (96.9 KB)\n\nlo        Link encap:Local Loopback  \n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:16436  Metric:1\n          RX packets:10 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:10 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:1380 (1.3 KB)  TX bytes:1380 (1.3 KB)\n</code></pre>\n"}]}]