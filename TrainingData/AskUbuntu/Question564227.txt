[{"id":564227,"title":"Right way to completely clean up old kernels in terminal","body":"<p>I have been going through various questions about how to clean up old Linux kernels. They all seem to have different answers and they are old, so someone is bound to say the question is too old and start a new post, so here it is:</p>\n\n<p>I want to do all the following:</p>\n\n<ol>\n<li>Remove old Linux kernels manually in terminal.</li>\n<li>Remove all configuration files</li>\n<li>Remove all header files</li>\n<li>Remove unnecessary inodes?</li>\n<li>Explain why dpkg -l | grep linux-image does not return the same results as what I see in my grub2 listing during boot</li>\n<li>Explain rc vs ii in the dpkg -l | grep linux-image listing</li>\n<li>Explain the discrepancy between entries in /usr/src directory (or wherever these files are found in other Ubuntu versions) and the above two methods of determining excess kernel versions.</li>\n<li>What are the ramifications of a complete cleanup of older kernels. Do I need to worry about dependencies? How do I know if any apps on my computer are dependent on the configurations files of older kernels.</li>\n</ol>\n\n<p>What I don't want:</p>\n\n<ul>\n<li>Links to other answers that you have not personally tested or do not address ALL the issues involved in a complete cleanup. </li>\n<li>Any answer you have not personally tested.</li>\n<li>Scripts that attempt to automatically clean everything at once. I just want to do this manually until I fully understand everything that is going on.</li>\n</ul>\n\n<p>Let's please try to stop the bu!!sh!t and actually get a comprehensive solution to the kernel buildup problem. I am currently playing with an older version of Ubuntu (10.04) before I upgrade, but I have had the same problem with Ubuntu 12.04. If the solution is different for different versions, please state the version you used to test your solution.</p>\n\n<p>What works:</p>\n\n<pre><code>uname -r\n</code></pre>\n\n<p>This correctly returns the kernel version I am currently using.</p>\n\n<p>Things that don't work:</p>\n\n<pre><code>sudo apt-get autoremove\nsudo apt-get clean\nsudo apt-get autoremove linux-image-x.x.xx-xx-generic\n</code></pre>\n\n<p>What I thought should work, but did not:</p>\n\n<pre><code>sudo apt-get purge linux-image-x.x.xx-xx-generic\n</code></pre>\n\n<p>This worked to diminish the list generated by <code>dpkg -l | grep linux-image</code>:</p>\n\n<pre><code>sudo dpkg --purge linux-image-x.x.xx-xx-generic\n</code></pre>\n\n<p>Also here is a head start on the <code>rc/ii</code> issue:</p>\n\n<p><code>ii</code> means 'It should be installed and it is installed' whereas\n<code>rc</code> means 'It's removed/uninstalled but it's configuration files are still there'.</p>\n\n<p>I think this addresses the issue between the discrepancy between the terminal listing and the grub2 menu at bootup. As I recall, the <code>ii</code> listings match the grub2 listing. The question here is how did the <code>ii</code> entries get there in the first place?</p>\n\n<p>Thanks to all who are willing to put real answers here that actually work so people can come to just one location and get the entire job done.</p>\n","related_questions":[{"id":701235,"title":"Grub corrupted after removing old kernels","body":"<p>Recently I started getting these error messages on my Ubuntu 14.04 saying that my systemfile disk running low on memory. </p>\n\n<p>So I did some research that I need to delete some old kernels, so I checked the kernels that are there, and I did: </p>\n\n<p><code>sudo apt-get autoremove linux-image-xxxx</code></p>\n\n<p>I am pretty sure, I only removed old kernels not the last two which exist on the list of kernels. </p>\n\n<p>Now when I start my system, on the Grub menu I don't see anything related to Linux kernel, it looks like bootloader got corrupted. I almost sure that I have the latest kernel, cause I always do all the updated regularly, is there anything I can add to the bootloader to fix it.<br>\nHere is a link to the info i got when I run boot-repair tool\n<a href=\"http://paste.ubuntu.com/13490592/\" rel=\"nofollow\">boot-repair-info</a></p>\n"},{"id":697054,"title":"How to stop booting to an old kernel version?","body":"<p>My Ubuntu system keeps booting to an old kernel version. I think I fiddled with it a while ago and can't figure out how to just have it go back to booting to the latest version installed.</p>\n\n<p>When I boot it always shows the grub2 menu and when I go into advanced I see kernel version 53 at the top of the list and the following older versions below it: 52, 51, 50, 49 and 48. I can't choose anything more recent than 53.</p>\n\n<p>Here's a pastebin with <code>/etc/default/grub</code> and <code>/boot/grub/grub.cfg</code>: <a href=\"http://paste.ubuntu.com/13245586/\" rel=\"nofollow\">http://paste.ubuntu.com/13245586/</a></p>\n\n<p>Here is some more info:</p>\n\n<pre><code>$ cat /proc/version\nLinux version 3.13.0-53-generic (buildd@phianna) (gcc version 4.8.2 (Ubuntu 4.8.2-19ubuntu1) ) #89-Ubuntu SMP Wed May 20 10:34:39 UTC 2015\n$\n$ ls -la /boot/\ntotal 359516\ndrwxrwxr-x  3 root root     4096 Nov  5 22:09 .\ndrwxr-xr-x 28 root root     4096 Nov 11 23:22 ..\n-rw-r--r--  1 root root  1164723 Mar 24  2015 abi-3.13.0-49-generic\n-rw-r--r--  1 root root  1164671 May 20 04:11 abi-3.13.0-53-generic\n-rw-r--r--  1 root root  1164806 May 26 13:11 abi-3.13.0-54-generic\n-rw-r--r--  1 root root  1164806 Jun 17 18:03 abi-3.13.0-55-generic\n-rw-r--r--  1 root root  1164984 Jun 19 03:04 abi-3.13.0-57-generic\n-rw-r--r--  1 root root  1165129 Jul  7 20:53 abi-3.13.0-58-generic\n-rw-r--r--  1 root root  1165129 Jul 29 05:35 abi-3.13.0-61-generic\n-rw-r--r--  1 root root  1165261 Aug 11 09:15 abi-3.13.0-62-generic\n-rw-r--r--  1 root root  1165204 Aug 14 16:07 abi-3.13.0-63-generic\n-rw-r--r--  1 root root  1165204 Oct  2 16:53 abi-3.13.0-65-generic\n-rw-r--r--  1 root root  1165260 Oct  7 09:34 abi-3.13.0-66-generic\n-rw-r--r--  1 root root  1165260 Oct 23 07:39 abi-3.13.0-67-generic\n-rw-r--r--  1 root root   165773 Mar 24  2015 config-3.13.0-49-generic\n-rw-r--r--  1 root root   165762 May 20 04:11 config-3.13.0-53-generic\n-rw-r--r--  1 root root   165762 May 26 13:11 config-3.13.0-54-generic\n-rw-r--r--  1 root root   165762 Jun 17 18:03 config-3.13.0-55-generic\n-rw-r--r--  1 root root   165762 Jun 19 03:04 config-3.13.0-57-generic\n-rw-r--r--  1 root root   165762 Jul  7 20:53 config-3.13.0-58-generic\n-rw-r--r--  1 root root   165763 Jul 29 05:35 config-3.13.0-61-generic\n-rw-r--r--  1 root root   165763 Aug 11 09:15 config-3.13.0-62-generic\n-rw-r--r--  1 root root   165763 Aug 14 16:07 config-3.13.0-63-generic\n-rw-r--r--  1 root root   165763 Oct  2 16:53 config-3.13.0-65-generic\n-rw-r--r--  1 root root   165763 Oct  7 09:34 config-3.13.0-66-generic\n-rw-r--r--  1 root root   165763 Oct 23 07:39 config-3.13.0-67-generic\ndrwxr-xr-x  2 root root     4096 Nov  5 22:10 grub\n-rw-r--r--  1 root root 20007897 Apr  8  2015 initrd.img-3.13.0-49-generic\n-rw-r--r--  1 root root 20128409 Jun  2 23:04 initrd.img-3.13.0-53-generic\n-rw-r--r--  1 root root 20128375 Jun 13 14:56 initrd.img-3.13.0-54-generic\n-rw-r--r--  1 root root 20129960 Jun 23 21:40 initrd.img-3.13.0-55-generic\n-rw-r--r--  1 root root 20130591 Jul  8 22:21 initrd.img-3.13.0-57-generic\n-rw-r--r--  1 root root 20132619 Jul 24 22:45 initrd.img-3.13.0-58-generic\n-rw-r--r--  1 root root 20131894 Aug 12 22:36 initrd.img-3.13.0-61-generic\n-rw-r--r--  1 root root 20134255 Aug 19 22:39 initrd.img-3.13.0-62-generic\n-rw-r--r--  1 root root 20133923 Sep 26 21:50 initrd.img-3.13.0-63-generic\n-rw-r--r--  1 root root 20133650 Oct 15 22:19 initrd.img-3.13.0-65-generic\n-rw-r--r--  1 root root 20136415 Oct 23 19:05 initrd.img-3.13.0-66-generic\n-rw-r--r--  1 root root 20133100 Nov  5 22:09 initrd.img-3.13.0-67-generic\n-rw-------  1 root root  3389437 Mar 24  2015 System.map-3.13.0-49-generic\n-rw-------  1 root root  3390132 May 20 04:11 System.map-3.13.0-53-generic\n-rw-------  1 root root  3390881 May 26 13:11 System.map-3.13.0-54-generic\n-rw-------  1 root root  3390881 Jun 17 18:03 System.map-3.13.0-55-generic\n-rw-------  1 root root  3391581 Jun 19 03:04 System.map-3.13.0-57-generic\n-rw-------  1 root root  3391763 Jul  7 20:53 System.map-3.13.0-58-generic\n-rw-------  1 root root  3391819 Jul 29 05:35 System.map-3.13.0-61-generic\n-rw-------  1 root root  3392306 Aug 11 09:15 System.map-3.13.0-62-generic\n-rw-------  1 root root  3392068 Aug 14 16:07 System.map-3.13.0-63-generic\n-rw-------  1 root root  3392068 Oct  2 16:53 System.map-3.13.0-65-generic\n-rw-------  1 root root  3392380 Oct  7 09:34 System.map-3.13.0-66-generic\n-rw-------  1 root root  3392383 Oct 23 07:39 System.map-3.13.0-67-generic\n-rw-------  1 root root  5815264 Mar 24  2015 vmlinuz-3.13.0-49-generic\n-rw-------  1 root root  5821152 May 20 04:11 vmlinuz-3.13.0-53-generic\n-rw-------  1 root root  5821664 May 26 13:11 vmlinuz-3.13.0-54-generic\n-rw-------  1 root root  5821984 Jun 17 18:03 vmlinuz-3.13.0-55-generic\n-rw-------  1 root root  5820800 Jun 19 03:04 vmlinuz-3.13.0-57-generic\n-rw-------  1 root root  5823136 Jul  7 20:53 vmlinuz-3.13.0-58-generic\n-rw-------  1 root root  5822208 Jul 29 05:35 vmlinuz-3.13.0-61-generic\n-rw-------  1 root root  5820896 Aug 11 09:15 vmlinuz-3.13.0-62-generic\n-rw-------  1 root root  5821152 Aug 14 16:07 vmlinuz-3.13.0-63-generic\n-rw-------  1 root root  5820640 Oct  2 16:53 vmlinuz-3.13.0-65-generic\n-rw-------  1 root root  5820544 Oct  7 09:34 vmlinuz-3.13.0-66-generic\n-rw-------  1 root root  5822368 Oct 23 07:39 vmlinuz-3.13.0-67-generic\n$\n$ cat /etc/default/grub\n# If you change this file, run 'update-grub' afterwards to update\n# /boot/grub/grub.cfg.\n# For full documentation of the options in this file, see:\n#   info -f grub -n 'Simple configuration'\n\nGRUB_DEFAULT=0\nGRUB_HIDDEN_TIMEOUT=0\nGRUB_HIDDEN_TIMEOUT_QUIET=true\nGRUB_TIMEOUT=10\nGRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || echo Debian`\nGRUB_CMDLINE_LINUX_DEFAULT=\"quiet splash\"\nGRUB_CMDLINE_LINUX=\"\"\n\n# Uncomment to enable BadRAM filtering, modify to suit your needs\n# This works with Linux (no patch required) and with any kernel that obtains\n# the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...)\n#GRUB_BADRAM=\"0x01234567,0xfefefefe,0x89abcdef,0xefefefef\"\n\n# Uncomment to disable graphical terminal (grub-pc only)\n#GRUB_TERMINAL=console\n\n# The resolution used on graphical terminal\n# note that you can use only modes which your graphic card supports via VBE\n# you can see them in real GRUB with the command `vbeinfo'\n#GRUB_GFXMODE=640x480\n\n# Uncomment if you don't want GRUB to pass \"root=UUID=xxx\" parameter to Linux\n#GRUB_DISABLE_LINUX_UUID=true\n\n# Uncomment to disable generation of recovery mode menu entries\n#GRUB_DISABLE_RECOVERY=\"true\"\n\n# Uncomment to get a beep at grub start\n#GRUB_INIT_TUNE=\"480 440 1\"\n$\n$ sudo update-grub\nGenerating grub configuration file ...\nWarning: Setting GRUB_TIMEOUT to a non-zero value when GRUB_HIDDEN_TIMEOUT is set is no longer supported.\nFound linux image: /boot/vmlinuz-3.13.0-67-generic\nFound initrd image: /boot/initrd.img-3.13.0-67-generic\nFound linux image: /boot/vmlinuz-3.13.0-66-generic\nFound initrd image: /boot/initrd.img-3.13.0-66-generic\nFound linux image: /boot/vmlinuz-3.13.0-65-generic\nFound initrd image: /boot/initrd.img-3.13.0-65-generic\nFound linux image: /boot/vmlinuz-3.13.0-63-generic\nFound initrd image: /boot/initrd.img-3.13.0-63-generic\nFound linux image: /boot/vmlinuz-3.13.0-62-generic\nFound initrd image: /boot/initrd.img-3.13.0-62-generic\nFound linux image: /boot/vmlinuz-3.13.0-61-generic\nFound initrd image: /boot/initrd.img-3.13.0-61-generic\nFound linux image: /boot/vmlinuz-3.13.0-58-generic\nFound initrd image: /boot/initrd.img-3.13.0-58-generic\nFound linux image: /boot/vmlinuz-3.13.0-57-generic\nFound initrd image: /boot/initrd.img-3.13.0-57-generic\nFound linux image: /boot/vmlinuz-3.13.0-55-generic\nFound initrd image: /boot/initrd.img-3.13.0-55-generic\nFound linux image: /boot/vmlinuz-3.13.0-54-generic\nFound initrd image: /boot/initrd.img-3.13.0-54-generic\nFound linux image: /boot/vmlinuz-3.13.0-53-generic\nFound initrd image: /boot/initrd.img-3.13.0-53-generic\nFound linux image: /boot/vmlinuz-3.13.0-49-generic\nFound initrd image: /boot/initrd.img-3.13.0-49-generic\ndone\n</code></pre>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I found there is another small 255mb partition on my hard drive. I mounted it and did ls on it. It seems I have two installations of grub and the one being used is on this small partition. Is this normal? What should I do to fix this?</p>\n\n<pre><code>ls -la /media/jabrams/3241b98f-b24e-4699-8a73-7b29a95bd5cd/\ntotal 150315\ndrwxr-xr-x  4 root root     3072 May 22 23:03 .\ndrwxr-x---+ 3 root root     4096 Nov 12 22:33 ..\n-rw-r--r--  1 root root  1164723 Mar 12  2015 abi-3.13.0-48-generic\n-rw-r--r--  1 root root  1164723 Apr 10  2015 abi-3.13.0-49-generic\n-rw-r--r--  1 root root  1164671 Apr 15  2015 abi-3.13.0-51-generic\n-rw-r--r--  1 root root  1164671 May  3  2015 abi-3.13.0-52-generic\n-rw-r--r--  1 root root  1164671 May 20 04:11 abi-3.13.0-53-generic\n-rw-r--r--  1 root root   165773 Mar 12  2015 config-3.13.0-48-generic\n-rw-r--r--  1 root root   165773 Apr 10  2015 config-3.13.0-49-generic\n-rw-r--r--  1 root root   165762 Apr 15  2015 config-3.13.0-51-generic\n-rw-r--r--  1 root root   165762 May  3  2015 config-3.13.0-52-generic\n-rw-r--r--  1 root root   165762 May 20 04:11 config-3.13.0-53-generic\ndrwxr-xr-x  5 root root     1024 May 22 23:03 grub\n-rw-r--r--  1 root root 20008474 Mar 23  2015 initrd.img-3.13.0-48-generic\n-rw-r--r--  1 root root 20007214 Apr 30  2015 initrd.img-3.13.0-49-generic\n-rw-r--r--  1 root root 20005543 May  2  2015 initrd.img-3.13.0-51-generic\n-rw-r--r--  1 root root 20007376 May  8  2015 initrd.img-3.13.0-52-generic\n-rw-r--r--  1 root root 20005275 May 22 23:03 initrd.img-3.13.0-53-generic\ndrwx------  2 root root    12288 Apr 19  2014 lost+found\n-rw-r--r--  1 root root   176500 Mar 12  2014 memtest86+.bin\n-rw-r--r--  1 root root   178176 Mar 12  2014 memtest86+.elf\n-rw-r--r--  1 root root   178680 Mar 12  2014 memtest86+_multiboot.bin\n-rw-------  1 root root  3389235 Mar 12  2015 System.map-3.13.0-48-generic\n-rw-------  1 root root  3389437 Apr 10  2015 System.map-3.13.0-49-generic\n-rw-------  1 root root  3389875 Apr 15  2015 System.map-3.13.0-51-generic\n-rw-------  1 root root  3389875 May  3  2015 System.map-3.13.0-52-generic\n-rw-------  1 root root  3390132 May 20 04:11 System.map-3.13.0-53-generic\n-rw-------  1 root root  5815680 Mar 12  2015 vmlinuz-3.13.0-48-generic\n-rw-------  1 root root  5815392 Apr 10  2015 vmlinuz-3.13.0-49-generic\n-rw-------  1 root root  5818368 Apr 15  2015 vmlinuz-3.13.0-51-generic\n-rw-------  1 root root  5818592 May  3  2015 vmlinuz-3.13.0-52-generic\n-rw-------  1 root root  5821152 May 20 04:11 vmlinuz-3.13.0-53-generic\n</code></pre>\n"},{"id":647171,"title":"Cannot apt upgrade due to kernel package problems","body":"<p>an Ubuntu 14.04 LTS user here.</p>\n\n<p>Basically I had a problem when running</p>\n\n<pre><code>sudo apt-get update\nsudo apt-get upgrade\n</code></pre>\n\n<p>An error code was returned by dpkg because the Linux kernel package 3.13.0.57 was being marked as \"not fully installed\": </p>\n\n<pre><code>Errors were encountered while processing:\n linux-image-3.13.0.57-generic\n linux-image-extra-3.13.0-57-generic\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n</code></pre>\n\n<p>I typed <strong>uname -r</strong> in order to see what the current version of my system kernel is and surprisingly it was <strong>3.13.0.57</strong>. Afterwards I rebooted the system and entered grub to list all of the installed linux kernels and saw that I have <strong>3.8.0-35-generic</strong> so I booted in with it to try to reinstall the 3.13.0.57 version. <em>I do not have any clue why by default Ubuntu 14.04 boots with 3.13.0.57 when 3.8.0-35 is available.</em></p>\n\n<p>After I had successfully booted with <strong>3.8.0</strong> I listed once again all of the kernels I have with dpkg in order to be sure that <strong>3.13.0-57</strong> exists.</p>\n\n<pre><code>sudo dpkg --list | grep linux-image\nsudo apt-get purge linux-image-3.13.0.57-generic\nsudo apt-get purge linux-image-extra-3.13.0-57-generic\n</code></pre>\n\n<p>But the extra image package cannot be removed, while the pure linux image can:</p>\n\n<pre><code>Errors were encountered while processing:\n linux-image-extra-3.13.0-57-generic\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n</code></pre>\n\n<p>Any ideas how to fix this? I searched and saw that a possible lack of space on the boot partition can cause this type of problem but I think my case is different. I managed to clear 4-5 old kernels manually in order to be sure that I have freed enough space on the boot partition.</p>\n\n<p><strong><em>Edit 1:</strong> I saw that Ubuntu 14.04.2 ships with Linux Kernel 3.16.x but I do not have it. The newest one I have is 3.8.0-35 and then comes 3.13.0-57.</em></p>\n\n<p><strong><em>Edit 2:</strong> Running <code>sudo apt-get autoremove</code> or <code>sudo apt-get dist-upgrade</code> does not help. It seems that I cannot run any upgrades. Here is the log of <code>sudo apt-get autoremove</code>:</em></p>\n\n<pre><code>    $ sudo apt-get autoremove\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nThe following packages will be REMOVED:\n  linux-image-extra-3.13.0-57-generic\n0 upgraded, 0 newly installed, 1 to remove and 0 not upgraded.\n2 not fully installed or removed.\nAfter this operation, 152 MB disk space will be freed.\nDo you want to continue? [Y/n] y\n(Reading database ... 747752 files and directories currently installed.)\nRemoving linux-image-extra-3.13.0-57-generic (3.13.0-57.95) ...\ndepmod: FATAL: could not load /boot/System.map-3.13.0-57-generic: No such file or directory\nrun-parts: executing /etc/kernel/postinst.d/apt-auto-removal 3.13.0-57-generic /boot/vmlinuz-3.13.0-57-generic\nrun-parts: executing /etc/kernel/postinst.d/dkms 3.13.0-57-generic /boot/vmlinuz-3.13.0-57-generic\nrun-parts: executing /etc/kernel/postinst.d/initramfs-tools 3.13.0-57-generic /boot/vmlinuz-3.13.0-57-generic\nupdate-initramfs: Generating /boot/initrd.img-3.13.0-57-generic\ngrep: /boot/config-3.13.0-57-generic: No such file or directory\nrun-parts: executing /etc/kernel/postinst.d/pm-utils 3.13.0-57-generic /boot/vmlinuz-3.13.0-57-generic\nrun-parts: executing /etc/kernel/postinst.d/update-notifier 3.13.0-57-generic /boot/vmlinuz-3.13.0-57-generic\nrun-parts: executing /etc/kernel/postinst.d/zz-runlilo 3.13.0-57-generic /boot/vmlinuz-3.13.0-57-generic\nFatal: open /boot/vmlinuz-3.13.0-46-generic.efi.signed: No such file or directory\nrun-parts: /etc/kernel/postinst.d/zz-runlilo exited with return code 1\ndpkg: error processing package linux-image-extra-3.13.0-57-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nErrors were encountered while processing:\n linux-image-extra-3.13.0-57-generic\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n</code></pre>\n\n<p>I don't know what this - <code>Fatal: open /boot/vmlinuz-3.13.0-46-generic.efi.signed: No such file or directory</code> has to do with removing 3.13.0-57.</p>\n"},{"id":652299,"title":"Need help removing linux-image-3.16.0-34-generic and linux-image-extra-3.16.0-34-generic","body":"<p>So I feel like a dunce having to post about this but, I need help trying to fix this issue, mostly because without the fix I can't install any new software or run updates. For some reason one of the kernals must not have been fully uninstalled (linux-image-3.16.0-34-generic), so I tried to do the first thing that came to mind: apt-get -f install... That fails and gives this: </p>\n\n<pre><code>cictrone@cictrone:~$ sudo apt-get -f install\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nThe following packages will be REMOVED:\n  linux-image-3.16.0-34-generic linux-image-extra-3.16.0-34-generic\n0 upgraded, 0 newly installed, 2 to remove and 14 not upgraded.\n7 not fully installed or removed.\nAfter this operation, 201 MB disk space will be freed.\nDo you want to continue? [Y/n] Y\n(Reading database ... 241430 files and directories currently installed.)\nRemoving linux-image-extra-3.16.0-34-generic (3.16.0-34.47~14.04.1) ...\ndepmod: ERROR: could not open directory /lib/modules/3.16.0-34-generic:No such file or directory\ndepmod: FATAL: could not search modules: No such file or directory\nrun-parts: executing /etc/kernel/postinst.d/apt-auto-removal 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nrun-parts: executing /etc/kernel/postinst.d/dkms 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nError! echo\nYour kernel headers for kernel 3.16.0-34-generic cannot be found at\n/lib/modules/3.16.0-34-generic/build or /lib/modules/3.16.0-34-generic/source.\nrun-parts: executing /etc/kernel/postinst.d/initramfs-tools 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nupdate-initramfs: Generating /boot/initrd.img-3.16.0-34-generic\ngrep: /boot/config-3.16.0-34-generic: No such file or directory\nWARNING: missing /lib/modules/3.16.0-34-generic\nDevice driver support needs thus be built-in linux image!\ndepmod: ERROR: could not open directory /lib/modules/3.16.0-34-generic: No such file or directory\ndepmod: FATAL: could not search modules: No such file or directory\ndepmod: WARNING: could not open /tmp/mkinitramfs_raVmra/lib/modules/3.16.0-34-generic/modules.order: No such file or directory\ndepmod: WARNING: could not open /tmp/mkinitramfs_raVmra/lib/modules/3.16.0-34-generic/modules.builtin: No such file or directory\nrun-parts: executing /etc/kernel/postinst.d/pm-utils 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nrun-parts: executing /etc/kernel/postinst.d/update-notifier 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nrun-parts: executing /etc/kernel/postinst.d/zz-update-grub 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\n/usr/sbin/grub-mkconfig: 39: /etc/default/grub: desktop-image=/home    /cictrone/Pictures/grub-splash.jpg: not found\nrun-parts: /etc/kernel/postinst.d/zz-update-grub exited with return code 127\ndpkg: error processing package linux-image-extra-3.16.0-34-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nRemoving linux-image-3.16.0-34-generic (3.16.0-34.47~14.04.1) ...\nExamining /etc/kernel/postrm.d .\nrun-parts: executing /etc/kernel/postrm.d/initramfs-tools 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nupdate-initramfs: Deleting /boot/initrd.img-3.16.0-34-generic\nrun-parts: executing /etc/kernel/postrm.d/zz-update-grub 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\n/usr/sbin/grub-mkconfig: 39: /etc/default/grub: desktop-image=/home/cictrone/Pictures/grub-splash.jpg: not found\nrun-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 127\nFailed to process /etc/kernel/postrm.d at /var/lib/dpkg/info/linux-image-3.16.0-34-generic.postrm line 328.\ndpkg: error processing package linux-image-3.16.0-34-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nErrors were encountered while processing:\n linux-image-extra-3.16.0-34-generic\n linux-image-3.16.0-34-generic\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n</code></pre>\n\n<p>I've also tried:</p>\n\n<ol>\n<li>sudo dpkg -C</li>\n<li>sudo apt-get autoremove</li>\n<li>sudo dpkg --remove</li>\n<li>sudo dpkg --configure -a</li>\n<li>sudo dpkg --remove  --force-remove-reinstreq</li>\n<li>sudo apt-get autoclean</li>\n</ol>\n\n<p>The output of my uname -r:</p>\n\n<pre><code>3.16.0-41-generic\n</code></pre>\n\n<p>The output of Terrance's suggestion:</p>\n\n<pre><code>cictrone@cictrone:~$ sudo apt-get install linux-image-3.16.0-34-generic linux-headers-3.16.0-34-generic linux-image-extra-3.16.0-34-generic\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nlinux-headers-3.16.0-34-generic is already the newest version.\nlinux-image-3.16.0-34-generic is already the newest version.    \nlinux-image-extra-3.16.0-34-generic is already the newest version.\n0 upgraded, 0 newly installed, 0 to remove and 14 not upgraded.\n7 not fully installed or removed.\nNeed to get 0 B/53.9 MB of archives.\nAfter this operation, 0 B of additional disk space will be used.\nDo you want to continue? [Y/n] Y\ndpkg: error processing package linux-image-3.16.0-34-generic (--configure):\n package linux-image-3.16.0-34-generic is not ready for configuration\n cannot configure (current status `half-installed')\nSetting up linux-image-3.16.0-43-generic (3.16.0-43.58~14.04.1) ...\nRunning depmod.\nupdate-initramfs: deferring update (hook will be called later)\ninitrd.img(/boot/initrd.img-3.16.0-43-generic) points to /boot/initrd.img-3.16.0-43-generic\n (/boot/initrd.img-3.16.0-43-generic) -- doing nothing at /var/lib/dpkg/info/linux-image-3.16.0-43-generic.postinst line 491.\nvmlinuz(/boot/vmlinuz-3.16.0-43-generic) points to /boot/vmlinuz-3.16.0-43-generic\n (/boot/vmlinuz-3.16.0-43-generic) -- doing nothing at /var/lib/dpkg/info/linux-image-3.16.0-43-generic.postinst line 491.\nExamining /etc/kernel/postinst.d.\nrun-parts: executing /etc/kernel/postinst.d/apt-auto-removal 3.16.0-43-generic /boot/vmlinuz-3.16.0-43-generic\nrun-parts: executing /etc/kernel/postinst.d/dkms 3.16.0-43-generic /boot/vmlinuz-3.16.0-43-generic\nrun-parts: executing /etc/kernel/postinst.d/initramfs-tools 3.16.0-43-generic /boot/vmlinuz-3.16.0-43-generic\nupdate-initramfs: Generating /boot/initrd.img-3.16.0-43-generic\nrun-parts: executing /etc/kernel/postinst.d/pm-utils 3.16.0-43-generic /boot/vmlinuz-3.16.0-43-generic\nrun-parts: executing /etc/kernel/postinst.d/update-notifier 3.16.0-43-generic /boot/vmlinuz-3.16.0-43-generic\nrun-parts: executing /etc/kernel/postinst.d/zz-update-grub 3.16.0-43-generic /boot/vmlinuz-3.16.0-43-generic\n/usr/sbin/grub-mkconfig: 39: /etc/default/grub: desktop-image=/home/cictrone/Pictures/grub-splash.jpg: not found\nrun-parts: /etc/kernel/postinst.d/zz-update-grub exited with return code 127\nFailed to process /etc/kernel/postinst.d at /var/lib/dpkg/info/linux-image-3.16.0-43-generic.postinst line 1025.\ndpkg: error processing package linux-image-3.16.0-43-generic (--configure):\n subprocess installed post-installation script returned error exit status 2\nSetting up grub-pc (2.02~beta2-9ubuntu1.3+elementary10~ubuntu0.3.1) ...\n/var/lib/dpkg/info/grub-pc.config: 39: /etc/default/grub: desktop-image=/home/cictrone/Pictures/grub-splash.jpg: not found\ndpkg: error processing package grub-pc (--configure):\n subprocess installed post-installation script returned error exit status 127\ndpkg: dependency problems prevent configuration of linux-image-extra-3.16.0-43-generic:\n linux-image-extra-3.16.0-43-generic depends on linux-image-3.16.0-43-generic; however:\n  Package linux-image-3.16.0-43-generic is not configured yet.\n\ndpkg: error processing package linux-image-extra-3.16.0-43-generic (--configure):\n dependency problems - leaving unconfigured\ndpkg: dependency problems prevent configuration of linux-image-generic-lts-utopic:\n linux-image-generic-lts-utopic depends on linux-image-3.16.0-43-generic; however:\n  Package linux-image-3.16.0-43-generic is not configured yet.\n linux-image-generic-lts-utopic depends on linux-image-extra-3.16.0-43-generic; however:\n  Package linux-image-extra-3.16.0-43-generic is not configured yet.\n\ndpkg: error processing package linux-image-generic-lts-utopic (--configure):\n dependency problems - leaving unconfigured\ndpkg: dependency problems prevent configuration of linux-generic-lts-utopic:\n linux-generic-lts-utopic depends on linux-image-generic-No apport report written because MaxReports is reached already\n No apport report written because MaxReports is reached already\n No apport report written because MaxReports is reached already\n No apport report written because MaxReports is reached already\nlts-utopic (= 3.16.0.43.34); however:\n Package linux-image-generic-lts-utopic is not configured yet.\ndpkg: error processing package linux-generic-lts-utopic (--configure):\n dependency problems - leaving unconfigured\ndpkg: error processing package linux-image-extra-3.16.0-34-generic (--configure):\n package linux-image-extra-3.16.0-34-generic is not ready for configuration\n cannot configure (current status `half-installed')\n    Errors were encountered while processing:\n     linux-image-3.16.0-34-generic\n     linux-image-3.16.0-43-generic\n     grub-pc\n     linux-image-extra-3.16.0-43-generic\n     linux-image-generic-lts-utopic\n     linux-generic-lts-utopic\n     linux-image-extra-3.16.0-34-generic\n    E: Sub-process /usr/bin/dpkg returned an error code (1)\n</code></pre>\n\n<p>The following is the output from the remove command after issueing the reinstall command (apt-get):</p>\n\n<pre><code>cictrone@cictrone:~$ sudo apt-get remove linux-image-3.16.0-34-generic linux-headers-3.16.0-34-generic linux-image-extra-3.16.0-34-generic\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nThe following package was automatically installed and is no longer required:\n  linux-headers-3.16.0-34\nUse 'apt-get autoremove' to remove it.\nThe following packages will be REMOVED:\n  linux-headers-3.16.0-34-generic linux-image-3.16.0-34-generic\n  linux-image-extra-3.16.0-34-generic\n0 upgraded, 0 newly installed, 3 to remove and 15 not upgraded.\n7 not fully installed or removed.\nAfter this operation, 215 MB disk space will be freed.\nDo you want to continue? [Y/n] Y\n(Reading database ... 271286 files and directories currently installed.)\nRemoving linux-image-extra-3.16.0-34-generic (3.16.0-34.47~14.04.1) ...\nrun-parts: executing /etc/kernel/postinst.d/apt-auto-removal 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nrun-parts: executing /etc/kernel/postinst.d/dkms 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nrun-parts: executing /etc/kernel/postinst.d/initramfs-tools 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nupdate-initramfs: Generating /boot/initrd.img-3.16.0-34-generic\nrun-parts: executing /etc/kernel/postinst.d/pm-utils 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nrun-parts: executing /etc/kernel/postinst.d/update-notifier 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nrun-parts: executing /etc/kernel/postinst.d/zz-update-grub 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\n/usr/sbin/grub-mkconfig: 39: /etc/default/grub: desktop-image=/home/cictrone/Pictures/grub-splash.jpg: not found\nrun-parts: /etc/kernel/postinst.d/zz-update-grub exited with return code 127\ndpkg: error processing package linux-image-extra-3.16.0-34-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nRemoving linux-image-3.16.0-34-generic (3.16.0-34.47~14.04.1) ...\nExamining /etc/kernel/prerm.d.\nrun-parts: executing /etc/kernel/prerm.d/dkms 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\ndkms: removing: bcmwl 6.30.223.248+bdcom (3.16.0-34-generic) (x86_64)\n\n-------- Uninstall Beginning --------\nModule:  bcmwl\nVersion: 6.30.223.248+bdcom\nKernel:  3.16.0-34-generic (x86_64)\n-------------------------------------\n\nStatus: Before uninstall, this module version was ACTIVE on this kernel.\n\nwl.ko:\n - Uninstallation\n   - Deleting from: /lib/modules/3.16.0-34-generic/extra/\n - Original module\n   - No original module was found for this module on this kernel.\n   - Use the dkms install command to reinstall any previous module version.\n\ndepmod....\n\nDKMS: uninstall completed.\nExamining /etc/kernel/postrm.d .\nrun-parts: executing /etc/kernel/postrm.d/initramfs-tools 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\nupdate-initramfs: Deleting /boot/initrd.img-3.16.0-34-generic\nrun-parts: executing /etc/kernel/postrm.d/zz-update-grub 3.16.0-34-generic /boot/vmlinuz-3.16.0-34-generic\n/usr/sbin/grub-mkconfig: 39: /etc/default/grub: desktop-image=/home/cictrone/Pictures/grub-splash.jpg: not found\nrun-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 127\nFailed to process /etc/kernel/postrm.d at /var/lib/dpkg/info/linux-image-3.16.0-34-generic.postrm line 328.\ndpkg: error processing package linux-image-3.16.0-34-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nRemoving linux-headers-3.16.0-34-generic (3.16.0-34.47~14.04.1) ...\nErrors were encountered while processing:\n linux-image-extra-3.16.0-34-generic\n linux-image-3.16.0-34-generic\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n</code></pre>\n\n<p>These ubuntu tweaks tool (was able to get it installed) also sees the kernel but gives same errors as the terminal.</p>\n\n<p>Any help is appreciated, thanks.</p>\n\n<p>****Solved****</p>\n\n<p>It turned out that the kernel issue wasn't the cause of holding aptitude up. It was actually grub.The line in particular :</p>\n\n<pre><code>/usr/sbin/grub-mkconfig: 39: /etc/default/grub: desktop-image=/home/cictrone/Pictures/grub-splash.jpg: not found\n</code></pre>\n\n<p>I went it to the file and deleted the line with the problem and then ran Terrence's suggestions and everything is fixed! Thanks Everyone.</p>\n"},{"id":639363,"title":"Cleaning old kernels does not work","body":"<p>I am a new Ubuntu user, so please have patience.</p>\n\n<p>It all started when my <code>/root</code> partition became full. It was obviously too small and I will have to resize. I tried to remove kernels using Synaptic and various commands in the Terminal without success. This is latest output:</p>\n\n<pre><code>$ dpkg --list | grep linux-image\nii  linux-image-3.16.0-30-generic                               3.16.0-30.40~14.04.1                                amd64        Linux kernel image for version 3.16.0 on 64 bit x86 SMP\nii  linux-image-3.16.0-36-generic                               3.16.0-36.48~14.04.1                                amd64        Linux kernel image for version 3.16.0 on 64 bit x86 SMP\nii  linux-image-3.16.0-37-generic                               3.16.0-37.51~14.04.1                                amd64        Linux kernel image for version 3.16.0 on 64 bit x86 SMP\nii  linux-image-3.16.0-38-generic                               3.16.0-38.52~14.04.1                                amd64        Linux kernel image for version 3.16.0 on 64 bit x86 SMP\nii  linux-image-3.16.0-40-generic                               3.16.0-40.54~14.04.1                                amd64        Linux kernel image for version 3.16.0 on 64 bit x86 SMP\nii  linux-image-extra-3.16.0-30-generic                         3.16.0-30.40~14.04.1                                amd64        Linux kernel extra modules for version 3.16.0 on 64 bit x86 SMP\nii  linux-image-extra-3.16.0-36-generic                         3.16.0-36.48~14.04.1                                amd64        Linux kernel extra modules for version 3.16.0 on 64 bit x86 SMP\nii  linux-image-extra-3.16.0-37-generic                         3.16.0-37.51~14.04.1                                amd64        Linux kernel extra modules for version 3.16.0 on 64 bit x86 SMP\nii  linux-image-extra-3.16.0-38-generic                         3.16.0-38.52~14.04.1                                amd64        Linux kernel extra modules for version 3.16.0 on 64 bit x86 SMP\niF  linux-image-extra-3.16.0-40-generic                         3.16.0-40.54~14.04.1                                amd64        Linux kernel extra modules for version 3.16.0 on 64 bit x86 SMP\nrH  linux-image-extra-3.16.0-41-generic                         3.16.0-41.55~14.04.1                                amd64        Linux kernel extra modules for version 3.16.0 on 64 bit x86 SMP\n\n$ sudo apt-get purge linux-image-extra-3.16.0.30-generic\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nNote, selecting 'linux-image-extra-3.16.0-30-generic' for regex 'linux-image-extra-3.16.0.30-generic'\nThe following packages were automatically installed and are no longer required:\n  account-plugin-windows-live cabextract kde-l10n-engb libllvm3.4 libupstart1\n  linux-headers-generic-lts-utopic smplayer-translations\nUse 'apt-get autoremove' to remove them.\nThe following packages will be REMOVED:\n  linux-image-extra-3.16.0-30-generic* linux-image-extra-3.16.0-41-generic\n  linux-signed-image-3.16.0-30-generic*\n0 upgraded, 0 newly installed, 3 to remove and 44 not upgraded.\n3 not fully installed or removed.\nAfter this operation, 313 MB disk space will be freed.\nDo you want to continue? [Y/n] y\n(Reading database ... 371721 files and directories currently installed.)\nRemoving linux-image-extra-3.16.0-41-generic (3.16.0-41.55~14.04.1) ...\ndepmod: FATAL: could not load /boot/System.map-3.16.0-41-generic: No such file or directory\nrun-parts: executing /etc/kernel/postinst.d/apt-auto-removal 3.16.0-41-generic /boot/vmlinuz-3.16.0-41-generic\nrun-parts: executing /etc/kernel/postinst.d/initramfs-tools 3.16.0-41-generic /boot/vmlinuz-3.16.0-41-generic\nupdate-initramfs: Generating /boot/initrd.img-3.16.0-41-generic\ngrep: /boot/config-3.16.0-41-generic: No such file or directory\ndepmod: WARNING: could not open /tmp/mkinitramfs_n4g54n/lib/modules/3.16.0-41-generic/modules.order: No such file or directory\ndepmod: WARNING: could not open /tmp/mkinitramfs_n4g54n/lib/modules/3.16.0-41-generic/modules.builtin: No such file or directory\n\ngzip: stdout: No space left on device\nE: mkinitramfs failure cpio 141 gzip 1\nupdate-initramfs: failed for /boot/initrd.img-3.16.0-41-generic with 1.\nrun-parts: /etc/kernel/postinst.d/initramfs-tools exited with return code 1\ndpkg: error processing package linux-image-extra-3.16.0-41-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nErrors were encountered while processing:\n linux-image-extra-3.16.0-41-generic\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n</code></pre>\n\n<p>The kernel currently in use is 3.16.0.40.</p>\n\n<p>Help will be appreciated!</p>\n\n<p>The results of df -h is:</p>\n\n<pre><code>$ df -h\nFilesystem                   Size  Used Avail Use% Mounted on\n/dev/mapper/ubuntu--vg-root  454G   53G  378G  13% /\nnone                         4,0K     0  4,0K   0% /sys/fs/cgroup\nudev                         1,9G  4,0K  1,9G   1% /dev\ntmpfs                        385M  1,2M  384M   1% /run\nnone                         5,0M     0  5,0M   0% /run/lock\nnone                         1,9G  268K  1,9G   1% /run/shm\nnone                         100M   36K  100M   1% /run/user\n/dev/sda2                    237M  231M     0 100% /boot\n/dev/sda1                    511M  3,4M  508M   1% /boot/efi\n/home/danie/.Private         454G   53G  378G  13% /home/danie\n</code></pre>\n"},{"id":203543,"title":"Can&#39;t remove kernels &quot;run-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 1&quot;","body":"<p>Yesterday I upgraded Ubuntu from 12.04 to 12.10. However, the linux kernel has not upgraded from 3.2 to 3.5 as I would have expected. </p>\n\n<pre><code>$ uname -r \n3.2.0-32-generic\n\n$ uname -a\nLinux tony-b 3.2.0-32-generic #51-Ubuntu SMP Wed Sep 26 21:33:09 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux\n\n$ cat /proc/version\nLinux version 3.2.0-32-generic (buildd@batsu) (gcc version 4.6.3 (Ubuntu/Linaro 4.6.3-1ubuntu5) ) #51-Ubuntu SMP Wed Sep 26 21:33:09 UTC 2012\n</code></pre>\n\n<p>Not sure why that happened there.</p>\n\n<p>I wanted to install Audacity (v2.0.1-1_amd64) to edit a lecture audio file. When trying this operation through Ubuntu Software Center, it says that to install audacity, four items will need to be removed:</p>\n\n<ul>\n<li>linux-image-3.2.0-27-generic</li>\n<li>linux-image-3.2.0-29-generic</li>\n<li>linux-image-3.2.0-30-generic</li>\n<li>linux-image-3.2.0-31-generic</li>\n</ul>\n\n<p>So I click \"Install Anyway\" but it fails with the following output:</p>\n\n<pre><code>installArchives() failed: (Reading database ... \n(Reading database ... 259675 files and directories currently installed.)\nRemoving linux-image-3.2.0-27-generic ...\nExamining /etc/kernel/postrm.d .\nrun-parts: executing /etc/kernel/postrm.d/initramfs-tools 3.2.0-27-generic /boot/vmlinuz-3.2.0-27-generic\nupdate-initramfs: Deleting /boot/initrd.img-3.2.0-27-generic\nrun-parts: executing /etc/kernel/postrm.d/zz-update-grub 3.2.0-27-generic /boot/vmlinuz-3.2.0-27-generic\nGenerating grub.cfg ...\nrun-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 1\nFailed to process /etc/kernel/postrm.d at /var/lib/dpkg/info/linux-image-3.2.0-27-generic.postrm line 328.\ndpkg: error processing linux-image-3.2.0-27-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nNo apport report written because MaxReports is reached already\nRemoving linux-image-3.2.0-29-generic ...\nExamining /etc/kernel/postrm.d .\nrun-parts: executing /etc/kernel/postrm.d/initramfs-tools 3.2.0-29-generic /boot/vmlinuz-3.2.0-29-generic\nupdate-initramfs: Deleting /boot/initrd.img-3.2.0-29-generic\nrun-parts: executing /etc/kernel/postrm.d/zz-update-grub 3.2.0-29-generic /boot/vmlinuz-3.2.0-29-generic\nGenerating grub.cfg ...\nrun-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 1\nFailed to process /etc/kernel/postrm.d at /var/lib/dpkg/info/linux-image-3.2.0-29-generic.postrm line 328.\ndpkg: error processing linux-image-3.2.0-29-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nNo apport report written because MaxReports is reached already\nRemoving linux-image-3.2.0-30-generic ...\nExamining /etc/kernel/postrm.d .\nrun-parts: executing /etc/kernel/postrm.d/initramfs-tools 3.2.0-30-generic /boot/vmlinuz-3.2.0-30-generic\nupdate-initramfs: Deleting /boot/initrd.img-3.2.0-30-generic\nrun-parts: executing /etc/kernel/postrm.d/zz-update-grub 3.2.0-30-generic /boot/vmlinuz-3.2.0-30-generic\nGenerating grub.cfg ...\nrun-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 1\nFailed to process /etc/kernel/postrm.d at /var/lib/dpkg/info/linux-image-3.2.0-30-generic.postrm line 328.\ndpkg: error processing linux-image-3.2.0-30-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nNo apport report written because MaxReports is reached already\nRemoving linux-image-3.2.0-31-generic ...\nExamining /etc/kernel/postrm.d .\nrun-parts: executing /etc/kernel/postrm.d/initramfs-tools 3.2.0-31-generic /boot/vmlinuz-3.2.0-31-generic\nupdate-initramfs: Deleting /boot/initrd.img-3.2.0-31-generic\nrun-parts: executing /etc/kernel/postrm.d/zz-update-grub 3.2.0-31-generic /boot/vmlinuz-3.2.0-31-generic\nGenerating grub.cfg ...\nrun-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 1\nFailed to process /etc/kernel/postrm.d at /var/lib/dpkg/info/linux-image-3.2.0-31-generic.postrm line 328.\ndpkg: error processing linux-image-3.2.0-31-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nNo apport report written because MaxReports is reached already\nErrors were encountered while processing:\n linux-image-3.2.0-27-generic\n linux-image-3.2.0-29-generic\n linux-image-3.2.0-30-generic\n linux-image-3.2.0-31-generic\nError in function: \nSetting up grub-pc (2.00-7ubuntu11) ...\n/usr/sbin/grub-bios-setup: warning: Sector 32 is already in use by the program `FlexNet'; avoiding it.  This software may cause boot or other problems in future.  Please ask its authors not to store data in the boot track.\nInstallation finished. No error reported.\nGenerating grub.cfg ...\ndpkg: error processing grub-pc (--configure):\n subprocess installed post-installation script returned error exit status 1\n</code></pre>\n\n<p>It seems I need to remove the old linux images somehow. I have tried this through (1) Synaptic, (2) Ubuntu Tweak, and (3) Computer Janitor. </p>\n\n<p>The first two fail, whilst Computer Janitor won't even open. The output from Synaptic is:</p>\n\n<pre><code>E: linux-image-3.2.0-27-generic: subprocess installed post-removal script returned error exit status 1\nE: linux-image-3.2.0-29-generic: subprocess installed post-removal script returned error exit status 1\nE: linux-image-3.2.0-30-generic: subprocess installed post-removal script returned error exit status 1\nE: linux-image-3.2.0-31-generic: subprocess installed post-removal script returned error exit status 1\n\n$ dpkg --list | grep linux-image\nrH  linux-image-3.2.0-27-generic                3.2.0-27.43                               amd64        Linux kernel image for version 3.2.0 on 64 bit x86 SMP\nrH  linux-image-3.2.0-29-generic                3.2.0-29.46                               amd64        Linux kernel image for version 3.2.0 on 64 bit x86 SMP\nrH  linux-image-3.2.0-30-generic                3.2.0-30.48                               amd64        Linux kernel image for version 3.2.0 on 64 bit x86 SMP\nrH  linux-image-3.2.0-31-generic                3.2.0-31.50                               amd64        Linux kernel image for version 3.2.0 on 64 bit x86 SMP\nii  linux-image-3.2.0-32-generic                3.2.0-32.51                               amd64        Linux kernel image for version 3.2.0 on 64 bit x86 SMP\nii  linux-image-3.5.0-17-generic                3.5.0-17.28                               amd64        Linux kernel image for version 3.5.0 on 64 bit x86 SMP\nii  linux-image-extra-3.5.0-17-generic          3.5.0-17.28                               amd64        Linux kernel image for version 3.5.0 on 64 bit x86 SMP\nii  linux-image-generic                         3.5.0.17.19                               amd64        Generic Linux kernel image\n</code></pre>\n\n<p>But trying to remove using the command line fails too e.g.:</p>\n\n<pre><code>$ sudo apt-get purge linux-image-3.2.0-27-generic\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nThe following packages will be REMOVED\n  linux-image-3.2.0-27-generic linux-image-3.2.0-29-generic linux-image-3.2.0-30-generic linux-image-3.2.0-31-generic\n0 upgraded, 0 newly installed, 4 to remove and 1 not upgraded.\n5 not fully installed or removed.\nAfter this operation, 597 MB disk space will be freed.\nDo you want to continue [Y/n]? Y\n\n(Reading database ... 259675 files and directories currently installed.)\nRemoving linux-image-3.2.0-27-generic ...\nExamining /etc/kernel/postrm.d .\nrun-parts: executing /etc/kernel/postrm.d/initramfs-tools 3.2.0-27-generic /boot/vmlinuz-3.2.0-27-generic\nupdate-initramfs: Deleting /boot/initrd.img-3.2.0-27-generic\nrun-parts: executing /etc/kernel/postrm.d/zz-update-grub 3.2.0-27-generic /boot/vmlinuz-3.2.0-27-generic\nGenerating grub.cfg ...\nrun-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 1\nFailed to process /etc/kernel/postrm.d at /var/lib/dpkg/info/linux-image-3.2.0-27-generic.postrm line 328.\ndpkg: error processing linux-image-3.2.0-27-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nNo apport report written because MaxReports has already been reached\n                                                                    Removing linux-image-3.2.0-29-generic ...\nExamining /etc/kernel/postrm.d .\nrun-parts: executing /etc/kernel/postrm.d/initramfs-tools 3.2.0-29-generic /boot/vmlinuz-3.2.0-29-generic\nupdate-initramfs: Deleting /boot/initrd.img-3.2.0-29-generic\nrun-parts: executing /etc/kernel/postrm.d/zz-update-grub 3.2.0-29-generic /boot/vmlinuz-3.2.0-29-generic\nGenerating grub.cfg ...\nrun-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 1\nFailed to process /etc/kernel/postrm.d at /var/lib/dpkg/info/linux-image-3.2.0-29-generic.postrm line 328.\ndpkg: error processing linux-image-3.2.0-29-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nNo apport report written because MaxReports has already been reached\n                                                                    Removing linux-image-3.2.0-30-generic ...\nExamining /etc/kernel/postrm.d .\nrun-parts: executing /etc/kernel/postrm.d/initramfs-tools 3.2.0-30-generic /boot/vmlinuz-3.2.0-30-generic\nupdate-initramfs: Deleting /boot/initrd.img-3.2.0-30-generic\nrun-parts: executing /etc/kernel/postrm.d/zz-update-grub 3.2.0-30-generic /boot/vmlinuz-3.2.0-30-generic\nGenerating grub.cfg ...\nrun-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 1\nFailed to process /etc/kernel/postrm.d at /var/lib/dpkg/info/linux-image-3.2.0-30-generic.postrm line 328.\ndpkg: error processing linux-image-3.2.0-30-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nNo apport report written because MaxReports has already been reached\n                                                                    Removing linux-image-3.2.0-31-generic ...\nExamining /etc/kernel/postrm.d .\nrun-parts: executing /etc/kernel/postrm.d/initramfs-tools 3.2.0-31-generic /boot/vmlinuz-3.2.0-31-generic\nupdate-initramfs: Deleting /boot/initrd.img-3.2.0-31-generic\nrun-parts: executing /etc/kernel/postrm.d/zz-update-grub 3.2.0-31-generic /boot/vmlinuz-3.2.0-31-generic\nGenerating grub.cfg ...\nrun-parts: /etc/kernel/postrm.d/zz-update-grub exited with return code 1\nFailed to process /etc/kernel/postrm.d at /var/lib/dpkg/info/linux-image-3.2.0-31-generic.postrm line 328.\ndpkg: error processing linux-image-3.2.0-31-generic (--remove):\n subprocess installed post-removal script returned error exit status 1\nNo apport report written because MaxReports has already been reached\n                                                                    Errors were encountered while processing:\n linux-image-3.2.0-27-generic\n linux-image-3.2.0-29-generic\n linux-image-3.2.0-30-generic\n linux-image-3.2.0-31-generic\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n</code></pre>\n\n<p>How do I remove old kernel images which refuse to be removed?  </p>\n"},{"id":267625,"title":"Problems with linux-headers and apt-get -f install","body":"<p>It has been a long time since I've asked for help, but I'm in dire need now.  </p>\n\n<p>Some time ago, I set up a friend's computer with 10.04.  He's still running it but somewhere along the way, he started having trouble with his nvidia drivers and seemingly his whole system.  Remotely, I've been trying to help him start from scratch and install fresh with 12.10.  The problem is that his CD-rom is broken, and his BIOS will not allow him to boot from external media, i.e., usb cd/dvd rom and/or usb flash drives.  Space on his system partition was very low but has deleted enough to give him just over a gig.  I thought the best solution would be to boot from a local iso file through grub2.  However, his system hasn't been updated/upgraded to grub2, he is still using the legacy version.  We can't seem to upgrade him because, well, I guess you could say apt-get is (broken?) and apt-get -f install isn't fixing it.  We can't remove or add packages until this is resolved.  I've listed the commands we've tried and their output.</p>\n\n<p>I would appreciate any help that would allow us to update the computer to grub2 and/or do a fresh install of Ubuntu.</p>\n\n<p><strong>sudo apt-get -f install</strong></p>\n\n<pre><code>dpkg: error processing /var/cache/apt/archives/linux-headers-2.6.32-45_2.6.32-45.104_all.deb (--unpack):\nunable to create `/usr/src/linux-headers-2.6.32-45/drivers/cpufreq/Kconfig.dpkg-new' (while processing `./usr/src/linux-headers-2.6.32-45/drivers/cpufreq/Kconfig'): No space left on device\nNo apport report written because the error message indicates a disk full error\ndpkg-deb: subprocess paste killed by signal (Broken pipe)\nErrors were encountered while processing:\n/var/cache/apt/archives/linux-headers-2.6.32-45_2.6.32-45.104_all.deb\n</code></pre>\n\n<p><strong>sudo dpkg --configure -a</strong></p>\n\n<pre><code>dpkg: dependency problems prevent configuration of linux-headers-2.6.32-45-generic:\nlinux-headers-2.6.32-45-generic depends on linux-headers-2.6.32-45; however:\nPackage linux-headers-2.6.32-45 is not installed.\ndpkg: error processing linux-headers-2.6.32-45-generic (--configure):\ndependency problems - leaving unconfigured\ndpkg: dependency problems prevent configuration of linux-headers-generic:\nlinux-headers-generic depends on linux-headers-2.6.32-45-generic; however:\nPackage linux-headers-2.6.32-45-generic is not configured yet.\ndpkg: error processing linux-headers-generic (--configure):\ndependency problems - leaving unconfigured\nErrors were encountered while processing:\nlinux-headers-2.6.32-45-generic\nlinux-headers-generic\n</code></pre>\n\n<p><strong>sudo dpkg -i --force-overwrite /var/cache/apt/archives/linux-headers-2.6.32-45_2.6.32-45.104_all.deb</strong></p>\n\n<pre><code>dpkg: error processing /var/cache/apt/archives/linux-headers-2.6.32-45_2.6.32-45.104_all.deb (--install):\nunable to create `/usr/src/linux-headers-2.6.32-45/drivers/cpufreq/Kconfig.dpkg-new' (while processing `./usr/src/linux-headers-2.6.32-45/drivers/cpufreq/Kconfig'): No space left on device\ndpkg-deb: subprocess paste killed by signal (Broken pipe)\nErrors were encountered while processing:\n/var/cache/apt/archives/linux-headers-2.6.32-45_2.6.32-45.104_all.deb\n</code></pre>\n\n<p><strong>sudo apt-get autoremove</strong></p>\n\n<pre><code>You might want to run `apt-get -f install' to correct these.\nThe following packages have unmet dependencies:\nlinux-headers-2.6.32-45-generic: Depends: linux-headers-2.6.32-45 but it is not installed\nE: Unmet dependencies. Try using -f.\n</code></pre>\n"},{"id":331538,"title":"what is the right way to downgrade kernel","body":"<p>I decide to downgrade kernel version due to unsolvable problem with wifi. Ubuntu version is <strong>12.10</strong>, kernel version is <strong>3.5</strong>.</p>\n\n<p>In <a href=\"http://packages.ubuntu.com/precise/kernel/\">http://packages.ubuntu.com/precise/kernel/</a> I found the previous kernel version <strong>3.2</strong>.  I decided to install linux-image-3.2.0-51-generic. The question is it enough to install just  <em>linux-image</em> package, do I need to install  <em>linux-header</em> package too, are there more package I should install?</p>\n\n<p>The second question, as it suggested on the website, the right way to install the packages is to edit the file <em>/etc/apt/sources.list</em> insert the line <em>deb <a href=\"http://security.ubuntu.com/ubuntu\">http://security.ubuntu.com/ubuntu</a> precise-security main</em>. However after inserting and running the update I still cannot find packages of <em>linux-image 3.2</em> by <strong>apt-cache search linux-images*</strong>. Where I am wrong?</p>\n"},{"id":176322,"title":"Removing old kernel entries in Grub","body":"<p>I regularly delete old kernels leaving only the latest two entries using Synaptic.</p>\n\n<p>I'm using Precise. However in my Grub \"previous Linux version\" menu there are quite a few entries labelled 2.6.8. I cannot find these linux-images in Synaptic.</p>\n\n<pre><code>dpkg -l | grep linux-image\n</code></pre>\n\n<p>Gives:</p>\n\n<pre><code>rc  linux-image-3.0.0-17-generic           3.0.0-17.30                         \n    Linux kernel image for version 3.0.0 on x86/x86_64\nii  linux-image-3.2.0-27-generic           3.2.0-27.43\nLinux kernel image for version 3.2.0 on 32 bit x86 SMP\nii  linux-image-3.2.0-29-generic           3.2.0-29.46\nLinux kernel image for version 3.2.0 on 32 bit x86 SMP\nii  linux-image-3.4.0-030400-generic       3.4.0-030400.201205210521\nLinux kernel image for version 3.4.0 on 32 bit x86 SMP\nii  linux-image-generic                    3.2.0.29.31\nGeneric Linux kernel image\n</code></pre>\n\n<p>Sudo update-grub gives:</p>\n\n<pre><code>Generating grub.cfg ...\nFound linux image: /boot/vmlinuz-3.4.0-030400-generic\nFound initrd image: /boot/initrd.img-3.4.0-030400-generic\nFound linux image: /boot/vmlinuz-3.2.0-29-generic\nFound initrd image: /boot/initrd.img-3.2.0-29-generic\nFound linux image: /boot/vmlinuz-3.2.0-27-generic\nFound initrd image: /boot/initrd.img-3.2.0-27-generic\nFound linux image: /boot/vmlinuz-2.6.38-11-generic\nFound initrd image: /boot/initrd.img-2.6.38-11-generic\nFound linux image: /boot/vmlinuz-2.6.38-10-generic\nFound initrd image: /boot/initrd.img-2.6.38-10-generic\nFound linux image: /boot/vmlinuz-2.6.38-8-generic\nFound initrd image: /boot/initrd.img-2.6.38-8-generic\nFound memtest86+ image: /boot/memtest86+.bin\nFound Windows Vista (loader) on /dev/sda1\n</code></pre>\n\n<p>sudo apt-get remove linux-image-2.6.8-8-generic gives:</p>\n\n<pre><code>E: Unable to locate package linux-image-2.6.8-8-generic\nE: Couldn't find any package by regex 'linux-image-2.6.8-8-generic'\n</code></pre>\n\n<p>My boot folder contains the following:</p>\n\n<pre>abi-2.6.38-10-generic         initrd.img-3.4.0-030400-generic\nabi-2.6.38-11-generic         memtest86+.bin\nabi-2.6.38-8-generic          memtest86+_multiboot.bin\nabi-3.2.0-27-generic          System.map-2.6.38-10-generic\nabi-3.2.0-29-generic          System.map-2.6.38-11-generic\nabi-3.4.0-030400-generic      System.map-2.6.38-8-generic\nconfig-2.6.38-10-generic      System.map-3.2.0-27-generic\nconfig-2.6.38-11-generic      System.map-3.2.0-29-generic\nconfig-2.6.38-8-generic       System.map-3.4.0-030400-generic\nconfig-3.2.0-27-generic       vmcoreinfo-2.6.38-10-generic\nconfig-3.2.0-29-generic       vmcoreinfo-2.6.38-11-generic\nconfig-3.4.0-030400-generic   vmcoreinfo-2.6.38-8-generic\nextlinux                      vmlinuz-2.6.38-10-generic\ngrub                          vmlinuz-2.6.38-11-generic\ninitrd.img-2.6.38-10-generic  vmlinuz-2.6.38-8-generic\ninitrd.img-2.6.38-11-generic  vmlinuz-3.2.0-27-generic\ninitrd.img-2.6.38-8-generic   vmlinuz-3.2.0-29-generic\ninitrd.img-3.2.0-27-generic   vmlinuz-3.4.0-030400-generic\ninitrd.img-3.2.0-29-generic</pre>\n\n<p>and <pre>ls -l /etc/grub.d</pre> yields:</p>\n\n<pre>total 56\n-rwxr-xr-x 1 root root 6715 Apr 17 20:16 00_header\n-rwxr-xr-x 1 root root 5522 Oct  1  2011 05_debian_theme\n-rwxr-xr-x 1 root root 7407 May 17 09:22 10_linux\n-rwxr-xr-x 1 root root 6335 Apr 17 20:16 20_linux_xen\n-rwxr-xr-x 1 root root 1588 May  3  2011 20_memtest86+\n-rwxr-xr-x 1 root root 7603 Apr 17 20:16 30_os-prober\n-rwxr-xr-x 1 root root  214 Oct  1  2011 40_custom\n-rwxr-xr-x 1 root root   95 Oct  1  2011 41_custom\n-rw-r--r-- 1 root root  483 Oct  1  2011 README\n</pre>\n\n<pre><code>gdisk -l /dev/sda\n</code></pre>\n\n<p>yields:</p>\n\n<pre>Partition table scan:\n  MBR: MBR only\n  BSD: not present\n  APM: not present\n  GPT: not present\n\n\n***************************************************************\nFound invalid GPT and valid MBR; converting MBR to GPT format.\n***************************************************************\n\nDisk /dev/sda: 312581808 sectors, 149.1 GiB\nLogical sector size: 512 bytes\nDisk identifier (GUID): F832A498-05E1-4615-B5B1-757ACB4A757A\nPartition table holds up to 128 entries\nFirst usable sector is 34, last usable sector is 312581774\nPartitions will be aligned on 2048-sector boundaries\nTotal free space is 4183661 sectors (2.0 GiB)\n\nNumber  Start (sector)    End (sector)  Size       Code  Name\n   1            2048        61442047   29.3 GiB    0700  Microsoft basic data\n   3       163842048       169986047   2.9 GiB     8200  Linux swap\n   4       169986048       312578047   68.0 GiB    0700  Microsoft basic data\n   5        61444096       159666175   46.8 GiB    8300  Linux filesystem\n</pre>\n\n<p>Please help with removing the old and inexistent kernels from Grub.</p>\n"},{"id":103536,"title":"Need ubuntu with old kernel ( &lt; 2.6.31)?","body":"<p>I have here some old applications and modules which ones only run on older linux kernels. I need an ubuntu with kernel &lt; 2.6.31 </p>\n\n<p>I tought there are two options:\n1.) Download 8.04/8.10 - there is an older kernel but I cannot use apt-get anymore to get stuff :/ I says its not supported\n2.) Using 11.10 and change the kernel. But thats the question how? Is it even possible?</p>\n\n<p>Any ideas? Thank you</p>\n"}]}]