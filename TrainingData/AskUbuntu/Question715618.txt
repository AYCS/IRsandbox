[{"id":715618,"title":"ext4 file system repairs","body":"<p>I have been trying to get my data back from a 475 GB partition which was my /home partition on a 500 GB external hard disk with ubuntu 14.04 installed on a 20 GB partition. When it developed problems, I reinstalled Ubuntu 14.04 on the 20 GB partition keeping the /home partition in tact.After the reinstallation the /home partition was renamed as 475 Gb partition only with the main directory \"Anil\". Still later when there were problems in the ext4 file system I tried to repair with fsck with -y option. I think that cancelled my main directory with the query:\" ... not a root directory. clear ? yes.\nSo my first question is can I undo these repairs?\nIt may not be possible. After trying to mount the sdd3 partition by the method suggested in an answer to my earlier question, I still get the reply about  the ext4-fs group descriptors being corrupted.Meaning still more repairs needed. Now I think I have two options for file system repairs : Gparted and Testdisk. I am not sure which is better. Can I get some guidance on this?</p>\n","related_questions":[{"id":714228,"title":"Lost main directory after fsck file system repairs","body":"<p>I did file system repairs on my 475 GB partition on an external USB hard drive. with main(root) directory named xyz. After the repairs by <code>fsck</code>, when I connect it to the computer the partition is not mounted. </p>\n\n<p><em>How can I get my data back?</em></p>\n\n<p>The output of \"lsblk\" with HD attached is :</p>\n\n<pre><code>NAME      MAJ:MIN  RM     SIZE  RO   TYPE    MOUNTPOINT  \nsda         8:0     0   149.1G  0    disk\nsda1        8:1     0    10  G  0    part\nsda2        8:2     0   139  G  0    part\nsdc         8:32    1     1.9G  0    disk\nsdc1        8:33    1     1.9G  0    part   /cdrom\nsdd         8:48    0   465.8G  0    disk\nsdd1        8:49    0    18.7G  0    part\nsdd2        8:50    0     4.7G  0    part\nsdd3        8:51    0   442.4G  0    part /media/ubuntu/356d60dc-80a5-40b4-8a20-117322d45\nsr0         11:0    1  1024M    0    rom\nloop0        7:0    0   952M    1   loop  /rofs\n</code></pre>\n\n<p>The output of <code>lsblk</code> without HD is without the details of sdd.</p>\n"},{"id":650069,"title":"root file system mounts as read only after some time","body":"<p>My root (<code>/</code>) file system get remounted as read only after the system has been up for some time. This seems to vary from 3 hours to 48 hours. This system is running Ubuntu desktop 14.04. Its primary function is to run several Virtual Machines for myself. Here is the system config.</p>\n\n<ul>\n<li>Dell XPS 8700 </li>\n<li>Intel i7 4770 24GB ram </li>\n<li>128 GB mSATA SSD (this hold the\n<code>/</code> file system that has been giving me issues. It also contains swap\nand other system file systems)</li>\n<li>3x 1TB SATA drive (no problem here) But they hold the VM files. This\ncurrently only runs 3 VMs.</li>\n</ul>\n\n<p>A similar system (HP) has 32GB ram but same config otherwise does not have this issue. It runs 12 VMs no prob.</p>\n\n<p>After <code>/</code> remounts as read only the VMs die as they write to a temp location on the SSD. I cannot <code>sudo</code> on the machine. And if I try to run the terminal command \"mount\" terminal just closes. After a reboot, I am asked to fix file system error (at startup) which I do and this works fine until the next incident.</p>\n\n<p>I have backups of the VMs (plus their drives seem to be fine). But I would rather fix this installation than redo it since I have made changes that customize the system to my liking. Greping <code>dmesg</code> for EXT4-fs show this but I think this is just startup. No errors.</p>\n\n<pre><code>[    1.331446] EXT4-fs (sde1): mounted filesystem with ordered data mode. Opts: (null)\n[    2.474298] EXT4-fs (sde1): re-mounted. Opts: errors=remount-ro\n[    2.584750] EXT4-fs (sda): mounted filesystem with ordered data mode. Opts: (null)\n[    2.637858] EXT4-fs (sdc): mounted filesystem with ordered data mode. Opts: (null)\n[    2.768738] EXT4-fs (sdd1): mounted filesystem with ordered data mode. Opts: (null)\n[    2.850718] EXT4-fs (sdb1): mounted filesystem with ordered data mode. Opts: (null)\n</code></pre>\n\n<p>I have run smart test in Disks. But it says everything is ok there. (And the machine is only 3 months old. This issue has been prominent for about 3 weeks now.</p>\n\n<p>I'm open to ideas.</p>\n\n<p>EDIT 1:\nIt crashed last night. So i did some digging.\ncharles@VMH2:/var/log$ cat /var/log/syslog.1 | grep sde1\n<br>Jul 18 19:19:40 VMH2 kernel: [    0.892391]  sde: sde1 sde2 &lt; sde5 >\n<br>Jul 18 19:19:40 VMH2 kernel: [    1.331446] EXT4-fs (sde1): mounted filesystem with ordered data mode. Opts: (null)\n<br>Jul 18 19:19:40 VMH2 kernel: [    2.474298] EXT4-fs (sde1): re-mounted. Opts: errors=remount-ro\n<br>Jul 19 04:49:13 VMH2 kernel: [27950.072962] INFO: task jbd2/sde1-8:212 blocked for more than 120 seconds.\n<br>Jul 19 04:49:13 VMH2 kernel: [27950.072968] jbd2/sde1-8     D ffff88061ecd30c0     0   212      2 0x00000000\n<br>Jul 19 11:48:50 VMH2 kernel: [    0.888753]  sde: sde1 sde2 &lt; sde5 >\n<br>Jul 19 11:48:50 VMH2 kernel: [    0.961088] EXT4-fs (sde1): mounted filesystem with ordered data mode. Opts: (null)\n<br>Jul 19 11:48:50 VMH2 kernel: [    1.999033] EXT4-fs (sde1): re-mounted. Opts: errors=remount-ro\ncharles@VMH2:/var/log$ cat /var/log/syslog.1 | grep 27950\n<br>Jul 19 04:49:13 VMH2 kernel: [27950.072962] INFO: task jbd2/sde1-8:212 blocked for more than 120 seconds.\n<br>Jul 19 04:49:13 VMH2 kernel: [27950.072966]       Tainted: P           OE 3.16.0-43-generic #58~14.04.1-Ubuntu\n<br>Jul 19 04:49:13 VMH2 kernel: [27950.072967] \"echo 0 > /proc/sys/kernel/hung_task_timeout_secs\" disables this message.\n<br>Jul 19 04:49:13 VMH2 kernel: [27950.072968] jbd2/sde1-8     D ffff88061ecd30c0     0   212      2 0x00000000\n<br>Jul 19 04:49:13 VMH2 kernel: [27950.072971]  ffff8805f8297cb0 0000000000000046 ffff8805f8218a30 ffff8805f8297fd8\n<br>Jul 19 04:49:13 VMH2 kernel: [27950.072973]  00000000000130c0 00000000000130c0 ffff8802e8570000 ffff8805f8297d98\n<br>Jul 19 04:49:13 VMH2 kernel: [27950.072975]  ffff8805f89160b8 ffff8805f8218a30 ffff8805dc2c9e00 ffff8805f8297d80\n<br>Jul 19 04:49:13 VMH2 kernel: [27950.072977] Call Trace:</p>\n\n<p>It appears to me that\nINFO: task jbd2/sde1-8:212 blocked for more than 120 seconds.\nis the source of my issues. I just don't know what the message means (or anything after it). Does anybody know what's going on here?</p>\n"},{"id":584656,"title":"Repair broken encrypted home","body":"<p>I've ran into following problem. I have split my disk into two partitions, one for / and one form /home. I've also encrypted /home. </p>\n\n<p>One beautiful day ubuntu reports upon boot some broken files, attempts to fix them, but still does not let me in - I enter my password, it is accepted, but I stay on the login screen.</p>\n\n<p>I've downloaded the livecd and ran the disk check - it reports two broken files, but does not say which files nor offers any option to repair them.</p>\n\n<p>Via nautilus I can see the contents of the drive, it contains two files:<br>\n    Access-Your-Private-Data.desktop<br>\n    README.txt</p>\n\n<p>The README says to access my data I must run \"ecryptfs-mount-private\" but when I ran it:<br>\n    ubuntu@ubuntu:~$ ecryptfs-mount-private<br>\n    ERROR: Encrypted private directory is not setup properly</p>\n\n<p>So I've looked up how to mount encrypted partitions and come to this <a href=\"http://askubuntu.com/questions/63594/mount-encrypted-volumes-from-command-line\">Mount encrypted volumes from command line?</a> but then I get this:<br>\n    ubuntu@ubuntu:~$ sudo cryptsetup luksOpen /dev/sda7 home<br>\n    Device /dev/sda7 is not a valid LUKS device. </p>\n\n<p>I'm not exactly sure what the problem is and I'm not that familiar with ubuntu/linux administration. Can you please help me locate the problem and fix it. I just want to access my data and ssh keys. </p>\n\n<p>Ubuntu version is 14.04.</p>\n\n<p>Many thanks in advance.\nCheers</p>\n"},{"id":520140,"title":"Need help making my second HDD a system wide mount in Ubuntu 14.04 server","body":"<p>Okay so long story short I set up my ubuntu 14.04 server as a time machine backup to back up my mac computers. I bought a 2tb WD RED drive to use for back ups. My macbook recognizes the time machine but I keep getting \"osstatus error 2\" when trying to connect to it and this has to do with permissions on the drive. Right now my WD red HDD location is /media/server (I named it server) and /media means its user specific I need it to be a system wide mount which is /mnt I believe. When I go into the disks program and click on the wheel the \"edit mount options\" is faded so I can't click on it. It also says \"2.0tb unknown\" where its suppose to show the partitions, I was wondering what I did wrong? My main drive which has ubuntu installed on it, and also a windows partition from my old computer I can change mount options fine its just this drive. I think I may have installed or formatted it wrong or something how can I fix this so I can system wide mount it?</p>\n\n<p>Thank you in advance </p>\n"},{"id":518693,"title":"Repair Ubuntu broken files under live Ubuntu","body":"<p><br/>\nMy installed Ubunut 14.04 doesn't work well and after splash screen it goes to black\n screen, and stuck there. I know where the problem is, I have deleted a file (this: <code>org.gnome.settings-daemon.plugins.media-keys.gschema.xml</code>) from <code>/usr/share/glib-2.0/schemas/</code>\n In the last successful login. now I want to repair that and copy/move original file into there until the problem is resolved but unfortunately I can't do this.</p>\n\n<p>I've done these steps:</p>\n\n<ol>\n<li>Boot from the live USB.</li>\n<li><p>Mount my root partition: (it's on <code>/dev/sda6</code>)</p>\n\n<pre><code>sudo mount /dev/sda6 /mnt\n</code></pre></li>\n<li><p>Bind mount some other necessary stuff:</p>\n\n<pre><code>for i in /sys /proc /run /dev; do sudo mount --bind \"$i\" \"/mnt$i\"; done\n</code></pre></li>\n<li><p><code>chroot</code> into my Ubuntu install:</p>\n\n<pre><code>sudo chroot /mnt\n</code></pre></li>\n</ol>\n\n<p>Now I am in my Ubuntu root partition, original file copied in Live Ubunut home folder (<code>/home/ubunut/original_File_here</code>), and destination is <code>/usr/share/glib-2.0/schemas/</code> in mounted partition.</p>\n\n<p>I tired with this commands bellow but I get error.</p>\n\n<pre><code>root@ubunut:/# sudo mv 'org.gnome.settings-daemon.plugins.media-keys.gschema.xml' '/usr/share/glib-2.0/schemas/'\nsudo: unable to resolve host ubuntu\nmv: cannot stat 'org.gnome.settings-daemon.plugins.media-keys.gschema.xml': No such file or directory\n</code></pre>\n\n<p>And</p>\n\n<pre><code>root@ubunut:/# sudo mv 'org.gnome.settings-daemon.plugins.media-keys.gschema.xml' '/dev/sda6/usr/share/glib-2.0/schemas/'\nsudo: unable to resolve host ubuntu\nmv: failed to access '/dev/sda6/usr/share/glib-2.0/schemas/': Not a direcoty\n</code></pre>\n\n<p>Thanks for your help</p>\n"},{"id":507307,"title":"ext4 File System got damaged due to improper write","body":"<p>This is what happened, </p>\n\n<p><strong>I inserted my <em></strong>(important)<strong></em> external HDD into a RedHat 6 machine, did my task's, unmounted the drive via Nautilus, and physically detached the drive from the machine</strong> <em>(and now I realized that, I detached the drive in a hurry while Nautilus (of RHEL6) was writing some thing to the disk).</em></p>\n\n<p>That hardisk had 3 partitions, <em>100GB ext4</em>, <em>50GB ext4</em> and remaining about <em>148GB ntfs</em>.</p>\n\n<p><strong>Later I connected it again to my Ubuntu 14.04 machine, and now the two <em>ext4</em> partitions of the drive are not mounting.</strong></p>\n\n<p><em>Here is what Gparted says,</em></p>\n\n<p><img src=\"http://i.stack.imgur.com/3QlzS.png\" alt=\"enter image description here\"></p>\n\n<p><em>and,</em></p>\n\n<p><img src=\"http://i.stack.imgur.com/UNjMH.png\" alt=\"enter image description here\"></p>\n\n<p>also, here is the <code>sudo fdisk -l</code> command's output,</p>\n\n<blockquote>\n  <p><code>Disk /dev/sdb: 320.1 GB, 320072932352 bytes</code><br>\n  <code>255 heads, 63 sectors/track, 38913 cylinders, total 625142446 sectors</code><br>\n  <code>Units = sectors of 1 * 512 = 512 bytes</code><br>\n  <code>Sector size (logical/physical): 512 bytes / 512 bytes</code><br>\n  <code>I/O size (minimum/optimal): 512 bytes / 512 bytes</code><br>\n  <code>Disk identifier: 0xf909bf11</code><br></p>\n  \n  <p><code>Device     Boot      Start         End      Blocks   Id  System</code><br>\n   <code>/dev/sdb1             2048   209717247   104857600   83  Linux</code><br>\n   <code>/dev/sdb2        209717248   314574847    52428800   83  Linux</code><br>\n   <code>/dev/sdb3        314574848   625141759   155283456    7  HPFS/NTFS/exFAT</code></p>\n</blockquote>\n\n<p>I am not that familiar to <code>fsck</code> or <code>fsck.ext4</code> command, please provide me a direction.</p>\n"},{"id":501164,"title":"How to know the file system of my USB memory from the terminal?","body":"<p>I have connected a USB memory to my PC. It has been automatically mounted and I can access it from <code>/media/...</code>. </p>\n\n<p>How can I know the file system of this memory from the terminal?</p>\n"},{"id":475196,"title":"Unable to mount external hard drive - Damaged file system and MFT","body":"<p>I get the following error when i try to mount my external hard drive.</p>\n\n<pre><code>UNABLE TO MOUNT\nError mounting /dev/sdc1 at /media/khalibloo/Khalibloo2: Command-line `mount -t \"ntfs\" -o \"uhelper=udisks2,nodev,nosuid,uid=1000,gid=1000,dmask=0077,fmask=0177\" \"/dev/sdc1\" \"/media/khalibloo/Khalibloo2\"' exited with non-zero exit status 13: ntfs_attr_pread_i: ntfs_pread failed: Input/output error\nFailed to read of MFT, mft=6 count=1 br=-1: Input/output error\nFailed to open inode FILE_Bitmap: Input/output error\nFailed to mount '/dev/sdc1': Input/output error\nNTFS is either inconsistent, or there is a hardware fault, or it's a SoftRAID/FakeRAID hardware. In the first case run chkdsk /f on Windows then reboot into Windows twice. The usage of the /f parameter is very important! If the device is a SoftRAID/FakeRAID then frst activate it and mount a different device under the /dev/mapper/ directory, (e.g. /dev/mapper/nvidia_eahaabcc1). Please see the 'dmraid' documentation for more details.\n</code></pre>\n\n<p>It doesn't mount on windows either:   </p>\n\n<blockquote>\n  <p>I/O Device error</p>\n</blockquote>\n\n<p>it's an ntfs hard drive with a single partition</p>\n\n<p>Of course, i tried <code>chkdsk /f</code>, it reported several file segments as unreadable, but didn't say whether it fixed them or not (apparently not). also tried with the <code>/b</code> flag.</p>\n\n<p><code>ntfsfix</code> reported the volume as corrupt.</p>\n\n<p><code>TestDisk</code> was able to fix a small error with the partition table by adding the \"80\" flag for the active (only) partition. TestDisk also confirmed that the boot sector was fine and it matched the backup. However, when attempting to repair the MFT, it couldn't read the MFT. It also couldn't list the files on the hard drive. It says file system may be damaged.</p>\n\n<p>Active@ also shows that MFT is missing or corrupt.</p>\n\n<p>I tried replacing the USB cable. Didn't change anything.\nI tried to update the driver. Windows reported that it was already up to date.\nYes, the driver was enabled.</p>\n\n<p>So how do I fix the file system? or the MFT? or the I/O device error?</p>\n\n<p>UPDATE:\nI noticed that with each try, <code>chkdsk /f</code> goes a bit further, so I kept trying until i got to a point where it says </p>\n\n<pre><code>    Insufficient disk space to hotfix unreadable system file 4\n</code></pre>\n\n<p>Since I can't access the files on the drive, there's no way to free up any space.\nSo I thought that perhaps I could format the drive partially to free up some space, and retry <code>chkdsk /f</code>.  Do you think that could work? Or will it just cause more problems to interrupt a format process?</p>\n"},{"id":398511,"title":"Mounting Points and File Permissions","body":"<p>I have a system with dual boot - Ubuntu 12.04 ans openSUSE 12.3</p>\n\n<p>I logged into Ubuntu and i am able to mount openSUSE partition without any issues by entering fstab UUID command with default options.</p>\n\n<p>The question has to do with File Permissions.\nWill the File Permissions get carried over to Ubuntu system?</p>\n\n<p>Because i find the first level of directories are mounted as root/root.</p>\n\n<p>If i go into /home/harish folder in opensuse partition, it actually owned by ubuntu user with same uid.</p>\n\n<p>It is not mounting entire partition as root/root. instead it is mapping uids and gids of opensuse user and ubuntu user and set the permissions accordingly.</p>\n\n<p>Is this behavior correct? I want to mount a ext4 partition into ubuntu as root/root, but need to have file permissions as <code>rwx-rwx-rwx</code> for all the files and folders. is this doable?</p>\n\n<p>Thanks,\nHarish Pathangay</p>\n"},{"id":83172,"title":"Repairing the FSTAB","body":"<p>I recently changed my /home to another partition and after it caused problems (I had it formatted as NTFS) I wish to change it back to it's original location. I changed the FSTAB listing for /home to use the UUID for the ext4 partition but it still causes problems. On startup I get \"unable to mount /dev/sda5\" and \"unable to mount /dev/sdc5\". I push 'S' to skip and get to the login screen where I can sometimes log into my session and sometimes the screen goes black then back to the login screen. I am now making this post using the Guest account.</p>\n\n<p>BLKID gives the following info:</p>\n\n<pre><code>/dev/sda1: LABEL=\"Additional Windows Stuff\" UUID=\"201821D41821AA2C\" TYPE=\"ntfs\" \n/dev/sda5: UUID=\"f1d24581-7850-4a0f-93cd-7e4d24dade1d\" TYPE=\"swap\" \n/dev/sda6: UUID=\"1eaa73bd-8758-4899-a4d2-2a992a2ea762\" TYPE=\"ext4\" \n/dev/sdb1: LABEL=\"Master Disk\" UUID=\"A0C41DD1C41DAA94\" TYPE=\"ntfs\" \n/dev/sdb5: LABEL=\"My Documents\" UUID=\"0F26083D43D41058\" TYPE=\"ntfs\" \n/dev/sdc1: LABEL=\"Elements\" UUID=\"CAB427ABB4279949\" TYPE=\"ntfs\" \n/dev/sdd1: LABEL=\"UBUNTU11-10\" UUID=\"19EC-2249\" TYPE=\"vfat\" \n</code></pre>\n\n<ul>\n<li>SDA1 is in physical position of IDE0 and so has GRUB and some other stuff on it.</li>\n<li>SDA5 is my Swap partition.</li>\n<li>SDA6 is my Ubuntu install and where I'm trying to return my /home to.</li>\n<li>SDB1 is in physical position of IDE1 and has my Windows install.</li>\n<li>SDB5 is where I moved /home to for a short time.</li>\n<li>SDC1 is a USB drive.</li>\n<li>SDD1 is my LiveUSB install drive with 11.10 on it.</li>\n</ul>\n\n<p>Currently my FSTAB file looks like this:</p>\n\n<pre><code># /etc/fstab: static file system information.\n#\n# Use 'blkid' to print the universally unique identifier for a\n# device; this may be used with UUID= as a more robust way to name devices\n# that works even if disks are added and removed. See fstab(5).\n#\n# &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;\nproc                                       /proc           proc  nodev,noexec,nosuid       0  0  \n# / was on /dev/sdc6 during installation\nUUID=1eaa73bd-8758-4899-a4d2-2a992a2ea762  /               ext4  defaults                  0  1  \n# swap was on /dev/sdc7 during installation\nUUID=92f46648-958f-40a1-b96b-607081c063a7  none            swap  sw                        0  0  \n/dev/fd0                                   /media/floppy0  auto  rw,user,noauto,exec,utf8  0  0  \n/dev/sdb2                                  /home           ntfs  defaults                  0  0  \n/dev/sdb1                                  /media/sdb1     ntfs  defaults                  0  0  \n/dev/sda5                                  /media/sda5     ntfs  defaults                  0  0  \n/dev/sdc5                                  /media/sdc5     ntfs  defaults                  0  0  \n/dev/sdb5                                  /media/sdb5     swap  defaults                  0  0  \n/dev/sdd1                                  /media/sdd1     vfat  defaults                  0  0 \n</code></pre>\n\n<p>Is there a way to completly start from scratch without stuffing the system or will I have to manually remount the affected drives? I don't mind re-installing if I have too, but who enjoys that? Once fixed, I think I will use simlinks to merge my 'My Documents' and /home!</p>\n\n<p>I am a Windows veteran but a Linux numpty!</p>\n\n<p>I do have 'Storage Device Manager' installed.</p>\n"}]}]