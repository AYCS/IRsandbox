[{"id":320458,"title":"How to exclude multiple directories with rsync?","body":"<p>I am trying to backup my home directory using rsync, and I want to exclude some of the directories that contain junk.  I want to specifically exclude <code>/home/ben/.ccache</code> and <code>/home/ben/build</code>.  Unfortunately the documentation for rsync was information overload and didn't answer my question.  This is what I tried:</p>\n\n<pre><code>rsync -arv --exclude \"/home/ben/.ccache:/home/ben/build\" /home/ben /media/ben/thumbdrive/\n</code></pre>\n\n<p>What is the right way to do this?</p>\n","related_questions":[{"id":703724,"title":"Local rsync command to capture a sub-sub-subdirectory of /","body":"<p>The task is simple: create a backup of <code>/usr/local/bin</code> and the files within it, and keep the path information.</p>\n\n<p>The following works, but I do not really understand what I have done. I've noticed that the order for the includes and excludes can be important.  Also, \"/usr/*\" cannot be replaced with \"*\".</p>\n\n<pre><code># --dry-run is for convenience.\nrsync --dry-run -aczvAXHS --progress \\\n  --include=\"/usr/local\" \\\n  --exclude=\"/usr/*\" \\\n  --include=\"/usr/local/bin\" \\\n  --exclude=\"/usr/local/*\" \\\n  /usr \\\n  backup/folder\n</code></pre>\n\n<p>Can anybody explain any better way of performing this task?</p>\n\n<p><strong>--- EDITED TO ADD ---</strong></p>\n\n<p>As pointed out in the comments, the question could have been more precise.  The answer provided here is expected to work in the context of 'archive a few select [sub-sub-sub]folders of <code>/</code>.</p>\n"},{"id":545655,"title":"Backup your home directory with rsync and skip useless folders","body":"<p>You can easyly backup your home folder on an external harddrive with</p>\n\n<pre><code>$USER=`whoami`\nrsync -a --exclude=.cache --progress /home/$USER /media/linuxbackup/home/$USER\n</code></pre>\n\n<p>I excluded the .cache folder cause I think I will never need it when I have to re-install from this backup.</p>\n\n<blockquote>\n  <p>I found this list of all folders that I could exclude in a normal backup here:<br>\n  <a href=\"http://askubuntu.com/a/40997/34298\">What files and directories can be excluded from a backup of the home directory? </a></p>\n</blockquote>\n\n<p>I created a list of this answer that contains some coments in this form:</p>\n\n<pre><code>#These directories may be excluded:\n\n.gvfs                           # contains mounted file systems?\n.local/share/gvfs-metadata\n.Private                        # contains the actual encrypted home directory\n.dbus                           # session-specific\n.cache\n.Trash                          # do I need to say more?\n.local/share/Trash\n.cddb                           # cached info about audio CDs\n.aptitude                       # cached packages lists\n\n#Flash-specific:\n\n.adobe                          # Cache for flash, maybe others?\n.macromedia   # except for Flash persistence, there is no reason to keep this\n\n#Files:\n\n.xsession-errors            # contains errors from the current graphical session\n.recently-used              # recently used files\n.recently-used.xbel\n.thumbnails\n</code></pre>\n\n<p><a href=\"https://gist.github.com/rubo77/8ffaadbc58ab099d2bc3\">Here is the full list at gist</a></p>\n\n<p>How can I add this list to my rsync command?</p>\n"},{"id":642176,"title":"How to cancel next job in order after rsync","body":"<p>If two jobs are entered into bash command line separated by semicolon:</p>\n\n<pre><code>$ job 1; job 2;\n</code></pre>\n\n<p>How do I cancel the second one? If I press <kbd>CTRL</kbd>+<kbd>c</kbd>, the first one will be canceled and 'job 2' would start, I just want to stop second job not to be executed. I tried atq, ps but no luck, with ps -ef I can see only 'job 1' but 'job 2' is not listed, so I can not get PID to use kill. I know I can use &amp;&amp; instead of ; but it is too late now, I ran this command by accident on my server instead of my home PC and now I am trying to figure out how to prevent a disaster. </p>\n\n<p>This problem is specific to rsync command followed by another command: </p>\n\n<pre><code>$ rsync ..... ; sudo shutdown -h now\n</code></pre>\n\n<p>Killing process by ID or killing it's parent will not work.</p>\n\n<p>After several hours of testing, I isolated it to rsync, other commands I am able to terminate with <kbd>CTRL</kbd>+<kbd>c</kbd> in various orders, but not if they are after some commands like rsync or ping, I tried different Ubuntu versions, kernels, server without sudo user and I could reproduce it everywhere, best way to avoid this problem is to use &amp;&amp; after rsync to execute following command only on success exitcode 0:</p>\n\n<pre><code>$ rsync .... &amp;&amp; job 2\n</code></pre>\n"},{"id":257892,"title":"How to make rsync run automatically when a new file or directory is added?","body":"<p>I decided to use rsync for backing up my downloaded torrents from my home-server to my laptop. I read the whole manual, but I didn't find a way to sync files automatically when a new file or directory is added to the complete torrents directory.</p>\n\n<p>The Best thing I could find was running rsync daily by a cron-job, But I want it to be more intelligent, like Ubuntu-One and do the job just when a new thing adds.</p>\n"},{"id":632091,"title":"How can I exclude all subdirectories but include files of a directory in rsync?","body":"<p>I want to backup my Ubuntu system and I have two partitions to care:\nOne is <code>/</code>, another is <code>/home</code>.</p>\n\n<p>I'll likely want to backup <code>/</code>. This is not even that big so I can carry it on my SD card, while being responsive enough for making me want to have a image of it (that's why I'm trying to use rsync at this moment).</p>\n\n<p>And about <code>/home</code>, it has many subdirectories that I do not care about much so I'll not likely include them, but I want to take care about files on there, such like <code>.bash_history</code>, <code>.bashrc</code>, <code>.face</code>, and so on.</p>\n\n<p>So I want to exclude all subdirectories while including files in <code>/home</code>. How can I achieve that?</p>\n\n<p><code>--exclude \"*/\"</code> wasn't working. <code>\"/*/\"</code>, <code>\"/**/\"</code>, <code>--include \"*\" --exclude */</code> doesn't show me what I want. at least it copied the source folder, without copying anything inside it.</p>\n"},{"id":625015,"title":"rsync back up of entire root system not working using --exclude?","body":"<p>I am trying to do a system back up of my entire OS</p>\n\n<p>I am using these command and both are not excluding the files I want</p>\n\n<p>sudo rsync -avz --exclude=\"/tmp\" --exclude=\"/sys\" --exclude=\"/lost+found\" --exclude=\"/mnt\" --exclude=\"/proc\" --exclude=\"/tmp\" --exclude=\"/media\" /* /home/willc86/backup/sudo rsync </p>\n\n<p>and the one I am trying that I searched online is </p>\n\n<h1>rsync -aAXv --exclude={\"/dev/<em>\",\"/proc/</em>\",\"/sys/<em>\",\"/tmp/</em>\",\"/run/<em>\",\"/mnt/</em>\",\"/media/<em>\",\"/lost+found\"} /</em> /path/to/backup/folder</h1>\n\n<p>both are still copying everything and I am not sure why</p>\n"},{"id":349613,"title":"How to exclude a folder from rsync","body":"<p>I am trying to backup my home folder on my NAS drive. I am giving this:</p>\n\n<p><code>rsync -Paz --exclude-from 'rsync-exclude.txt' /home/chris/ admin@192.168.1.65:LinuxHome</code></p>\n\n<p>where <code>rsync-exclude.txt</code> has this content:</p>\n\n<pre><code>/home/chris/Downloads/*\n/home/chris/Downloads/\n/home/chris/Downloads/*.*\n</code></pre>\n\n<p>and it is in the same folder I execute rsync (home folder).</p>\n\n<p>However the rsync tries to copy this folder, too.</p>\n\n<p>What am I doing wrong?</p>\n"},{"id":291322,"title":"How to exclude files in rsync?","body":"<p>I'm using ubuntu server 12.04, now I want to backup some files using rsync, here is a try:</p>\n\n<pre><code>rsync -aAX $HOME/Documents/* $HOME/Backups/TEST --exclude={$HOME/Documents/another/*,$HOME/Documents/temp/*} \n</code></pre>\n\n<p>As you can see, I want to backup all files in the folder <em>$HOME/Documents</em> to folder <em>$HOME/Backups/TEST</em>, but <strong><em>exclude</em></strong> files in folder <strong>another</strong> and <strong>temp</strong>. But I failed, rsync still copied the files in both excluded folders:</p>\n\n<pre><code>ls $HOME/Backups/TEST/another\ntest\n</code></pre>\n\n<p><em><strong>test</em></strong> is a file in the folder <strong><em>another</em></strong>, and it is also copied though I exclude the file in rsync, why? How to let those files be actually excluded?</p>\n"},{"id":410735,"title":"Help with rsync excludes not working","body":"<p>\nI'm trying to setup rsync to keep an image on the my external drive current.\n\nI've got 4 partitions to deal with: /, /boot, /home, /usr.\n\nI want to mount each one in turn and sync each with the internal drive.\n\nOne problem I'm having is that excluded files are not being excluded.  I've experimented with a few patterns but none do the trick.  I'm setting the exclude pattern relative to the source but it's not working.\n</p>\n\n<p>\nThis log snippet of the /home/ sync shows the excluded files being copied:\n</p>\n\n<pre>\n<code>\n    --begin snippet--\n    backing up /home/ via rsync to: /media/Ubuntu_Backup...\n    sudo rsync -a -x -i -h -v -A -X -H --delete --inplace --numeric-ids --compare-dest=./ -n --exclude='*/lost+found/**' --exclude='*/Downloads/**' --exclude='*/.cache/**' --exclude='*/.thumbnails' --exclude='*/.mozilla/firefox/*.default/Cache' /home/ /media/Ubuntu_Backup\n    sending incremental file list\n    .d..t...... kmiller/\n    >f..t...... kmiller/.vim_mru_files\n    >f.st...... kmiller/.viminfo\n    >f.st...... kmiller/.zsh_history\n    >f.st...... kmiller/backup.log\n    >f.st...... kmiller/cron.log\n    .d..t...... kmiller/.cache/google-chrome-beta/Default/Cache/\n    *deleting   kmiller/.cache/google-chrome-beta/Default/Cache/f_000806\n    >f..t...... kmiller/.cache/google-chrome-beta/Default/Cache/data_0\n    >f..t...... kmiller/.cache/google-chrome-beta/Default/Cache/data_1\n    >f..t...... kmiller/.cache/google-chrome-beta/Default/Cache/data_2\n    >f..t...... kmiller/.cache/google-chrome-beta/Default/Cache/data_3\n    >f+++++++++ kmiller/.cache/google-chrome-beta/Default/Cache/f_00080a\n    >f+++++++++ kmiller/.cache/google-chrome-beta/Default/Cache/f_00080b\n    >f+++++++++ kmiller/.cache/google-chrome-beta/Default/Cache/f_00080c\n    >f+++++++++ kmiller/.cache/google-chrome-beta/Default/Cache/f_00080d\n    >f+++++++++ kmiller/.cache/google-chrome-beta/Default/Cache/f_00080e\n    --end of snippet--\n</code>\n</pre>\n\n<p>\nThe other problem I was having is that rsync was creating a duplcate directory structure\nwithin the target dir i.e. a /usr/ dir inside the /usr on the target.  The\n--compare-dest=./ seemed to stop that but I don't fully understand why.\n</p>\n\n<p>\nThis is the script I'm developing to do the job:\n</p>\n\n<pre>\n<code>\n#!/usr/bin/zsh\ntypeset -A FILESYSTEMS\ntypeset -A NAMES\n\nMOUNTPOINT='/media/Ubuntu_Backup'\nLOGFILE='/home/kmiller/backup.log'\n\nOPTIONS=('-a') #archive\nOPTIONS+=('-x') #don't cross file system boundaries\nOPTIONS+=('-i') #itemize changes\nOPTIONS+=('-h') #human readable output\nOPTIONS+=('-v') #verbose\nOPTIONS+=('-A') #preserve ACLS\nOPTIONS+=('-X') #preserve extended attributes\nOPTIONS+=('-H') #preserve hard links\nOPTIONS+=('--delete') #delete extraneous\nOPTIONS+=('--inplace') #update files directly (faster - no building temp copies)\nOPTIONS+=('--numeric-ids') #no translation of UID,GID - needed for proper restores\nOPTIONS+=('--compare-dest=./') #\nOPTIONS+=('-n') #dry run\n\nFILESYSTEMS=('/' '/dev/sdb6')\nFILESYSTEMS+=('/boot/' '/dev/sdb1')\nFILESYSTEMS+=('/usr/' '/dev/sdb8')\nFILESYSTEMS+=('/home/' '/dev/sdb7')\n\nROOTEXCLUDES=(\"--exclude='boot/*'\")\nROOTEXCLUDES+=(\"--exclude='usr/*'\")\nROOTEXCLUDES+=(\"--exclude='home/*'\")\nROOTEXCLUDES+=(\"--exclude='dev/*'\")\nROOTEXCLUDES+=(\"--exclude='proc/*'\")\nROOTEXCLUDES+=(\"--exclude='sys/*'\")\nROOTEXCLUDES+=(\"--exclude='tmp/*'\")\nROOTEXCLUDES+=(\"--exclude='run/*'\")\nROOTEXCLUDES+=(\"--exclude='mnt/*'\")\nROOTEXCLUDES+=(\"--exclude='media/*'\")\nROOTEXCLUDES+=(\"--exclude='lost+found/*'\")\nROOTEXCLUDES+=(\"--exclude='etc/fstab'\")\n\nBOOTEXCLUDES=(\"--exclude='lost+found/*'\")\nBOOTEXCLUDES+=(\"--exclude='grub/grub.cfg'\")\n\nUSREXCLUDES=(\"--exclude='lost+found/*'\")\n\nHOMEEXCLUDES=(\"--exclude='*/lost+found/*'\")\nHOMEEXCLUDES+=(\"--exclude='*/Downloads/*'\")\nHOMEEXCLUDES+=(\"--exclude='*/.cache'\")\nHOMEEXCLUDES+=(\"--exclude='*/.thumbnails'\")\n\nNAMES=('/' 'ROOT' '/boot/' 'BOOT' '/usr/' 'USR' '/home/' 'HOME')\n\nis_mounted () {\n    mount | grep \"$1\" || return 1\n    return 0\n}\n\nif [[ ! -d $MOUNTPOINT ]];then\n    echo \"creating $MOUNTPOINT...\"\n    sudo mkdir $MOUNTPOINT || {echo \"$0 failed - Problem creating mount dir: $MOUNTPOINT\" && exit;}\nfi\n\nrm -rf $LOGFILE\n\n#unmount any target backup partitons if they happen to be mounted\nfor FS in ${(k)FILESYSTEMS};do\n    if is_mounted ${FILESYSTEMS[$FS]};then\n        sudo umount ${FILESYSTEMS[$FS]} || {echo \"$0 - Problem unmounting: $MOUNTPOINT\" && exit;}\n    fi\ndone\n\necho -e \"\\nStarting partition backups...\"\nfor FS in ${(k)FILESYSTEMS};do\n    EXCLUDES=$(eval echo \\$${NAMES[${FS}]}EXCLUDES)\n    echo \"-------------------------------------------------------\"\n    echo \"mounting ${FS} partition: ${FILESYSTEMS[$FS]}...\"\n    sudo mount ${FILESYSTEMS[$FS]} $MOUNTPOINT || {echo \"$0 - Problem mounting: ${FILESYSTEMS[$FS]} $MOUNTPOINT\" && exit;}\n    echo \"backing up ${FS} via rsync to: $MOUNTPOINT...\" | tee -a $LOGFILE 2>&1\n    echo \"sudo rsync ${OPTIONS} ${EXCLUDES} ${FS} /media/Ubuntu_Backup\" >> ${LOGFILE} 2>&1\n    eval sudo rsync ${OPTIONS} ${EXCLUDES} ${FS} /media/Ubuntu_Backup >> ${LOGFILE} 2>&1 || {echo -e \"WARNING: rsync returned an error: $rc\\nSee backup.out for details!\" && exit;}\n    df ${FILESYSTEMS[$FS]} | tee -a $LOGFILE 2>&1\n    echo \"unmounting ${FILESYSTEMS[$FS]}\"\n    sleep 2\n    sudo umount ${FILESYSTEMS[$FS]} || {echo \"$0 failed - Problem unmounting partition: ${FILESYSTEMS[$FS]}\" && exit;}\ndone\necho -e \"Finished partition backups...\\n\"\n</code>\n</pre>\n\n<p>\nAny advice/insights are welcome...\n</p>\n"},{"id":90594,"title":"rsync between two directories","body":"<p>Currently I use </p>\n\n<pre><code>rsync -avh --stats --progress dir1(source)say dir2(destination) ...\n</code></pre>\n\n<p>say I have 10 files in <code>dir1</code> and I have copied using the above command to <code>dir2</code> all 10 files.</p>\n\n<p>Say now I have added another 5 files to <code>dir1</code> and I want only the new 5 files and any updates to get copied to <code>dir2</code> when I run <code>rsync</code> again. Can I use the above command and switches or should I modify it?</p>\n"}]}]