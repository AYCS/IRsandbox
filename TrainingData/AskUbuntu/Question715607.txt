[{"id":715607,"title":"Creating virtual hosts for a domain and subdomain on ubuntu","body":"<p>I have two versions of applications running on an apache server.Now I have to point one to the main domain viz <code>www.example.com</code> and the other to a subdomain \n<code>mysite.example.com</code>.</p>\n\n<p>The challenge I am facing is if I type in only <code>example.com</code> it goes to <code>mysite.example.com</code> instead of <code>www.example.com</code>.</p>\n\n<p>I do not have anything configured in the <code>.htaccess</code> files as far as redirection is concerned. Also DNS entries for both <code>www</code> and <code>example.com</code> are pointing to the same ip</p>\n\n<p>My conf files are as below:</p>\n\n<p>This is for the subdomain\n     </p>\n\n<pre><code>    ServerName mysite.example.com\n    #ServerAlias mysite.example.com      // not sure if i need alias\n    ServerAdmin webmaster@localhost\n    DocumentRoot /var/www/html/site1\n\n    &lt;Directory /var/www/html/site1&gt;\n     Options Indexes FollowSymLinks MultiViews\n     AllowOverride All\n     Order allow,deny\n     allow from all\n    &lt;/Directory&gt;\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n  &lt;/VirtualHost&gt;\n</code></pre>\n\n<p>This one for the main domain</p>\n\n<pre><code> &lt;VirtualHost *:80&gt;\n\n    ServerName www.example.com\n    ServerAlias example.com      \n    ServerAdmin webmaster@localhost\n    DocumentRoot /var/www/html/site2\n\n    &lt;Directory /var/www/html/site2&gt;\n     Options Indexes FollowSymLinks MultiViews\n     AllowOverride All\n     Order allow,deny\n     allow from all\n    &lt;/Directory&gt;\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n  &lt;/VirtualHost&gt;\n</code></pre>\n\n<p>I want to serve one version for the subdomain and the other on the main domain,with all URL possibilities covered. </p>\n\n<p>Can anybody point where I am going wrong on this? </p>\n","related_questions":[{"id":637944,"title":"Setting up an intranet by Apache2 and Bind9","body":"<p>I need some support to setup an intranet.</p>\n\n<p>ENVIRONMENT</p>\n\n<p>A LAN (192.168.1.x) conntected to Internet through an ADSL modem/router (192.168.1.1). \nAn Ubuntu 14 server (192.168.1.111) is connected to the LAN too.</p>\n\n<p>WHAY I WISH TO DO</p>\n\n<p>Create an intranet domain (sample.lan) installing Apache2 and Bind9 on the server (server.sample.lan).\nApache2 will serve requests on port 80 for www.sample.lan whereas w3.sample.lan will be redirected to server.sample.lan:888</p>\n\n<p>WHAT I DID </p>\n\n<ol>\n<li>I installed Apache2 and Bind9 on the server.</li>\n<li>I created and configured a named.conf.options for bind9</li>\n</ol>\n\n<pre>\n    acl \"trusted\" {\n        192.168.1.1;     # router\n        192.168.1.111;    # server\n    };\n\n    options {\n        directory \"/var/cache/bind\";\n\n        recursion yes;                    \n        allow-recursion { trusted; };    \n        listen-on { 192.168.1.111; };    \n        allow-transfer { none; };        \n\n        forwarders {\n            192.168.1.1;     # router\n            8.8.8.8;        # Google\n            91.80.35.166;    # ISP\n        };\n\n        dnssec-validation auto;\n\n        auth-nxdomain no;    # conform to RFC1035\n        listen-on-v6 { any; };\n    };\n</pre>\n\n<ol start=\"3\">\n<li>I created and configured a named.conf.local for bind9</li>\n</ol>\n\n<pre>\n    zone \"sample.lan\" {\n        type master;\n        file \"/etc/bind/db.sample.lan\";\n    };\n\n    zone \"1.168.192.in-addr.arpa\" {\n        type master;\n        file \"/etc/bind/db.192\";\n    };\n</pre>\n\n<ol start=\"4\">\n<li>I created and configured a db.sample.lan for bind9</li>\n</ol>\n\n<pre>\n    $TTL    604800\n    @    IN    SOA    server.sample.lan. webmaster.sample.lan. (\n                      3        ; Serial\n                 604800        ; Refresh\n                  86400        ; Retry\n                2419200        ; Expire\n                 604800 )    ; Negative Cache TTL\n    ;\n        IN    NS    server.sample.lan.\n    ; Below are A Record addresses\n    gateway.sample.lan.        IN    A    192.168.1.1\n    server.sample.lan.        IN    A    192.168.1.111\n    www.sample.lan.            IN    A    192.168.1.111\n    w3.sample.lan.            IN    A    192.168.1.111\n    ; Below are CNAME records addresses\n    www.sample.lan.        IN    CNAME    sample.lan.\n</pre>\n\n<ol start=\"5\">\n<li>I created and configured a db.192 for bind9</li>\n</ol>\n\n<pre>\n    $TTL    604800\n    @    IN    SOA    server.sample.lan. webmaster.sample.lan. (\n                      3        ; Serial\n                 604800        ; Refresh\n                  86400        ; Retry\n                2419200        ; Expire\n                 604800 )    ; Negative Cache TTL\n    ; name servers - NS records\n        IN    NS    server.sample.lan.\n    ; PTR records\n    1    IN    PTR    gateway.sample.lan.\n    111    IN    PTR    server.sample.lan.\n</pre>\n\n<ol start=\"6\">\n<li>I created and configured a httpd.conf for apache2</li>\n</ol>\n\n<pre>\n    ServerName localhost\n</pre>\n\n<ol start=\"7\">\n<li>I created and configured a 000-default.conf for apache2 and activated by a2ensite command</li>\n</ol>\n\n<pre>\n     &lt;VirtualHost *:80&gt;\n        ServerAdmin webmaster@sample.lan\n        ServerName www.sample.lan\n        ServerAlias sample.lan\n        DocumentRoot /var/www/html\n        &lt;Directory /var/www/html&gt;\n            Options Indexes FollowSymLinks MultiViews\n            AllowOverride All\n            Order Allow,Deny\n            Allow from All\n        &lt;/Directory&gt;\n        LogLevel warn\n        ErrorLog ${APACHE_LOG_DIR}/www.error.log\n        CustomLog ${APACHE_LOG_DIR}/www.access.log combined\n    &lt;/VirtualHost&gt;\n</pre>\n\n<ol start=\"8\">\n<li>I created and configured a 001-w3.conf for apache2 and activated by a2ensite command</li>\n</ol>\n\n<pre>\n     &lt;VirtualHost *:80&gt;\n        ServerAdmin webmaster@sample.lan\n        ServerName w3.sample.lan\n        DocumentRoot /var/www/w3/\n        &lt;Directory /var/www/w3&gt;\n            AllowOverride None\n            Order Deny,Allow\n            Deny from All\n        &lt;/Directory&gt;\n        &lt;Proxy *&gt;\n            Order allow,deny\n            Allow from all\n        &lt;/Proxy&gt;\n        ProxyPass / http://server.sample.lan:888/\n        ProxyPassReverse / http://server.sample.lan:888/\n        LogLevel warn\n        CustomLog ${APACHE_LOG_DIR}/w3.access.log combined\n    &lt;/VirtualHost&gt;\n</pre>\n\n<p>I restarted/reloaded services when needed, rebooted when needed.</p>\n\n<p>RESULTS</p>\n\n<p>I can access server.sample.lan:888 but if I try to access</p>\n\n<pre>\n    www.sample.lan\n    w3.sample.lan\n    sample.lan\n</pre>\n\n<p>no page is loaded. What I did wrong?</p>\n"},{"id":620381,"title":"Need to host 30 domains, but Bind9 config info is confusing","body":"<p>Bringing up a new server using ubuntu 15.04, Bind9 and Apache 2.4 that needs to host 30 web sites - each with own domain name. Have configured Apache virtual hosts and all seem correct, but Bind must not be passing info to Apache as the default host xyz.net web pages are always displayed even though I enter other domain names like abc.com, bcd.org, etc.</p>\n\n<p>I think the problem must be in how named.conf.local is configured (including the associated abc.com.db bcd.org.db files) - but I cannot find a tutorial that covers this. </p>\n\n<p>Right now my <strong>named.conf.local</strong> looks like this: (except the in-addr.arpa really uses an external IP address rather than a private one)</p>\n\n<pre><code>zone \"xyz.net\" {\n type master;\n file \"/etc/bind/zones/xyz.net.db\";\n };\n\n zone \"abc.com\" {\n type master;\n file \"/etc/bind/zones/abc.com.db\";\n };\n\n zone \"bcd.org\" {\n type master;\n file \"/etc/bind/zones/bcd.org.db\";\n };\n\n zone \"1.1.10.in-addr.arpa\" {\n type master;\n file \"/etc/bind/zones/rev.1.1.10.in-addr.arpa\";\n };\n</code></pre>\n\n<p>The contents of <strong>xyz.net.db</strong> are:</p>\n\n<pre><code> ; BIND data file for xyz.net\n ;\n $TTL 14400\n @ IN SOA ns1.xyz.net. tuv.xyz.net. (\n 201505061 ; Serial\n 7200 ; Refresh\n 120 ; Retry\n 2419200 ; Expire\n 60480) ; Default TTL\n ;\n xyz.net. IN NS ns1.xyz.net.\n xyz.net. IN NS ns2.xyz.net.\n\n xyz.net. IN MX 10 mail.xyz.net.\n xyz.net. IN A 10.1.1.33\n\n ns1 IN A 10.1.1.33\n ns2 IN A 10.1.1.33\n www IN CNAME xyz.net.\n mail IN A 10.1.1.33\n ftp IN CNAME xyz.net.\n xyz.net. IN TXT \"V=spf1 ip4:10.1.1.33 a mx ~all\"\n mail IN TXT \"V=spf1 a -all\"\n</code></pre>\n\n<p>and this is essentially the same as the virtual domain file <strong>bcd.org.db</strong> except (I would assume) that the nameserver names should be those of the primary domain.</p>\n\n<pre><code>; BIND data file for bcd.org\n ;\n $TTL 14400\n @ IN SOA ns1.xyz.net. tuv.xyz.net. (\n 201505061 ; Serial\n 7200 ; Refresh\n 120 ; Retry\n 2419200 ; Expire\n 60480) ; Default TTL\n ;\n bcd.org. IN NS ns1.xyz.net.\n bcd.org. IN NS ns2.xyz.net.\n\n bcd.org. IN MX 10 mail.bcd.org.\n bcd.org. IN A 10.1.1.33\n\n ns1 IN A 10.1.1.33\n ns2 IN A 10.1.1.33\n www IN CNAME xyz.net.\n mail IN A 10.1.1.33\n ftp IN CNAME bcd.org.\n xyz.net. IN TXT \"V=spf1 ip4:10.1.1.33 a mx ~all\"\n mail IN TXT \"V=spf1 a -all\"\n</code></pre>\n\n<p>Does this make sense? or am I wandering down the wrong road?</p>\n"},{"id":608656,"title":"subdomains on apache with external dns","body":"<p>First I will describe my setup, after that my problem and last my question for solution.</p>\n\n<p>I have an external DNS server solution (not using DNS on my UBUNTU) where I control all my primary DNS etc. I have my  A records established like this:</p>\n\n<pre><code>localhost.itaportalen.dk    127.0.0.1   43200   \nitaportalen.dk  5.196.14.205    43200\n</code></pre>\n\n<p>Furthermore I have a <code>CNAME</code>:</p>\n\n<blockquote>\n  <p>.itaportalen.dk    itaportalen.dk  43200</p>\n</blockquote>\n\n<p>I have an UBUNTU server with apache2 running, and my website is placed in <code>/var/www/html</code> - That works like a charm.</p>\n\n<p>I have installed <code>MySQL</code> and <code>VSFTPD</code> and that works fine as well.</p>\n\n<p>My problem is that I would like to run a multiuser site, and all users should have a <code>subdomain</code> to <code>itaportalen.dk</code>. When I create a user i.e. \"test\" that user should have a home directory according to the subdomain <code>test.itaportalen.dk</code> with FTP access to only that folder (and subdirectories that user might create).</p>\n\n<p>My questions are as follows:</p>\n\n<p>Where do I place folder for subdomain <code>test.itaportalen.dk</code> so that the <code>CNAME</code> will point directly to that folder? I can not seem to make this work on UBUNTU and APACHE2</p>\n\n<p>I have <code>chrooted</code> my users so that they only see their homefolder (in this case a subdomain) what is the correct way to give them RW access so thay can upload files to their websites?</p>\n\n<p>I know this is pretty basic stuff but I can not seem to make it work on this UBUNTU installation.</p>\n"},{"id":606306,"title":"Sporadically unable to connect to ubuntu 14.04 LTS server using domain name","body":"<p>I use a DDNS which is automatically updated by my router every time a new IP address is assigned to the domain name.</p>\n\n<p>The no-ip domain name is pointing to the correct IP address.</p>\n\n<p>Currently I am trying to connect to my server in an FTP client. I can connect to the server using the IP address: 109.158.126.123. But I can not connect to the server using the domain name: crmepham.no-ip.biz.</p>\n\n<p>Here is proof that I can not connect using crmepham.no-ip.biz:\n<img src=\"http://i.stack.imgur.com/YvG3m.png\" alt=\"enter image description here\"></p>\n\n<p>-</p>\n\n<p>Here is proof I can connect using the IP address: \n<img src=\"http://i.stack.imgur.com/Y3T9S.png\" alt=\"enter image description here\"></p>\n\n<p>But then sometimes it does resolve the domain name and connects me fine. I have been in contact with no-ip who can't see any issues with resolving the domain name from their end. </p>\n\n<p>What could possibly be causing the sporadic resolving issues? This is effecting all the websites that are hosted on my server also only sporadically being available, however always being available via the IP address.</p>\n\n<p>The server runs Ubuntu 14.04 LTS, Apache 2.4, I have setup Virtual hosts and Tomcat 7. All was working fine a couple of days ago under Ubuntu 12.04.</p>\n\n<p>EDIT:</p>\n\n<p>added nslookup:</p>\n\n<p><img src=\"http://i.stack.imgur.com/UHtYM.png\" alt=\"enter image description here\"></p>\n\n<p>And a further nslookup 3 minutes after the last:\n<img src=\"http://i.stack.imgur.com/gqd7v.png\" alt=\"enter image description here\"></p>\n"},{"id":597119,"title":"Apache2 Virtual Hosting ServerName in Ubuntu Server 14.04 in LAN not Working","body":"<p>i am very new to Ubuntu Apache2 World. \nI have a Apache2 in my Ubuntu Server (14.04) in my home installed. \nI tried to visit this Apache Server in my LAN environment. (Server IP is static: 192.168.0.105). </p>\n\n<p>My Problem is: I enter 192.168.0.105 in my laptop, I can visit the Apache2, but I write my Apache ServerName(www.pigeontest.de), it will not work...\nMy works were like below:</p>\n\n<ol>\n<li><p>I set \"Server Name\" under /etc/apache2/sites-available/pigeontest.de.conf already like below: \n![\n      ServerAdmin webmaster@ubuntu.lan</p>\n\n<pre><code>  ServerName www.pigeontest.de\n  ServerAlias pigeontest.de\n\n  DocumentRoot /var/www/html/pigeontest.de\n</code></pre>\n\n<p>\n      Options Indexes<br>\n      DirectoryIndex index.php index.html\n      AllowOverride All\n      Order allow,deny\n      Allow from all\n    Require all granted \n   </p>\n\n<pre><code>  ErrorLog ${APACHE_LOG_DIR}/pigeontest.de/error.log\n  CustomLog ${APACHE_LOG_DIR}/pigeontest.de/access.log combined\n</code></pre></li>\n</ol>\n\n<p> \n]<a href=\"http://i.stack.imgur.com/7Kb8F.png\" rel=\"nofollow\">1</a></p>\n\n<ol start=\"2\">\n<li>Then I did: sudo a2ensite pigeontest.de.conf</li>\n<li>Then I goto \"sudo vim /etc/hosts\": \n127.0.0.1       localhost<br>\n127.0.1.1       UbuntuServer www.pigeontest.de</li>\n</ol>\n\n<h1>The following lines are desirable for IPv6 capable hosts</h1>\n\n<p>::1     localhost ip6-localhost ip6-loopback</p>\n\n<ol start=\"4\">\n<li>Then sudo service apache2 reload</li>\n<li>Then sudo service apache2 restart </li>\n</ol>\n\n<p>IT NOT WORKS!\nI do not know why...Thank you for help!</p>\n"},{"id":588566,"title":"Changing the hosts file is not working","body":"<p>I am in the processing of migrating a site to a new server.</p>\n\n<p>I am currently testing it before actually changing the DNS for that domain.</p>\n\n<p>I changed my windows hosts file to point the site to the new server and set up my virtual host configuration for that domain name on the new server. This is working fine and I am seeing the migrated version of the site in the browser.</p>\n\n<p>However some php code which looks at full http urls is still looking at the original server. This is to be expected I guess as nothing is telling it not to.</p>\n\n<p>So I tried changing the hosts file /etc/hosts</p>\n\n<p>I added these lines...</p>\n\n<pre><code>0.0.0.0 www.example.com\n0.0.0.0 example.com\n</code></pre>\n\n<p>Upon doing some googling I realised I would have to flush DNS so I ran</p>\n\n<pre><code>sudo apt-get install nscd\nservice nscd restart\n</code></pre>\n\n<p>However its still not working and the php is still looking the original live server and not the local server.</p>\n\n<p>Am I missing something else to get this working?</p>\n\n<p>Thank you</p>\n"},{"id":584056,"title":"Windows local network access to apache virtual hosts on a ubuntu DNS domain","body":"<p>I have set up a Ubuntu Server machine (14.04) with LAMP, and I have set up a static domain name with bind9 at <code>http://webserv.dev</code>. That domain is showing up when I try to access it from a Windows machine on my local network, but none of the sites being served by Apache will display using the <code>ServerName</code> I set in the virtual host - I get a 404 for all of them.</p>\n\n<p>I can access the contents of the sites via <code>wget</code> on the Ubuntu machine, and I can successfully ping the Ubuntu machine from windows using <code>webserv.dev</code></p>\n\n<p>What can I do to make the virtual host sites available in windows via the <code>ServerName</code>s I set in the vhosts (they're all supposed to be accessible as subdomains of webserv.dev)?</p>\n\n<p>My proficiency level with Ubuntu is \"beginner\" :-)</p>\n"},{"id":583007,"title":"Mail server: shall I set up a sub-domain name?","body":"<p>I am trying to put in place a mail server following this tutorial: <a href=\"http://www.starbridge.org/spip/spip.php?article12\" rel=\"nofollow\">http://www.starbridge.org/spip/spip.php?article12</a> \nBefore starting I was wondering if I had ta create a virtual domain on apache.</p>\n\n<p>my hostname is: server01\nmy domaine name is (for the example): domain.net</p>\n\n<p>do I have to create a sub domain name mail.doamin.net or server01.domain.net</p>\n\n<p>I am a bit confused when I see in different tutorials the use of url like hostname.domain.net (is that the FQDN?)\nThanks in advance for your help</p>\n"},{"id":402730,"title":"Is it possible to setup multiple Virtual Hosts with one ip/domain?","body":"<p>Is it possible to setup multiple Virtual Hosts with one ip/domain?</p>\n\n<p>We have a single domain (example.com) pointing to our server at ip (123.123.555.555). At location 123.123.555.555 we require the following folder structure:</p>\n\n<pre><code># production level\n/htdocs/www/prod/proj1/\n/htdocs/www/prod/proj2/\n\n# dev level\n/htdocs/www/dev/proj3/\n/htdocs/www/dev/proj4\n</code></pre>\n\n<p>Where ideally we would like <code>example.com</code> to resolve to <code>/htdocs/www/prod/</code> and <code>example.com/dev</code> to resolve to <code>/htdocs/www/dev/</code>.</p>\n\n<p>Simple enough no?</p>\n\n<p><strong>Caveats:</strong></p>\n\n<ol>\n<li><code>dev</code> and <code>prod</code> need different setup directory/apache rules (<code>allow deny from</code>, etc)</li>\n<li><code>prod</code> needs to resolve without <code>prod</code> in the url. <code>example.com/proj1</code> would goto <code>example.com/prod/proj1</code></li>\n</ol>\n\n<p><strong>Attempts so far..</strong></p>\n\n<p>I've tried setting up with the same virtual host, but giving a directory an alias of <code>/</code> sends it into a fit, claiming that it will be overwritten later. It makes sense because <code>/</code> matches <code>/</code> but also <code>/dev</code></p>\n\n<p>I've also tried setting up multiple virtual hosts with apache2' sites-available/sites-enabled but it seems I can't distinguish it based on the ip/domain. Normally I would attempt something like <code>&lt;Directory 'sub.domain.com'&gt;</code> and <code>&lt;Directory 'sub2.domain.com'&gt;</code></p>\n"},{"id":299936,"title":"Access to Apache Subdomains externally","body":"<p>I just recently configured a localhost subdomain on my Apache web server. </p>\n\n<p>domain: <code>hjm.im</code> \nsubdomain: <code>blog.hjm.im</code></p>\n\n<p>It is working correctly from on my server (which makes sense), but how can I get access to it from the outside. If you type <code>blog.hjm.im</code> into your browser nothing gets returned. </p>\n\n<p>Do I need to create a DNS record? Or is there some setting inside of Apache that does this for me? </p>\n"}]}]