[{"id":715651,"title":"Samba share not working","body":"<p>Ok before this I could not access on ubuntu shared files on my windows 10 pc but now i can't share folders at all I get an error message </p>\n\n<pre><code>'net usershare' returned error 255: net usershare add: cannot convert `name \"Everyone\" to a SID. Unexpected information received.`\n</code></pre>\n\n<p>I haven't configured anything through text, I used system-config-samba 1.2.63-0ubuntu6 to add a username and share folder </p>\n\n<p>So is there a way to fix samba share, one more thing i don't want to create any new user on ubuntu. </p>\n\n<p>Well I managed to fix this, if you can call it a fix.</p>\n\n<p>So I had an external hdd connected to my pc the hdd that contains a shared folder. I read that I should have chmod this folder, didn't work, but I should point out that same hdd when connected to a different pc with the same ubuntu 14.04 (only difference it's 32 bit) other pc can connect to this share folder. Ok so copped the files from that hdd to the ubuntu pc and it still didn't work but after using chmor -R 777 folder it finally started to work.</p>\n","related_questions":[{"id":438511,"title":"Samba shares with windows AD picking wrong username","body":"<p>I have a strange problem, which I have found no answers for on the web.</p>\n\n<p>I have ubuntu 12.04 LTS with Samba 3.6. 3 (ntp krb5-user smbfs smbclient winbind)</p>\n\n<p>At first everything works fine, groups in AD have the proper file access and user permissions work, <strong>except for one anomaly:</strong></p>\n\n<p>There are 2 users with the same first name:</p>\n\n<p>simon folly and\nsimon wally</p>\n\n<p>If I log into Windows as simon wally and try to access his share I get permission denied. When I view samba.log is states:</p>\n\n<blockquote>\n  <p>[2014/03/24 20:39:04.702632,  2]\n  smbd/service.c:627(create_connection_session_info)   user\n  'WINDOMAIN\\simon folly' (from session setup) not permitted to access\n  this share (simonw)</p>\n</blockquote>\n\n<p>As you can see above the wrong username is been authenticated. It's seems it finds the first name from the list and picks that one.</p>\n\n<p>So to test my theory I changed the username in the smb.conf file to \"simon folly\" and sure enough when logged in as simon wally I have full access to my share ??</p>\n\n<p>Has this happened to anyone and how to fix it ?</p>\n\n<p>Here is my share in smb.conf</p>\n\n<pre><code>note: when I change wally to folly then wally has full access.\notherwise below gets denied.    \n\n[simonw]\n    comment = Simon Only\n    path = /sharing/ceo\n    valid users = \"WINDOMAIN\\simon wally\"\n    force group = \"domain users\"\n    writable = yes\n    read only = no\n    force create mode = 0660\n    create mask = 0777\n    directory mask = 0777\n    force directory mode = 0770\n    access based share enum = yes\n    hide unreadable = yes\n</code></pre>\n\n<p>thank you in advance for your help :)</p>\n"},{"id":647851,"title":"Samba: Mac cannot access share?","body":"<p>I have a anonymous share setup on my linux box.</p>\n\n<p>I'd like to access it without passwords from my mac.</p>\n\n<p>However, when I try to do that it crashes my Finder. </p>\n\n<p>Here's the samba config:</p>\n\n<pre><code>[global]\n  workgroup = HOBBIT\n  dns proxy = no\n  netbios name srvr1\n  log file = /var/log/samba/log.%m\n  max log size = 1000\n  security = user\n  map to guest = bad user\n  name resolve order bcast host\n\n[theshare]\n  comment = theshare\n  path = /media/maja/Samba\n  public = yes\n  writable = yes\n  available = yes\n  browsable = yes\n  guest ok = yes\n  create mask = 0777\n  directory mask = 0777\n</code></pre>\n\n<p>So I see the PC in the network, and I see the share:\n<img src=\"http://i.stack.imgur.com/5zNT8.png\" alt=\"You can see the share\"></p>\n\n<p>But when I try to click on the folder, Finder crashes and I get this error:\n<img src=\"http://i.stack.imgur.com/dg8mj.png\" alt=\"Finder error message\"></p>\n\n<p>Any ideas? </p>\n"},{"id":628435,"title":"Windows7 machine cannot access Linux share folders via Samba, help please","body":"<p>I have a linux and a windows 7 machine connected via samba. My linux machine is able to gain access to the folders on the windows 7 machine via the browse network tab in file manager but the windows 7 machine is not able to see the linux machine via windows explorer. I have a vast knowledge of windows but am relatively new to linux so i apologize if i seem noobish. I am able to ping the windows ip and vice versa. again i apologize for seeming noobish. i hope i am presenting the valid information, any help would be greatly appreciated. thank you</p>\n\n<p>Solutions i have tried so far:</p>\n\n<ol>\n<li><p>using the run dialogue box from windows to access using ip</p>\n\n<blockquote>\n  <p>\\\\ip-of-linux-machine</p>\n</blockquote></li>\n<li><p>using the run dialogue box from windows to access using pc name</p>\n\n<blockquote>\n  <p>\\\\pc-name</p>\n</blockquote></li>\n</ol>\n\n<p>here is a copy of my smb.conf settings</p>\n\n<blockquote>\n  <p>[global]</p>\n  \n  <p>workgroup = WORKGROUP</p>\n  \n  <p>server string = %h server (Samba, Ubuntu)</p>\n  \n  <p>;   wins server = w.x.y.z</p>\n  \n  <p>dns proxy = no</p>\n  \n  <p>;   name resolve order = lmhosts host wins bcast</p>\n  \n  <p>;   interfaces = 127.0.0.0/8 eth0</p>\n  \n  <p>;   bind interfaces only = yes</p>\n  \n  <p>log file = /var/log/samba/log.%m</p>\n  \n  <p>max log size = 1000</p>\n  \n  <p>syslog = 0</p>\n  \n  <p>panic action = /usr/share/samba/panic-action %d</p>\n  \n  <p>encrypt passwords = true</p>\n  \n  <p>passdb backend = tdbsam</p>\n  \n  <p>obey pam restrictions = yes</p>\n  \n  <p>unix password sync = yes</p>\n  \n  <p>passwd program = /usr/bin/passwd %u\n   passwd chat = <em>Enter\\snew\\s</em>\\spassword:* %n\\n <em>Retype\\snew\\s</em>\\spassword:* >%n\\n <em>password\\supdated\\ssuccessfully</em> .</p>\n  \n  <p>pam password change = yes</p>\n  \n  <p>map to guest = bad user</p>\n  \n  <p>;   domain logons = yes\n  ;   logon path = \\%N\\profiles\\%U</p>\n  \n  <p>;   logon drive = H:</p>\n  \n  <p>;   logon script = logon.cmd</p>\n  \n  <p>; add user script = /usr/sbin/adduser --quiet --disabled-password --gecos \"\" >%u</p>\n  \n  <p>; add machine script  = /usr/sbin/useradd -g machines -c \"%u machine account\" -d /var/lib/samba -s /bin/false %u</p>\n  \n  <p>; add group script = /usr/sbin/addgroup --force-badname %g</p>\n  \n  <p>;   printing = bsd\n  ;   printcap name = /etc/printcap</p>\n  \n  <p>;   printing = cups\n  ;   printcap name = cups</p>\n  \n  <p>;   include = /home/samba/etc/smb.conf.%m</p>\n  \n  <p>;   message command = /bin/sh -c '/usr/bin/linpopup \"%f\" \"%m\" %s; rm %s' &amp;</p>\n  \n  <p>;   idmap uid = 10000-20000\n  ;   idmap gid = 10000-20000\n  ;   template shell = /bin/bash</p>\n  \n  <p>;   winbind enum groups = yes\n  ;   winbind enum users = yes</p>\n  \n  <p>;   usershare max shares = 100</p>\n  \n  <p>usershare allow guests = yes</p>\n  \n  <p>;[homes]\n  ;   comment = Home Directories\n  ;   browseable = no</p>\n  \n  <p>;   read only = yes</p>\n  \n  <p>;   create mask = 0700</p>\n  \n  <p>;   directory mask = 0700</p>\n  \n  <p>;   valid users = %S</p>\n  \n  <p>;[netlogon]\n  ;   comment = Network Logon Service\n  ;   path = /home/samba/netlogon\n  ;   guest ok = yes\n  ;   read only = yes</p>\n  \n  <p>;[profiles]\n  ;   comment = Users profiles\n  ;   path = /home/samba/profiles\n  ;   guest ok = no\n  ;   browseable = no\n  ;   create mask = 0600\n  ;   directory mask = 0700</p>\n  \n  <p>[printers]\n    comment = All Printers\n    browseable = no\n    path = /var/spool/samba\n    printable = yes\n    guest ok = no\n    read only = yes\n    create mask = 0700</p>\n  \n  <p>[print$]\n    comment = Printer Drivers\n    path = /var/lib/samba/printers\n    browseable = yes\n    read only = yes\n    guest ok = no\n  ;   write list = root, @lpadmin</p>\n  \n  <p>;[cdrom]\n  ;   comment = Samba server's CD-ROM\n  ;   read only = yes\n  ;   locking = no\n  ;   path = /cdrom\n  ;   guest ok = yes</p>\n  \n  <p>;   preexec = /bin/mount /cdrom\n  ;   postexec = /bin/umount /cdrom</p>\n</blockquote>\n"},{"id":623781,"title":"samba username case issue in samba 4.x","body":"<p>I have a problem with a samba service on my server. It's began since ubuntu have switched to samba 4.x in their distributions and continues til last one 15.04.</p>\n\n<p>I have a user <code>ag</code> on my server and user <code>AG</code> on a Windows 7 box. In samba 3.x everything worked fine but in samba 4.x I've got some funny username mismatch issue.</p>\n\n<p>I observe following behavior: When I login from Windows host I type a username <code>ag</code> (or <code>AG</code> it does not matter) and a password. Samba server rejects me for a first time but lets me in on second try. Actually, the same behavior show Linux and Mac OSX clients too, so it's not a Windows issue. I can simulate this from linux console following way:</p>\n\n<pre><code>nas@AGStorage:~$ smbclient -U AG //agvault/backup\nEnter AG's password:\nsession setup failed: NT_STATUS_NO_MEMORY\nnas@AGStorage:~$ smbclient -U AG //agvault/backup\nEnter AG's password:\nDomain=[HOME] OS=[Unix] Server=[Samba 4.1.13-Ubuntu]\nsmb: \\&gt; q\n</code></pre>\n\n<p>I tried to analyze the behavior with Wireshark and it shows clear that Windows tries first with <code>AG</code> (remember the user name in Windows is <code>AG</code>) and gets error, then comes with <code>ag</code> second time and gets Ok from samba server.</p>\n\n<p>When I simulate the login with <code>ag</code> it lets in with a single try:</p>\n\n<pre><code>nas@AGStorage:~$ smbclient -U ag //agvault/backup\nEnter ag's password:\nDomain=[HOME] OS=[Unix] Server=[Samba 4.1.13-Ubuntu]\nsmb: \\&gt; q\n</code></pre>\n\n<p>I've tried suggested in internet solution: Adding a line <code>username map = /etc/samba/usermap.txt</code> to my <code>smb.conf</code> with <code>ag = AG</code> inside of mentioned <code>usermap.txt</code> but it does not work in my case.</p>\n\n<p>How can I fix this inconsistent behavior of samba server? Any ideas?</p>\n\n<p>Thanks in advance!</p>\n"},{"id":12254,"title":"No access to Samba shares","body":"<p>I have three shared folders in my local home directory- that is to say, on my Ubuntu desktop's /home/me/. All were set up using \"Sharing Options\" in Nautilus' right-click menu. The standard \"Music\" and \"Videos\" folders are configured identically: the \"Guest Access\" box is checked, but the \"Allow others to create and delete\" is not. The third folder, called \"shared\", is configured to not allow Guest access but to allow others to modify files. I have not altered <code>/etc/samba/smb.conf</code> by hand, I have only used Sharing Options to create and modify these so-called \"shares\".</p>\n\n<p>My roommates have two Windows 7 computers and one Ubuntu Netbook Remix netbook. I have the aforementioned desktop machine and laptop running 10.04. None of these machines can access any of the shares. Attempts to access the Guest shares result in the message</p>\n\n<p><code>\\\\machine\\directory is not accessible. The network name could not be found.</code></p>\n\n<p>This is the error message generated by a VM running Windows 2000. The other Windows machines generate a similar error. The Ubuntu laptop gives the error <code>Unable to mount location: Failed to mount Windows share</code>. Hurrah, once again, for informative error messages. That really helps a lot.</p>\n\n<p>When attempting to browse the folder called \"shared\" from the laptop, I'm confronted with a password dialog. This behavior is the same will all machines I've tried in the situation. On entering my username and password for the account to which the shares belong, the password dialog briefly disappears and is replaced with an identical dialog. No error message, useful or not, appears.</p>\n\n<p>When attempting to browse this folder with the VM, the outcome is the same except that the password dialog helpfully states \"incorrect username or password\". My assumption is that the username and password in question is that of the user which owns the shares. I have tried all other username and password combinations available in this context and the outcome is the same.</p>\n\n<p>I would like to be able to share files. Sharing them with Windows machines is a nice feature, or would be if it was available. Really I consider sharing files between two machines with the same version of the same operating system kind of a minimum condition for network usability.</p>\n\n<p>Samba last functioned reliably for me more than ten years ago. I have attempted to use it on and off since then with only intermittent success. </p>\n\n<p>Oh, and \"Personal File Sharing\" from the Preferences menu does not result in an entry in Places &rarr; Network &rarr; my-server. In fact, the old entry \"MY-SERVER\" goes away and is replaced by \"koanhead's public files on my-server\", which when I attempt to open it from the laptop gives a \"DBus.Error.NoReply: Message did not receive a reply.\"</p>\n\n<p>I know I come here and gripe about Ubuntu a lot, but on the other hand I spend literally hours <em>every day</em> trying to fix things in Ubuntu. It's a good system which aspires to greatness, which is why things like this either</p>\n\n<ol>\n<li><p>Need to work; or</p></li>\n<li><p>Be adequately documented.</p></li>\n</ol>\n\n<p>Ideally both would be the case. Anyway, rant over. Hopefully someone will have some insight on this issue. Thanks all who bother to read this wall o'text for your time.</p>\n"},{"id":449769,"title":"Access samba share from other linux client","body":"<p>First of all, I'm a long-time Windows user and thought I should try something new. So be easy on me and pardon in ahead if i don't get all that linux mumble-jumble ;)</p>\n\n<p>So i installed a Ubuntu Server and started to create samba shares. I wanted one share public accessible without password and one share that required password.\nThe password less share is all fine, but the password-protected share is not working as fine. When i try to browse the share from a Windows client i get a login window and enter the username and password. That's all working great, but when i try to access the same shared folder from a Linux client and enter username and password it seems as it's the wrong password. Just keep getting the credentials windows thrown in my face.</p>\n\n<p>Any ideas what could be wrong?\nThanks in advance</p>\n"},{"id":425515,"title":"How setup samba share only readable by a certain domain group?","body":"<p>I'm using Ubuntu Server 12.04 connected to an active directory by Likewise open. I want to be able to share my files with others in the same domain group. I've followed <a href=\"http://help.ubuntu.com/12.04/serverguide/samba-ad-integration.html\" rel=\"nofollow\">this guide</a>  and also uncommented the [homes] section in <code>smb.conf</code> file and created a new share with read permission for group members. I have only managed to share files when allowing guests, otherwise I only get an authentication pop-up, that is unable to actually authenticate with my credentials (my domain user, used to login on both Windows and Ubuntu). I've googled around and found lots of confusing information that either doesn't apply to Likewise open or simply doesn't work.  Surely I don't need to setup Samba as a Domain Controller to do this? I just want to setup an Ubuntu file server in a Windows domain. I can see the shares but when I double click I get a popup asking for user, domain and password, but none is accepted. I've tried to map the domain group to a Linux group but that didn't work either. Please help.</p>\n"},{"id":251179,"title":"File sharing through samba is not working over LAN","body":"<p>getting the following error while running net usershare command.\nnet usershare' returned error 255: net usershare: cannot open usershare directory /var/lib/samba/usershares. Error Permission denied\nYou do not have permission to create a usershare. Ask your administrator to grant you permissions to create a share.</p>\n\n<p>How to fix this?\nThanks,\n:)</p>\n"},{"id":280859,"title":"Samba shares, using smb.conf or /var/lib/samba/usershare","body":"<p>Ok, so I caused my own problem by trying to be funny. And now I am very confused about how to fix it.</p>\n\n<p>So here we go:\nOur server has had 2 open shares since day one. only one of them offered windows users write permissions, and the other worked fine for mac or *nix boxes. Both files looked as follows.</p>\n\n<p><code>/etc/samba/smb.conf</code></p>\n\n<pre><code>[HomeShare]\n    path = /home/\n    browseable = yes\n    read only = no\n    guest ok = no\n    force create mode = 0775\n    force directory mode = 0775\n    valid users = @users\n</code></pre>\n\n<p>This has worked fine for years, and allows our users to connect with their windows desktops and have read\\write permissions all fine.</p>\n\n<p><code>/var/lib/samba/usershare/home</code></p>\n\n<pre><code>#version\npath=/home\ncomment=\nusershare_acl=S-1-1-0:R\nguest_ok=n\n</code></pre>\n\n<p>This, we don't really know why was setup, never needed or used. But took forever to finally trace down and remove several months ago.</p>\n\n<p>So to get to the point I thought it would be funny to comment out the share definition in the <code>smb.conf</code> </p>\n\n<p>#i just blocked out the lines. So that the information wouldn't be lost, just not read after restarting samba.</p>\n\n<p>then recreated the share file in <code>/var/lib/samba/usershare/home</code> except changed the name to <code>HomeShare</code>, a quick <strong><em>$sudo service smbd restart</em></strong> later and voila suddenly the network share claims to be readonly.</p>\n\n<p>My problem is that after removing the file from <code>samba/usershare/</code> and un-commenting the original <code>[HomeShare]</code> definition, neither restarting samba, or a full system reboot allows write access again.  I changed the share name to <code>[HomeShares]</code> and everything works perfectly again. So my guess is there is some cached record someplace of the name with the wrong permissions.</p>\n\n<p>Any help or suggested directions to clear this error would be most useful.</p>\n"},{"id":178121,"title":"why samba share files are not able to access by some user for some time?","body":"<p>I'm running samba on Ubuntu Server 10.04 LTS, I've some folders on samba share and created some user to access it, but suddenly some of the user are not able to access it for a certain time only.</p>\n\n<p>For i.e: </p>\n\n<p>There are 5 users as A,B,C,D,E and there are two folders in samba share name as \"test\" and \"develop\" </p>\n\n<p>\"test\" doesn't have any user access password but \"develop\" has user access with password.</p>\n\n<p>Now A,C,E are able to access folder \"develop\" with their samba password but B,D are not able to access with their samba password for some time only or if I use B-username &amp; password in A or C laptop its working fine at that time.</p>\n\n<p>While connecting to samba share, below error message appears:</p>\n\n<pre><code>An error has occurred while connecting [drive letter]: to [share name] Microsoft Windows Network: the local device name is already in use. \nThis connection has not been restored.\n</code></pre>\n\n<p>This happens randomly with the username &amp; laptops.</p>\n\n<p>I restarted entire network &amp; server &amp; laptop but still doesn't work.</p>\n\n<p>Any solution for this?</p>\n"}]}]