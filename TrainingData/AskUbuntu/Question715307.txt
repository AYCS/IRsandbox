[{"id":715307,"title":"Forgot vsftpd password on local machine","body":"<p>I forgot my vsftpd password on local machine which i put while ftp 127.0.0.1 , now I want to see <strong>or</strong> change my password . I tried to remove completely and install again vsftpd but still the same problem. Here's /etc/vsftpd.conf's contents:</p>\n\n<pre><code># Example config file /etc/vsftpd.conf\n#\n# The default compiled in settings are fairly paranoid. This sample file\n# loosens things up a bit, to make the ftp daemon more usable.\n# Please see vsftpd.conf.5 for all compiled in defaults.\n#\n# READ THIS: This example file is NOT an exhaustive list of vsftpd options.\n# Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd's\n# capabilities.\n#\n#\n# Run standalone?  vsftpd can run either from an inetd or as a standalone\n# daemon started from an initscript.\nlisten=YES\n#\n# Run standalone with IPv6?\n# Like the listen parameter, except vsftpd will listen on an IPv6 socket\n# instead of an IPv4 one. This parameter and the listen parameter are   mutually\n# exclusive.\n#listen_ipv6=YES\n#\n# Allow anonymous FTP? (Disabled by default)\nanonymous_enable=NO\n#\n# Uncomment this to allow local users to log in.\nlocal_enable=YES\n#\n# Uncomment this to enable any form of FTP write command.\n#write_enable=YES\n#\n# Default umask for local users is 077. You may wish to change this to 022,\n# if your users expect that (022 is used by most other ftpd's)\n#local_umask=022\n#\n# Uncomment this to allow the anonymous FTP user to upload files. This only\n# has an effect if the above global write enable is activated. Also, you  will\n# obviously need to create a directory writable by the FTP user.\n#anon_upload_enable=YES\n#\n# Uncomment this if you want the anonymous FTP user to be able to create\n# new directories.\n#anon_mkdir_write_enable=YES\n#\n# Activate directory messages - messages given to remote users when they\n# go into a certain directory.\ndirmessage_enable=YES\n#\n# If enabled, vsftpd will display directory listings with the time\n# in  your  local  time  zone.  The default is to display GMT. The\n# times returned by the MDTM FTP command are also affected by this\n# option.\nuse_localtime=YES\n#\n# Activate logging of uploads/downloads.\nxferlog_enable=YES\n#\n# Make sure PORT transfer connections originate from port 20 (ftp-data).\nconnect_from_port_20=YES\n#\n# If you want, you can arrange for uploaded anonymous files to be owned by\n# a different user. Note! Using \"root\" for uploaded files is not\n# recommended!\n#chown_uploads=YES\n#chown_username=whoever\n#\n# You may override where the log file goes if you like. The default is shown\n# below.\n#xferlog_file=/var/log/vsftpd.log\n#\n# If you want, you can have your log file in standard ftpd xferlog format.\n# Note that the default log file location is /var/log/xferlog in this case.\n#xferlog_std_format=YES\n#\n# You may change the default value for timing out an idle session.\n#idle_session_timeout=600\n#\n# You may change the default value for timing out a data connection.\n#data_connection_timeout=120\n#\n# It is recommended that you define on your system a unique user which the\n# ftp server can use as a totally isolated and unprivileged user.\n#nopriv_user=ftpsecure\n#\n# Enable this and the server will recognise asynchronous ABOR requests. Not\n# recommended for security (the code is non-trivial). Not enabling it,\n# however, may confuse older FTP clients.\n#async_abor_enable=YES\n#\n# By default the server will pretend to allow ASCII mode but in fact ignore\n# the request. Turn on the below options to have the server actually do   ASCII\n# mangling on files when in ASCII mode.\n# Beware that on some FTP servers, ASCII support allows a denial of service\n# attack (DoS) via the command \"SIZE /big/file\" in ASCII mode. vsftpd\n# predicted this attack and has always been safe, reporting the size of the\n# raw file.\n# ASCII mangling is a horrible feature of the protocol.\n#ascii_upload_enable=YES\n#ascii_download_enable=YES\n#\n# You may fully customise the login banner string:\n#ftpd_banner=Welcome to blah FTP service.\n#\n# You may specify a file of disallowed anonymous e-mail addresses. Apparently\n# useful for combatting certain DoS attacks.\n#deny_email_enable=YES\n# (default follows)\n#banned_email_file=/etc/vsftpd.banned_emails\n#\n# You may restrict local users to their home directories.  See the FAQ for\n# the possible risks in this before using chroot_local_user or\n# chroot_list_enable below.\n#chroot_local_user=YES\n#\n# You may specify an explicit list of local users to chroot() to their home\n# directory. If chroot_local_user is YES, then this list becomes a list of\n# users to NOT chroot().\n# (Warning! chroot'ing can be very dangerous. If using chroot, make sure that\n# the user does not have write access to the top level directory within the\n# chroot)\n#chroot_local_user=YES\n#chroot_list_enable=YES\n# (default follows)\n#chroot_list_file=/etc/vsftpd.chroot_list\n#\n# You may activate the \"-R\" option to the builtin ls. This is disabled by\n# default to avoid remote users being able to cause excessive I/O on large\n# sites. However, some broken FTP clients such as \"ncftp\" and \"mirror\" assume\n# the presence of the \"-R\" option, so there is a strong case for enabling it.\n#ls_recurse_enable=YES\n#\n# Customization\n#\n# Some of vsftpd's settings don't fit the filesystem layout by\n# default.\n#\n# This option should be the name of a directory which is empty.  Also, the\n# directory should not be writable by the ftp user. This directory is used\n# as a secure chroot() jail at times vsftpd does not require filesystem\n# access.\nsecure_chroot_dir=/var/run/vsftpd/empty\n#\n# This string is the name of the PAM service vsftpd will use.\npam_service_name=vsftpd\n#\n# This option specifies the location of the RSA certificate to use for SSL\n# encrypted connections.\nrsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem\n# This option specifies the location of the RSA key to use for SSL\n# encrypted connections.\nrsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key\nlisten=YES\nlocal_enable=YES\nwrite_enable=YES\ndirmessage_enable=YES\nuse_localtime=YES\nxferlog_enable=YES\nuserlist_deny=NO\nuserlist_file=/etc/vsftpd.userlist\nuserlist_enable=YES\n</code></pre>\n","related_questions":[{"id":705093,"title":"why can vsftpd by passive mode work with firewall allowing only 21 port?","body":"<p>I have a question.</p>\n\n<p>Why can vsftpd by passive mode work with firewall allowing only 21 port ?</p>\n\n<p>I open only 21/tcp port.</p>\n\n<p>$ ufw enable</p>\n\n<p>$ ufw allow 21/tcp</p>\n\n<p>$ cat /etc/vsftpd.conf | grep pasv</p>\n\n<p>pasv_enable=YES<br/>\n  pasv_min_port=13000<br/>\n  pasv_max_port=13100</p>\n\n<p>vsftpd listens to 13000~13100 ports\nand ftp clients connect to 13000~13100 ports.</p>\n\n<p>I don't allow these ports.\nBut it works well.</p>\n\n<p>... </p>\n"},{"id":672484,"title":"vsftp configuration for anonymous and local user","body":"<p>Hello I'm newbie in linux world and I'm trying to configure vsftp server for local users (just we admins, who can upload and download files) and anonymous for all other who can need it. </p>\n\n<p>So idea is local users login with user and password and upload and download and delete and make dirs. Anonymous users just view and download any files.</p>\n\n<p>The ftp folder must be /ftp for anonymous and local users too. </p>\n\n<p>I have such listing in my <code>vsftpd.conf</code></p>\n\n<pre><code>listen=YES\nanonymous_enable=YES\nlocal_enable=YES\nwrite_enable=YES\n\ndirmessage_enable=YES\nuse_localtime=YES\nxferlog_enable=YES\n\nlocal_root=/ftp\nanon_root=/ftp\nallow_writeable_chroot=YES\nanon_upload_enable=NO\nanon_mkdir_write_enable=NO\n</code></pre>\n\n<p>The problem is that local users work but anonymous log in, but cannot see any files and dirs.</p>\n"},{"id":453784,"title":"vsftpd installation not working on virtual server as of 14.04","body":"<p>The process I have used for installing vsftpd since 12.04 no longer works. I get the error <code>stop: Unknown instance</code> when restarting the service. I believe this means the configuration is wrong, but I cannot track down the issue. I'm having this problem on a virtual server.</p>\n\n<p>Additionally, running <code>sudo vsftpd</code> results in <code>500 OOPS: munmap</code> as noted by @Beltran.</p>\n\n<hr>\n\n<ol>\n<li><p>Acquire root privileges</p>\n\n<pre><code>sudo -s\n</code></pre></li>\n<li><p>Install vsftpd and libpam-pwdfile</p>\n\n<pre><code>apt-get install vsftpd libpam-pwdfile\n</code></pre></li>\n<li><p>Edit vsftpd.conf</p>\n\n<pre><code>mv /etc/vsftpd.conf /etc/vsftpd.conf.bak\nvim /etc/vsftpd.conf\n</code></pre>\n\n<p>Copy and paste the following lines.</p>\n\n<pre><code>allow_writeable_chroot=YES\nanonymous_enable=NO\nchroot_list_enable=YES\nchroot_local_user=YES\nguest_enable=YES\nguest_username=vsftpd\nhide_ids=YES\nlisten=YES\nlocal_enable=YES\nlocal_umask=022\nlocal_root=/var/clients/$USER\nnopriv_user=vsftpd\npasv_address=127.0.0.1\npasv_enable=YES\npasv_min_port=65000\npasv_max_port=65100\nport_enable=YES\nuser_sub_token=$USER\nseccomp_sandbox=NO\nvirtual_use_local_privs=YES\nwrite_enable=YES\n</code></pre></li>\n<li><p>Register virtual admin</p>\n\n<pre><code>apt-get install apache2-utils\nmkdir /etc/vsftpd\nhtpasswd -cd /etc/vsftpd/ftpd.passwd admin\nvim /etc/vsftpd.chroot_list\n</code></pre>\n\n<p>Add 1 line for the admin user</p>\n\n<pre><code>admin\n</code></pre></li>\n<li><p>Configure PAM</p>\n\n<pre><code>mv /etc/pam.d/vsftpd /etc/pam.d/vsftpd.bak\nvim /etc/pam.d/vsftpd\n</code></pre>\n\n<p>Copy and paste these 2 lines.</p>\n\n<pre><code>auth required pam_pwdfile.so pwdfile /etc/vsftpd/ftpd.passwd\naccount required pam_permit.so\n</code></pre></li>\n<li><p>Create a local user without shell access</p>\n\n<pre><code>useradd --home /home/vsftpd --gid nogroup -m --shell /bin/false vsftpd\n</code></pre></li>\n<li><p>Create root directory and give local user proper access.</p>\n\n<pre><code>mkdir /var/clients\nchmod -R 755 /var/clients\nchown -R vsftpd:nogroup /var/clients\n</code></pre></li>\n<li><p>Register jailed virtual users <em>(initially, I skip this step)</em></p>\n\n<pre><code>htpasswd -d /etc/vsftpd/ftpd.passwd {user_name}\nmkdir /var/clients/{user_name}\n</code></pre></li>\n<li><p>Restart service</p>\n\n<pre><code>service vsftpd restart\n</code></pre></li>\n</ol>\n"},{"id":617370,"title":"Why vsftpd doesnt work when pam_service_name=vsftpd?","body":"<p>I did a vsftpd setup on my home server. I got some authentication error so I searched through this forum and got a solution. \n<a href=\"http://askubuntu.com/questions/129563/vsftpd-configuration-problems-with-12-04\">This solution worked for me</a></p>\n\n<p>As in the solution. the default setting</p>\n\n<pre><code>pam_service_name=vsftpd\n</code></pre>\n\n<p>doesnt work and FTP server doesnt allow me to login. </p>\n\n<p>And After I changed it to</p>\n\n<pre><code>pam_service_name=ftp\n</code></pre>\n\n<p>It works and I can login as my local user to the FTP server. What is the reason behind this? Why the default doesnt work?\nI'm learning linux so your good explanation can help me a lot</p>\n"},{"id":615003,"title":"I can&#39;t remove VSFTPD from the boot system in Kubuntu 14.04","body":"<p>I have a problem with VSFTPD on Kubuntu 14.04. I have the service installed, but I can't remove it from the boot system. I tried it many times with <em>“update-rc.d -f foobar remove”</em> but it remains booting with the system.</p>\n\n<p>How do I remove VSFTPD from the boot system and starting the service manually? I searched a little, but I didn't found any solve, and I'm bored to try it.</p>\n\n<p>I'm considering to switch to another FTP server if there is any easy to configure.</p>\n"},{"id":592577,"title":"vsftpd PASV configuration set up, yet still not working","body":"<p>So, I've been researching FTP/FTPS, and have been trying to set up a working FTPS server. To use FTP(S), I've been using the service vsftpd, and the my server is an amazon EC2 instance running Ubuntu 14.04. </p>\n\n<pre><code>masq@ftp:~$ uname -a\nLinux ftp 3.15.0-031500rc2-generic #201404201435 SMP Sun Apr 20 18:36:18 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux\n</code></pre>\n\n<p>Now, the configuration file <em>seems</em> pretty straightforward in setting up. <em>HOW-EVER</em>, things.. aren't working properly... for some reason...</p>\n\n<p>The problem I'd like addressed in this thread is the problem of passive vs. active configuration. \nNow, I've enabled pasv mode in the config file. I've specified some ports for pasv to utilize, and I've specified the address that it's on... etc. (I'll post my file's config below) and yet... I still get this error when i issue an \"ls\" command over ftp! Here is an example run of that (I'm just FTPing to localhost so i know that firewall stuff isn't getting in the way (that <em>does</em> ensure that firewall doesn't get in the way... right?!)):</p>\n\n<pre><code>masq@ftp:~$ ftp localhost\nConnected to localhost.\n220 (vsFTPd 3.0.2)\nName (localhost:masq): john\n331 Please specify the password.\nPassword:\n230 Login successful.\nRemote system type is UNIX.\nUsing binary mode to transfer files.\nftp&gt; ls\n200 PORT command successful. Consider using PASV.\n150 Here comes the directory listing.\n-rw-rw-r--    1 1000     1000            0 Feb 18 04:55 random\n226 Directory send OK.\nftp&gt; passive\nPassive mode on.\nftp&gt; ls\n227 Entering Passive Mode (xxx,xxx,xxx,xxx,46,229).\nftp: connect: Connection refused\nftp&gt;\n</code></pre>\n\n<p>and here is my config file...</p>\n\n<pre><code># allow anyone to connect?\nanonymous_enable=NO\n\n# is it turned on?\nlisten=YES\nxferlog_enable=YES\nlog_ftp_protocol=YES\n\n# allow people to upload?\nwrite_enable=NO\n\n# allow people to download?\ndownload_enable=YES\n\n# passive/active mode configuration\npasv_enable=YES\npasv_max_port=12050\npasv_min_port=12000\nport_enable=YES\npasv_address=&lt;retracted public IP&gt;\n# if pasv_address_resolve=YES, pasv_address should be a name, e.g. ftp.blah.com\n#pasv_addr_resolve=YES\n\n# local account enable\nlocal_enable=YES\nchroot_local_user=YES\nuser_sub_token=$USER\nlocal_root=/home/$USER\nallow_writeable_chroot=YES\n\n# ssl config\n#ssl_enable=YES\n</code></pre>\n\n<p>So... I've got pasv_enable=YES... and all of the other options set as properly as all my research has told me, and yet it's not actually able to work in pasv mode. Does anyone know why this isn't working? >_></p>\n\n<p>I've tried to reach this server from the internet using a computer that will not work with active connections and it fails to get directory listings, i.e. pasv is definitely not working. :/</p>\n\n<p>Thanks, guys, I'm really stumped with this one. I can provide any more information if necessary.</p>\n\n<p>P.S. I did configure my ec2 security group to open ports 12000-12050, ports 20-21, TCP... so i don't think that's a problem either.</p>\n\n<p>EDIT 1: Ubuntu version is 14.04 LTS Trusty. vsftpd: version 3.0.2</p>\n\n<pre><code>masq@ftp:~$ sudo cat /var/log/vsftpd.log                                  \nThu Mar 12 00:35:38 2015 [pid 19825] \nCONNECT: Client \"127.0.0.1\"          \nThu Mar 12 00:35:46 2015 [pid 19824] \n[masq] OK LOGIN: Client \"127.0.0.1\"  \nThu Mar 12 00:37:19 2015 [pid 19834] \nCONNECT: Client \"127.0.0.1\"          \nThu Mar 12 00:37:24 2015 [pid 19833] \n[masq] OK LOGIN: Client \"127.0.0.1\"\n</code></pre>\n\n<p>^ there is a run of me logging in via localhost and requesting a directory. then i logged out and logged back in and issued the passive command, and it failed despite having pasv_enable=YES in the config file as i showed in the original post.</p>\n\n<p>Something else i noticed is that if i just run </p>\n\n<pre><code>$sudo vsftpd\n500 OOPS: could not bind listening IPv4 socket\n</code></pre>\n\n<p>I get this error. once again, I'm using amazon ec2 and so as my pasv_address=xxx.xxx.xxx.xxx is my public ip address, not my private one. do you know where in the logs i could find logs being more verbose about what that failure to bind to the socket error? I just discovered this since posting, and I'm starting to think this is the cause of my problem.</p>\n\n<p>EDIT_2: I tried connecting from an external source, and tried locally (just FTPing localhost on my server box)</p>\n\n<pre><code>Wed Mar 18 01:36:10 2015 [pid 8194] CONNECT: Client \"127.0.0.1\"\nWed Mar 18 01:36:10 2015 [pid 8194] FTP response: Client \"127.0.0.1\", \"220 (vsFTPd 3.0.2)\"\nWed Mar 18 01:36:16 2015 [pid 8194] FTP command: Client \"127.0.0.1\", \"USER masq\"\nWed Mar 18 01:36:16 2015 [pid 8194] [masq] FTP response: Client \"127.0.0.1\", \"331 Please specify the password.\"\nWed Mar 18 01:36:20 2015 [pid 8194] [masq] FTP command: Client \"127.0.0.1\", \"PASS &lt;password&gt;\"\nWed Mar 18 01:36:20 2015 [pid 8193] [masq] OK LOGIN: Client \"127.0.0.1\"\nWed Mar 18 01:36:20 2015 [pid 8195] [masq] FTP response: Client \"127.0.0.1\", \"230 Login successful.\"\nWed Mar 18 01:36:20 2015 [pid 8195] [masq] FTP command: Client \"127.0.0.1\", \"SYST\"\nWed Mar 18 01:36:20 2015 [pid 8195] [masq] FTP response: Client \"127.0.0.1\", \"215 UNIX Type: L8\"\nWed Mar 18 01:36:22 2015 [pid 8195] [masq] FTP command: Client \"127.0.0.1\", \"PORT 127,0,0,1,204,221\"\nWed Mar 18 01:36:22 2015 [pid 8195] [masq] FTP response: Client \"127.0.0.1\", \"200 PORT command successful. Consider using PASV.\"\nWed Mar 18 01:36:22 2015 [pid 8195] [masq] FTP command: Client \"127.0.0.1\", \"LIST\"\nWed Mar 18 01:36:22 2015 [pid 8195] [masq] FTP response: Client \"127.0.0.1\", \"150 Here comes the directory listing.\"\nWed Mar 18 01:36:22 2015 [pid 8195] [masq] FTP response: Client \"127.0.0.1\", \"226 Directory send OK.\"\nWed Mar 18 01:36:35 2015 [pid 8195] [masq] FTP command: Client \"127.0.0.1\", \"PASV\"\nWed Mar 18 01:36:35 2015 [pid 8195] [masq] FTP response: Client \"127.0.0.1\", \"227 Entering Passive Mode (52,10,22,18,46,246).\"\nWed Mar 18 01:36:47 2015 [pid 8195] [masq] FTP command: Client \"127.0.0.1\", \"QUIT\"\nWed Mar 18 01:36:47 2015 [pid 8195] [masq] FTP response: Client \"127.0.0.1\", \"221 Goodbye.\"\nWed Mar 18 01:58:11 2015 [pid 8257] CONNECT: Client \"127.0.0.1\"\nWed Mar 18 01:58:11 2015 [pid 8257] FTP response: Client \"127.0.0.1\", \"220 (vsFTPd 3.0.2)\"\nWed Mar 18 01:58:13 2015 [pid 8257] FTP command: Client \"127.0.0.1\", \"USER john\"\nWed Mar 18 01:58:13 2015 [pid 8257] [john] FTP response: Client \"127.0.0.1\", \"331 Please specify the password.\"\nWed Mar 18 01:58:15 2015 [pid 8257] [john] FTP command: Client \"127.0.0.1\", \"PASS &lt;password&gt;\"\nWed Mar 18 01:58:15 2015 [pid 8256] [john] OK LOGIN: Client \"127.0.0.1\"\nWed Mar 18 01:58:15 2015 [pid 8258] [john] FTP response: Client \"127.0.0.1\", \"230 Login successful.\"\nWed Mar 18 01:58:15 2015 [pid 8258] [john] FTP command: Client \"127.0.0.1\", \"SYST\"\nWed Mar 18 01:58:15 2015 [pid 8258] [john] FTP response: Client \"127.0.0.1\", \"215 UNIX Type: L8\"\nWed Mar 18 01:58:16 2015 [pid 8258] [john] FTP command: Client \"127.0.0.1\", \"PORT 127,0,0,1,183,134\"\nWed Mar 18 01:58:16 2015 [pid 8258] [john] FTP response: Client \"127.0.0.1\", \"200 PORT command successful. Consider using PASV.\"\nWed Mar 18 01:58:16 2015 [pid 8258] [john] FTP command: Client \"127.0.0.1\", \"LIST\"\nWed Mar 18 01:58:16 2015 [pid 8258] [john] FTP response: Client \"127.0.0.1\", \"150 Here comes the directory listing.\"\nWed Mar 18 01:58:16 2015 [pid 8258] [john] FTP response: Client \"127.0.0.1\", \"226 Directory send OK.\"\nWed Mar 18 01:58:22 2015 [pid 8258] [john] FTP command: Client \"127.0.0.1\", \"QUIT\"\nWed Mar 18 01:58:22 2015 [pid 8258] [john] FTP response: Client \"127.0.0.1\", \"221 Goodbye.\"\nWed Mar 18 02:14:44 2015 [pid 8374] CONNECT: Client \"xxx.xxx.2.43\"\nWed Mar 18 02:14:44 2015 [pid 8374] FTP response: Client \"xxx.xxx.2.43\", \"220 (vsFTPd 3.0.2)\"\nWed Mar 18 02:14:46 2015 [pid 8374] FTP command: Client \"xxx.xxx.2.43\", \"USER john\"\nWed Mar 18 02:14:46 2015 [pid 8374] [john] FTP response: Client \"xxx.xxx.2.43\", \"331 Please specify the password.\"\nWed Mar 18 02:14:49 2015 [pid 8374] [john] FTP command: Client \"xxx.xxx.2.43\", \"PASS &lt;password&gt;\"\nWed Mar 18 02:14:49 2015 [pid 8373] [john] OK LOGIN: Client \"xxx.xxx.2.43\"\nWed Mar 18 02:14:49 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"230 Login successful.\"\nWed Mar 18 02:14:49 2015 [pid 8375] [john] FTP command: Client \"xxx.xxx.2.43\", \"SYST\"\nWed Mar 18 02:14:49 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"215 UNIX Type: L8\"\nWed Mar 18 02:14:52 2015 [pid 8375] [john] FTP command: Client \"xxx.xxx.2.43\", \"PASV\"\nWed Mar 18 02:14:52 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"227 Entering Passive Mode (52,10,22,18,47,5).\"\nWed Mar 18 02:14:52 2015 [pid 8375] [john] FTP command: Client \"xxx.xxx.2.43\", \"LIST\"\nWed Mar 18 02:14:52 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"150 Here comes the directory listing.\"\nWed Mar 18 02:14:52 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"226 Directory send OK.\"\nWed Mar 18 02:15:06 2015 [pid 8375] [john] FTP command: Client \"xxx.xxx.2.43\", \"PORT 10,0,0,2,199,11\"\nWed Mar 18 02:15:06 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"500 Illegal PORT command.\"\nWed Mar 18 02:15:21 2015 [pid 8375] [john] FTP command: Client \"xxx.xxx.2.43\", \"PORT 10,0,0,2,235,22\"\nWed Mar 18 02:15:21 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"500 Illegal PORT command.\"\nWed Mar 18 02:15:24 2015 [pid 8375] [john] FTP command: Client \"xxx.xxx.2.43\", \"PASV\"\nWed Mar 18 02:15:24 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"227 Entering Passive Mode (52,10,22,18,46,232).\"\nWed Mar 18 02:15:24 2015 [pid 8375] [john] FTP command: Client \"xxx.xxx.2.43\", \"LIST\"\nWed Mar 18 02:15:24 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"150 Here comes the directory listing.\"\nWed Mar 18 02:15:24 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"226 Directory send OK.\"\nWed Mar 18 02:15:26 2015 [pid 8375] [john] FTP command: Client \"xxx.xxx.2.43\", \"PASV\"\nWed Mar 18 02:15:26 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"227 Entering Passive Mode (52,10,22,18,46,254).\"\nWed Mar 18 02:15:27 2015 [pid 8375] [john] FTP command: Client \"xxx.xxx.2.43\", \"LIST\"\nWed Mar 18 02:15:27 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"150 Here comes the directory listing.\"\nWed Mar 18 02:15:27 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"226 Directory send OK.\"\nWed Mar 18 02:15:35 2015 [pid 8375] [john] FTP command: Client \"xxx.xxx.2.43\", \"QUIT\"\nWed Mar 18 02:15:35 2015 [pid 8375] [john] FTP response: Client \"xxx.xxx.2.43\", \"221 Goodbye.\"\n</code></pre>\n\n<p>Here is the latest log (I altered my external IP however). Interestingly, I could successfully change to passive from my external client, where I couldn't when I tried connecting on the server itself. However, the external client I used was another Ubuntu 14.04 server I have. When I tried to connect externally from one of my windows clients using FileZilla or WinSCP (on FTP mode), I was unable to connect AT ALL anymore (passive or active) and those failed connections don't show up in the logs at all either. The server that I was successfully able to connect with is on the same LAN as the windows client so any network issues should be present with both boxes. I was previously able to connect with my windows client using active connections but for whatever reason it's not working even with that.</p>\n"},{"id":257154,"title":"Configure vsftpd to chown uploaded files","body":"<p>I have vsftpd up and running on my Ubuntu server. This is a development server and I want to be able to FTP my code directly to the directory which Apache is serving out.</p>\n\n<p>As most of you know, www-data is the Apache user and the www-data user needs to have permissions to the directory that Apache is serving out.</p>\n\n<p>I didn't want to make www-data an FTP user as well, so what I did instead was create another user for use with FTP, and put both www-data and the new user in a new group called www.</p>\n\n<p>I did a <code>chown -R www-data:www *</code> to the directory that Apache is serving and it works mostly fine.</p>\n\n<p>The issue comes in when I FTP upload a file that didn't previously exist in that directory. The owner gets set to my FTP user. I want the owner to get set to www-data and the group to get set to www whenever a new file gets uploaded.</p>\n\n<p>Is there any way to do this with vsftpd? </p>\n\n<p>I've been furiously googling around for hours, but I can't find a way to do it. Any help would be greatly appreciated.</p>\n\n<p>Edit:</p>\n\n<p>I just set up a couple of cron jobs to run every minute and set the permissions:</p>\n\n<p><code>*/1 * * * * chown -R www-data:www /var/www</code></p>\n\n<p><code>*/1 * * * * chmod -R g+rw /var/www</code></p>\n\n<p>It works but it's kind of clunky, and there's a ~1 minute delay between me uploading new code and having it work when I hit F5 in my browser.</p>\n"},{"id":225761,"title":"vsftpd - restrict users to home directory","body":"<p>Setup vsftpd easily</p>\n\n<p>If I run this config:</p>\n\n<pre><code>listen=YES\nanonymous_enable=NO\nlocal_enable=YES\nwrite_enable=NO\ndirmessage_enable=YES\nuse_localtime=YES\nxferlog_enable=YES\nconnect_from_port_20=YES\nchroot_local_user=YES\nsecure_chroot_dir=/var/run/vsftpd/empty\npam_service_name=vsftpd\nrsa_cert_file=/etc/ssl/private/vsftpd.pem\n</code></pre>\n\n<p>Then I get an error message: 500 OOPS: vsftpd: refusing to run with writable root inside chroot()</p>\n\n<p>However, if I add in:\nallow_writeable_chroot=YES\nas suggested <a href=\"http://www.benscobie.com/fixing-500-oops-vsftpd-refusing-to-run-with-writable-root-inside-chroot/\" rel=\"nofollow\">here</a>, then It just fials to connect:\nConnection attempt failed with \"ECONNREFUSED - Connection refused by server\".</p>\n\n<p>However, if I remove that line that was just added and perform \nsudo chmod a-w on the users home directory they can now connect but the service is pointless as they cant upload anything.</p>\n\n<p>Is there a way to restrict users to just their home directory, AND be able to connect and write to their home directory? Turning off chroot_local_user is not an option as they can then browse all the other users directories.</p>\n\n<p>Stu</p>\n"},{"id":193325,"title":"VSFTPD: default to local user subdirectory","body":"<p>The goal: when a local user logs in to ftp, the user is directed to /home/{username}/htdocs.  The expectation is that FileZilla or equivalent will show / and the contents of /home/{username}/htdocs below  Like this:</p>\n\n<pre><code>/-\n  -file1\n  -file2\n  |-dir1\n  |-dir2\n</code></pre>\n\n<p>The closest I can get is to see / as /home/{username} and then its contents below.  </p>\n\n<pre><code>/-\n  |-htdocs\n    |-file1\n    |-file2\n    |-dir1\n    |-dir2\n</code></pre>\n\n<p>I have tried multiple variations on the configurations suggested by all the postings on vsftpd but none seem to get me where I want to go.  Either one can't get there from here or I'm missing something.</p>\n\n<p>I've pared vsftpd.conf to a minimum:</p>\n\n<pre><code>listen=YES\nanonymous_enable=NO\nlocal_enable=YES\nwrite_enable=YES\ndirmessage_enable=YES\nuse_localtime=YES\nconnect_from_port_20=YES\nvirtual_use_local_privs=YES\n#chroot_local_user=YES\nuser_config_dir=/etc/vsftp/users\n</code></pre>\n\n<p>With /etc/vsftp/users containing a file named {username} containing</p>\n\n<pre><code>local_root=/home/{username}/htdocs\n</code></pre>\n\n<p>This doesn't get me where I want to go.</p>\n\n<p>So, what am I missing?</p>\n\n<p>[Note: this is in anticipation of no result to my question <a href=\"http://askubuntu.com/questions/192917/defaultroot-in-proftpd-virtual-host-not-going-to-subdirectory\">about proftpd earlier</a>]</p>\n\n<p>Thanks.</p>\n\n<p>George</p>\n"},{"id":55223,"title":"Setting vsftpd for upload to public (http)","body":"<p>I just installed LAMP, vsftpd on Ubuntu server 11.04 64bits and I'm going to to adduser for ftp and let's users (in private LAN) upload files to public in private LAN such as <a href=\"http://local-server-ip/username/\" rel=\"nofollow\">http://local-server-ip/username/</a> could anyone recommend link or help me list these steps what I should to do? I try it before with Googling and I getting a lot of problems about permission after users add files into my specific path of apache2, when anyone open in browser it show \"Forbidden: You don't have permission to access /... on this server.\" then I re-install it. (for remove my dirty configuration).. <em>Sorry for my terrible English</em> </p>\n"}]}]