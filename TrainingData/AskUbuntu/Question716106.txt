[{"id":716106,"title":"Working with screen sessions in LXD-managed containers","body":"<p>I have been trying to attach and detach <code>screen</code> sessions in LXD-managed containers; initially, I wasn't able to even start one, but that problem <a href=\"http://askubuntu.com/q/716028/142526\">was answered here</a>.</p>\n\n<p>However, being able to start a session, then detach it, isn't sufficient. To work with <code>screen</code> sessions, one must be able to re-attach to a certain session.</p>\n\n<p>I can initiate a session with</p>\n\n<pre><code>lxc exec my-ubuntu -- sh -c \"exec &gt;/dev/tty 2&gt;/dev/tty &lt;/dev/tty &amp;&amp; /usr/bin/screen -s /bin/bash\"\n</code></pre>\n\n<p>but then, when I issue</p>\n\n<pre><code>lxc exec my-ubuntu -- sh -c \"exec &gt;/dev/tty 2&gt;/dev/tty &lt;/dev/tty &amp;&amp; /usr/bin/screen -x\"\n</code></pre>\n\n<p>either nothing at all happens (I just get another command line) or, if I've issued the first command more than once, I get <code>There are several suitable screens on:</code> followed by a list of sessions, and a suggestion to re-attach to them with <code>\"screen [-d] -r [pid.]tty.host\"</code>. However, that also fails silently. I've also tried to issue</p>\n\n<pre><code>lxc exec my-ubuntu -- sh -c \"exec &gt;/dev/tty 2&gt;/dev/tty &lt;/dev/tty &amp;&amp; /bin/bash\"\n</code></pre>\n\n<p>and then <code>screen -x</code> from the resulting terminal, to no avail.</p>\n\n<p>What can I do?</p>\n\n<p><strong>EDIT</strong>:\nIf I use the last command to get a terminal inside my container <code>my-ubuntu</code>, I can initiate <code>screen</code> sessions just typing <code>screen</code>, and detach them with <code>CTRL-a</code> followed by <code>d</code>. However, <code>screen -x</code> then fails silently just as described above, and if I try <code>CTRL-a</code> followed by <code>n</code> from within a session, it reports <code>no other window.</code></p>\n","related_questions":[{"id":716028,"title":"Start a screen session inside LXD-managed container","body":"<p>I'd like to start a <code>screen</code> session inside an LXD-managed container so that I could detach running processes and maybe re-attach in the future when I want to check on their status.</p>\n\n<p>I tried to attach to the container running</p>\n\n<pre><code>$ lxc exec my-ubuntu -- /bin/bash\n</code></pre>\n\n<p>and then start a session with <code>screen -x</code>, but I get the following error:</p>\n\n<pre><code>Must be connected to a terminal.\n</code></pre>\n\n<p>I can see that many people have had a similar problem when trying to initiate <code>screen</code> from <code>ssh</code>, but I couldn't apply the suggested solution to my case.</p>\n"},{"id":650471,"title":"How do I allow /dev/net/Tun in a LXD managed LXC container?","body":"<p>I am trying to get Openvpn run inside a LXD/LXC container, and redirect traffic coming to the container to the VPN.</p>\n\n<p>The purpose is to replace a fully fledged VM that does exactly that (and toy with LXD :-)</p>\n\n<p>I managed to get an IP from my main DHCP server, set up the iptables rules for masquerading / forwarding the traffic, but when I try to launch openvpn, it is blocked by the lack of (access to) /dev/net/tun device.</p>\n\n<p>I came accross this post on ServerFault <a href=\"http://serverfault.com/questions/429461/no-tun-device-in-lxc-guest-for-openvpn\">http://serverfault.com/questions/429461/no-tun-device-in-lxc-guest-for-openvpn</a>, but it does not seem to work with current version of LXC and/or LXD managing the configuration...</p>\n\n<p>EDIT: I tried using this incantation, but it did not succeed:</p>\n\n<pre><code>lxc config set mycontainer raw.lxc 'lxc.cgroup.devices.allow = c 10:200 rwm'\n</code></pre>\n\n<p>EDIT2: tried <code>lxc config device add mycontainer tun unix-char path=/dev/net/tun major=10 minor=200</code> but on next stop/start, I got </p>\n\n<blockquote>\n  <p>error: Failed configuring device tun: Not implemented</p>\n</blockquote>\n\n<p>Now I can't even <code>lxc config device remove mycontainer tun</code> as it throws the same Not implemented error. Container seems to be lost...</p>\n"},{"id":665741,"title":"How to create a LXD container on a machine and register it in MAAS?","body":"<p>Is it possible to deploy a bare-metal machine with MAAS and create some LXD instances that are registered in a MAAS zone?</p>\n"},{"id":690488,"title":"Mount LXD guest directory without destroying data and ownership","body":"<p>I've created a LXD guest for hosting my webserver, and to easily access the document root, I did:</p>\n\n<pre><code>lxc config device add guest sharedhtml disk path=/document/root/ source=/home/$USER/public_html\n</code></pre>\n\n<p>This did two things:</p>\n\n<ul>\n<li>completely replaced <code>/document/root/</code> with <code>public_html/</code> (all default webserver files are gone, as <code>public-html</code> is empty)</li>\n<li>destroyed <code>/document/root</code> ownership settings; the directory and the files I create in <code>public_html/</code> is now owned by <code>nobody:nogroup</code></li>\n</ul>\n\n<p>As I understand, this is more like a reverse mount; instead of mounting the guest's directory, the host's directory is reverse mounted forcefully into the guest.</p>\n\n<p>How may I mount guest directory in host without destroying existing contents make it so that the changes inherit the guest directory's ownership settings?</p>\n\n<p>Bonus: how do I remove the <code>device</code> that's mounting the directory?</p>\n"},{"id":697458,"title":"lxd forkstart: the famous error","body":"<p>I just started diving into the cloud computing, trying to hypervisor my ubuntu server. I started with LXD but it raises few issues at early stage.</p>\n\n<p>Whenever I want to create a container lxd send this message:</p>\n\n<pre><code> error: Error calling 'lxd forkstart \"name of my container\" \"container path/lxc.conf\"': err='exit status 1'\n</code></pre>\n\n<p>I was using the ubuntu server with kernel 4.0.18 (the latest one) and then after spending sometimes (hours) I found that most of those using LXD have faced the same issue and they solved by downgrading the kernel. \nI did that and downgraded my kernel to -4.0.0, but with no luck, I still have the same message error.</p>\n\n<p>Is there any solution for this problem?</p>\n\n<p>Will appreciate your help</p>\n"},{"id":356006,"title":"kill a screen session","body":"<p>I'm trying to kill a screen session. I noticed a lot of other related questions, but none of those answers are working for me. I am trying to kill the following session:</p>\n\n<pre><code>screen -ls\nThere is a screen on:\n    23520.pts-6.porkypig    (09/30/2013 02:49:47 PM)    (Detached)\n1 Socket in /var/run/screen/S-root.\n\nscreen -r 23520.pts-6.porkypig\n</code></pre>\n\n<p>Now I am in the session. According to the documentation:</p>\n\n<p><a href=\"http://www.gnu.org/software/screen/manual/screen.html#Quit\">http://www.gnu.org/software/screen/manual/screen.html#Quit</a></p>\n\n<p>I am supposed to press \"control a\" and then \"control \\\". I do that and nothing happens.</p>\n\n<p>Another solution said to  press Ctrl + a and type :quit. However, again it doesn't do anything. In fact, pressing control + a, absolutely nothing happens afterwards except a message \"No Other Window\"</p>\n"},{"id":694349,"title":"LXD container refusing connections from the host","body":"<p>I'm pretty new to LXD having recently discovered it.  I'm making progress with the basic interactions with images and containers - it looks promising.</p>\n\n<p>Currently I am stuck on a problem connecting from the host to a service running in a local container.  This is my first time trying this.  I get a \"connection refused\" error.  More details below:</p>\n\n<pre><code>user@sparky1:~$ curl 10.0.3.49\ncurl: (7) Failed to connect to 10.0.3.49 port 80: Connection refused\nuser@sparky1:~$ \n</code></pre>\n\n<p>The host is Ubuntu Server 14.04 on my laptop - it's a new install and is pretty plain-vanila.  I let the system do all of the configuration (including the lxcbr0 bridge) and haven't changed any of the out-of-the-box defaults.</p>\n\n<p>I'm running a container based on a CentOSv6 image.  The container is started and inside I am running a web server.  From within the container I can connect to its local web server on port 80 just fine (by running \"curl hostname\").  It connects on the loopback IP 127.0.0.1  I get a valid response from the local web server from within the container.  Yay.</p>\n\n<p>A successful response (even though it's a 403 reponse):</p>\n\n<pre><code>[root@wc1 ~]# curl wc1\n&lt;!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"&gt;\n&lt;html&gt;&lt;head&gt;\n&lt;title&gt;403 Forbidden&lt;/title&gt;\n&lt;/head&gt;&lt;body&gt;\n&lt;h1&gt;Forbidden&lt;/h1&gt;\n&lt;p&gt;You don't have permission to access /\non this server.&lt;/p&gt;\n&lt;hr&gt;\n&lt;address&gt;IBM_HTTP_Server at wc1 Port 80&lt;/address&gt;\n&lt;/body&gt;&lt;/html&gt;\n[root@wc1 ~]#\n</code></pre>\n\n<p>If I try connecting via the IP on the bridge, either from within the container or from the host then I get the mentioned \"connection refused\" error.</p>\n\n<p>So, I'm trying to figure out what it will take to allow connections from the host to the the web server running in the container.  I have spent a few hours googling and have not found the answer (or been too dense to recognize it).</p>\n\n<p>The firewall is disabled (\"ufw status\" says so).  What am I missing?  Thanks in advance.</p>\n"},{"id":691039,"title":"Adding a shared host directory to an LXC/LXD Container","body":"<p>I have been experimenting with LXC/LXD on Ubuntu 14.04 and it's all working great. I just need to figure out how to get shared directories working between my host machine and a container so I can ditch Virtualbox once and for all.</p>\n\n<p>I have seen this page: <a href=\"https://wiki.gentoo.org/wiki/LXD\" rel=\"nofollow\">https://wiki.gentoo.org/wiki/LXD</a></p>\n\n<p>Which provides instructions, but I just keep getting errors. </p>\n\n<p>Does anyone know of any simple, clear instructions to get this working? Any help much appreciated.</p>\n"},{"id":650546,"title":"How to persist configuration changes accross restart with LXD containers?","body":"<p>I am experimenting with LXD, but I'm stuck with a seamingly simple problem: I can't make my bridge config persistent.</p>\n\n<p>The host server has a birdge <code>br0</code>. By default, lxd managed containers will use <code>lxcbr0</code> and be on another network.</p>\n\n<p>What I want is a container that will get its IP from my main DHCP server, and share the same network as the rest of my servers.</p>\n\n<p>I managed to do so using this stanza:</p>\n\n<pre><code>lxc config set mycontainer raw.lxc 'lxc.network.link = br0'\n</code></pre>\n\n<p>This seems to work, but every now and then, the configuration gets lost, and the container falls back onto lxcbr0 !</p>\n\n<ul>\n<li>So, is this the right way to get my container to use br0 ?</li>\n<li>And what is the way to make this persistent for real ?</li>\n</ul>\n"},{"id":646625,"title":"lxc launch hangs for lxd","body":"<p>New to lxd, and follow the article <a href=\"https://insights.ubuntu.com/2015/04/28/getting-started-with-lxd-the-container-lightervisor/\" rel=\"nofollow\">https://insights.ubuntu.com/2015/04/28/getting-started-with-lxd-the-container-lightervisor/</a> , also refer the <a href=\"https://github.com/lxc/lxd\" rel=\"nofollow\">https://github.com/lxc/lxd</a> for upgrading to latest lxd</p>\n\n<p>I can get the result from <code>lxc image list images:</code> command</p>\n\n<pre><code>root@lxd:~# lxc image list images:\n+--------------------------------+--------------+--------+-------------------------+---------+-------------------------------+\n|             ALIAS              | FINGERPRINT  | PUBLIC |       DESCRIPTION       |  ARCH   |          UPLOAD DATE          |\n+--------------------------------+--------------+--------+-------------------------+---------+-------------------------------+\n|                                | 8d552ca0de3c | yes    | Centos 6 (amd64)        | x86_64  | Jun 17, 2015 at 11:17am (CST) |\n|                                | f7d9e7940fbb | yes    | Centos 6 (amd64)        | x86_64  | Jun 18, 2015 at 11:17am (CST) |\n....\n</code></pre>\n\n<p>While I try to launch the container by </p>\n\n<pre><code>root@lxd:~# lxc launch images:ubuntu/trusty/i386 ubuntu-32\nCreating container...\n</code></pre>\n\n<p>It just hangs there, any suggestion for the problem or where is the log message for debug ?</p>\n\n<p>below is the env.</p>\n\n<pre>\nroot@lxd:~# lxc --version\n0.7\nroot@lxd:~# lxd --version\n0.13\nroot@lxd:~# uname -a\nLinux lxd 3.19.0-15-generic #15-Ubuntu SMP Thu Apr 16 23:32:37 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\nroot@lxd:~# cat /etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=15.04\nDISTRIB_CODENAME=vivid\nDISTRIB_DESCRIPTION=\"Ubuntu 15.04\"\n</pre>\n"}]}]