[{"id":547922,"title":"Unrecognized keyboard layout after login","body":"<p>Two of my computers running Ubuntu randomly ignore the configured keyboard layout and fall back to <em>qwerty</em>.</p>\n\n<p>On one computer the configured layout is \"Français\" (French), on the other it is a bépo (dvorak-like layout for French). On both computers the layout was selected at installation time in order to make it the default system-wide. On both computers the login screen always uses the right layout. It's only once that the user is logged in that the keyboard starts working as a <em>qwerty</em></p>\n\n<p>One computer uses <em>LightDM</em> and <em>Unity</em>, the other uses <em>GNOME Display Manager</em> and <em>GNOME 3.8</em>. The problem occurred with <em>Ubuntu 14.04</em> and is still in <em>14.10</em>.</p>\n\n<p>So far I tried to erase my <code>~/.gnome*</code> and <code>~/.config</code> directories and to reinstall the system, without success. I have also ensured that the session settings were copied in the system settings in the control panel.</p>\n\n<p>Do you have any hint to solve this problem?</p>\n\n<p><strong>Edit:</strong> also, even if the layout is incorrect in the session, it is still correct in a terminal opened with <code>ctrl+alt+F1</code>.</p>\n","related_questions":[{"id":402743,"title":"Keyboard layout incorrect on login","body":"<p>My keyboard layout is supposed to be the Swiss-French keyboard (QWERTZ, pretty similar to the English QWERTY). Here is what is really happening:</p>\n\n<ul>\n<li>When the login screen appears, the keyboard layout is correct (QWERTZ). I know that because I can enter my password.</li>\n<li>When I log in, the keyboard layout switches to QWERTY, even though the only configured layout is QWERTZ. The icon in the tray displays <em>Swiss French</em> and there is no other choice in the drop-down menu.</li>\n<li>When I click the already selected option <em>Swiss French</em> in the drop-down menu, it realizes its mistake and gives me the correct QWERTZ keyboard layout.</li>\n</ul>\n\n<p>Additional information:</p>\n\n<ul>\n<li>I'm using 13.10 on an Acer Aspire V3-571G laptop.</li>\n<li>Only my (cursed?) session has this problem on the computer.</li>\n</ul>\n\n<p>Update: appears to persist in 14.04.</p>\n"},{"id":328952,"title":"How do I change the login manager&#39;s keyboard layout?","body":"<p>I have a netbook with an AZERTY layout. I've changed it to \"bépo\" to try it, but now I've reset it to a french layout.</p>\n\n<p>While all the apps have taken the change into account, Ubuntu's login manager still uses bépo, making entering passwords a challenge. I've enabled the virtual keyboard for the time being so that I could login again.</p>\n\n<p>I don't remember what I had done in the first place to switch the login screen to bépo, but now I can't switch it back.</p>\n\n<p><img src=\"http://i.stack.imgur.com/VSwyN.jpg\" alt=\"enter image description here\"></p>\n\n<p><strong>EDIT</strong> : In the keyboard settings page, if I click \"use system defaults\", then everything is in bépo ! Where is this different keyboard layout set ?</p>\n\n<p><strong>ANOTHER EDIT</strong> : Here's what did not work :</p>\n\n<ol>\n<li>Changing the layout in settings</li>\n<li>using the \"use system defaults\" checkbox in settings</li>\n<li>sudo dpkg-reconfigure keyboard-configuration</li>\n<li>changing it in Xconf</li>\n<li>adding a line in /etc/lightdm/lightdm.conf </li>\n<li>sudo dpkg-reconfigure locales</li>\n<li>slaming head against desk</li>\n<li>dpkg-reconfigure lightdm</li>\n<li>sudo gsettings set org.gnome.libgnomekbd.keyboard layouts \"['fr']\"</li>\n<li>combinations of the above</li>\n</ol>\n\n<p><img src=\"http://i.stack.imgur.com/BWY55.png\" alt=\"enter image description here\"></p>\n\n<p>Is it possible to relaunch the keyboard configuration tool that's in ubuntu's setup ? The thing has automatic layout detection and it changes the setting everywhere.</p>\n"},{"id":149530,"title":"How to share two keyboard on the same laptop, french iso layout and usa ansi layout keyboard with usb?","body":"<p>I recently bought a \"noppoo choc mini\" with this specific <a href=\"http://i.stack.imgur.com/3riXX.png\" rel=\"nofollow\">ANSI US-INTERNATIONAL pc84 layout</a></p>\n\n<p>This specific keyboard only has 84 keys, a 60% (<a href=\"http://i.stack.imgur.com/RJlor.jpg\" rel=\"nofollow\">compact tenkeyless</a>) reduced layout.</p>\n\n<p>My problem is simple, there is no keyboard layout into Ubuntu 12.04 which corresponds to this <code>English, US</code> keyboard layout ... so it's the same problem with the reduced version and only 84 keys...</p>\n\n<p>I searched for a template of a normal <code>ANSI US-INTERNATIONAL</code> for xmodmap/xkb, and after that I ccould try to manually map the other keys. I searched on Google, but I couldn't find any other user which has the same problem.</p>\n\n<p><strong>Edit 1 :</strong></p>\n\n<p>Here you can see there is probably a bug in Ubuntu, because the layout for USA with dead key is not correct !</p>\n\n<p>I have <a href=\"http://i.stack.imgur.com/ODb6H.png\" rel=\"nofollow\">this now.</a></p>\n\n<p>And other users have <a href=\"http://i.stack.imgur.com/9eKDa.png\" rel=\"nofollow\">this</a> for the same layout: </p>\n\n<p><strong>EDIT 2</strong> </p>\n\n<p>It seems after a \"sudo dpkg-reconfigure keyboard-configuration\" :\nfrench standard keyboard pc105 + precision M65 keyboard from dell laptop</p>\n\n<p>Now I can see the good US layout in the parameters, but I cannot choose the iso layout for French usage...</p>\n\n<p><strong>EDIT 3</strong></p>\n\n<p>Ok, I'll explain the problem a bit better: I have one laptop with an integrated <code>French</code> keyboard, and I want to use my USB keyboard to use an <code>English, US</code> layout. </p>\n\n<p>It seem it's impossible in Ubuntu and \"dpkg-reconfigure keyboard-configuration\" to share two different physical layout (ANSI and EU ISO) on the same computer ...</p>\n\n<p><strong>EDIT4</strong></p>\n\n<p>Ok, it seems I can switch the physical layout (ISO &lt;-> ANSI) with this command in the terminal:</p>\n\n<pre><code>setxkbmap -layout us\nsetxkbmap -layout us -variant alt-intl\n</code></pre>\n\n<p>an</p>\n\n<pre><code>setxkbmap -layout fr \n</code></pre>\n\n<p>It's very complicated and it seem Ubuntu 12.04 still has a problem with the keyboard manager because all works great with these two commands, but that doesn't change anything in the <kbd>System parameters</kbd> → <kbd>Keyboard</kbd> !!!</p>\n\n<p>Secondly: The image of the layout for FR is buggy, the layout is not ISO, but I can press on the key <kbd>&lt; ></kbd> at the left of right <kbd>Shift</kbd> without any problem! You can see the image <a href=\"http://i.stack.imgur.com/kLhU6.png\" rel=\"nofollow\">here</a> (french alternative with ANSI layout ? it's crazy ?) : </p>\n\n<p>Can you help me on this point ? \nI'm lost with xkb, and manual mapping is very complicated ...</p>\n"},{"id":451945,"title":"Permanently set keyboard layout options with setxkbmap in gnome/unity","body":"<p>Ubuntu 13.10<sup>1</sup> (and maybe upstream gnome) introduced <a href=\"https://bugs.launchpad.net/gnome-settings-daemon/+bug/1244090\">very annoying bug</a>: pressing keyboard layout switch shortcut makes focus go away to some system window, then back to window where shortcut was pressed. Some applications have some actions bound to change of focus, for example twitter (in browser) closes reply text input field when losing focus, etc. So ubuntu's native keyboard switcher isn't suitable for me, until fixed.</p>\n\n<p>X has builtin switching mechanism, and it is much better, in addition to that it does not involve focus switching, it switches immediately (gnome switcher also sometimes lags).</p>\n\n<p>How can I set up xkbmap options so settings will remain after reboot and will not be reset by Gnome?</p>\n\n<h2>What I've tried:</h2>\n\n<h3>First, just executing setxkbmap:</h3>\n\n<pre><code>setxkbmap -layout \"us,ru\"\nsetxkbmap -option \"grp:caps_toggle,grp_led:scroll,compose:ralt\"\n</code></pre>\n\n<p>But it works only:</p>\n\n<ol>\n<li>For current session</li>\n<li>Until Gnome will overwrite it (for example touching something in gconf's <code>org.gnome.desktop.input-sources</code> triggers reset).</li>\n</ol>\n\n<h3>Second, adding xkb options to Xorg config:</h3>\n\n<p>Another option is to add following to xorg config:</p>\n\n<pre><code>Section \"InputClass\"\n        Identifier \"system-keyboard\"\n        MatchIsKeyboard \"on\"\n        Option \"XkbLayout\" \"us,ru\"\n        Option \"XkbModel\" \"pc105\"\n        Option \"XkbVariant\" \"pc105\"\n        Option \"XkbOptions\" \"grp:rctrl_toggle,grp_led:scroll\"\nEndSection\n</code></pre>\n\n<p>Xorg understands that during startup:</p>\n\n<pre><code>[    33.791] (**) Option \"xkb_rules\" \"evdev\"\n[    33.791] (**) Option \"xkb_model\" \"pc105\"\n[    33.791] (**) Option \"xkb_layout\" \"us,ru\"\n[    33.791] (**) Option \"xkb_variant\" \"pc105\"\n[    33.791] (**) Option \"xkb_options\" \"grp:rctrl_toggle,grp_led:scroll\"\n</code></pre>\n\n<p>But switching configuration still resets later, likely by gnome.</p>\n\n<h3>Third, gconf</h3>\n\n<p><img src=\"http://i.stack.imgur.com/u1aNw.png\" alt=\"enter image description here\"></p>\n\n<p>I have <code>xkb-options</code> and <code>sources</code> set in <code>org.gnome.desktop.input-sources</code>, but Gnome still sets xkb to single English layout:</p>\n\n<pre><code>$ setxkbmap -print -verbose 10\nSetting verbose level to 10\nlocale is C\nTrying to load rules file ./rules/evdev...\nTrying to load rules file /usr/share/X11/xkb/rules/evdev...\nSuccess.\nApplied rules from evdev:\nrules:      evdev\nmodel:      pc105\nlayout:     us\noptions:    grp_led:scroll\nTrying to build keymap using the following components:\nkeycodes:   evdev+aliases(qwerty)\ntypes:      complete\ncompat:     complete+ledscroll(group_lock)\nsymbols:    pc+us+inet(evdev)\ngeometry:   pc(pc105)\nxkb_keymap {\n    xkb_keycodes  { include \"evdev+aliases(qwerty)\" };\n    xkb_types     { include \"complete\"  };\n    xkb_compat    { include \"complete+ledscroll(group_lock)\"    };\n    xkb_symbols   { include \"pc+us+inet(evdev)\" };\n    xkb_geometry  { include \"pc(pc105)\" };\n};\n</code></pre>\n\n<h3>Fourth, another option in gconf</h3>\n\n<p><img src=\"http://i.stack.imgur.com/4GpbM.png\" alt=\"enter image description here\"></p>\n\n<p>Setting <code>org.gnome.settings-daemon.peripherals.keyboard</code> also does not work for me. Nothing changes.</p>\n\n<p><strong>Upd 1</strong>: <a href=\"http://anarsoul.blogspot.ru/2012/10/gnome-36-and-keyboard-layout.html\">There is discussion</a> recommending to remove <code>/usr/lib/gnome-settings-daemon-3.0/libkeyboard.so</code>. At least this fixes some resets of xkbmap (i.e. after lock screen).</p>\n\n<p><sup>1</sup> I use 14.04, but problem with losing focus is still not fixed. (<a href=\"https://bugzilla.gnome.org/show_bug.cgi?id=700316\">Unconfirmed report in upstream Gnome</a>)</p>\n"},{"id":590839,"title":"the keyboard layout randomly turns off dead keys on boot","body":"<p>I'm using the English (US international with dead keys) keyboard layout and no other layout has been set up.<br>\nMy problem is that my computer turns the dead keys off seemingly random at boot. To fix this I have to set up another keyboard layout and then switch back to the English (US international with dead keys).  </p>\n\n<p>This is quite annoying and I'm hoping someone can shed some light onto the randomness that is my keyboard layout.</p>\n\n<p>I'm using Ubuntu 14.04 with Gnome-shell version 3.10.4 and Gnome desktop (Gnome-session) version 3.9.90</p>\n"},{"id":575915,"title":"Problems switching keyboard layouts","body":"<p>I’m using Ubuntu 14.04.\nI selected System Settings… Text Entry and have added the Dvorak UK keyboard.\nMy partner still uses the UK QWERTY keyboard, so we switch between layouts.</p>\n\n<p>Since switching, holding down a key to repeat letters has stopped working.</p>\n\n<p><kbd>Ctrl</kbd>+<kbd>Alt</kbd>+T to bring up the terminal has stopped working too.</p>\n\n<p>Also is it possible to have the <kbd>CAPS lock</kbd> key remap to <code>ë</code> for one layout (UK) and remap <kbd>CAPS lock</kbd> to <kbd>Ctrl</kbd> for Dvorak UK layout?</p>\n"},{"id":574398,"title":"Keyboard layout changes after login","body":"<p>In my system with Ubuntu 14.04 system, I've recognized that my keyboard layout changes after I log in. Normally I use <strong>only</strong> Turkish keyboard layout, I can use it during login screen appears but after that it turns back to English layout even regarding indicator shows \"Tr\", regarding to Turkish.</p>\n\n<p>Each time I have to; </p>\n\n<ul>\n<li>remove Turkish layout</li>\n<li>add English layout (temporarily)</li>\n<li>add Turkish layout again</li>\n<li>remove English one</li>\n</ul>\n\n<p>Could you tell me how can I fix it, what's the reason of the issue?</p>\n"},{"id":151177,"title":"Keyboard layout wont change","body":"<p>I am using DVORAK layout and I want to switch to QWERTY but apparently this is not possible via GUI settings and it stuck on DVORAK\nIs there any way to <strong>completely reset</strong> keyboard layout?\nI am using ubuntu 12 04 and I have this problem in both KDE and GNOME\nthanks</p>\n\n<p><strong>EDIT</strong>: the indicator on the top bar in GNOME is also messed up. I have another layout (persian (fa) ), but, when I switch between layouts with keyboard shortcuts, it is English(DVORAK) when the indicator is fa (and is not en), and vice versa.</p>\n"},{"id":130413,"title":"Russian phonetic keyboard layout","body":"<p>The keyboard layout GUI in 12.04 system settings is not responding on my laptop. In a different post a workaround was found (see: <a href=\"http://askubuntu.com/questions/129700/cannot-switch-keyboard-layouts\">Cannot switch keyboard layouts</a>). </p>\n\n<p>Problem now: Having manually altered the file /etc/default/keyboard I can now access all the keyboard layouts I want except for one: Russian phonetic. (i.e. the letters are placed where the equivalent Latin letters are - qwerty) This keyboard was in the old Gnome and it is still listed in the \"system settings\" keyboard GUI. But the GUI is not responding. </p>\n\n<p>I can toggle between the official Russian keyboard and Norwegian with the command: </p>\n\n<blockquote>\n  <p>sudo setxkbmap -option grp:alt_shift_toggle no,ru</p>\n</blockquote>\n\n<p>But \"ru phonetic\" is not understood. What is the code for the phonetic Russian keyboard?</p>\n"},{"id":51228,"title":"USA keyboard layout keeps getting added on login","body":"<p>I use the USA International keyboard layout. Every time I log in, the USA layout gets added to my list of layouts, which causes the keyboard layout indicator to be displayed. How can I stop the USA layout from being added?</p>\n\n<p>Additional info: I'm running Natty. Until recently, I had all four layout slots filled. Recently I changed from SCIM to iBus. With this change, I no longer need multiple layouts since iBus better handles my needs. So, I don't want both indicators (iBus and Keyboard layout) showing up.</p>\n"}]}]