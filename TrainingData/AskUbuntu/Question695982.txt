[{"id":695982,"title":"Listening on port 80 in Ubuntu","body":"<p>I have an Ubuntu 15.04 system with a Java webserver listening on port 3000. Iptables prerouting is setup like this:</p>\n\n<pre><code>iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 3000\n</code></pre>\n\n<p>I've also removed apache2 packages from the system with:</p>\n\n<pre><code>apt-get remove apache2\n</code></pre>\n\n<p>However, now i don't get any process listening on port 80 in the system:</p>\n\n<pre><code>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      259/sshd\ntcp        0      0 0.0.0.0:3000            0.0.0.0:*               LISTEN      4841/java\ntcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      455/master\ntcp        0      0 0.0.0.0:5355            0.0.0.0:*               LISTEN      256/systemd-resolve\n</code></pre>\n\n<p>As a consequence the pages are not accessible from the browser. Can someone please help?</p>\n\n<p>Thanks!</p>\n\n<p><strong>UPDATE:</strong>\nFor now i've ended up configuring Apache with <code>proxy</code> and <code>proxy_http</code> modules, like so:</p>\n\n<pre><code>&lt;VirtualHost *:80&gt;\n  ProxyRequests Off\n  ProxyVia Off\n  ProxyPreserveHost On\n\n  &lt;Proxy *&gt;\n    AddDefaultCharset off\n    Order deny,allow\n    Allow from all\n  &lt;/Proxy&gt;\n\n  ProxyPass / http://127.0.0.1:3000/\n\n&lt;/VirtualHost&gt;\n</code></pre>\n\n<p>What is weird is that on a similarly configured machine running Ubuntu 14.04 running Apache in order to have some process listening on port 80 was not necessary. On these machines, <code>netstat</code> also would show no processes listening on port 80, yet HTTP requests were somehow forwarded to Java server listening on port 3000. Hmmm.</p>\n","related_questions":[{"id":301787,"title":"Opening a port for listening","body":"<p>I have a small program I created. Here is a relevant piece of it:</p>\n\n<pre><code>void TcpSocket::ConnectSocket()\n{\n    socket = new QTcpSocket(this);\n    socket-&gt;connectToHost(\"localhost\", 77);\n\n    if(socket-&gt;waitForConnected(3000)){\n        qDebug() &lt;&lt; \"Connected\";\n\n        socket-&gt;write(\"Hello Server\\n\\r\\n\");\n        socket-&gt;waitForBytesWritten(1000);\n        socket-&gt;waitForReadyRead(3000);\n        qDebug() &lt;&lt; \"Reading: \" &lt;&lt; socket-&gt;bytesAvailable();\n        qDebug() &lt;&lt; socket-&gt;readAll();\n        socket-&gt;close();\n    }\n    else {\n        qDebug() &lt;&lt; \"Could not connect\";\n    }\n}\n</code></pre>\n\n<p>Basically, I want to open a tcp socket at localhost:77. I want to write some data to it, get a response, and then output the response. However, right now that port is closed, as most ports are in ubuntu by default. So right now it cannot connect to that port to listen on. Well from what I researched, iptables seems to be the only way to open a port for listening. So I run this line on my machine:</p>\n\n<pre><code>sudo iptables -A INPUT -p tcp --dport 77 -j ACCEPT\n</code></pre>\n\n<p>However, the port 77 is still not open. </p>\n\n<pre><code>sudo netstat -tulpn\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      1199/dnsmasq    \ntcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      1004/cupsd      \ntcp        0      0 127.0.0.1:5432          0.0.0.0:*               LISTEN      1157/postgres   \ntcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      1121/mysqld     \ntcp6       0      0 ::1:631                 :::*                    LISTEN      1004/cupsd      \nudp        0      0 127.0.0.1:53            0.0.0.0:*                           1199/dnsmasq    \nudp        0      0 0.0.0.0:68              0.0.0.0:*                           1070/dhclient   \nudp        0      0 0.0.0.0:39617           0.0.0.0:*                           990/avahi-daemon: r\nudp        0      0 0.0.0.0:5353            0.0.0.0:*                           990/avahi-daemon: r\nudp6       0      0 :::57021                :::*                                990/avahi-daemon: r\nudp6       0      0 :::5353                 :::*                                990/avahi-daemon: r\n</code></pre>\n\n<p>netstat doesnt show it to be open. Also I still have the same problem with my program: it cannot connect to 77.</p>\n"},{"id":617159,"title":"Ubuntu Port Scan , Security concerns","body":"<p>Scan results of my ubuntu 14.04</p>\n\n<pre><code>$ nmap  127.0.0.1\n\nStarting Nmap 6.40 ( http://nmap.org ) at 2015-05-02 08:43 IST\nNmap scan report for localhost (127.0.0.1)\nHost is up (0.0021s latency).\nNot shown: 994 closed ports\nPORT     STATE SERVICE\n25/tcp   open  smtp\n80/tcp   open  http\n139/tcp  open  netbios-ssn\n445/tcp  open  microsoft-ds\n631/tcp  open  ipp\n3306/tcp open  mysql\n\nNmap done: 1 IP address (1 host up) scanned in 0.29 seconds\n</code></pre>\n\n<p>Why is port open ? I am running LAMP. Are the other open ports normal?</p>\n\n<pre><code>$ sudo netstat -tunlp | grep :25\ntcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1281/master     \ntcp6       0      0 ::1:25                  :::*                    LISTEN      1281/master\n\n$ sudo netstat -tunlp | grep :3306 tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN 1101/mysqld\n$ sudo netstat -tunlp | grep :25 tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN 1233/master\ntcp6 0 0 ::1:25 :::* LISTEN 1233/master\n$ sudo netstat -tunlp | grep :80 tcp6 0 0 :::80 :::* LISTEN 1315/apache2\n$ sudo netstat -tunlp | grep :631 tcp 0 0 127.0.0.1:631 0.0.0.0:* LISTEN 2559/cupsd\ntcp6 0 0 ::1:631 :::* LISTEN 2559/cupsd\nudp 0 0 0.0.0.0:631 0.0.0.0:* 1088/cups-browsed \n$ sudo netstat -tunlp | grep :139 tcp 0 0 0.0.0.0:139 0.0.0.0:* LISTEN 592/smbd\ntcp6 0 0 :::139 :::* LISTEN 592/smbd\n$ sudo netstat -tunlp | grep :445 tcp 0 0 0.0.0.0:445 0.0.0.0:* LISTEN 592/smbd\ntcp6 0 0 :::445 :::* LISTEN 592/smbd \n</code></pre>\n\n<p>Using GUFW I have blocked Port 80 incoming and Port 25 incoming \nand out going. What other ports should I block?</p>\n\n<p>How to really seriously lock down Ubuntu? A guide, please.</p>\n\n<p>May I ask email session hijacking queries here?</p>\n"},{"id":584159,"title":"Ubuntu / Apache2: I cannot open port 443","body":"<p>I am trying to install a SSL certificat on my Ubuntu 14 server (using apache 2). For some reason the port 443 appears to be closed </p>\n\n<p>I installed and enable ssl </p>\n\n<p><code>/etc/apache2/ports.conf</code> is as followed:</p>\n\n<pre><code>Listen 80\n\n#&lt;IfModule ssl_module&gt;\n#       Listen 443\n#&lt;/IfModule&gt;\n\n&lt;IfModule mod_ssl.c&gt;\n    Listen 443\n    NameVirtualHost 11.11.11.11:443\n&lt;/IfModule&gt;\n\n&lt;IfModule mod_gnutls.c&gt;\n        Listen 443\n&lt;/IfModule&gt;\n</code></pre>\n\n<p>LISTEN </p>\n\n<pre><code>root@server01:/home/admin# netstat -ntlp | grep LISTEN\ntcp        0      0 127.0.0.1:10024         0.0.0.0:*               LISTEN      1317/amavisd-new (m\ntcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      1184/mysqld     \ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1116/sshd       \ntcp6       0      0 :::80                   :::*                    LISTEN      2037/apache2    \ntcp6       0      0 :::22                   :::*                    LISTEN      1116/sshd       \ntcp6       0      0 :::443                  :::*                    LISTEN      2037/apache2 \n</code></pre>\n\n<p>UFW</p>\n\n<pre><code>root@server01:/home/admin# ufw status verbose\nStatus: active\nLogging: on (low)\nDefault: deny (incoming), allow (outgoing), disabled (routed)\nNew profiles: skip\n\nTo                         Action      From\n--                         ------      ----\n22                         ALLOW IN    Anywhere\n22/tcp                     ALLOW IN    Anywhere\n80/tcp                     ALLOW IN    Anywhere\n21/tcp                     ALLOW IN    Anywhere\n443/tcp                    ALLOW IN    Anywhere\n22 (v6)                    ALLOW IN    Anywhere (v6)\n22/tcp (v6)                ALLOW IN    Anywhere (v6)\n80/tcp (v6)                ALLOW IN    Anywhere (v6)\n21/tcp (v6)                ALLOW IN    Anywhere (v6)\n443/tcp (v6)               ALLOW IN    Anywhere (v6)\n</code></pre>\n\n<p>Am I missing something? Any help would be highly appreciated.</p>\n\n<p><strong>EDIT</strong> \nhere my exemple.net-ssl.conf</p>\n\n<pre><code>&lt;VirtualHost *:443&gt;\n\n        ServerName exemple.net\n        ServerAlias www.exemple.net\n        DocumentRoot /var/www/exemple.net/\n        CustomLog /var/log/apache2/secure_access.log combined\n\n        SSLEngine on\n        SSLCertificateFile /etc/ssl/certs/exemple.net.crt\n        SSLCertificateKeyFile /etc/ssl/private/exemple.net.key\n        SSLCertificateChainFile /etc/ssl/certs/GandiXXXSSLCA.pem\n        # SSLVerifyClient None\n\n  &lt;/VirtualHost&gt;\n</code></pre>\n"},{"id":552805,"title":"How to allow a WAN connection via a forward port?","body":"<p>My home internet connection has a static IP address (eg: <code>123.123.123.123</code>)</p>\n\n<p>I have configured my router to forward port <code>9000</code> to an internal host (<code>192.168.1.101</code>), which is running <code>Ubuntu 14-04</code>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/pmY0I.png\" alt=\"enter image description here\"></p>\n\n<p>I run <code>netcat</code> listening on port 9000:</p>\n\n<pre><code>$ nc -l 9000\n</code></pre>\n\n<p><strong>Connecting from inside my LAN:</strong></p>\n\n<p>On another machine on my LAN I can telnet to that port:</p>\n\n<pre><code>$ telnet 192.168.1.101 9000\nTrying 192.168.1.101...\nConnected to 192.168.1.101.\nEscape character is '^]'.\nhello world\n</code></pre>\n\n<p>and the connection succeeds</p>\n\n<pre><code>$ nc -l 9000\nhello world\n</code></pre>\n\n<p><strong>Connecting from outside my LAN:</strong></p>\n\n<p>However, if I try to connect via my external IP address I cannot get through:</p>\n\n<pre><code>$ telnet 123.213.123.123 9000\nTrying 123.213.123.123...\n</code></pre>\n\n<p><strong>Firewall issue?</strong></p>\n\n<p>I tried to allow port 9000 on iptables (I am <strong>no</strong> expert on <code>iptables</code> btw!):</p>\n\n<pre><code>$ sudo iptables -I INPUT 1 -p tcp --dport 9000 -j ACCEPT\n</code></pre>\n\n<p>This is my resulting configuration:</p>\n\n<pre><code>$ sudo iptables -L -n -v\nChain INPUT (policy ACCEPT 203 packets, 16977 bytes)\n pkts bytes target     prot opt in     out     source               destination         \n    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:9000\n\nChain FORWARD (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination         \n\nChain OUTPUT (policy ACCEPT 178 packets, 23749 bytes)\n pkts bytes target     prot opt in     out     source               destination         \n</code></pre>\n\n<p><code>telnet</code> still can't get through.</p>\n\n<p>I think the <code>iptables</code> config might be unnecessary anyway though, because <code>ufw status</code> says it's inactive:</p>\n\n<pre><code>$ sudo ufw status\nStatus: inactive\n</code></pre>\n\n<p><strong>Port scanning says it's open:</strong></p>\n\n<p>If I run a <a href=\"http://www.yougetsignal.com/tools/open-ports/\" rel=\"nofollow\">port scanner</a> on my external IP with <code>nc -l 9000</code> running it says the port is open.</p>\n\n<p><img src=\"http://i.stack.imgur.com/hJivf.png\" alt=\"enter image description here\"></p>\n\n<p>If I run <code>tcpdump</code> I can't see anything coming in on port 9000 when I try <code>telnet</code> to the port. However, running the port scanner does show up:</p>\n\n<pre><code>18:41:34.023692 IP 198.199.98.246.49977 &gt; my_host.9000: Flags [S], seq 3955039481, win 14600, options [mss 1400,sackOK,TS val 4051434607 ecr 0,nop,wscale 8], length 0\n18:41:34.023748 IP my_host.9000 &gt; 198.199.98.246.49977: Flags [S.], seq 3541700333, ack 3955039482, win 28960, options [mss 1460,sackOK,TS val 465840988 ecr 4051434607,nop,wscale 7], length 0\n18:41:34.250110 IP 198.199.98.246.49977 &gt; my_host.9000: Flags [.], ack 1, win 58, options [nop,nop,TS val 4051434663 ecr 465840988], length 0\n18:41:34.250973 IP 198.199.98.246.49977 &gt; my_host.9000: Flags [F.], seq 1, ack 1, win 58, options [nop,nop,TS val 4051434664 ecr 465840988], length 0\n18:41:34.251035 IP my_host.9000 &gt; 198.199.98.246.49977: Flags [F.], seq 1, ack 2, win 227, options [nop,nop,TS val 465841045 ecr 4051434664], length 0\n18:41:34.477197 IP 198.199.98.246.49977 &gt; my_host.9000: Flags [.], ack 2, win 58, options [nop,nop,TS val 4051434720 ecr 465841045], length 0\n</code></pre>\n\n<p><strong>Questions:</strong></p>\n\n<p>I'm at a bit of a loss as to where the problem is.</p>\n\n<ul>\n<li><strong>How can I diagnose where the issue is?</strong></li>\n<li><strong>How come the port scan data comes through, but not my telnet?</strong></li>\n<li><strong>How can I allow incoming connections?</strong></li>\n</ul>\n"},{"id":477437,"title":"How to open the ports on firewall in Ubuntu?","body":"<p>I'm pretty new to Ubuntu. I just want to open the most common ports namely</p>\n\n<ol>\n<li>FTP (port 20 TCP/UDP)</li>\n<li>HTTP (port 80 TCP/UDP)</li>\n<li>SMTP (port 25 TCP)</li>\n<li>ETC</li>\n</ol>\n\n<p>I've tried all the ways in <code>iptables</code>, <code>ufw</code>, and <code>gufw</code>.</p>\n\n<p>In the end, it still remains unchanged with the same error: \n<code>Connection refused.</code></p>\n\n<p>I can't even access the home page on HTTP port: 80 from the other device.</p>\n"},{"id":420674,"title":"Ubuntu Port 80 from some hosts not reachable","body":"<p>I have an ubuntu-server in a LAN. Whenever I try to run a Web-Server like apache2, or any other server like node.js on port 80 it is only reachable for some hosts in the network (the browser is loading for a while and then it shows the browser-specific not found screen [not an apache site not found]). And it seems to change who is able to access it. \nHere is the <strong>iptables -L</strong> output:</p>\n\n<pre><code>Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination \n</code></pre>\n\n<p>I don't think it is a problem with apache, since as I said it doesn't work with Node, too.</p>\n\n<p>Do you guys have any idea what else I could check?\nThis issue has been giving me headache for a while now..</p>\n\n<p>Let me know if you need any additional information.</p>\n\n<p>Thanks &amp; Best,\nMarc</p>\n"},{"id":445685,"title":"Ubuntu forward ports, default state, forwarding not working?","body":"<p>im running ubuntu 12.04.4 server. I been googling the nett for answers, but could not find any..\nI would like accsess a few web-gui's on my server.\nI have forwarder the ports in my router, worked when i runned the same programs on a windows server, but when i went over to linux, all stopt working when im not on LAN.</p>\n\n<p>I have not configured Iptables at all.. As far as i know Iptables is accepting all requests by default?</p>\n\n<p>Anyway, if i need to configuer iptables this is the port.\nLooks like on lan: htps://server-lan-ip:9090 and i would reache the web-gui.\nWhen i used windows server is could simply reache the web-gui form exsternal locations on: \"htps://my-exsternal-ip:9090\" (yes i know its two tt*)</p>\n\n<p>I have tried diffrent iptables rules the i tought would work, but no luck for exsternal location :(</p>\n\n<p>Any suggestions to what i should do?\nI have runned iptables -L -n there are no rules in motion.</p>\n\n<p>thx</p>\n"},{"id":433084,"title":"enable port 9696 on ubuntu server","body":"<p>I am using ubuntu server lts 12.04 on vmware virtual machine.\nI need to enable port 9696 which is blocked or filtered.\nWhen i use the <code>nc -v -w 1 localhost -z 9696</code> command it shows me the following message  </p>\n\n<pre><code>nc: connect to localhost port 9696 (tcp) failed: Connection refused\n</code></pre>\n\n<p>So i tried this command <code>iptables -A INPUT -p tcp --dport 9696 -j ACCEPT</code> but it is still not working. This is what <code>iptables  -L -N</code> shows </p>\n\n<pre><code>Chain INPUT (policy ACCEPT) target     prot opt source              \ndestination nova-api-INPUT  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain FORWARD (policy ACCEPT) target     prot opt source              \ndestination nova-filter-top  all  --  0.0.0.0/0            0.0.0.0/0\nnova-api-FORWARD  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain OUTPUT (policy ACCEPT) target     prot opt source              \ndestination nova-filter-top  all  --  0.0.0.0/0            0.0.0.0/0\nnova-api-OUTPUT  all  --  0.0.0.0/0            0.0.0.0/0\n\nChain nova-api-FORWARD (1 references) target     prot opt source      \ndestination\n\nChain nova-api-INPUT (1 references) target     prot opt source        \ndestination ACCEPT     tcp  --  0.0.0.0/0            192.168.10.50    \ntcp dpt:8775\n\nChain nova-api-OUTPUT (1 references) target     prot opt source       \ndestination\n\nChain nova-api-local (1 references) target     prot opt source        \ndestination\n\nChain nova-filter-top (2 references) target     prot opt source       \ndestination nova-api-local  all  --  0.0.0.0/0            0.0.0.0/0\n</code></pre>\n\n<p>Any help would be appreciated.</p>\n"},{"id":286060,"title":"Iptables on Ubuntu Server does not open ports","body":"<p>Does Iptables need ufw to work?</p>\n\n<p>I tried unsuccessfully open 4447 on my ubuntu server 12.10 using iptables.</p>\n\n<p>Did:</p>\n\n<p><strong><code>server:~# iptables -A INPUT -p tcp --dport 4447 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT</code></strong></p>\n\n<p>After that iptables -L:</p>\n\n<pre><code>Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \nACCEPT     tcp  --  anywhere             anywhere             tcp dpt:4447 state NEW,RELATED,ESTABLISHED\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination         \nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\n</code></pre>\n\n<p>But nmap does not show me port 4447:</p>\n\n<pre><code>server:~# nmap -sV localhost\nStarting Nmap 6.00 ( http://nmap.org ) at 2013-04-26 12:54 BRT\nNmap scan report for localhost (127.0.0.1)\nHost is up (0.00078s latency).\nNot shown: 991 closed ports\nPORT     STATE SERVICE                VERSION\n22/tcp   open  ssh                    OpenSSH 6.0p1 Debian 3ubuntu1 (protocol 2.0)\n139/tcp  open  netbios-ssn            Samba smbd 3.X (workgroup: WORKGROUP)\n445/tcp  open  netbios-ssn            Samba smbd 3.X (workgroup: WORKGROUP)\n3306/tcp open  mysql                  MySQL 5.5.31-0ubuntu0.12.10.1\n5432/tcp open  postgresql             PostgreSQL DB\n8080/tcp open  http                   Apache httpd 2.2.22 ((Ubuntu))\n</code></pre>\n\n<p>Can someone helps me to fix it?</p>\n\n<p>I did the same steps on another server (CentOS 6) and it worked at a glance</p>\n\n<p>Thanks in advance</p>\n"},{"id":118858,"title":"ubuntu as multi port router","body":"<p>If I have an 4 (or more) ethernet port linux box, How to setup it as router to handle 4 class c subnet ? for example, eth0 => 192.168.1.0/24, eth1 => 192.168.2.0/24, eth2 => 192.168.3.0/24, eth3 => 192.168.4.0/24, each client machine with in those 4 subnets can talk to each other.</p>\n\n<p>Any suggest script ?</p>\n"}]}]