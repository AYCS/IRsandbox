[{"id":715696,"title":"Need help on setting up Wake On Lan","body":"<p>i am using an Ubuntu 14.04.3 and try to set up Wake On Lan.\nI already did the following:\nEnabled WOL for the particular network interface in the UEFI.\nUsed ethtool to properly set wol. <br> I did it via</p>\n\n<pre><code>ethtool -s p8p1 wol g \n</code></pre>\n\n<p>in /etc/rc.local and also via </p>\n\n<pre><code>pre-down /usr/sbin/ethtool -s p8p1 wol g\n</code></pre>\n\n<p>in /etc/network/interfaces.\n<br>I added </p>\n\n<pre><code>netdown=no\n</code></pre>\n\n<p>to /etc/default/halt\nand i added </p>\n\n<pre><code>STOP_SERVICES=\"networking\"\n</code></pre>\n\n<p>to /etc/default/acpi-support</p>\n\n<p>However when sending the Magic packet to the MAC Address of the network interface the machine does not wake up.\nI also configured the machine to wake up on keyboard events and this works withour problems.\nI did check /proc/acpi/wakeup and the particular line for my network device says:</p>\n\n<pre><code>Device  S-state   Status   Sysfs node\n....\nPXSX      S4    *disabled\nRP04      S4    *disabled\nPXSX      S4    *disabled\nRP05      S4    *disabled  pci:0000:00:1c.4\nPXSX      S4    *enabled   pci:0000:03:00.0 &lt;-- my network interface\nRP06      S4    *disabled  pci:0000:00:1c.5\nPXSX      S4    *disabled  pci:0000:04:00.0\nRP07      S4    *disabled\n....\n</code></pre>\n\n<p>This looks correct to me. <br>\nThe network adapter is an Intel I211 and i use a Gigabyte UD3 Z170N motherboard.\nAny hints on what else i could do to find out why WOL is not working would be great.\nThanks a lot. </p>\n","related_questions":[{"id":690876,"title":"Wake-on-LAN broken on 64 bit, works on 32 bit","body":"<h3>How can I get WOL to work on 64 bit Ubuntu?</h3>\n\n<p>It's a wierd situation. The hardware is a heavily modified ASUS G75VW 3D. Windows and 32 bit Ubuntu work fine for Wake on LAN. The motherboard has a minor role here, only having some power save settings which I disabled in bios to allow WOL. Then, the NIC has to be configured. On Windows this is a one time setting and it works great. On Ubuntu 32 bit, I used an <code>rc.local</code> trigger for <code>ethtool</code> and it worked great.</p>\n\n<p>On 32 bit Ubuntu the network card shows up as <code>eth0</code> as one might expect. On 64 bit, it get's renamed to <code>enp4s0</code>. I know it's renamed because I checked <code>dmesg</code>, which also says why my rc.local script doesn't change the <code>wol</code> from <code>d</code> to <code>g</code> in <code>ethtool</code>:</p>\n\n<pre><code>[    1.624275] atl1c 0000:04:00.0 enp4s0: renamed from eth0\n[    3.821446] IPv6: ADDRCONF(NETDEV_UP): enp4s0: link is not ready\n[    3.822431] atl1c 0000:04:00.0: atl1c: enp4s0 NIC Link is Up&lt;1000 Mbps Full Duplex&gt;\n</code></pre>\n\n<p>ok, whatever. I can deal with the link being not ready, put it on a timer or something for later. But if I set it manually, ethtool says it's showing wol g for the card</p>\n\n<pre><code>Supports Wake-on: pg\nWake-on: g\n</code></pre>\n\n<p>For some reason, this gets reset when I shutdown the computer, because the wol magic packet does not wake the computer even after this.</p>\n\n<h2>Testing</h2>\n\n<p>I've tested a lot of things. First, the wol trigger does not work if the laptop has been unplugged, even briefly. It does work if the ethernet cable has been unplugged and plugged back in. The wol trigger is clearly being set as the OS shuts down because if I shutdown 32 bit ubuntu and swap the hard drives without unplugging, I can WOL into 64 bit ubuntu.</p>\n\n<p>I suspect it has something to do with the drivers, but I don't know where to get them if that's the case. Then again, can I just run the 32 bit driver on 64 bit and be done with it? I have 32 bit libs on the machine for other purposes.</p>\n\n<p>I can't solve this by running 32 bit ubuntu, because I run JVMs on the machine that require a large amount of RAM (beyond the 32 bit limit).</p>\n\n<p>Per the <a href=\"https://help.ubuntu.com/community/WakeOnLan\" rel=\"nofollow\">ubuntu help docs</a> I removed <code>network-manager</code> and attempted to configure the connection with <code>ifup</code> (<a href=\"http://askubuntu.com/a/249972/123532\">from here</a>). Unfortunately, ifup didn't recognize the interface. Here were the contents of my <code>/etc/network/interfaces</code> file in 64 bit.</p>\n\n<pre><code># interfaces(5) file used by ifup(8) and ifdown(8)\nauto lo\niface lo inet loopback\n</code></pre>\n\n<p>I don't know why my wireless and ethernet card were not listed there. Here is <code>ifconfig -a</code>.</p>\n\n<pre><code>enp4s0    Link encap:Ethernet  HWaddr 10:bf:48:19:08:b4\n          inet addr:192.168.1.91  Bcast:192.168.1.255  Mask:255.255.255.0\n          inet6 addr: fe80::12bf:48ff:fe19:8b4/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:505 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:289 errors:0 dropped:0 overruns:0 carrier:1\n          collisions:0 txqueuelen:1000\n          RX bytes:48646 (48.6 KB)  TX bytes:38816 (38.8 KB)\n\nlo        Link encap:Local Loopback\n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:65536  Metric:1\n          RX packets:57 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:57 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:8091 (8.0 KB)  TX bytes:8091 (8.0 KB)\n\nwlp3s0    Link encap:Ethernet  HWaddr c4:85:08:70:7d:7b\n          BROADCAST MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)\n</code></pre>\n\n<p>So per <a href=\"http://ubuntuforums.org/showthread.php?t=1021210\" rel=\"nofollow\">a forum post</a> I added <code>enp4s0</code> manually to the network interfaces file. It now looks like:</p>\n\n<pre><code># interfaces(5) file used by ifup(8) and ifdown(8)\nauto lo\niface lo inet loopback\n\nauto enp4s0\niface enp4s0 inet dhcp\n</code></pre>\n\n<p>Then ifup worked. I don't know if I did it right, but all I did was type:</p>\n\n<pre><code>ifup enp4s0\n</code></pre>\n\n<p>Everything still worked and I could still SSH in after a restart, so I guess I haven't yet broken my ethernet card. I really don't know what I'm doing here guys and I'm grasping at straws.</p>\n\n<p>I read a little further down the help page and realized I overlooked <a href=\"https://bugs.launchpad.net/ubuntu/+source/ifupdown/+bug/981461\" rel=\"nofollow\">the link to a bug</a>.</p>\n\n<p>Following the workaround, I added a script to <code>rc6.d</code> and <code>rc0.d</code> and set them to executable but I'm not sure how to check if the actually executed (I guess I could <code>echo</code> something and check <code>dmesg</code>...would that work?). I rebooted the machine once for good measure and powered it down, but it still did not come up with WOL attempts.</p>\n\n<p>Following the rabbit hole I found <a href=\"http://confoundedtech.blogspot.com/2011/06/enable-wol-on-ubuntu-hp-microserver.html?showComment=1321625607248#c6681025261024168629\" rel=\"nofollow\">a comment on a blog post</a> which suggested a more specific static IP address would help. I didn't see why (since magic packet sends to the entire network with a mac address), but I tried it anyway. If my configuration for network interfaces looks like his, there is no change.</p>\n\n<p>Further details about the machine. Both 32 bit and 64 bit are on the latest <code>Ubuntu 15.10 Wily Werewolf</code>.</p>\n\n<hr>\n\n<h2>Update</h2>\n\n<p>I have more research.</p>\n\n<p>I can confirm that WoL works on a fresh install of Wily Werewolf 64 bit.  Following that, I ran:</p>\n\n<pre><code>sudo apt-get update\nsudo apt-get upgrade\n</code></pre>\n\n<p>And then WoL stopped working.  That appears to be the only steps necessary to reproduce my issue.</p>\n\n<hr>\n\n<p>So again, here's my question:</p>\n\n<h3>How can I get wake on lan to work in 64 bit Ubuntu?</h3>\n"},{"id":138445,"title":"Wake-on-LAN worked 3 times then no more","body":"<p><strong>Update: My main theories for now are (see below for details):</strong></p>\n\n<ul>\n<li>Ubuntu system shuts down NIC power in standby mode?</li>\n<li>Realtek RTL8111 driver for 64-bit machines does not work?</li>\n</ul>\n\n<p><strong>Can anyone confirm or deny?</strong></p>\n\n<hr>\n\n<p>I installed Ubuntu 12.04 a few days ago and got Wake-on-lan to work by sending Magic Packets from a different PC after having put the Ubuntu machine in standby via the desktop menu. I did this 3 times and it worked beautifully. Then suddenly it didn't work anymore! How on earth can this be possible?!</p>\n\n<p>I know potentially 1000 things can be wrong when WOL doesn't work but the fact it worked 3 consecutive times rules out most of them. It worked 3 times (a few minutes apart) and after that has never worked. During the 3 times it worked and the followingh 10 unsuccessful tries the only thing I fiddled with was the firewall on the PC that sends the magic packets, and I soon switched the firewall off to eliminate that potential problem, and also verified the packets come through with wireshark (with the Ubuntu machine on then of course). I made a full update of Ubuntu a few hours before the tests started.</p>\n\n<p>Most of the time I feel like I'm just testing various things blindly. Is there for example any way to check that power isn't shut down for the NIC? And doesn't the \"cat /proc/acpi/wakeup\" being \"disabled\" mean something's wrong?</p>\n\n<p>There's lots of threads on WOL, I know, but none where it works perfectly for 10 minutes then stops working for no reason. A few threads mention problems with WOL after 12.04 was installed. My only remaining idea right now is to install Ubuntu 10. But that would just be a test, not a permanent solution, and a very time consuming test. And I'm sure RTL8111/RTL8168 isn't properly supported on older Ubuntus (there have been major problems with those NICs with older Ubuntus) which complicates such a test even more.</p>\n\n<hr>\n\n<p>You should only have to read the text above to understand my problem. But for in-depth info, here are some facts and tests I've done:</p>\n\n<ul>\n<li>I tried adding \"pci=noacpi\", \"pci=noapic\", \"acpi=force\" and \"apm=on apm=power-off\" to /etc/default/grub (and I verified the changes in grab.cfg). One at a time of course (reboot after each).</li>\n<li>I saw the NIC was disabled in cat /proc/acpi/wakeup, enabled it with command \"echo -n LAN | sudo tee /proc/acpi/wakeup\" and now LAN was enabled in the list</li>\n<li>Firewalls are disabled</li>\n<li>ethtool shows wol is in state \"g\" (I tried setting it to \"pumbag\", and also to \"d\" then \"g\").</li>\n<li>It is an ASUS board with Realtek RTL1111/R8168B (driver R8169 came with the kernel and it was with that driver is worked 3 times; lately I changed to driver R8168 which wasn't easy but I can't see any difference and people seem to report R8169 should be used for all nowadays).</li>\n<li>I also tried using wireshark on the Ubuntu machine to verify the magic packets got through to the PC</li>\n<li>Tried resetting CMOS RAM (both by jumper and removing battery for 5 minutes).</li>\n<li>NIC LED is not lit when in sleep but it's also not lit on my other PC when in sleep and WOL works for that PC.</li>\n<li>I tried enabling \"Wake on when hit PS/2 spacebar\" in BIOS, started Ubuntu, selected \"Standby\" from menu so that it got into standby, pressed spacebar, and it started. Also worked after Terminal command pm-suspend and halt -p (shuts down and reboots completely though) but does not wake after command halt. Halt makes the OS shut down but the HW to remain on. Still ignoring WOL in all cases.</li>\n<li>When in standby the power LED blinks, fans and hard disk are silent, and this remains the same after WOL attempts</li>\n<li>Program used for sending magic packets is: magicpacket(dot)free(dot)fr on a different (Windows) PC</li>\n<li>Settings for Magic Packet sender is UDP port 80 subnet mask 255.255.255.255 and that's the settings it worked with but I also tried ports 9, 7 and 0, TCp and mask 0.0.0.0. Have double checked MAC address but I entered it via copy-and-paste and it has worked with these settings 3 times as I mentioned.</li>\n<li>I have only used Ubuntu for a week (have some brief experience with Linux and Unix systems from long ago)</li>\n<li>I haven't added \"ethtool -s eth0 wol g\" (or \"echo -n LAN | sudo tee /proc/acpi/wakeup\") to startup scripts since I believe WOL should work ONCE if these things are set properly (script are needed to make it work after each reboot)\nThe motherboard Asus AT5NM10T-I has no BIOS updates (is v0306)\nTried most things on these pages:\nwiki.ubuntuusers.de/Wake_on_LAN --\nen.gentoo-wiki.com/wiki/ACPI/Fix_common_problems#Nothing_Works --\nwiki.xbmc.org/index.php?title=HOW-TO:Enable_Wake-On-Device_for_Ubuntu</li>\n</ul>\n\n<hr>\n\n<p>Updates:</p>\n\n<ul>\n<li>Yes I have enabled \"Power on by PME\" (PCI Power Management Events) in BIOS. I also enabled \"Power on by Ring\" since someone suggested that in a forum but I can't believe it affects WOL but also can't hurt. Since it worked 3 rimes this is no BIOS settings problem.</li>\n<li>I actually tried reinstalling Ubuntu 12.04, and again it worked 3 times then after that is dead. (Actually this time it worked 1 time, then didn't work, then worked 2 times in a row, then never again.) --- Some details on this new test which probably have no significance: It didn't work until I enabled Samba properly for file sharing between PCs in a workgroup. The 3 times it worked I did not have to send sudo ethtool -s eth0 wol g (sudo ethtool eth0 always reports it is in wol mode \"g\" so apparently my NIC starts in that mode). And sudo cat /proc/acpi/wakeup now always shows LAN as \"enabled\" now. This time I used the downloaded 12.04 without updates (Ubuntu's desktop said there were no updates), later (long after it stopped working) it said there were 136 updates, I installed them and rebnooted, still didn't work.</li>\n<li>Apparently this NIC has been troublesome for Linux users for years, but I thought it was working properly since recently, with the driver that comes with the kernel. It isone of the most common NICs I think.</li>\n</ul>\n\n<hr>\n\n<p>Update:</p>\n\n<ul>\n<li>I tested with Ubuntu 11.10. It has the same problems, or a version of it: WOL seems to work about 1 out of 4 times. Doesn't suddenly stop working, just doesn't work every time (far from it).</li>\n<li>Tested with Windows 7. Installed Realtek driver. Ticked \"allow only magic packet to wake up\" in NIC settings (HW manager) and it worked flawlessly, tested 5 times in a row. Note: First I didn't bother to install video and audio drivers and then only hibernation worked, but it did respond to WOL calls flawlessly. Installed video and audio driver plus \"PC Probe II\" which seems to have something to do with ACPI driver. Did this after I read in Wikipedia on ACPI that Windows might not allow standby (S3) if one device in the system doesn't support acpi.</li>\n<li>When in sleep mode (or hibernation) in Windows, I can still see this unit in the router's list of attached devices (but the LED on the NIC is out). (As I said before, for a different PC, it is not seen in this list even though WOL works, so apparently this isn't always the case). For this PC, however, it might indicate that the NIC hasn't any power, i e that the problem here is that Ubuntu shuts down the NICs power.</li>\n<li>I forgot to mention my machines are all 64 bit. It is not so uncommon that 32 bit drivers work while 64 bit drivers don't. So one suspicion is that the 64 bit Realtek driver still doesn't work properly on Linux with RTL8111 etc - I know there's been problems with these NICs for years which I read were solved rather recently, but can anyone confirm they have RTL8111/RTL8168&amp;RTL8168B etc working with WOL on a 64 bit machine?</li>\n</ul>\n\n<p>So my main theories for now are:</p>\n\n<ul>\n<li>Ubuntu system shuts down NIC power in standby mode?</li>\n<li>Realtek driver for 64-bit machines does not work?</li>\n</ul>\n"},{"id":624782,"title":"Wake-On-LAN for ASROCK H81M-ITX","body":"<p>I'm using Ubuntu 14.04.1 on an ASROCK H81M-ITX motherboard.  I'm pretty sure I have the BIOS configured correctly for wake-on-lan.  I read <a href=\"http://ubuntuforums.org/showthread.php?t=234588\" rel=\"nofollow\">this forum post</a> about what you need to do from the ubuntu side to make WOL work.</p>\n\n<p>But I get this error when trying to enable WOL:</p>\n\n<p><code>sudo ethtool -s eth0 wol g</code></p>\n\n<pre><code>Cannot get current wake-on-lan settings: Operation not supported\n  not setting wol\n</code></pre>\n\n<p>Here's the ethtool dump for eth0.  (What is the meaning of the wol in the ouptut?)</p>\n\n<p><code>$ sudo ethtool eth0</code></p>\n\n<pre><code>Settings for eth0:\n    Supported ports: [ TP ]\n    Supported link modes:   10baseT/Half 10baseT/Full\n                            100baseT/Half 100baseT/Full\n                            1000baseT/Full\n    Supported pause frame use: Symmetric Receive-only\n    Supports auto-negotiation: Yes\n    Advertised link modes:  10baseT/Half 10baseT/Full\n                            100baseT/Half 100baseT/Full\n                            1000baseT/Full\n    Advertised pause frame use: Symmetric\n    Advertised auto-negotiation: Yes\n    Speed: 1000Mb/s\n    Duplex: Full\n    Port: Twisted Pair\n    PHYAD: 0\n    Transceiver: internal\n    Auto-negotiation: on\n    MDI-X: Unknown\n    Current message level: 0x000060e4 (24804)\n                           link ifup rx_err tx_err hw wol\n    Link detected: yes\n</code></pre>\n\n<p>The <a href=\"http://download.asrock.com/manual/H81M-ITX.pdf\" rel=\"nofollow\">manual for the H81M-ITX</a> has two configuration settings that refer to waking from a lan:</p>\n\n<ol>\n<li><p><strong>Boot From Onboard LAN</strong>:  Allow the system to be waked up by the onboard LAN.</p></li>\n<li><p><strong>PCIE Device Power On</strong>:  Allow the system to be waked up by a PCIE device and enable wake on LAN.</p></li>\n</ol>\n\n<p>I'm actually using the onboard LAN, but I have both enabled anyway.</p>\n\n<p>When I shutdown, I'm using:</p>\n\n<p><code>$sudo shutdown -P now</code></p>\n\n<p>After the shutdown, the link light goes off for the LAN connection on both the motherboard, and at the hub where it's connected.  It appears to have no power.  Do I need to shutdown in a different way to preserve power to the ethernet port?</p>\n\n<p>Here are all the BIOS configuration settings that I found that had to do with sleep states (power saving).  These are their current settings which they were preset at the factory:</p>\n\n<ol>\n<li>CPU C States Support:  <code>Auto</code></li>\n<li>Enhanced Halt State (C1E):  <code>Auto</code></li>\n<li>CPU C3 State Support:  <code>Auto</code></li>\n<li>CPU C6 State Support:  <code>Auto</code></li>\n<li>CPU C7 State Support:  <code>Auto</code></li>\n<li>Package C State Support:  <code>Disabled</code></li>\n</ol>\n\n<p>Each of these 6 configuration items have 3 possible settings:  auto, enabled and disabled.  The last item (which is the only one that's disabled) has a description, \"Enable CPU, PCIe, Memory, Graphics C State Suppport for power saving.\"  Does anything here look amiss?</p>\n"},{"id":47918,"title":"How can I enable wake-on-lan permanently?","body":"<p>I want to enable wake-on-lan for my network cards, for always. The <a href=\"https://help.ubuntu.com/community/WakeOnLan\" rel=\"nofollow\">community guide</a> recommends adding the relevant command to <code>/etc/network/interfaces</code>. In past experiences editing Ubuntu conf files, it's extremely likely that the network interface file is written anew every boot, if not every apt upgrade. What's the best way to ensure that wake-on-lan is enabled every boot?</p>\n"},{"id":344047,"title":"Wake-on-LAN works with Windows 8 but not with Ubuntu","body":"<p>I have a PC that has a Windows 8 partition and an Ubuntu 13.04 partition.  I am trying to get wake-on-lan to work.  Everything works fine on the Windows 8 partition: I can wake-on-lan from both the sleep state and the shutdown state. However, when I shutdown Ubuntu using:</p>\n\n<pre><code>sudo shutdown -h now\n</code></pre>\n\n<p>I cannot wake the PC through my LAN. Is this because the network interface is getting turned off? What command can I use or how can I reconfigure Ubuntu so that wake-on-lan still works?</p>\n\n<p>Also, if I do not use the -h option in the shutdown command, the PC does not actually shutdown; it just freezes up on me.</p>\n\n<p>Using ethtool, I found that it says:</p>\n\n<pre><code>Supports Wake-on: pumbg\nWake-on: g\n...\nLink detected: yes\n</code></pre>\n\n<p>My etc/network/interfaces says this:</p>\n\n<pre><code>auto eth0\niface eth0 inet dhcp\n      up ethtool -s eth0 wol g\n</code></pre>\n\n<p><strong>EDIT:</strong> I have found that if I shut down the PC by simply holding the power button, then wol works. If I shutdown using the command line or through the Ubunutu GUI, then it does not work. So I think the issue is not that it is not being setup properly, but that something is overriding it or shutting it off when I shut down properly. Are there are any scripts that get run at shutdown?</p>\n\n<p>I have added</p>\n\n<pre><code>NETDOWN=no\n</code></pre>\n\n<p>to both etc/default/halt and etc/init.d/halt</p>\n"},{"id":515509,"title":"Wake On Lan not working","body":"<p>I have been trying to get Wake On Lan to work on my Ubuntu server (14.04.1 LTS), which I have configured as a home NAS box. I have followed several tutorials to try to get this working, but for some reason, which I can't trace, it is not working.</p>\n\n<p>The system is an old (4-5 year old) shuttle pc system (Shuttle SN78SH7), amd64 cpu (AMD Athlon 64 X2 7550).</p>\n\n<p>Steps taken so far</p>\n\n<ol>\n<li>I have set WoL on my BIOS</li>\n<li>I have enabled WoL (method g) on eth0</li>\n<li>I have added a script so that eth0 stays as g on startup</li>\n<li>I can confirm that the green and orange lights on the network card are on</li>\n</ol>\n\n<p>If I use ethtool, I can see the following, which I believe means it is configured as expected.</p>\n\n<pre><code>Supports Wake-on: g\nWake-on: g\n</code></pre>\n\n<p>I am using <a href=\"http://www.depicus.com/wake-on-lan/wake-on-lan-for-apple-mac.aspx\" rel=\"nofollow\">wolcmd</a> (from a mac), to send the magic packet, to the MAC address, IP address, and subnet specified in <code>ifconfig eth0</code> (to port 9). </p>\n\n<p>I am not sure what the next steps should be to try to resolve the problem.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I can confirm that WoL does indeed work sometimes if I suspend (<code>pm-suspend</code>), but does not if I use (<code>halt -p</code> or <code>shutdown -h now</code>). Suspend seems to be really unstable, so using that is not likely to be a good answer for me.</p>\n"},{"id":405608,"title":"can&#39;t get out of suspend with WOL - RTL8111E","body":"<p>I can't get my desktop out of suspend through WOL. Running Ubuntu 13.10, installed the RTL8168 driver from the Realtek site (was provided by Realtek site for onboard RTL8111E on mobo Asrock b75-pro3-m)</p>\n\n<p>Using ethtool, I set the onboard NIC to wake on \"g\" (magic packet).\nIn the BIOS, I set wake on \"ring\", \"PCI devices\" and \"RTC\" (set to OS), I also disabled \"deep sleep\".\nYet, the LED's of the onboard NIC are NOT lighting up when in suspend, although I've read on this forum that this isn't necessarily a requirement for the NIC to listen to WOL.</p>\n\n<p>I tried sending magic packets to the MAC address of the onboard NIC through several UDP ports: 7,9, 2304 and 655325 ... alas with no effect.\nI tried some quirks for pm-suspend, but that did not help either.</p>\n\n<p>I'm sending the magic packets through my laptop (wireless), which is running Windows 7 (using softwares such as mc-wol and wake-on-lan from aquila software).</p>\n\n<p>-update: viewing <code>cat /proc/acpi/wakeup</code> I noticed that the ethernet interfaces did not have the status \"enabled\". So using <code>echo xxxx &gt; /proc/acpi/wakeup</code> I changed this, but still no effect.</p>\n\n<p>Perhaps important information: I also have a Realtek PCI NIC of type RTL8169, for which I also installed the RTL8169 driver provided by the Realtek site.</p>\n\n<p>Update: Setting NETDOWN = NO in /etc/init.d/halt didn't help either</p>\n\n<p>Update: No results from \necho on > /sys/class/net/$interface/device/power/control\necho enabled >  /sys/class/net/$interface/device/power/wakeup</p>\n\n<p>Blacklisting the r8169 driver only caused my r8169 NIC to get disabled: editing /etc/modprobe.d/blacklist.conf and adding \n    #blacklist r8169 driver\n    blacklist r8169\nSo that didn't do it either...</p>\n\n<p>I'm not sure what else I can do to resolve this. Any thoughts ?</p>\n\n<p>Many thanks in advance :-) !!</p>\n"},{"id":367271,"title":"Wake on Lan on Ubuntu?","body":"<p>There is a computer in lab I need to turn it on wakeonlan, I followed <a href=\"https://help.ubuntu.com/community/WakeOnLan\" rel=\"nofollow\">these instructions</a>. I used gWakeOnLan tool to wake up the system. The default <code>UDP port number is 9</code> and i checked from the <a href=\"http://www.yougetsignal.com/tools/open-ports/\" rel=\"nofollow\">website</a> that port is blocked in my network. so i thought any other will work which are open in my network but nothing worked for me I tried <code>80, 443, 22, 23,20, 14000</code><br>\nHelp!</p>\n"},{"id":352888,"title":"Wake-On-LAN 13.04 problems","body":"<p>I've been trying to get WOL to work for weeks on my Ubuntu server 13.04 install but it just doesn't seem to work. </p>\n\n<p>I notice when I suspend the server with \"sudo pm-suspend\" or via the desktop gui, the NIC card turns off. I.e., there is no blinking lights on the network port. I don't know if that's the issue but in my <code>/var/log/syslog</code>, I also saw that my ethernet was not one of the PCIs that had \"system wakeup enabled by ACPI\":</p>\n\n<pre><code>    Oct  2 16:46:10 JAMFS1 kernel: [26462.745615] PM: suspend of devices complete after 519.955 msecs\n    Oct  2 16:46:10 JAMFS1 kernel: [26462.745743] PM: late suspend of devices complete after 0.126 msecs\n    Oct  2 16:46:10 JAMFS1 kernel: [26462.745953] ehci-pci 0000:00:1d.0: System wakeup enabled by ACPI\n    Oct  2 16:46:10 JAMFS1 kernel: [26462.761576] ehci-pci 0000:00:1a.0: System wakeup enabled by ACPI\n    Oct  2 16:46:10 JAMFS1 kernel: [26462.793491] xhci_hcd 0000:00:14.0: System wakeup enabled by ACPI\n    Oct  2 16:46:10 JAMFS1 kernel: [26462.809491] PM: noirq suspend of devices complete after 63.784 msecs\n    Oct  2 16:46:10 JAMFS1 kernel: [26462.809695] ACPI: Preparing to enter system sleep state S3\n.......\n    Oct  2 16:46:10 JAMFS1 kernel: [26463.464575] ACPI: Waking up from system sleep state S3\n    Oct  2 16:46:10 JAMFS1 kernel: [26463.510511] xhci_hcd 0000:00:14.0: System wakeup disabled by ACPI\n    Oct  2 16:46:10 JAMFS1 kernel: [26463.542498] ehci-pci 0000:00:1a.0: System wakeup disabled by ACPI\n    Oct  2 16:46:10 JAMFS1 kernel: [26463.574474] ehci-pci 0000:00:1d.0: System wakeup disabled by ACPI\n    Oct  2 16:46:10 JAMFS1 kernel: [26463.590562] PM: noirq resume of devices complete after 125.527 msecs\n    Oct  2 16:46:10 JAMFS1 kernel: [26463.590650] PM: early resume of devices complete after 0.071 msecs\n</code></pre>\n\n<p>But according to \"cat /proc/acpi/wakeup\" my ethernet card IS supposed be to enabled:</p>\n\n<pre><code>Device  S-state   Status   Sysfs node\nUSB1      S3    *disabled\nRP01      S4    *enabled   pci:0000:00:1c.0\nRP03      S4    *enabled   pci:0000:00:1c.2\nGLAN      S4    *disabled\nEHC1      S4    *enabled   pci:0000:00:1d.0\nEHC2      S4    *enabled   pci:0000:00:1a.0\nXHC       S4    *enabled   pci:0000:00:14.0\nHDEF      S4    *enabled   pci:0000:00:1b.0\nPEG0      S4    *disabled\nPEGP      S4    *disabled\n</code></pre>\n\n<p>From my \"lspci -tv\", you can see that \"pci:0000:00:1c.2\" is the Atheros ethernet card:</p>\n\n<pre><code>       +-14.0  Intel Corporation Lynx Point USB xHCI Host Controller\n       +-16.0  Intel Corporation Lynx Point MEI Controller #1\n       +-1a.0  Intel Corporation Lynx Point USB Enhanced Host Controller #2\n       +-1b.0  Intel Corporation Lynx Point High Definition Audio Controller\n       +-1c.0-[01]--\n       +-1c.2-[02]----00.0  Qualcomm Atheros QCA8171 Gigabit Ethernet\n       +-1d.0  Intel Corporation Lynx Point USB Enhanced Host Controller #1\n       +-1f.0  Intel Corporation Lynx Point LPC Controller\n</code></pre>\n\n<p>I also set <code>/sys/class/net/p2p1/device/power/wakeup</code> to 'enabled'. As well as ran <code>sudo ethtool -s p2p1 wol g</code> and inserted that into my <code>/etc/rc.local</code></p>\n\n<p>I have enabled the equivalent wake on LAN/PCI in my ASRock Bios. </p>\n\n<p><code>ethtool p2p1</code> (p2p1 is my Qualcomm Atheros QCA8171 Gigabit Ethernet name) shows this:</p>\n\n<pre><code>Supports Wake-on: pg\nWake-on: g\n</code></pre>\n\n<p>So what do I do?? I followed every guide and suggestion I found. Do you think it's a driver issue? Is there a way to update the Atheros driver? Has anyone been able to wake on lan if the NIC card has no blinking lights? With the system up, I used wireshark and was able to detect the WOL packets sent from my local dd-wrt via the command <code>/usr/sbin/wol -i 192.168.1.254 -v bc:5f:f4:be:38:e4 -p 9</code>. I also was able to receive the packets from a windows machine with a WOL generator. Anyone has any suggestions as I'm just out of ideas.... Thanks in advance for reading.</p>\n\n<p>Lastly, my <code>lspci -vv</code> is as such if that helps anyone:</p>\n\n<pre><code>02:00.0 Ethernet controller: Qualcomm Atheros QCA8171 Gigabit Ethernet (rev 10)\n        Subsystem: ASRock Incorporation Device 10a1\n        Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx-\n        Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx+\n        Latency: 0, Cache Line Size: 64 bytes\n        Interrupt: pin A routed to IRQ 18\n        Region 0: Memory at f0400000 (64-bit, non-prefetchable) [size=256K]\n        Region 2: I/O ports at e000 [size=128]\n        Capabilities: [40] Power Management version 3\n                Flags: PMEClk- DSI- D1- D2- AuxCurrent=375mA PME(D0+,D1+,D2+,D3hot+,D3cold+)\n                Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME-\n        Capabilities: [58] Express (v1) Endpoint, MSI 00\n                DevCap: MaxPayload 4096 bytes, PhantFunc 0, Latency L0s unlimited, L1 unlimited\n                        ExtTag- AttnBtn+ AttnInd+ PwrInd+ RBE+ FLReset-\n                DevCtl: Report errors: Correctable+ Non-Fatal+ Fatal+ Unsupported+\n                        RlxdOrd- ExtTag- PhantFunc- AuxPwr- NoSnoop-\n                        MaxPayload 128 bytes, MaxReadReq 512 bytes\n                DevSta: CorrErr- UncorrErr+ FatalErr- UnsuppReq+ AuxPwr+ TransPend-\n                LnkCap: Port #0, Speed 2.5GT/s, Width x1, ASPM L0s L1, Latency L0 unlimited, L1 unlimited\n                        ClockPM+ Surprise- LLActRep- BwNot-\n                LnkCtl: ASPM Disabled; RCB 64 bytes Disabled- Retrain- CommClk+\n                        ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt-\n                LnkSta: Speed 2.5GT/s, Width x1, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt-\n        Capabilities: [c0] MSI: Enable- Count=1/16 Maskable+ 64bit+\n                Address: 0000000000000000  Data: 0000\n                Masking: 00000000  Pending: 00000000\n        Capabilities: [d8] MSI-X: Enable+ Count=16 Masked-\n                Vector table: BAR=0 offset=00002000\n                PBA: BAR=0 offset=00003000\n        Capabilities: [100 v1] Advanced Error Reporting\n                UESta:  DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq+ ACSViol-\n                UEMsk:  DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol-\n                UESvrt: DLP- SDES+ TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF+ MalfTLP+ ECRC- UnsupReq- ACSViol-\n                CESta:  RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr-\n                CEMsk:  RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr+\n                AERCap: First Error Pointer: 14, GenCap+ CGenEn- ChkCap+ ChkEn-\n        Capabilities: [180 v1] Device Serial Number ff-be-38-f4-bc-ef-f4-df\n        Kernel driver in use: alx\n</code></pre>\n"},{"id":205826,"title":"Which LAN card / module combinations proven to work with Wake on LAN","body":"<p>I've got a 12.04 headless server that I've been trying to get to work with wake-on-lan. The card is Marvel 88E8053 using the sky2 module. Although WOL is enabled in BIOS and ethtool shows the card as WOL enabled, it refuses to wake when I send the magic packet. I have verified that the packet is being received OK when the machine is on. The machine does wake OK from a BIOS alarm which suggests it is a network card issue. </p>\n\n<p>I've seen reference to bugs in sky2 that mean WOL fails in recent versions of Ubuntu (and have tried <a href=\"http://us.generation-nt.com/answer/bug-647560-squeeze-sky2-wake-lan-broken-asus-p5ld2-motherboard-marvell-88e8053-rev-19-re-patch-tested-working-help-207357901.html\" rel=\"nofollow\">a module conf file as suggested here</a> but to no avail)</p>\n\n<p>So I am thinking the best bet is to replace the ethernet card with one that definitely works with WOL in 12.04 - please could you post your card make and model no if you are using it successfully, along with any tweaks you had to make?</p>\n"}]}]