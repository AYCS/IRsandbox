[{"id":715674,"title":"Samba share mounts have wrong permissions","body":"<p>In my <code>/etc/fstab</code> I have multiple lines similar to </p>\n\n<pre><code>//myserver/myshare /media/Server/myshare cifs credentials=/home/myuser/.smbcredentials,iocharset=utf8,sec=ntlm 0 0 \n</code></pre>\n\n<p>However I can't access all the shares. Investigating the problem I found that the folders where the shares are mounted have weird ownerships. Most of them are owned by the user root and the group root. One of them is owned by my user but then there are strange ones. One has <code>speech-dispatcher</code> as the owner and <code>utempter</code> as the group. Then there's one that's owned by the group <code>1005</code> and one that's owned by <code>www-data</code> group.</p>\n\n<p>These shares are served from a Ubuntu server and I believe these groups and owners come from there. The ones that I said have <code>root:root</code> owner are currently disconnected from the server. The one that is owned by me is a personal home folder share. Could it be that the server tells my machine the ids of the shares and because they don't map one to one on my machine and the server they are seen as these strange groups and users? And since my computer doesn't have a group with id 1005 it shows as just the number in <code>ls -la</code>?</p>\n\n<p>How do I fix this? I want all the mounts to be owned by my own user.</p>\n\n<p>I tried dismounting the shares and changing the share folders' ownership with <code>chown</code>. This worked partly: Now I can access the share that had <code>root:1005</code> owner, but the ones with a group or user id which is found locally too don't work.</p>\n","related_questions":[{"id":438511,"title":"Samba shares with windows AD picking wrong username","body":"<p>I have a strange problem, which I have found no answers for on the web.</p>\n\n<p>I have ubuntu 12.04 LTS with Samba 3.6. 3 (ntp krb5-user smbfs smbclient winbind)</p>\n\n<p>At first everything works fine, groups in AD have the proper file access and user permissions work, <strong>except for one anomaly:</strong></p>\n\n<p>There are 2 users with the same first name:</p>\n\n<p>simon folly and\nsimon wally</p>\n\n<p>If I log into Windows as simon wally and try to access his share I get permission denied. When I view samba.log is states:</p>\n\n<blockquote>\n  <p>[2014/03/24 20:39:04.702632,  2]\n  smbd/service.c:627(create_connection_session_info)   user\n  'WINDOMAIN\\simon folly' (from session setup) not permitted to access\n  this share (simonw)</p>\n</blockquote>\n\n<p>As you can see above the wrong username is been authenticated. It's seems it finds the first name from the list and picks that one.</p>\n\n<p>So to test my theory I changed the username in the smb.conf file to \"simon folly\" and sure enough when logged in as simon wally I have full access to my share ??</p>\n\n<p>Has this happened to anyone and how to fix it ?</p>\n\n<p>Here is my share in smb.conf</p>\n\n<pre><code>note: when I change wally to folly then wally has full access.\notherwise below gets denied.    \n\n[simonw]\n    comment = Simon Only\n    path = /sharing/ceo\n    valid users = \"WINDOMAIN\\simon wally\"\n    force group = \"domain users\"\n    writable = yes\n    read only = no\n    force create mode = 0660\n    create mask = 0777\n    directory mask = 0777\n    force directory mode = 0770\n    access based share enum = yes\n    hide unreadable = yes\n</code></pre>\n\n<p>thank you in advance for your help :)</p>\n"},{"id":663606,"title":"Samba permissions in 14.04","body":"<p>Looked high and low - but not able to get a clear cut answer / leads.</p>\n\n<p>I am using 14.04 for file server. There are 4 users connected to this - each with their own pwds. All are shared to one group.</p>\n\n<p>The file create and directory create mask are set to 0777 - thus it should be that each file and folder is shared to all other users. But it is not working like this.</p>\n\n<p>I have also enabled recycle bin in the samba settings.</p>\n\n<p>Would be grateful for some hints.</p>\n\n<p>Rgds.</p>\n"},{"id":649831,"title":"Samba group access permissions","body":"<p>I have a file/media server running Samba, Plex and Transmission. However I am having a little trouble with the access permissions of my media folder. This folder needs to grant access to the 'david', 'plex' and the 'debian-transmission user. So I made a group called 'media_users' and added them to the group and added the appropriate permission to the media folder. Now I am unable to access the shared folder from my windows machine and plex does not have a access to the files. </p>\n\n<p>Does someone have an idea what I did wrong?</p>\n\n<pre><code>david@server:/mnt/storagedata$ groupadd media_users\ndavid@server:/mnt/storagedata$ sudo usermod -a -G media_users david\ndavid@server:/mnt/storagedata$ sudo usermod -a -G media_users debian-transmission\ndavid@server:/mnt/storagedata$ sudo usermod -a -G media_users plex\n\ndavid@server:/mnt/storagedata$ sudo chown -R root:media_users media\ndavid@server:/mnt/storagedata$ sudo chmod 770 -R media\ndavid@server:/mnt/storagedata$ ls -l\ndrwx------ 10 david david       10 Jul 13 00:54 david\ndrwxrwx---  6 root  media_users  6 Feb 26 18:12 media\n\ndavid@server:/mnt/storagedata$ sudo testparm\n\n...SNIP...\n\n[david]\n        path = /mnt/storagedata/david\n        force user = david\n        read only = No\n\n[media]\n        path = /mnt/storagedata/media\n        read only = No\n</code></pre>\n"},{"id":645550,"title":"Ubuntu Samba auto mounted hard drive permission fails","body":"<p>So I plugged in my harddrive to the Ubuntu Samba Server and it automatically mounted it inside media/user/harddrivename/, so far so good.</p>\n\n<p>Now I want to share the harddrive like the foldes I share in my filesystem with Samba (which do work).</p>\n\n<p>These were my first steps.</p>\n\n<pre><code>sudo chown -c $USER &lt;filespath&gt;\n</code></pre>\n\n<p>Then I tried to give the correct permissions</p>\n\n<pre><code>sudo -R 744 &lt;filespath&gt;\n</code></pre>\n\n<p>(so that the owner has full acces and group and other only read acces)\nunfortunaly this does not work, has anybody and idea how to fix this.\nIt is probaly a permission error I think:)</p>\n"},{"id":618002,"title":"Permissions with Samba Share","body":"<p>I created a samba share with anonymous access. <br>\nI changed the permissions/ownership of all files and folder to root. I can read, write and delete to the share.</p>\n\n<p>now I installed a torrent program (deluge). I set the download dir to the share (its local). Whenever deluge downloads a file it creates with its own user \"deluge\". </p>\n\n<p>I cant read, but can't delete the file from the share because I dont have the permission. What do i have to do?</p>\n"},{"id":612005,"title":"Samba mount through fstab but only with permissions for one user","body":"<p>I recently set up a server with samba file sharing. On the clients I would like to automount the server during boot using fstab. I read a few tutorials and ended up using this line in /etc/fstab</p>\n\n<pre><code>//server/share  /mnt/mountpoint cifs    username=user,password=password 0   0\n</code></pre>\n\n<p>After reboot the server is successfully mounted at the defined mountpoint but only one user (USER1) has read/write permissions. When the other user (USER2) tries to open mnt/mountpoint a popup window says that the curent user is not the owner of the folder and has no rights to read or write.</p>\n\n<p>When I look at the properties of the mounted folder it says that USER1 is the owner. When I log in as USER1 I can change the permissions for the first folder but all other folders inside this one are also the property of USER1 and connot be changed. So there is no way for USER2 to do anything inside the mounted server.</p>\n\n<p>Have I done something wrong? Do I have to set the permissions or the owner of the mounted folder in the fstab file sowhere? I already read about the options for fstab in the ubuntu wiki but couldnt find anything that seemed to be helpful with my situation.</p>\n\n<p>Im thankful for any kind of help.</p>\n\n<p>Oh and I have Ubuntu 14.04 LTS installed on all the machines (server and the clients) and both users have root rights</p>\n"},{"id":454477,"title":"Samba user and guest permissions","body":"<p>I have a folder in <code>/var/www/html/</code> that people upload files to via PHP called <code>store</code>. </p>\n\n<p><code>store</code> has the permissions <code>rwxrwxr--</code> it is owned by the user <code>josh</code> and the <code>www-data</code> group.</p>\n\n<p>The <code>store</code> folder is also an SMB share and works if I use <code>josh</code> to login to it. However I need everyone to be able to access it but without write permissions as well.</p>\n\n<p>This is what I have tried in my samba config:</p>\n\n<pre><code>[propellor]\npath = /var/www/html/store\nbrowsable = yes\nguest ok = yes\nread only = yes\nwrite list = josh\ncreate mask = 755\n</code></pre>\n\n<p>Mapping a network drive in Windows allows me to read and write if I use <code>josh</code> credentials but will not let me open the share at all if I am a guest or use another (Windows) user account.</p>\n\n<p>I am missing something in my settings or permissions surly.</p>\n\n<p>Thanks!</p>\n"},{"id":410552,"title":"Mounted Samba permission problem","body":"<p>I use Lubuntu as server machine and have few Lubuntu client machines. </p>\n\n<p>On server Samba config file is configured that there is no need for passwords and everyone can write.</p>\n\n<p>I added every user who will access from client machines to server users and groups.\nFolder permissions are set that owner is nobody and group - <strong>nogroup</strong>. I added all users under this group.</p>\n\n<p>When they access trough file manager PCManFM (smb://machine-ip/folder), mostly everything works fine.</p>\n\n<p>But I need to be able to mount it.</p>\n\n<p>On client machine I install cifs-utils then I edit /etc/fstab and add this line</p>\n\n<pre><code>//servername/sharename  /home/user-2/sharename  cifs  guest,uid=1000,iocharset=utf8  0  0\n</code></pre>\n\n<p>I mount it with user who is allowed to use sudo (user-1).</p>\n\n<p>After that, /home/user-2/sharename i cant write with user-2</p>\n\n<p>Owner is user-1 and group is nogroup, and by default on most of folders can write only owner and group.</p>\n\n<p>I cant change owner and group even with root, also when I add user-2 to nogroup nothing happen, I can only change under permission view content, change content and access content to everyone.</p>\n\n<p>Then I can write with user-2, but I cant then write to sub-folders. I need to repeat last step for every sub-folder. </p>\n\n<p>When from another client machine user-3 add new folder, I need again then in machine with user-1 and user-2 manually set permissions to everyone can change content.</p>\n\n<p>Maybe this text was not clear, in short:</p>\n\n<p>1 server machine Lubuntu with Samba .</p>\n\n<p>Few Lubutnu client machine, which need to mount this samba share and access to it. And there use folders, add new content...</p>\n"},{"id":295302,"title":"Permissions of mounted cifs share (Shared from FreeNAS)","body":"<p>I have a FreeNAS installation running under VirtualBox.  When I try to mount one of my FreeNAS shares in Ubuntu 12.10, permissions on the share prevent me from entering the directory, listing or creating files.</p>\n\n<p>My intention was to provide a share where the FreeNAS <code>john</code> account has full authority, and the <code>barbara</code> and <code>mark</code> accounts have read-only access.  However the permissions of the mounted share pevent me from even listing the directory, let alone create or read any files there.</p>\n\n<p>Am I doing something wrong when mounting the share?</p>\n\n<p>I will try to provide more information below.</p>\n\n<p>I set up my FreeNAS according to the instructions found <a href=\"http://forums.freenas.org/showthread.php?12689-Permissions-Set-Up-Example-for-Dummies-COPY-from-HowTo-area\">here</a>.  The resulting storage has permisssions as shown here:</p>\n\n<p><img src=\"http://i.stack.imgur.com/S2SkR.png\" alt=\"enter image description here\"></p>\n\n<p>(I know I need to tweak the write-permissions for the group.)</p>\n\n<p>Under Windows7, I have no problems mounting the share:</p>\n\n<pre><code>C:\\Users\\John&gt;ipconfig /all\n\nWindows IP Configuration\n\n   Host Name . . . . . . . . . . . . : Orion\n   Primary Dns Suffix  . . . . . . . :\n   Node Type . . . . . . . . . . . . : Hybrid\n   IP Routing Enabled. . . . . . . . : No\n   WINS Proxy Enabled. . . . . . . . : No\n   DNS Suffix Search List. . . . . . : dibnatri.net\n\n\nWireless LAN adapter Wireless Network Connection:\n\n   Connection-specific DNS Suffix  . : dibnatri.net\n   Description . . . . . . . . . . . : Intel(R) Centrino(R) Wireless-N 1030\n   Physical Address. . . . . . . . . : [redacted]\n   DHCP Enabled. . . . . . . . . . . : Yes\n   Autoconfiguration Enabled . . . . : Yes\n   IPv4 Address. . . . . . . . . . . : 192.168.1.100(Preferred)\n   Subnet Mask . . . . . . . . . . . : 255.255.255.0\n   Lease Obtained. . . . . . . . . . : Tuesday, May 14, 2013 6:47:24 AM\n   Lease Expires . . . . . . . . . . : Friday, June 20, 2149 1:24:02 PM\n   Default Gateway . . . . . . . . . : 192.168.1.1\n   DHCP Server . . . . . . . . . . . : 192.168.1.1\n   DNS Servers . . . . . . . . . . . : 192.168.1.1\n   NetBIOS over Tcpip. . . . . . . . : Enabled\n\nEthernet adapter Local Area Connection:\n\n   Media State . . . . . . . . . . . : Media disconnected\n   Connection-specific DNS Suffix  . : dibnatri.net\n   Description . . . . . . . . . . . : Realtek PCIe FE Family Controller\n   Physical Address. . . . . . . . . : [redacted]\n   DHCP Enabled. . . . . . . . . . . : Yes\n   Autoconfiguration Enabled . . . . : Yes\n\n  [snip]\n\nC:\\Users\\John&gt;net use\nNew connections will be remembered.\n\nThere are no entries in the list.\n\n\nC:\\Users\\John&gt;net use y: /user:john \\\\192.168.1.20\\Tunes\nThe password is invalid for \\\\192.168.1.20\\Tunes.\n\nEnter the password for 'john' to connect to '192.168.1.20':\nThe command completed successfully.\n\nY:\\&gt;net use\nNew connections will be remembered.\n\n\nStatus       Local     Remote                    Network\n\n-------------------------------------------------------------------------------\nOK           Y:        \\\\192.168.1.20\\Tunes      Microsoft Windows Network\nThe command completed successfully.\n\n\nC:\\Users\\John&gt;y:\n\nY:\\&gt;dir\n Volume in drive Y is Tunes\n Volume Serial Number is 1D20-98EC\n\n Directory of Y:\\\n\n05/14/2013  06:54 AM    &lt;DIR&gt;          .\n05/13/2013  02:58 PM    &lt;DIR&gt;          ..\n               0 File(s)              0 bytes\n               2 Dir(s)  6,131,715,282,944 bytes free\n\nY:\\&gt;copy con test1\nsss\n^Z\n        1 file(s) copied.\n\nY:\\&gt;dir\n Volume in drive Y is Tunes\n Volume Serial Number is 1D20-98EC\n\n Directory of Y:\\\n\n05/14/2013  06:56 AM    &lt;DIR&gt;          .\n05/13/2013  02:58 PM    &lt;DIR&gt;          ..\n05/14/2013  06:56 AM                 5 test1\n               1 File(s)              5 bytes\n               2 Dir(s)  6,131,715,447,808 bytes free\n\nY:\\&gt;type test1\nsss\n</code></pre>\n\n<p>However, attempting to do the same under Ubuntu doesn't work as well:</p>\n\n<pre><code>[johnd:~] $ ifconfig\neth0      Link encap:Ethernet  HWaddr [redacted]  \n          UP BROADCAST MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000 \n          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)\n\nlo        Link encap:Local Loopback  \n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:65536  Metric:1\n          RX packets:215 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:215 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:20073 (20.0 KB)  TX bytes:20073 (20.0 KB)\n\nwlan0     Link encap:Ethernet  HWaddr [redacted]  \n          inet addr:192.168.1.100  Bcast:192.168.1.255  Mask:255.255.255.0\n          inet6 addr: fe80::4e80:93ff:fe0c:f3a0/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:2287 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:1980 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000 \n          RX bytes:1669164 (1.6 MB)  TX bytes:761260 (761.2 KB)\n\n[johnd:~] $ sudo mount -l\n[sudo] password for johnd: \n/dev/sda5 on / type ext4 (rw,errors=remount-ro)\nproc on /proc type proc (rw,noexec,nosuid,nodev)\nsysfs on /sys type sysfs (rw,noexec,nosuid,nodev)\nnone on /sys/fs/cgroup type tmpfs (rw)\nnone on /sys/fs/fuse/connections type fusectl (rw)\nnone on /sys/kernel/debug type debugfs (rw)\nnone on /sys/kernel/security type securityfs (rw)\nudev on /dev type devtmpfs (rw,mode=0755)\ndevpts on /dev/pts type devpts (rw,noexec,nosuid,gid=5,mode=0620)\ntmpfs on /run type tmpfs (rw,noexec,nosuid,size=10%,mode=0755)\nnone on /run/lock type tmpfs (rw,noexec,nosuid,nodev,size=5242880)\nnone on /run/shm type tmpfs (rw,nosuid,nodev)\nnone on /run/user type tmpfs (rw,noexec,nosuid,nodev,size=104857600,mode=0755)\n/dev/sda6 on /home type ext4 (rw)\nbinfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc (rw,noexec,nosuid,nodev)\ngvfsd-fuse on /run/user/johnd/gvfs type fuse.gvfsd-fuse (rw,nosuid,nodev,user=johnd)\n[johnd:~] $ ls /mnt/\n[johnd:~] $ sudo mkdir /mnt/tunes\n[johnd:~] $ ls -l /mnt/\ntotal 4 \ndrwxr-xr-x 2 root root 4096 May 14 07:04 tunes\n[johnd:~] $ ls -l /mnt/\ntotal 4\ndrwxr-xr-x 2 root root 4096 May 14 07:04 tunes\n</code></pre>\n\n<p>Note the permissions &amp; owner of <code>/mnt/tunes</code> above.  It is about to change, though I don't know if that's expected/correct.</p>\n\n<pre><code>[johnd:~] $ sudo mount -t cifs //192.168.1.20/Tunes /mnt/tunes -o rw,user=john\nPassword: \n[johnd:~] $ ls -l /mnt/\ntotal 0\ndrwxrwx--- 2 1001 1003 0 May 14 06:56 tunes\n</code></pre>\n\n<p><code>1001</code> is the uid for <code>john</code> on my FreeNAS, and <code>1003</code> is the gid for <code>users</code> there.  <code>john</code> should have full access.</p>\n\n<pre><code>[johnd:~] 1 $ ll /mnt/tunes\nls: cannot open directory /mnt/tunes: Permission denied\n[johnd:~] 1 $ cat&gt;/mnt/tunes/test2\nbash: /mnt/tunes/test2: Permission denied\n[johnd:~] 2 $ \n</code></pre>\n\n<p>What am I doing wrong here?</p>\n"},{"id":335055,"title":"How to force group ownership on samba share?","body":"<p>I have a samba server running on ubuntu server 12.04. Only one folder <code>/sharetest</code> is shared with group <code>storageusers</code>, and users <code>user1</code>, <code>user2</code>, <code>wowza</code> are members of it. Here is smb.conf</p>\n\n<pre><code>#======================= Global Settings =====================================\n[global]\nworkgroup = WORKGROUP\nserver string = Samba Server %v\nnetbios name = ubuntu\nsecurity = user\nmap to guest = bad user\ndns proxy = no\n#============================ Share Definitions ==============================\n[Storage]\npath            = /sharetest\nbrowsable       = yes\nwriteable       = yes\nguest ok        = no\nvalid users     = @storageusers\ncreate mask     = 0775\ndirectory mask  = 0775\n</code></pre>\n\n<p>A second ubuntu server 12.04 will be using above mentioned share. The share on the second server is automounted via fstab line</p>\n\n<pre><code>//192.168.1.12/Storage /share smbfs credentials=/root/.smbcredentials,gid=0 0 0\n</code></pre>\n\n<p>File and folders created inside share folder on the second server have ownership of user <code>wowza</code> and group <code>wowza</code>. I assume because of this other share users do not have access to writing or deleting files and folders. Is there a setting for samba server that will force all files and folders created on share to have group ownership set to <code>storageusers</code> instead of user's primary group?</p>\n"}]}]