[{"id":711266,"title":"kerberos passwd: Authentication token manipulation error","body":"<p>(note - ignore the upgrade 15.10 bit, see \"more info\", below)</p>\n\n<p>I've just upgraded to Ubuntu 15.10 using the Live CD over an existing 14.04 version. Users that were configured before were lost from /etc/passwd, so I'm trying to re-add them. useradd works fine, but when I try (as root) to set the password I get:</p>\n\n<pre><code># passwd username\nCurrent Kerberos password:\nCurrent Kerberos password:\npasswd: Authentication token manipulation error\npasswd: password unchanged\n</code></pre>\n\n<p>I've tried the pre-upgrade password for this user, but that didn't work. I don't even know why it's asking about Kerberos, this is a local user and I don't ever recall creating a kerberos password in the first place.</p>\n\n<p>I've done the following:</p>\n\n<pre><code>passwd -u username\npasswd -d username\n</code></pre>\n\n<p>Which did in fact remove the pw field from the shadow file, but I still get the same request to enter \"Current kerberos password\". </p>\n\n<p>Before you ask, yes, I've confirmed that the file system is rw. I've even remounted, just in case.</p>\n\n<p>How do I clear this? Perhaps remove the kerberos entry for this user? Something?</p>\n\n<p>more info 2015-12-30:</p>\n\n<p>I've confirmed that this has nothing to do with upgrading to 15.10. Same issue on 14.04. Also, as soon as I install the kerberos packages:</p>\n\n<p>apt-get install krb5-config libpam-krb5 krb5-user ssh-krb5</p>\n\n<p>I got the \"Current Kerberos password\" prompt and \"Authentication token manipulation error\" with the vanilla, as-installed Kerberos and samba config files. If I remove these packages I can change local user password.</p>\n\n<p>This indicates to me that ANYONE who has installed Kerberos on Linux (or at least Ubuntu) have all run into this same problem. I would think the solution would be all over the net, but I've found nothing yet! Has no one at askubuntu run into this problem? Surely there are some Kerberos gurus lurking here!</p>\n","related_questions":[{"id":643567,"title":"ssh not authenticating to kerberos","body":"<p>I am using my single PC as a ssh-client,ssh-server,kdc,admin-server. I am not using any of the virtual machines for this kerberos lab. I am connected to wife get the ip of 192.168.1.224 but i am using my hosts file as name resolution. \nMy hostname entry in the /etc/hosts file.</p>\n\n<pre><code>192.168.1.224   igroup.com ashokkrishna-Lenovo-B560\n</code></pre>\n\n<p>and the retrived tickets</p>\n\n<pre><code>ashokkrishna@ashokkrishna-Lenovo-B560:~$ klist\nTicket cache: FILE:/tmp/krb5cc_1000\nDefault principal: ashokkrishna/admin@IGROUP.COM\n\nValid starting       Expires              Service principal\n2015-07-02T17:53:25  2015-07-03T03:53:25  krbtgt/IGROUP.COM@IGROUP.COM\n    renew until 2015-07-03T17:53:23\n2015-07-02T17:53:50  2015-07-03T03:53:25  host/igroup.com@IGROUP.COM\n    renew until 2015-07-03T17:53:23\n</code></pre>\n\n<p>and this is the keytab file.</p>\n\n<pre><code>ashokkrishna@ashokkrishna-Lenovo-B560:~$ sudo klist -kt /etc/krb5.keytab\nKeytab name: FILE:/etc/krb5.keytab\nKVNO Timestamp           Principal\n---- ------------------- ------------------------------------------------------\n   2 2015-07-02T17:52:06 host/igroup.com@IGROUP.COM\n   2 2015-07-02T17:52:06 host/igroup.com@IGROUP.COM\n   2 2015-07-02T17:52:06 host/igroup.com@IGROUP.COM\n   2 2015-07-02T17:52:06 host/igroup.com@IGROUP.COM\n</code></pre>\n\n<p>here is my sshd_config file.</p>\n\n<pre><code>Port 22\nProtocol 2\nUsePrivilegeSeparation yes\n\nKeyRegenerationInterval 3600\nServerKeyBits 1024\n\nSyslogFacility AUTH\nLogLevel INFO\n\nLoginGraceTime 120\nPermitRootLogin yes\nStrictModes yes\n\n\nIgnoreRhosts yes\nRhostsRSAAuthentication no\nHostbasedAuthentication no\nPermitEmptyPasswords no\n\nKerberosAuthentication yes\n\nGSSAPIAuthentication yes\nGSSAPICleanupCredentials yes\n\nX11Forwarding yes\nX11DisplayOffset 10\nPrintMotd no\nPrintLastLog yes\nTCPKeepAlive yes\nAcceptEnv LANG LC_*\nUsePAM yes\n</code></pre>\n\n<p>but when i tried to connect to the </p>\n\n<pre><code>ashokkrishna@ashokkrishna-Lenovo-B560~$: ssh -v ashokkrishna@ashokkrishna-Lenovo-B560\ndebug1: Reading configuration data /etc/ssh/ssh_config\ndebug1: /etc/ssh/ssh_config line 19: Applying options for *\ndebug1: Connecting to ashokkrishna-lenovo-b560 [192.168.1.224] port 22.\ndebug1: Connection established.\ndebug1: identity file /home/ashokkrishna/.ssh/id_rsa type -1\ndebug1: identity file /home/ashokkrishna/.ssh/id_rsa-cert type -1\ndebug1: identity file /home/ashokkrishna/.ssh/id_dsa type -1\ndebug1: identity file /home/ashokkrishna/.ssh/id_dsa-cert type -1\ndebug1: identity file /home/ashokkrishna/.ssh/id_ecdsa type -1\ndebug1: identity file /home/ashokkrishna/.ssh/id_ecdsa-cert type -1\ndebug1: identity file /home/ashokkrishna/.ssh/id_ed25519 type -1\ndebug1: identity file /home/ashokkrishna/.ssh/id_ed25519-cert type -1\ndebug1: Enabling compatibility mode for protocol 2.0\ndebug1: Local version string SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2\ndebug1: Remote protocol version 2.0, remote software version OpenSSH_6.6.1p1 Ubuntu-2ubuntu2\ndebug1: match: OpenSSH_6.6.1p1 Ubuntu-2ubuntu2 pat OpenSSH_6.6.1* compat 0x04000000\ndebug1: SSH2_MSG_KEXINIT sent\ndebug1: SSH2_MSG_KEXINIT received\ndebug1: kex: server-&gt;client aes128-ctr hmac-md5-etm@openssh.com none\ndebug1: kex: client-&gt;server aes128-ctr hmac-md5-etm@openssh.com none\ndebug1: sending SSH2_MSG_KEX_ECDH_INIT\ndebug1: expecting SSH2_MSG_KEX_ECDH_REPLY\ndebug1: Server host key: ECDSA 82:94:1f:20:2d:21:bc:a6:f2:ac:0c:1e:b9:95:44:08\ndebug1: Host 'ashokkrishna-lenovo-b560' is known and matches the ECDSA host key.\ndebug1: Found key in /home/ashokkrishna/.ssh/known_hosts:3\ndebug1: ssh_ecdsa_verify: signature correct\ndebug1: SSH2_MSG_NEWKEYS sent\ndebug1: expecting SSH2_MSG_NEWKEYS\ndebug1: SSH2_MSG_NEWKEYS received\ndebug1: Roaming not allowed by server\ndebug1: SSH2_MSG_SERVICE_REQUEST sent\ndebug1: SSH2_MSG_SERVICE_ACCEPT received\ndebug1: Authentications that can continue: publickey,gssapi-keyex,gssapi-with-mic,password\ndebug1: Next authentication method: gssapi-keyex\ndebug1: No valid Key exchange context\ndebug1: Next authentication method: gssapi-with-mic\ndebug1: Delegating credentials\ndebug1: Delegating credentials\ndebug1: Authentications that can continue: publickey,gssapi-keyex,gssapi-with-mic,password\ndebug1: Authentications that can continue: publickey,gssapi-keyex,gssapi-with-mic,password\ndebug1: Authentications that can continue: publickey,gssapi-keyex,gssapi-with-mic,password\ndebug1: Authentications that can continue: publickey,gssapi-keyex,gssapi-with-mic,password\ndebug1: Next authentication method: publickey\ndebug1: Trying private key: /home/ashokkrishna/.ssh/id_rsa\ndebug1: Trying private key: /home/ashokkrishna/.ssh/id_dsa\ndebug1: Trying private key: /home/ashokkrishna/.ssh/id_ecdsa\ndebug1: Trying private key: /home/ashokkrishna/.ssh/id_ed25519\ndebug1: Next authentication method: password\n</code></pre>\n\n<p>it is asking password not using the kerberos this is the problem i am facing how to resolve this.</p>\n"},{"id":176337,"title":"Installed perfectly but password not working for login or authentication","body":"<p>I installed Ubuntu on an old XP machine (replaced XP with Ubuntu) and it seemed like it went well... Until I tried to download and install the suggested updates! </p>\n\n<p>The password I set during installation will not work for authentication. It won't even work for the User account. I thought maybe I'd typed the password wrong (twice) and checked online how to change it. Holding shift during start up won't give me boot options or grub so I can't get into recovery mode!</p>\n\n<p>I've reinstalled three times (twice with the CD, once with the usb) and it's the same deal.</p>\n\n<p>Basically, I'm sure I typed the password correctly, so I severely doubt that changing the password will help. It will automatically log in if I set it to do so during installation. Otherwise, I can only use the guest account and obviously can't setup another account or update software.</p>\n\n<p>This is my first experience with Ubuntu and until it asked for the password, I thought it had gone so well. I sincerely hope I've missed something simple and I can get this working properly.</p>\n\n<p>I'm surprised that I haven't found any questions with exactly the same issue. Please help! :)</p>\n\n<h3>Requested information</h3>\n\n<p><strong>1:</strong> <code>df -h</code></p>\n\n<pre><code>Filesystem      Size  Used Avail Use% Mounted on\n/dev/sda1       147G  4.7G  135G   4% /\nudev           1000M  4.0K 1000M   1% /dev\ntmpfs           403M  836K  402M   1% /run\nnone            5.0M     0  5.0M   0% /run/lock\nnone           1007M  176K 1007M   1% /run/shm\n/dev/sdc1       7.5G  4.7G  2.8G  63% /media/PENDRIVE\npatricia@[computer name removed by me just in case it shouldn't be shared]\n</code></pre>\n\n<p><strong>2:</strong> <code>dpkg -l | egrep 'lightdm|gdm|kdm|lxdm'</code></p>\n\n<pre><code>ii  liblightdm-gobject-1-0       1.2.1-0ubuntu1          LightDM GObject client library\nii  lightdm                      1.2.1-0ubuntu1          Display Manager\n</code></pre>\n\n<p><strong>3:</strong> Regarding whether or not there were error messages when logging in to a virtual console and attempting to change the password with <code>passwd</code> and <code>sudo passwd $USER</code>:</p>\n\n<ul>\n<li>No, I had to do the mount remount thing first but it said the password was successfully changed after that. It also tells me that I've successfully logged in... </li>\n</ul>\n\n<h3>New development:</h3>\n\n<p>I can now login to the user account created during setup.... I still can't use that password to authenticate though!</p>\n\n<p>Hopefully we're getting closer.. Thanks so much for all your help :)                      </p>\n"},{"id":601830,"title":"**PLEASE** Help with Password Recovery / &quot;Authentication token manipulation error&quot; / keyboard won&#39;t type","body":"<p>I am really hoping that someone can help me with Password Recovery.  A couple weeks ago my doctor found a 6 cm tumor in my head and had a surgeon remove it asap.  Good news, it's benign so I get to live, bad news is I can't remember my passwords for the life of me and I really need some info from my computer.  After reading through other answers I have made it to \"Enter new UNIX password:\" only to have the keyboard freeze up and not type.  I am forced to press enter with blank passwords and then I get a \"Authentication token manipulation error\".  I am using Ubuntu 12.4.  Here is what I have tried so far:</p>\n\n<p>root@ubuntu:~# mount -o remount,rw /</p>\n\n<p>root@ubuntu:~# passwd user</p>\n\n<p>Enter new UNIX password:</p>\n\n<p>(It is a this point that my keyboard freezes and I can't type the new password.  I have to hit enter to get to the next line that says:)</p>\n\n<p>Retype new UNIX password:</p>\n\n<p>(Keyboard still froze so I hit enter again and get:)</p>\n\n<p>Sorry, passwords do not match</p>\n\n<p>passwd: Authentication token manipulation error</p>\n\n<p>passwd: password unchanged</p>\n\n<p>Any help would be greatly appreciated.  Thanks</p>\n"},{"id":468254,"title":"How do I configure a default principal for kinit (acquiring Kerberos ticket)?","body":"<p>When using <code>kinit</code> to acquire a Kerberos ticket I have configured it to use a default realm, e.g. <code>GERT.LAN</code> by editing <code>/etc/krb5.conf</code>:</p>\n\n<pre><code>[libdefaults]\n        default_realm = GERT.LAN\n</code></pre>\n\n<p>That's great since I don't have to supply that all the time on the command line.</p>\n\n<pre><code>⟫ kinit\ngert@GERT.LAN's Password:\n</code></pre>\n\n<p>However, my local username <code>gert</code> does not match the remote username <code>gertvdijk</code>. Now I have to supply the full principal name as an argument still. If this is just kinit I could create a bash alias, but more Kerberos tools appear to try my local username. For example <a href=\"http://packages.ubuntu.com/trusty/kredentials\">Kredentials</a> does not allow me to use another than default principal.</p>\n\n<p>So, basically, what I want is to create a mapping between the local user <code>gert</code> and the remote principal <code>gertvdijk@GERT.LAN</code>.</p>\n\n<p>Ironically, when using a more complicated setup with PAM I am able to achieve this. In <code>krb5.conf</code>:</p>\n\n<pre><code>[appdefaults]\n        pam = {\n                mappings = gert gertvdijk@GERT.LAN\n        }\n</code></pre>\n\n<p>But I don't want to use the Kerberos PAM module anymore since I've locked out myself so many times by thinking the Kerberos server isn't reachable and I'm trying to enter the local password...</p>\n\n<p>So, long story short, is there a way to configure a default principal or a mapping from local usernames?</p>\n"},{"id":414046,"title":"Kerberos and google-authenticator (2-factor auth)","body":"<p>Does anyone know how can I use google-authenticator in combination with kerberos and thus provide to my users 2-factor authentication?</p>\n"},{"id":305583,"title":"I can authenticate but can not login in using my password?","body":"<p>Here is my story :</p>\n\n<ul>\n<li>there were days when I had my password and everything was fine.</li>\n<li>I removed my password :\n<ul>\n<li>Opened <strong><code>User accounts</code></strong></li>\n<li>Unlocked it by pressing \"Unlock\" button</li>\n<li>Selected my username (btw, I have only one user which is Administrator user)</li>\n<li>Chose \"Login without password\"</li>\n<li>Pressed \"Change\" button</li>\n</ul></li>\n<li>and some day there came a trouble</li>\n<li>i needed to authenticate (as I had no password I could not authenticate)</li>\n<li>using <strong><code>Startup Disk Creator</code></strong> wrote Ubuntu 12.04 to a USB.</li>\n<li>I \"tried Ubuntu\"</li>\n<li>mounted my Ubuntu's <code>filesystem</code> (not Try Ubuntu's)</li>\n<li>in terminal run <strong><code>gksu nautilus</code></strong> (No authentication was necessary)</li>\n<li>opened <strong><code>etc/shadow</code></strong> file, and removed <code>some_encrypted_text</code> from this line :\n<ul>\n<li><code>wicked6:some_encrypted_text:15864:0:99999:7:::</code></li>\n</ul></li>\n<li>Rebooted and opened my Ubuntu\n<ul>\n<li>in terminal run <code>passwd myusername</code> and changed my password</li>\n</ul></li>\n<li>I got the message <strong><code>passwd: password updated successfully</code></strong></li>\n<li>I can use this password for authentication but not for logging in by pressing login button (I can log in directly on first log in {Remember that I had used <strong><code>login without password</code></strong>}. But when I lock my screen I need to press <code>switch user</code> and then press <code>login</code>, because when I enter my password it does not accept it)</li>\n</ul>\n\n<p>Please don't advice me to reinstall Ubuntu, because I don't want. Help me to login in on Lock Screen. Thanks in advance.</p>\n\n<p>P.S. I am using Ubuntu 12.04 :-)</p>\n"},{"id":137530,"title":"Once authenticated once, passwords are cached in lightdm","body":"<p>We are preparing 12.04 LTS for our userbase and have done some basic configuration to the login screen (disabled guest account, removed user list, etc). However, one thing that I've noticed is that once a user has authenticated at the login screen (KRB5), a user will no longer have to enter their password. In fact, even after reboot, if a user has previously authenticated, all they have to do is type their username and they can login with no other prompts.</p>\n\n<p>Obviously this is a major security risk at the enterprise level. Please let me know if you need any other information. Any advice would be greatly appreciated!</p>\n\n<p>Thanks for your consideration, but we've realized it is a GID conflict. We have an LDAP group with GID 112, which happens to be the GID of the nopasswdlogin group at least in Precise. We'll be migrating that LDAP group to another GID. This is just an FYI if others see this behavior by chance. I can't close this for another few hours.</p>\n"},{"id":127374,"title":"I can log in with my password, but it&#39;s not accepted as valid for authentication","body":"<p>I can log in with my password just fine, but when trying to use sudo to run commands or authenticating to install software, my password does not work and my account is an administrator account. Further more, when I try to change my password with \"passwd\" in recovery mode, I get \"Authentication token manipulation error.\" I've just installed 12.04, so I'm not sure what I could've done to break the system.</p>\n"},{"id":97464,"title":"Authentication token manipulation error when I try to change password","body":"<p>I get this message when I try to change my password. Everything started when I removed password for my username, so when I go to User Accounts, it says \"None\" for password. But when I try to install some application in Terminal, it is still wants me to write password. When I leave blank field, doesn't help. When I type the old password, still nothing.</p>\n\n<p>Do you know what's wrong?</p>\n"},{"id":90468,"title":"Authentication problem - and I still can&#39;t change the password","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://askubuntu.com/questions/24006/how-do-i-reset-a-lost-administrativeroot-password\">How do I reset a lost Administrative(root) password?</a>  </p>\n</blockquote>\n\n\n\n<p>My question has been previously asked by other users, but has been dismissed by those who answered. I changed the password to blank, but ubuntu still keeps on asking me for authentication every time I open a program and both blank and my old password do not work. I am certain I do remember my old password. I tried changing it in grub but when I go to the console in root and type passwd [my account name] then asks me to type and retype my new password the console does not react to my typing. When I still type my password, assuming it simply just does not show it but it receives it I get an error: token malfunction, password unchanged. Please help, I need my computer for work.</p>\n"}]}]