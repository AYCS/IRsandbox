[{"id":715633,"title":"Run service with previledges of another user?","body":"<p>I want to host a CouchDB but heard that it might be wise not to run it as a root but create an own user for that with little privileges as possible.</p>\n\n<p>How can I achieve that? When I just install CouchDB it seems like it gets started as a service with the root privileges.</p>\n","related_questions":[{"id":1298,"title":"Ubuntu Server samba running as root?","body":"<p>I recently installed Ubuntu Server 10.04. I selected <em>samba file server</em> from the install menu and everything works fine. The problem is, the samba daemon is running as root which has me a little nervous. </p>\n\n<p>I added a 'samba' group and a user called 'samba' to that group, but I can't get the daemon run under it.  MySQL from the LAMP seems to run as its own user.</p>\n"},{"id":639130,"title":"Install script as service running under speciffied user","body":"<p>I would like to install services into init.d folder in most standard way. Suppose I have script which should be run under specific user and starts the service (tomcat8 good example) </p>\n\n<blockquote>\n  <p>.../serviceFoo/start.sh</p>\n</blockquote>\n\n<p>another script </p>\n\n<blockquote>\n  <p>.../serviceFoo/stop.sh</p>\n</blockquote>\n\n<p>Now I want to install this as init.d startup scripts so I can /etc/init.d.seviceFoo start|stop|restart. \n   It would be nice if the service would get killed after some time refusing to stop by issuing stop command. \n   It would be even nicer if i can do it by running simple command like </p>\n\n<blockquote>\n  <p>installService user startScript stopScript</p>\n</blockquote>\n\n<p>Is there something like that in ubuntu ? something like brand new sysv-rc-conf with add button ?</p>\n"},{"id":676007,"title":"How do I make my systemd service run via specific user and start on boot?","body":"<p>I just upgraded from Ubuntu server 14 to version 15. I had trouble getting my upstart script working after the upgrade, and read that systemd is the new default. I'm far from a linux expert, so please go easy on me :-)</p>\n\n<p>Here is what my upstart script was before:</p>\n\n<pre><code>description \"NZBGet upstart script\"\n\nsetuid robert\nsetgid robert\n\nstart on runlevel [2345]\nstop on runlevel [016]\n\nrespawn\n\nexpect fork\n\nscript\n    exec nzbget -D\nend script\n\npre-stop script\n    exec nzbget -Q\nend script\n</code></pre>\n\n<p>Based on the <a href=\"https://wiki.ubuntu.com/SystemdForUpstartUsers\" rel=\"nofollow\">upstart to systemd wiki page</a>, I used the tables provided there to map things as closely as I could in my new systemd service file:</p>\n\n<pre><code>[Unit]\nDescription=NZBGet Service\n\n[Service]\nType=forking\nExecStart=/usr/local/bin/nzbget -D\nExecStop=/usr/local/bin/nzbget -Q\nRestart=on-failure\n</code></pre>\n\n<p>This file is located at <code>/home/robert/.config/systemd/user/nzbget.service</code>. To start the service manually, I've been doing:</p>\n\n<pre><code>$ systemctl --user start nzbget\n</code></pre>\n\n<p>This works great. However, when I log out of my SSH session, the service shuts down. Also, it does not start on bootup or user login. I want it to behave the same as it did as an upstart service: I want it to start at boot, run constantly, and as a specific user.</p>\n\n<p>What do I need to do to get this configuration?</p>\n"},{"id":595495,"title":"Running etherpad as a service on raspberry pi [Fail]","body":"<p>I am setting up etherpad-lite on my raspberry pi ubuntu 14.04 server. I got stuck trying to make etherpad-lite run as a service, following <a href=\"https://github.com/ether/etherpad-lite/wiki/How-to-deploy-Etherpad-Lite-as-a-service\" rel=\"nofollow\">these instructions</a> (I've also checked several others but that hasn't helped).</p>\n\n<p>After starting the service with</p>\n\n<pre><code>service etherpad-lite start\n</code></pre>\n\n<p>i get a discouraging response:</p>\n\n<pre><code>start-stop-daemon: unable to open pidfile '/var/run/etherpad-lite.pid' for writing (Permission denied)\n</code></pre>\n\n<p>I tried to change the permissions for the file, give writing privileges to etherpad (the user running etherpad), but that changed nothing.</p>\n\n<pre><code>sudo chown etherpad: /var/run/etherpad-lite.pid\nsudo chmod 754 /var/run/etherpad-lite.pid\n</code></pre>\n\n<p>Any ideas on how to solve this?</p>\n"},{"id":592868,"title":"Run cronjobs as root while Apache is running as a non-root user","body":"<p>im building a simple Web Application which runs on a tiny device (Odroid C1 with Ubuntu Server 14.04).. the web application will use php.. my problem is that i want to create a \"Settings\" page where the user can customize, for example, local ip address or reboot/shutdown the machine .. basically i will need to run commands which need root user in general. But, for security reasons i want to deny root access to device to everyone.. moreover, i want to run Apache (and another C++ program which the Web Application interact with) as normal (non-root) user.</p>\n\n<p>i will give you an example to explain better.. in the example \"user\" will be the non-root user and \"root\" will be....imagine :)\nHence, i was wondering if this scenario is possible and, if yes, how:</p>\n\n<ul>\n<li>install apache2 and php;</li>\n<li>create the non-root user \"user\" and install/run the C++ application in /home/user/prod</li>\n<li>run apache as non-root user (is it possible? how? is it not recommended?)</li>\n<li>create cronjobs to run <strong>as root</strong>.. i will need them to allow web application do root stuffs</li>\n</ul>\n\n<p>I am quite new in web development and system administration, so i have some more questions (most of them may be even noob questions, i am sorry):</p>\n\n<ul>\n<li>when a customer will boot up the device (which will have no GUI, the only way to interact will be the Web Server, like a router/modem), I know i can run whichever script/command at boot, but what about the user? i mean, since i want to run Apache and the C++ program as non-root.. is there a way to run them at boot as non-root? How?</li>\n<li>is there a way to delete/deny any login? i want the user just push the \"Boot\" button and connect through his Browser to Apache.. nothing more</li>\n</ul>\n\n<p>Thanks a lot.</p>\n\n<p>EDIT:</p>\n\n<ul>\n<li>do cronjobs run always as root, which ever user is logged in and whichever program is running? i've never used cronjobs before</li>\n</ul>\n"},{"id":284882,"title":"How to make ubuntu service run as specific user","body":"<p>How to make ubuntu service run as specific user?</p>\n\n<p>I created an init.d script and make it start at boot, but sooner I found the service is running as root after reboot.</p>\n\n<p>I google and google, people suggest run as a seperate user, so what's the steps?</p>\n"},{"id":210923,"title":"Ubuntu security with services running from /opt","body":"<p>It took me a while to understand what's going on here (I think), but can someone explain to me if there are security risks with regards to my logic of what's going on here as I am trying to set up a home web server as a developer with some good Linux knowledge?</p>\n\n<p>Ubuntu is not like other systems, as it has restricted the root user account. You can not log in as root or <code>su</code> to root. This was a problem for me as I have had to install numerous applications and services to <code>/opt</code> as per user documentation (XAMPPfor Linux is a good example). The problem here is that this directory is owned by <code>root:root</code>. I notice that my admin user account does not belong to <code>root</code> group through the following command:</p>\n\n<p><code>groups username</code> so my understanding is that even though the files and services that I place in <code>/opt</code> belong to root, executing them by means of <code>sudo</code> (as required) does not mean that they are run as root? I imagine that the <code>sudo</code> command is hidden somewhere under belonging to the <code>root</code> user and has a <code>775</code> permission? So the question I have is if running a service like Tomcat, Apcahe, etc exposes my system like on other systems? Obviously I need to secure these in configurations, but isn't the golden rule to never run something as root? What happens if I have multiple services running under same user/group with regards to a compromised server?</p>\n"},{"id":23388,"title":"Installing CouchDB 1.0.1","body":"<p>I have Ubuntu server 10.04 and it comes with its own couchdb version 0.10  I am trying to upgrade this to 1.0.1 or at least install 1.0.1 on the side.  No matter what I try, I can't seem to be able to do it.  Things I have tried are below:</p>\n\n<ul>\n<li><code>sudo apt-get install couchdb</code> (installs something, but when I use curl to check on it, it gives me the Welcome JSON with a version number 0.10)</li>\n<li><code>sudo apt-get upgrade couchdb</code> (installs a whole bunch of stuff, same result)</li>\n<li><code>sudo apt-get remove couchdb</code> (somehow still running - also purged.  now, I can curl to <a href=\"http://127.0.0.1:5984\" rel=\"nofollow\">http://127.0.0.1:5984</a> and get the welcome JSON, but couchdb is not installed any more i.e. typing in couchdb stop gives me a \"not installed\" error)</li>\n<li>Installed from the 1.0.1 binary, but after installation, it is not actually running - tested with netstat)</li>\n<li>Tried to change the port number in the local.ini file and tried to restart, but now can't figure out how to restart couchdb1.0.1 or even if it is actually running.</li>\n</ul>\n\n<p>In case I haven't made it abundantly clear, I am completely new to linux.  I have some rudimentary experience with .htaccess and configuring Apache and PHP but that's it.  If you can help me, I will be very grateful!</p>\n"},{"id":47857,"title":"Stop and start desktop couch with &quot;service&quot;?","body":"<p>I think I'm hitting the same error as <a href=\"http://askubuntu.com/questions/21986/evolution-has-no-access-to-couchdb\">Evolution has no access to couchdb</a> but the first step in the solution is to \"stop desktopcouch service\"</p>\n\n<p><code>Service</code> doesn't know desktopcouch (or couch, as far as I can tell). <code>ps</code> shows a number of couch instances running. I could just kill them all by process ID, but that seems like a hack.</p>\n\n<pre><code>amanda    4290  0.0  0.0   1896   592 ?        S    10:16   0:00 /bin/sh -e /usr/bin/couchdb -n -a /etc/couchdb/default.ini -a /etc/xdg/desktop-couch/compulsory-auth.ini\n-a /home/amanda/.config/desktop-couch/desktop-couchdb.ini\n-b -r 0 -p /home/amanda/.cache/desktop-couch/desktop-couchdb.pid\n-o /home/amanda/.cache/desktop-couch/desktop-couchdb.stdout\n-e /home/amanda/.cache/desktop-couch/desktop-couchdb.stderr\n-R amanda    4314  0.0  0.0   1896   304 ?        S    10:16   0:00 /bin/sh\n-e /usr/bin/couchdb -n -a /etc/couchdb/default.ini -a /etc/xdg/desktop-couch/compulsory-auth.ini\n-a /home/amanda/.config/desktop-couch/desktop-couchdb.ini\n-b -r 0 -p /home/amanda/.cache/desktop-couch/desktop-couchdb.pid\n-o /home/amanda/.cache/desktop-couch/desktop-couchdb.stdout\n-e /home/amanda/.cache/desktop-couch/desktop-couchdb.stderr\n-R amanda    4315  3.0  0.6  81816 19376 ?        Sl   10:16   1:55 /usr/lib/erlang/erts-5.7.4/bin/beam.smp\n-Bd -K true -A 4 -- -root /usr/lib/erlang -progname erl -- -home /home/amanda -- -noshell -noinput\n-sasl errlog_type error -couch_ini /etc/couchdb/default.ini /etc/xdg/desktop-couch/compulsory-auth.ini /home/amanda/.config/desktop-couch/desktop-couchdb.ini\n-s couch -pidfile /home/amanda/.cache/desktop-couch/desktop-couchdb.pid\n-heart amanda    4334  0.0  0.1  20448  3552 ?        Ssl  10:17   0:00 /usr/lib/couchdb/bin/couchjs /usr/share/couchdb/server/main.js amanda    4519  0.1  0.4  19216 12568 ?        S    10:29   0:05 /usr/bin/python /usr/lib/desktopcouch/desktopcouch-service amanda    4548  0.2  0.4  19824 12356 ?        SN   10:29   0:07 /usr/bin/python /usr/lib/desktopcouch/desktopcouch-service amanda    5841  0.0  0.0   4012   756 pts/3    S+   11:19   0:00 grep couch\n</code></pre>\n\n<p>What's the right way to start and stop desktopcouch in 10.10?</p>\n"},{"id":46419,"title":"Is it safe to run a GUI program as another user?","body":"<p>I need to run a program (<code>libreoffice</code>) as another user. I noticed that the program started in the background when invoked as <code>kdesudo -u otheruser libreoffice</code>, possibly to avoid social engineering attacks.</p>\n\n<p>(in the below text, \"logged-in user\" refers to me, not \"otheruser\")</p>\n\n<ul>\n<li>Is it safe to run an untrusted program in this way?</li>\n<li>Does it affect the current logged-in user? (file and process access in the context of the logged-in user)</li>\n</ul>\n\n<p>Denial of Service attacks by fork-bombs, using excess CPU, etc. are excluded since those can occur too if I login directly on <code>otheruser</code>. For clarity, I'm looking for differences between running programs in <em>directly</em> when logged in as <code>otheruser</code> and running programs using <code>kdesudo</code>, <code>gksudo</code> and <code>sudo</code>.</p>\n"}]}]