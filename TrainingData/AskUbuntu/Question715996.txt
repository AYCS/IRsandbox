[{"id":715996,"title":"Can&#39;t connect VPN with OpenVPN on Network Manager Ubuntu 14.04 LTS","body":"<p>I would like to connect to my new VPN (HMA) with openVPN and Network Manager on Ubuntu 14.04LTS. I can establish a connection with a VPN server but I can't use Web browsers.</p>\n","related_questions":[{"id":707983,"title":"Fix VPN DNS Leak on Ubuntu 15.10","body":"<p>When using Cyberghost through OpenVPN, my computer still uses the DNS settings from my router (in this case, Google Public DNS). I was able to use OpenVPN without DNS leaks on Ubuntu 15.04.</p>\n\n<p>Following this article: <a href=\"http://www.ubuntubuzz.com/2015/09/how-to-fix-openvpn-dns-leak-in-linux.html\" rel=\"nofollow\">http://www.ubuntubuzz.com/2015/09/how-to-fix-openvpn-dns-leak-in-linux.html</a></p>\n\n<p>I don't have a DNS leak if I connect to my VPN via terminal. But if I connect via Network Manager, I still have a DNS leak.</p>\n\n<p>Is there a known way to fix this, or is it a bug with Network Manager? If I can't fix it, can my ISP still track me if I'm not using their DNS servers?</p>\n\n<p>If it helps, here's my OpenVPN configuration:</p>\n\n<pre><code>client\nremote 4-us.cg-dialup.net 443\ndev tun \nproto udp\nauth-user-pass\n\n\nresolv-retry infinite \nredirect-gateway def1\npersist-key\npersist-tun\nnobind\ncipher AES-256-CBC\nauth MD5\nping 5\nping-exit 60\nping-timer-rem\nexplicit-exit-notify 2\nscript-security 2\nremote-cert-tls server\nroute-delay 5\ntun-mtu 1500 \nfragment 1300\nmssfix 1300\nverb 4\ncomp-lzo\n\n\nca ca.crt\n\ncert client.crt\n\nkey client.key\n\nscript-security 2\nup /etc/openvpn/update-resolv-conf\ndown /etc/openvpn/update-resolv-conf\n</code></pre>\n"},{"id":705790,"title":"Openvpn not working on ubuntu 15.10","body":"<p>I have a problem trying to connect to openvpn on ubuntu 15.10(32 bits). I have 15.04 64 bits and to install open vpn all I have to do is run the command \"sudo apt-get install openvpn network-manager-openvpn-gnome\" and sellect the openvpn config file and it works fine.</p>\n\n<p>The problem now is that it connects fine and but when it connects, I can't access the internet from firefox. The page request timesout. But when i connect directly it works fine. Here is my system Log.</p>\n\n<pre><code>    Dec  4 07:11:19 user-pc nm-openvpn[3039]: TUN/TAP device tun0 opened\nDec  4 07:11:19 user-pc nm-openvpn[3039]: /usr/lib/NetworkManager/nm-openvpn-service-openvpn-helper --tun -- tun0 1500 1559 10.101.0.6 10.101.0.5 init\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): new Tun device (carrier: OFF, driver: 'tun', ifindex: 9)\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  devices added (path: /sys/devices/virtual/net/tun0, iface: tun0)\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  device added (path: /sys/devices/virtual/net/tun0, iface: tun0): no ifupdown configuration found.\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  VPN connection '11-&gt;xxxVPN.com TCP-443' (IP Config Get) reply received.\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  VPN connection '11-&gt;xxxVPN.com TCP-443' (IP4 Config Get) reply received.\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  VPN Gateway: 189.102.037.102\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  Tunnel Device: tun0\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  IPv4 configuration:\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;    Internal Gateway: 10.101.0.5\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;    Internal Address: 10.101.0.6\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;    Internal Prefix: 32\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;    Internal Point-to-Point Address: 10.101.0.5\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;    Maximum Segment Size (MSS): 0\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;    Static Route: 10.101.0.0/16   Next Hop: 10.101.0.5\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;    Static Route: 10.101.0.1/32   Next Hop: 10.101.0.5\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;    Forbid Default Route: no\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;    Internal DNS: 10.101.0.1\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;    DNS Domain: '(none)'\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  No IPv6 configuration\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  VPN plugin state changed: started (4)\nDec  4 07:11:19 user-pc nm-openvpn[3039]: Initialization Sequence Completed\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  VPN connection '11-&gt;xxxVPN.com TCP-443' (IP Config Get) complete.\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): link connected\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  NetworkManager state is now CONNECTED_LOCAL\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  NetworkManager state is now CONNECTED_GLOBAL\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  Writing DNS information to /sbin/resolvconf\nDec  4 07:11:19 user-pc dnsmasq[2010]: setting upstream servers from DBus\nDec  4 07:11:19 user-pc dnsmasq[2010]: using nameserver 10.101.0.1#53\nDec  4 07:11:19 user-pc dbus[791]: [system] Activating via systemd: service name='org.freedesktop.nm_dispatcher' unit='dbus-org.freedesktop.nm-dispatcher.service'\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  keyfile: add connection in-memory (10173ed3-3e98-4fe0-9742-a8f2a9980adc,\"tun0\")\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): device state change: unmanaged -&gt; unavailable (reason 'connection-assumed') [10 20 41]\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): device state change: unavailable -&gt; disconnected (reason 'connection-assumed') [20 30 41]\nDec  4 07:11:19 user-pc systemd[1]: Starting Network Manager Script Dispatcher Service...\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  Device 'tun0' has no connection; scheduling activate_check in 0 seconds.\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): Activation: starting connection 'tun0' (10173ed3-3e98-4fe0-9742-a8f2a9980adc)\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): device state change: disconnected -&gt; prepare (reason 'none') [30 40 0]\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): device state change: prepare -&gt; config (reason 'none') [40 50 0]\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): device state change: config -&gt; ip-config (reason 'none') [50 70 0]\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): device state change: ip-config -&gt; ip-check (reason 'none') [70 80 0]\nDec  4 07:11:19 user-pc dbus[791]: [system] Successfully activated service 'org.freedesktop.nm_dispatcher'\nDec  4 07:11:19 user-pc systemd[1]: Started Network Manager Script Dispatcher Service.\nDec  4 07:11:19 user-pc nm-dispatcher: Dispatching action 'vpn-up' for tun0\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): device state change: ip-check -&gt; secondaries (reason 'none') [80 90 0]\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  (tun0): device state change: secondaries -&gt; activated (reason 'none') [90 100 0]\nDec  4 07:11:19 user-pc gnome-session[1409]: ** (nm-connection-editor:3002): WARNING **: Unsupported connection type 'generic'\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  NetworkManager state is now CONNECTED_LOCAL\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  NetworkManager state is now CONNECTED_GLOBAL\nDec  4 07:11:19 user-pc NetworkManager[821]: &lt;info&gt;  Policy set 'tun0' (tun0) as default for IPv4 routing and DNS.\n</code></pre>\n\n<p>This are my iptables rules:</p>\n\n<pre><code>Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination         \n\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n</code></pre>\n\n<p>As you can see it is empty is this normal and if it is empty should it stop the vpn from working?</p>\n"},{"id":696223,"title":"network manager and openvpn file","body":"<p>I am experiencing a weird problem with the network manager and VPN configuration file.</p>\n\n<p>I have modified my openvpn file by adding the following lines to the end of the file:</p>\n\n<pre><code>route-nopull\nroute 54.234.36.132\n</code></pre>\n\n<p>Basically what this does (as a test) is to instruct openvpn that only the traffic to that IP is routed through the VPN.</p>\n\n<p>This works fine if I run it like this:</p>\n\n<pre><code>openvpn configfile.openvpn\n</code></pre>\n\n<p>If instead, I import that file into the network manager by adding a new connection type and selecting the Import a saved VPN configuration, the overall VPN connection works but the last two lines seem to be completely ignored because ALL traffic is routed through the VPN.</p>\n\n<p>I have seen the following question <a href=\"https://askubuntu.com/questions/187511/how-can-i-use-a-ovpn-file-with-network-manager\">here</a> but this is not really related to a modified openvpn file, not like my case anyway.</p>\n\n<p>Can anyone point me in the right direction? Maybe tell me what am I doing wrong?</p>\n\n<p>I would like to be able to enable the connection from the GUI rather than the CLI.</p>\n\n<p>Cheers</p>\n"},{"id":614517,"title":"How to run OpenVPN as unprivileged user with Network Manager?","body":"<p>Recently I noticed that when running openvpn as a client on my friends Ubuntu Gnome 14.10 system, the actual openvpn deamon is running as root.</p>\n\n<pre><code>$~:ps aux | grep openvpn\nroot &lt;xxxxxxxxxxxxxxx&gt; S    00:39   0:00 /usr/sbin/openvpn --&lt;xxxx&gt;\n</code></pre>\n\n<p>This is not desirable obvious reasons. I tried reinstalling network-manager thinking maybe it was an error, with no result. Adding the <code>user nobody</code>, <code>group nogroup</code>, <code>persist-key</code>, and <code>persist-tun</code> directives to the config file and than importing it via network-manager not work, nor did attempting to edit the configuration file in the <code>/etc/NetworkManager/system-connections</code> directory.</p>\n\n<p>Edit: This is not the fault of network-manager, but rather the default behavior of openvpn for clients. I tried following <a href=\"https://community.openvpn.net/openvpn/wiki/UnprivilegedUser\" rel=\"nofollow\">this guild</a> from the openvpn website. It did not work because openvpn (when launched from terminal) fails to ask me for my private key password, so it just times out and does not connect.</p>\n\n<p>I would like to know if anyone has a recipe for running openvpn clients as non-privileged users on an Ubuntu system, preferably using the graphical network-manager.</p>\n"},{"id":449642,"title":"Network only using one DNS when connected to VPN","body":"<p>My company has a VPN that I need to connect to. In OSX, I do this by using <code>openvpn</code> with the following configuration:</p>\n\n<pre><code>client\ndev tun\nproto udp\nremote &lt;GATEWAY_ADDRESS&gt; &lt;PORT&gt;\nresolv-retry infinite\nnobind\nuser nobody\ngroup nobody\npersist-key\npersist-tun\nca /Users/Tommy/.openvpn/dev/ca-dev.crt\ncert /Users/Tommy/.openvpn/dev/tommy.brunn-20131122-dev.crt\nkey /Users/Tommy/.openvpn/dev/tommy.brunn-20131122-dev.key\nns-cert-type server\ntls-auth /Users/Tommy/.openvpn/dev/ta-dev.key 1\ncipher BF-CBC\ncomp-lzo\nverb 3\nauth-nocache\n;daemon\n;writepid openvpn.pid\n</code></pre>\n\n<p>In Ubuntu, I've installed <code>network-manager-openvpn</code> and added a new VPN connection (trying to import the config file caused a crash) with the same configuration options set: <a href=\"http://imgur.com/a/tCUrS\" rel=\"nofollow\">Screenshots of my settings</a></p>\n\n<p>Once I connect to the VPN, <strong>I can't resolve any domains whatsoever.</strong></p>\n\n<p>If I edit <code>/etc/NetworkManager/NetworkManager.conf</code>, comment out the line <code>dns=dnsmasq</code> and restart <code>network-manager</code>, I can resolve internal domains from my company, but other domains like google.com won't resolve at all. I've made sure to set my \"Method\" to \"Automatic (VPN) addresses only\" in the IPv4 and IPv6 tabs of the network manager for my VPN connection, but it doesn't seem to make any difference.</p>\n\n<p>I've also tried re-enabling <code>dnsmasq</code> and modifying <code>/etc/resolvconf/resolv.conf.d/base</code>\nto contain <code>nameserver 127.0.1.1</code>, then running <code>sudo resolveconf -u</code>, but then no domains will resolve again.</p>\n\n<p>What I would like is to be able to connect to my VPN so that domains pushed by my company's DNS server are resolved that way, and all other domains are resolved normally.</p>\n\n<p>EDIT: Turns out dnsmasq wasn't actually installed, which I thought it would be by default. Nevertheless, if I install it, re-enable it in <code>/etc/NetworkManager/NetworkManager.conf</code>, add the local nameserver address in <code>/etc/resolvconf/resolv.conf.d/base</code>, restart all the services and connect to the VPN, I can resolve domains from the company DNS, but I can't resolve any other domains. So basically the same situation as when I disabled dnsmasq entirely.</p>\n\n<p>EDIT: Contents of <code>/etc/dnsmasq.conf</code>: <a href=\"http://paste.ubuntu.com/7297231/\" rel=\"nofollow\">http://paste.ubuntu.com/7297231/</a></p>\n"},{"id":561289,"title":"Kubuntu Network Manager setting wrong route when using OpenVPN","body":"<p>When I use the build in OpenVPN functionality of the KDE Network Manager in compairsion to the native openvpn program, I wont get any connection to the internet.</p>\n\n<p>I have a Ubuntu OpenVPN server running. I just created a <code>conf.ovpn</code> configuration file and everything runs perfectly, if I set up the connection by <code>sudo openvpn conf.ovpn</code>. Which means, the tap device, ip routes and connections are established and working.</p>\n\n<p>Now I want to setup the connection with my Kubuntu 14.04 KDE Network Manager.\nI setup everything like in my configuration file and my manager says, that the connection is established. Also the tap device is configured, but actually no connection goes through.</p>\n\n<p>I mentioned that the ip routes a set differently, so maybe this is the point for hands on?</p>\n\n<p>No OpenVPN:</p>\n\n<pre><code>/sbin/ip -d route\ndefault via 192.168.0.1 dev wlan0  proto static \n192.168.0.0/24 dev wlan0  proto kernel  scope link  src 192.168.0.15  metric 9\n</code></pre>\n\n<p>With <code>sudo openvpn conf.ovpn</code> (I obfuscated the global addresses by <code>&lt;someIP&gt;</code>):</p>\n\n<pre><code>/sbin/ip -d route\ndefault via 192.168.0.1 dev wlan0  proto static \n&lt;someIP&gt;/24 via 192.168.233.2 dev tap0 \n&lt;someIP&gt;/26 via 192.168.233.2 dev tap0 \n&lt;someIP&gt; via 192.168.233.2 dev tap0 \n&lt;someIP&gt;/24 via 192.168.233.2 dev tap0 \n192.168.0.0/24 dev wlan0  proto kernel  scope link  src 192.168.0.15  metric 9 \n192.168.116.0/24 via 192.168.233.2 dev tap0 \n192.168.233.0/24 dev tap0  proto kernel  scope link  src 192.168.233.49\n</code></pre>\n\n<p>With Kubuntu Network Manager:</p>\n\n<pre><code>/sbin/ip -d route\ndefault via 192.168.233.2 dev tap0  proto static \n&lt;someIP&gt;/24 via 192.168.233.2 dev tap0  proto static \n&lt;someIP&gt;/26 via 192.168.233.2 dev tap0  proto static \n&lt;someIP&gt; via 192.168.233.2 dev tap0  proto static \n&lt;someIP&gt; via 192.168.0.1 dev wlan0  proto static \n&lt;someIP&gt;/24 via 192.168.233.2 dev tap0  proto static \n192.168.0.0/24 dev wlan0  proto kernel  scope link  src 192.168.0.15  metric 9 \n192.168.116.0/24 via 192.168.233.2 dev tap0  proto static \n192.168.233.0/24 dev tap0  proto kernel  scope link  src 192.168.233.49\n</code></pre>\n\n<p>Does the difference make the problem. And if so, how to set the routes correctly?</p>\n\n<p>Kind regards!</p>\n"},{"id":498185,"title":"How to avoid IP packets leaking when openvpn connection drops","body":"<p>I have a laptop running Ubuntu 12.04 (still waiting for the 14.04.1)<br>\nI have set an openvpn network with the network manager.<br>\nIf the vpn drops the network manager set back its route through the available network interface and the packet are routed through the other networks.<br>\nI there a simple way to avoid that ?</p>\n\n<hr>\n\n<p>After some testing :<br>\nA VPN gateway can have many different addresses, you can check that using command </p>\n\n<pre><code>nslookup VPN_gateway_name\n</code></pre>\n\n<p>If it is the case, each new request to establish a VPN will use randomly one IP in the address pool. To not change the IP filter at each new connection, one can use the DNS name of the gateway; <code>iptables</code> will set one rule for each IP. </p>\n\n<p>second rule will looks like</p>\n\n<pre><code> sudo iptables -A OUTPUT -d your_vpn_gateway_dns_name -j ACCEPT\n</code></pre>\n"},{"id":440302,"title":"How to disable IPv6 when connecting to an OpenVPN server using Network Manager on a dual-stack system?","body":"<p>I'm using the OpenVPN client through the OpenVPN Network Manager plugin on a dual stack (meaning configured both for IPv4 and IPv6 connectivity) Ubuntu 13.10 to redirect all traffic through the VPN (redirect-gateway). It generally works fine. </p>\n\n<p>However, due to the fact that IPv6 is preferred by the system, the VPN \"leaks\" and when connecting to sites that are also available over IPv6 (like Google, or Wikipedia), the browser connects directly. </p>\n\n<p>One solution would be to configure the OpenVPN server to provide IPv6 connectivity. While possible with OpenVPN, the plugin for Network Manager currently doesn't support it. </p>\n\n<p>Since IPv6 connectivity over the VPN is not strictly necessary, <strong>I'd like to simply disable IPv6 on the client when connecting to the OpenVPN server. Is it possible? If so, how can I do it?</strong></p>\n"},{"id":439583,"title":"Openvpn w/ Network manager","body":"<p>This may be a shot in the dark. I'm setting up a Ubuntu 12.04 computer in an open area in which each user need their own username and password to access the network via VPN. This must be a very simple task. Which is why I choose network manager. But Network manager requires a username to be place in a text box and saved in editing VPN connection. Is their a way to make it ask with saving the config for a username and password? </p>\n"},{"id":176810,"title":"Why does the common internet stop working when I connect to an OpenVPN server?","body":"<p>I've set up an OpenVPN daemon on an Ubuntu server of mine and as soon as I connect to it from my Ubuntu laptop with a Network Manager plug-in web pages won't open any more (but get ok as soon as I disconnect from the VPN).</p>\n\n<p>I've tried to use command-line OpenVPN client  and it works ok (both Internet and VPN are accessible). But when I use Network Manager - only local and VPN hosts are accessible.</p>\n"}]}]