[{"id":716065,"title":"Do I need iptables if only two ports are open to the public?","body":"<p>For a special task I have a root server running Linux Ubuntu 14.04. The server has a very minimalistic installation with ssh on a non-standard port and no root access. </p>\n\n<p>Basically the servers primary purpose is to collect and process large amounts of data coming from a number of clients. There is only one single application with a TCP listener handling the client requests.</p>\n\n<p>Last year I've been using iptables and I noticed in my logs many ICMP, DoS and DDoS attacks to my servers ip address. Some of these attacks caused a lot of unwanted traffic. I can see this in the traffic reports I get from my hosting provider. In one case, due to the unusual traffic, my ISP even blocked the access to my server.</p>\n\n<p>As I didn't know how to resolve the issue I temporarilly deactivated iptables and to my big surprise, my traffic statistics went back to normal! Now I'm asking myself what was wrong? Is it even better to have no iptables installed, because I have only 2 ports open to the Internet at all? How can iptables contribute to the protection of my server in this case?</p>\n","related_questions":[{"id":715111,"title":"Need some help Port Forwarding","body":"<hr>\n\n<p>Hello, i was wondering if i could get a bit of help opening/forwarding my port 3410. Im trying to be able to connect to my other computers through a Remote Access Client using port 3410, ive forwarded the ports in my router.<a href=\"http://i.stack.imgur.com/18Jqs.png\" rel=\"nofollow\">router page.</a></p>\n\n<p>Ive Set a rule in iptables.</p>\n\n<pre><code>Chain ufw-user-input (1 references)\n\ntarget     prot opt source               destination         \n\nACCEPT     tcp  --  anywhere             anywhere             tcp dpt:1998\n\nACCEPT     udp  --  anywhere             anywhere             udp dpt:1998\n\nACCEPT     tcp  --  anywhere             anywhere             tcp dpt:3410\n\nACCEPT     udp  --  anywhere             anywhere             udp dpt:3410\n\nACCEPT     tcp  --  192.168.1.0/24       anywhere             tcp dpt:3410\n</code></pre>\n\n<p>And this is the result of the nmap command </p>\n\n<pre><code>me@my_machine:~$ nmap localhost\n\nStarting Nmap 7.00 ( https://nmap.org ) at 2015-12-30 13:15 EST\n\nNmap scan report for localhost (127.0.0.1)\n\nHost is up (0.00016s latency).\n\nNot shown: 996 closed ports\n\nPORT     STATE SERVICE\n\n139/tcp  open  netbios-ssn\n\n445/tcp  open  microsoft-ds\n\n631/tcp  open  ipp\n\n9050/tcp open  tor-socks\n</code></pre>\n\n<p>(3410 is not in there?) </p>\n\n<p>I have enabled UFW and have made a rule to allow the port</p>\n\n<pre><code>me@my_machine:~$ sudo ufw status verbose\n\n\nStatus: active\n\nLogging: on (low)\n\nDefault: deny (incoming), allow (outgoing), disabled (routed)\n\nNew profiles: skip\n\n\nTo                         Action      From\n\n--                         ------      ----\n\n3410                       ALLOW IN    Anywhere\n\n3410/tcp                   ALLOW IN    192.168.1.0/24\n\n3410 (v6)                  ALLOW IN    Anywhere (v6)\n</code></pre>\n\n<hr>\n\n<p>Is there something im not doing? because when i go to an online port checker it says the port is closed/connection timed out. Any help is appreciated.\nThanks in advance. </p>\n"},{"id":714371,"title":"Do I need iptables or ufw if I have gufw?","body":"<p>On my Ubuntu computer I have Iptables,ufw and gufw installed on it but I am trying to figure out if I need to remove one so I did a experiment and removed iptables and I saw ufw and gufw was removed automatically with iptables I reintall iptables and it did not  automatically came with ufw or gufw I install gufw without installing ufw and ufw was install automatically with gufw It like there are all connected to function properly but that just a experiment I went a true answer?</p>\n"},{"id":702823,"title":"iptables block port from local network","body":"<p>I have a problem inside my infrastructure.\nchat.example.com port 8185 is reachable outside my infrastructure with a port fowarding to the right box.\nBut inside my infrastructure, i'm not able to reach it.</p>\n\n<pre><code>root@node1:/etc/iptables# telnet chat.example.com 8185\nTrying 91.x.x.x...\ntelnet: Unable to connect to remote host: Connection refused\n</code></pre>\n\n<p>and outside my infrastructure :</p>\n\n<pre><code>guilhem@guilhem-Lenovo-B50-30:~$ telnet chat.example.com 8185\nTrying 91.x.x.x...\nConnected to chat.example.com.\nEscape character is '^]'.\n</code></pre>\n\n<p>I don't understand why i can't reach it from my infra...</p>\n\n<p>Here is my iptables rules :</p>\n\n<pre><code>root@node1:/etc/iptables# cat rules.v4\n# Generated by iptables-save v1.4.21 on Thu Nov 26 13:51:03 2015\n*nat\n:PREROUTING ACCEPT [1577:148565]\n:INPUT ACCEPT [484:29040]\n:OUTPUT ACCEPT [403:31487]\n:POSTROUTING ACCEPT [47:2820]\n-A PREROUTING -d 91.x.x.x/32 -i eth0 -p tcp -m tcp --dport 8185 -j DNAT --to-destination 10.0.100.30:8185\n-A POSTROUTING -o eth0 -j MASQUERADE\nCOMMIT\n# Completed on Thu Nov 26 13:51:03 2015\n# Generated by iptables-save v1.4.21 on Thu Nov 26 13:51:03 2015\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [4:407]\n:OUTPUT ACCEPT [0:0]\n-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A INPUT -p icmp -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -i eth1 -j ACCEPT\n-A INPUT -i eth0 -p tcp -m tcp --dport 22 -j ACCEPT\n-A INPUT -i eth0 -p tcp -m tcp --dport 443 -j ACCEPT\n-A INPUT -i eth0 -p tcp -m tcp --dport 80 -j ACCEPT\n-A INPUT -i eth0 -p tcp -m tcp --dport 8185 -j ACCEPT\n-A INPUT -j DROP\n-A FORWARD -i eth1 -j ACCEPT\n-A FORWARD -d 10.0.100.30/32 -i eth0 -p tcp -m tcp --dport 8185 -j ACCEPT\n-A OUTPUT -p icmp -j ACCEPT\n-A OUTPUT -o lo -j ACCEPT\n-A OUTPUT -o eth1 -j ACCEPT\n-A OUTPUT -o eth0 -j ACCEPT\nCOMMIT\n# Completed on Thu Nov 26 13:51:03 2015\n</code></pre>\n\n<p>If you have any idea... Thank you !</p>\n"},{"id":657612,"title":"How to configure iptables file to allow only specific ipaddress on all port and deny all other ipaddress?","body":"<p>I require a configuration of iptables file which will allow me connection through only specific ip-address say 10.0.0.1 on all port ranging from 0-5555 and deny all other ip-addresses?</p>\n\n<p>I have tried varies iptables command option but it didn't worked properly. What will be the exact iptables command?</p>\n\n<p>Edit: Ubuntu 14.04 LTS</p>\n"},{"id":646293,"title":"Open port 80 on Ubuntu server","body":"<p>I'm just starting out in ubuntu/linux, and have some trouble opening port 80 for incoming connections.</p>\n\n<p>I ran the <code>sudo ufw allow80/tcp</code> command, and when I run <code>sudo ufw status</code> the result looks like this: </p>\n\n<pre><code>Status: active\n\nTo                         Action      From\n--                         ------      ----\n22                         ALLOW       Anywhere\n80/tcp                     ALLOW       Anywhere\n22 (v6)                    ALLOW       Anywhere (v6)\n80/tcp (v6)                ALLOW       Anywhere (v6)\n</code></pre>\n\n<p>However, I still get this error when trying to connect to the port with curl.</p>\n\n<blockquote>\n  <p>Failed to connect to MY_IP_ADDRESS port 80: Connection refused</p>\n</blockquote>\n\n<p>When I run this command <code>netstat -ntlp | grep LISTEN</code> to see what ports are open, I get this result:</p>\n\n<pre><code>(No info could be read for \"-p\": geteuid()=1000 but you should be root.)\ntcp        0      0 127.0.0.1:27017         0.0.0.0:*               LISTEN      -               \ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -               \ntcp6       0      0 :::22                   :::*                    LISTEN      -         \n</code></pre>\n\n<p>which doesn't look that promising.</p>\n\n<p>How do I open port 80 for incoming connections?</p>\n"},{"id":637188,"title":"iptable rules works sometimes only","body":"<p>I have blocked an attacker IP that was sending me lots of UDP packets.</p>\n\n<p>iptables -I INPUT 1 -s IP_OF_ATTACKER -j DROP</p>\n\n<p>This rule was working all fine.</p>\n\n<pre><code>iptables -nvL --line-numbers\n</code></pre>\n\n<p>22G traffic was blocked for 2-3 days:</p>\n\n<pre><code>num   pkts bytes target     prot opt in     out     source               destination\n1    3203K   22G DROP       all  --  *      *       ATTACKER_IP          0.0.0.0/0\n</code></pre>\n\n<p>However, from last 2-3 days, this rule isn't working anymore. Attacker is sending UDP packets and iptables are not blocking them.</p>\n\n<pre><code>num   pkts bytes target     prot opt in     out     source               destination\n1     707K 3553M DROP       all  --  *      *       ATTACKER_IP         0.0.0.0/0\n</code></pre>\n\n<p>What could be the reason?</p>\n\n<p>PS: Please do not suggest about contacting hosting provider if they were any help I wouldn't be here :)</p>\n\n<h2>Edit</h2>\n\n<p>I used wireshark/tcpdump to analyze/capture packets. It shows all packets are UDP. I use iptables command (as mentioned above) to see how much data iptables rule has blocked. Above is the output of iptables blocked data. When iptable was blocking all the data, our server was working all fine.</p>\n\n<pre><code>**IP Table rules**\n# Generated by iptables-save v1.4.21 on Mon Jun 15 23:26:40 2015\n*raw\n:PREROUTING ACCEPT [8393:667810]\n:OUTPUT ACCEPT [7043:795032]\nCOMMIT\n# Completed on Mon Jun 15 23:26:40 2015\n# Generated by iptables-save v1.4.21 on Mon Jun 15 23:26:40 2015\n*nat\n:PREROUTING ACCEPT [2517:112725]\n:INPUT ACCEPT [2517:112725]\n:OUTPUT ACCEPT [1018:179752]\n:POSTROUTING ACCEPT [1018:179752]\nCOMMIT\n# Completed on Mon Jun 15 23:26:40 2015\n# Generated by iptables-save v1.4.21 on Mon Jun 15 23:26:40 2015\n*mangle\n:PREROUTING ACCEPT [8393:667810]\n:INPUT ACCEPT [8393:667810]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [7043:795032]\n:POSTROUTING ACCEPT [7043:795032]\nCOMMIT\n# Completed on Mon Jun 15 23:26:40 2015\n# Generated by iptables-save v1.4.21 on Mon Jun 15 23:26:40 2015\n*filter\n:INPUT ACCEPT [23:1500]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [18:2068]\n:fail2ban-ssh - [0:0]\n-A INPUT -s xx.xxx.xx.xx/32 -j DROP\nCOMMIT\n# Completed on Mon Jun 15 23:26:40 2015\n</code></pre>\n"},{"id":586415,"title":"Iptables: some ports are closed despite being open by my iptables; can it be something else?","body":"<p>Beginner question. I set up the following iptables rules: </p>\n\n<pre><code>#!/bin/sh \n\n# Réinitialise les règles\nsudo iptables -t filter -F \nsudo iptables -t filter -X \n\n# Bloque tout le trafic\nsudo iptables -t filter -P INPUT DROP \nsudo iptables -t filter -P FORWARD DROP \nsudo iptables -t filter -P OUTPUT DROP \n\n# Autorise les connexions déjà établies et localhost\nsudo iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT \nsudo iptables -A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT \nsudo iptables -t filter -A INPUT -i lo -j ACCEPT \nsudo iptables -t filter -A OUTPUT -o lo -j ACCEPT \n\n# ICMP (Ping)\nsudo iptables -t filter -A INPUT -p icmp -j ACCEPT \nsudo iptables -t filter -A OUTPUT -p icmp -j ACCEPT \n\n# SSH\nsudo iptables -t filter -A INPUT -p tcp --dport 22 -j ACCEPT \nsudo iptables -t filter -A OUTPUT -p tcp --dport 22 -j ACCEPT \n\n# DNS\nsudo iptables -t filter -A OUTPUT -p tcp --dport 53 -j ACCEPT \nsudo iptables -t filter -A OUTPUT -p udp --dport 53 -j ACCEPT \nsudo iptables -t filter -A INPUT -p tcp --dport 53 -j ACCEPT \nsudo iptables -t filter -A INPUT -p udp --dport 53 -j ACCEPT \n\n# HTTP\nsudo iptables -t filter -A OUTPUT -p tcp --dport 80 -j ACCEPT \nsudo iptables -t filter -A INPUT -p tcp --dport 80 -j ACCEPT \n\n# SSL\nsudo iptables -t filter -A OUTPUT -p tcp --dport 443 -j ACCEPT \nsudo iptables -t filter -A INPUT -p tcp --dport 443 -j ACCEPT \n\n# FTP \nsudo iptables -t filter -A OUTPUT -p tcp --dport 20:21 -j ACCEPT \nsudo iptables -t filter -A INPUT -p tcp --dport 20:21 -j ACCEPT \n\n# Mail SMTP \niptables -t filter -A INPUT -p tcp --dport 25 -j ACCEPT \niptables -t filter -A OUTPUT -p tcp --dport 25 -j ACCEPT \n\n# Mail POP3\niptables -t filter -A INPUT -p tcp --dport 110 -j ACCEPT \niptables -t filter -A OUTPUT -p tcp --dport 110 -j ACCEPT \n\n# Mail IMAP\niptables -t filter -A INPUT -p tcp --dport 143 -j ACCEPT \niptables -t filter -A OUTPUT -p tcp --dport 143 -j ACCEPT \n\n# NTP (horloge du serveur) \nsudo iptables -t filter -A OUTPUT -p udp --dport 123 -j ACCEPT\n\n\n#Flood ou déni de service\niptables -A FORWARD -p tcp --syn -m limit --limit 1/second -j ACCEPT\niptables -A FORWARD -p udp -m limit --limit 1/second -j ACCEPT\niptables -A FORWARD -p icmp --icmp-type echo-request -m limit --limit 1/second -j ACCEPT\n</code></pre>\n\n<p>Unfortunately ports 53, 143, 443 remained closed.\nI tied to reboot my server and reload the rules; but still the same issue (I am using a OVH VPS). Can the ports be closed by something else?</p>\n"},{"id":565032,"title":"Forwarding ports with iptables not working?","body":"<p>I have an ubuntu server (14.04.1) which is asking as a router for my network. It has an internet facing interface, eth0, and a second interface, eth1, for connecting to my 10.0.0.0 network.</p>\n\n<p>I am attempting to forward TCP traffic directed to eth0 (for this example, lets say its IP is 118.94.79.113) to eth1 with an address of 10.0.0.1 for port 27016</p>\n\n<p>I have attempted the following commands in sequence:</p>\n\n<p><code>sudo echo \"1\" &gt; /proc/sys/net/ipv4/ip_forward</code></p>\n\n<p><code>sudo sysctl net.ipv4.ip_forward=1</code></p>\n\n<p><code>sudo iptables -t nat -A PREROUTING -p tcp --dport 27016 -j DNAT --to-destination 10.0.0.104:27016</code></p>\n\n<p><code>sudo iptables -t nat -A POSTROUTING -j MASQUERADE</code></p>\n\n<p>but this doesnt seem to work at all, i cannot connect to 118.94.79.113:27016 to access the application running on 10.0.0.104:27016. Is it to do with it being across two interfaces or what?</p>\n"},{"id":432865,"title":"Port won&#39;t open!","body":"<p>I have a server that want to allow connections into it through port 25565, but when I test on <a href=\"http://www.yougetsignal.com/tools/open-ports/\" rel=\"nofollow\">http://www.yougetsignal.com/tools/open-ports/</a> it says they are closed?</p>\n\n<p>I have no outfacing interface configured either</p>\n\n<p>My router has ports 25565 open, and these are my iptables rules</p>\n\n<pre><code>$ iptables -L\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \nACCEPT     tcp  --  anywhere             anywhere             tcp dpt:webmin\nACCEPT     tcp  --  anywhere             anywhere             tcp dpt:25565\n           all  --  anywhere             anywhere             state NEW,RELATED,ESTABLISHED\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination    \n\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \nDNAT       tcp  --  anywhere             94.5.56.101          tcp to:192.168.0.8\n\n$ iptables -t nat -L\n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \nMASQUERADE  all  --  anywhere             anywhere     \n</code></pre>\n"},{"id":274210,"title":"Forward [open] Ports 7777; 2106","body":"<p>Hi i am new to Ubuntu (12.10) x64\nTrying to forward ports for gameserver on my pc (Lineage II)\nPorts are opened in UFW \nPorts are opened in my Router\nEven if i disable UFW others still cant login to gameserver \nTried most [Terminal] commands to forward ports still wont open\nI have the server opened which should make ports liste and they should appear to be open in sites like canyouseeme.ogr </p>\n\n<p>Also tried some commands to open them in 'iptables' \nim so confused help </p>\n"}]}]