[{"id":712707,"title":"Bulk email sending issue with Ubuntu 14.04 (Linode VPS)","body":"<p>I have an email server on Linode.com with the following specs:</p>\n\n<ul>\n<li>Ubuntu 14.04</li>\n<li>Apache &amp; MySQL</li>\n<li>Postfix, Dovecot, Spamassassin, Postgrey, RoundCube, sievemail components.</li>\n</ul>\n\n<p><strong>Problem:</strong> Everything works fine but when I try to send bulk email to more than 15 recipients, it gives the error \"Too many recipients\". I am using Microsoft Outlook 2010 to send and receive emails and I see this error in MS Outlook.</p>\n\n<p><strong>My questions:</strong></p>\n\n<ol>\n<li>What could be the possible issue and how to solve it?</li>\n<li>Is there any limit set in <strong>Postfix</strong> which is not allowing to send bulk email? How to uplift that limit? </li>\n</ol>\n","related_questions":[{"id":675301,"title":"Send an email from the local server using PHP and Postfix","body":"<p>I have written a php code so that when a button is pressed the code sends out an email to the provided email address.</p>\n\n<p>I have followed the instructions that were mentioned in this link for the configuration of postfix without really understanding the steps : </p>\n\n<p><a href=\"https://help.ubuntu.com/community/Postfix\" rel=\"nofollow\">https://help.ubuntu.com/community/Postfix</a></p>\n\n<p>My code worked for gmail and I have receive an email from www-data@example.com. </p>\n\n<p>I did not get anything when I changed the email address to my work address which is a windowslive address and I get it though thunderbird on ubuntu. As I was trying to fix this I have changed the Mail System name to fqdn and typed:\npostconf -e \"myhostname = [hosts fqdn]\"</p>\n\n<p>postconf -e \"myorigin = \\$myhostname\"</p>\n\n<p>in my terminal. Now I have ruined everything and I can not even get an email in my gmail.</p>\n\n<p><strong>So the questions are</strong>:</p>\n\n<p>1-How can I undo my mess</p>\n\n<p>2-How come I was receiving the email in my gmail account and not my work account</p>\n\n<p>3- Is postfix enough or should I install dovecot too? and if so why?</p>\n\n<p>4- If someone has a general understanding of how postfix and emailing using PHP works, I would appreciate it if you could shed some lights on the problem by describing the procedure and the needed prepherials</p>\n"},{"id":674538,"title":"Send an email with PHP using postfix from a local server to any email address","body":"<p>I have created a webpage on my localhost and there is a text box for the user to fill out with her/him email address and there is a Send Email button. When the button is pressed an email with a content of Hello is sent to the provided email address. The code is written using PHP.</p>\n\n<p>I have installed postfix and for the configuration steps I have followed this link : <a href=\"https://help.ubuntu.com/community/Postfix\" rel=\"nofollow\">https://help.ubuntu.com/community/Postfix</a></p>\n\n<p>General type of mail configuration: Internet Site</p>\n\n<p>NONE doesn't appear to be requested in current config</p>\n\n<p>System mail name: example.com</p>\n\n<p>Root and postmaster mail recipient: </p>\n\n<p>Other destinations for mail: server1.example.com, example.com, localhost.example.com, localhost</p>\n\n<p>Force synchronous updates on mail queue?: No</p>\n\n<p>Local networks: 127.0.0.0/8</p>\n\n<p>Yes doesn't appear to be requested in current config</p>\n\n<p>Mailbox size limit (bytes): 0</p>\n\n<p>Local address extension character: +</p>\n\n<p>Internet protocols to use: all</p>\n\n<p>I have tried different email in the text box and I only get the message as www-data@example.com in my gmail account. </p>\n\n<p><strong>So the question is</strong>,would I able to fix it by changing the configurations and if so how?</p>\n"},{"id":575979,"title":"Set up Postfix to send but not receive mail","body":"<p>I want to set up my web server (Ubuntu 14.04) so that I can use contact forms, forum email confirmations, etc. without having to go through Gmail or some other server. I don't want to receive emails, just send them (and only from 127.0.0.1). I need to be able to send them from any address I specify, even if it's fake (for example, a fake no-reply@mydomain.net). I've had this sort of ability on shared hosting, but I'm moving everything to my own server and want this sort of functionality with php mail().</p>\n\n<p>I tried using Sendmail, but it had too many configuration errors to work through (I had everything fixed, but it still wouldn't allow localhost to send email). I already set up Postfix with Gmail, but that restricts me to sending every email from one address (won't work for other domains on the machine).</p>\n\n<p>Port 25 is blocked by my ISP to cut down on spam. I have Ubuntu 14.04 with Nginx.</p>\n"},{"id":533216,"title":"Postfix 2.11.0, Error Code: Relay access denied 554.5.7.1, Rejects all external in-bound emails","body":"<p>Some TLC needed here.\nI am building this postfix/dovecot/clamav mail server following the tutorial here: <a href=\"https://www.exratione.com/2014/05/a-mailserver-on-ubuntu-1404-postfix-dovecot-mysql/\" rel=\"nofollow\">https://www.exratione.com/2014/05/a-mailserver-on-ubuntu-1404-postfix-dovecot-mysql/</a></p>\n\n<p>The issue I ran into and have spent tons of hours without any outcome.\nThis server can be accessed by mail clients fine, sending emails out ok, however it won't take / will straight reject any in-bound emails from outside.</p>\n\n<p>The error msg from mail.log is:</p>\n\n<pre><code>Oct  7 12:52:19 mail postfix/smtpd[7612]: NOQUEUE: reject: RCPT from mail-la0-f49.google.com[209.85.215.49]: 554 5.7.1 &lt;admin@ncullc.com&gt;: Relay access denied; from=&lt;wz6@gmail.com&gt; to=&lt;admin@ncullc.com&gt; proto=ESMTP helo=&lt;mail-la0-f49.google.com&gt;\n</code></pre>\n\n<p>Here is my postconf -n result:</p>\n\n<pre><code>    append_dot_mydomain = no\n    biff = no\n    broken_sasl_auth_clients = yes\n    config_directory = /etc/postfix\n    content_filter = amavis:[127.0.0.1]:10024\n    disable_vrfy_command = yes\n    dovecot_destination_recipient_limit = 1\n    enable_original_recipient = no\n    header_checks = regexp:/etc/postfix/header_checks\n    inet_interfaces = all\n    mailbox_size_limit = 0\n    maximal_backoff_time = 8000s\n    maximal_queue_lifetime = 7d\n    minimal_backoff_time = 1000s\n    mydestination =\n    myhostname = mail.ncullc.com\n    mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128\n    mynetworks_style = host\n    myorigin = /etc/hostname\n    readme_directory = no\n    recipient_delimiter = +\n    smtp_helo_timeout = 60s\n    smtp_tls_note_starttls_offer = yes\n    smtp_tls_security_level = may\n    smtpd_banner = $myhostname ESMTP $mail_name\n    smtpd_client_restrictions = reject_rbl_client sbl.spamhaus.org, reject_rbl_client blackholes.easynet.nl, reject_rbl_client dnsbl.njabl.org\n    smtpd_data_restrictions = reject_unauth_pipelining\n    smtpd_delay_reject = yes\n    smtpd_hard_error_limit = 12\n    smtpd_helo_required = yes\n    smtpd_helo_restrictions = permit_mynetworks, warn_if_reject reject_non_fqdn_hostname, reject_invalid_hostname, permit\n    smtpd_recipient_limit = 16\n    smtpd_relay_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination, permit\n    smtpd_sasl_auth_enable = yes\n    smtpd_sasl_authenticated_header = yes\n    smtpd_sasl_local_domain =\n    smtpd_sasl_path = private/auth\n    smtpd_sasl_security_options = noanonymous\n    smtpd_sasl_type = dovecot\n    smtpd_sender_restrictions = permit_sasl_authenticated, permit_mynetworks, warn_if_reject reject_non_fqdn_sender, reject_unknown_sender_domain, reject_unauth_pipelining, permit\n    smtpd_soft_error_limit = 3\n    smtpd_tls_cert_file = /etc/ssl/certs/ssl-cert-snakeoil.pem\n    smtpd_tls_key_file = /etc/ssl/private/ssl-cert-snakeoil.key\n    smtpd_tls_loglevel = 1\n    smtpd_tls_received_header = yes\n    smtpd_tls_security_level = may\n    smtpd_tls_session_cache_timeout = 3600s\n    tls_random_source = dev:/dev/urandom\n    unknown_local_recipient_reject_code = 450\n    virtual_alias_maps = mysql:/etc/postfix/mysql_virtual_alias_maps.cf, mysql:/etc/postfix/mysql_virtual_alias_domainaliases_maps.cf\n    virtual_gid_maps = static:8\n    virtual_mailbox_base = /var/vmail\n    virtual_mailbox_domains = mysql:/etc/postfix/mysql_virtual_domains_maps.cf\n    virtual_mailbox_maps = mysql:/etc/postfix/mysql_virtual_mailbox_maps.cf, mysql:/etc/postfix/mysql_virtual_mailbox_domainaliases_maps.cf\n    virtual_transport = dovecot\n    virtual_uid_maps = static:150\n</code></pre>\n\n<p>Here is my dovecot -n result:</p>\n\n<pre><code>    # 2.2.9: /etc/dovecot/dovecot.conf\n    # OS: Linux 3.13.0-36-generic x86_64 Ubuntu 14.04.1 LTS ext3\n    auth_mechanisms = plain login\n    first_valid_uid = 150\n    last_valid_uid = 150\n    mail_gid = mail\n    mail_location = maildir:/var/vmail/%d/%n\n    mail_uid = vmail\n    namespace inbox {\n      inbox = yes\n      location =\n      mailbox Drafts {\n        special_use = \\Drafts\n      }\n      mailbox Junk {\n        special_use = \\Junk\n      }\n      mailbox Sent {\n        special_use = \\Sent\n      }\n      mailbox \"Sent Messages\" {\n        special_use = \\Sent\n      }\n      mailbox Trash {\n        special_use = \\Trash\n      }\n      prefix =\n    }\n    passdb {\n      args = /etc/dovecot/dovecot-sql.conf.ext\n      driver = sql\n    }\n    postmaster_address = admin@ncullc.com\n    protocols = \" imap pop3\"\n    service auth {\n      unix_listener /var/spool/postfix/private/auth {\n        group = postfix\n        mode = 0666\n        user = postfix\n      }\n      unix_listener auth-userdb {\n        group = mail\n        mode = 0666\n        user = vmail\n      }\n    }\n    ssl_cert = &lt;/etc/ssl/certs/ssl-cert-snakeoil.pem\n    ssl_key = &lt;/etc/ssl/private/ssl-cert-snakeoil.key\n    userdb {\n      args = /etc/dovecot/dovecot-sql.conf.ext\n      driver = sql\n    }\n</code></pre>\n\n<p>When I send emails from Gmail, it will bounce back the email right away and spit the 554 5.7.1 error code.</p>\n\n<p>I have tried to play with smtpd_relay_restrictions vs smtpd_recipient_restrictions a little bit, has no positie result.</p>\n\n<p>Thanks,\nWayne</p>\n"},{"id":414263,"title":"Emails send to Yahoo declined","body":"<p>I recently set up purchased a VPS, installed Ubuntu 12.04 LTS on it and Webmin/Virtualmin. I think I configured DNS records for each domain I've added properly.</p>\n\n<p>When I am sending emails to an Yahoo email I receive the following error:</p>\n\n<pre><code>C658BA3706      565 Wed Jan 29 15:13:47  nedegroup@nedegroup.com\n(host mta5.am0.yahoodns.net[98.136.217.202] said: 421 4.7.1 [TS03] All messages from 188.226.139.41 will be permanently deferred; Retrying will NOT succeed. See http://postmaster.yahoo.com/421-ts03.html (in reply to MAIL FROM command))\n</code></pre>\n\n<p>How can I solve this problem? I do not intent to send bulk/spam email.</p>\n\n<p>Is there a way to make all my email accounts created on different domain names under my VPS to send emails to the Inbox folder of other email accounts? </p>\n\n<p>For example when I send to gmail my emails go to inbox, but when I send to hotmail they go to the spam folder.</p>\n\n<p>Thanks</p>\n"},{"id":401000,"title":"If you can send emails from server, but cannot configure desktop client, can you say SMTP is working?","body":"<p>This question is a somewhat prologue to a different question posted (<a href=\"http://serverfault.com/questions/565332/vps-smtp-working-on-server-client-roundcube-but-cannot-be-configured-on-deskt\">here)</a>. As I can state that I can send email from my Ubuntu server (12.04) via Roundcube, perfectly. However, I cannot manage to correctly configure my desktop email client on my Mac. And I feel the problem lies in the SMTP port.</p>\n\n<p>However, I want to know where I should be debugging. Therefore I want to know: If I can send emails from the server, via Roundcube, can I state that the SMTP server/postfix is correctly installed/configured/working?</p>\n\n<p>Edit: Just found this information, which made help:</p>\n\n<blockquote>\n  <p>Starting Nmap 5.21 ( <a href=\"http://nmap.org\" rel=\"nofollow\">http://nmap.org</a> ) at 2014-01-06 15:50 CET</p>\n  \n  <p>Nmap scan report for localhost (127.0.0.1)</p>\n  \n  <p>Host is up (0.0000060s latency).</p>\n  \n  <p>Not shown: 993 closed ports</p>\n  \n  <p>PORT     STATE SERVICE</p>\n  \n  <p>21/tcp   open  ftp</p>\n  \n  <p>22/tcp   open  ssh</p>\n  \n  <p>53/tcp   open  domain</p>\n  \n  <p>80/tcp   open  http</p>\n  \n  <p>110/tcp  open  pop3</p>\n  \n  <p>143/tcp  open  imap</p>\n  \n  <p>3306/tcp open  mysql</p>\n</blockquote>\n\n<p><code>sudo netstat -tlnp\nroot@vps:~# sudo netstat -tlnp\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 127.0.0.1:10025         0.0.0.0:*               LISTEN      2550/master<br>\ntcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      779/mysqld<br>\ntcp        0      0 0.0.0.0:110             0.0.0.0:*               LISTEN      758/dovecot<br>\ntcp        0      0 0.0.0.0:143             0.0.0.0:*               LISTEN      758/dovecot<br>\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1002/apache2<br>\ntcp        0      0 159.253.1.196:53        0.0.0.0:*               LISTEN      744/named<br>\ntcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      744/named<br>\ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      665/sshd<br>\ntcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      2550/master<br>\ntcp        0      0 127.0.0.1:953           0.0.0.0:*               LISTEN      744/named<br>\ntcp        0      0 0.0.0.0:4190            0.0.0.0:*               LISTEN      758/dovecot<br>\ntcp6       0      0 :::21                   :::*                    LISTEN      946/proftpd: (accep\ntcp6       0      0 :::22                   :::*                    LISTEN      665/sshd<br>\ntcp6       0      0 :::25                   :::*                    LISTEN      2550/master</code></p>\n"},{"id":396547,"title":"Ubuntu 12.04, Php5-fpm, Apache2, Postfix: impossible to send a mail with PHP","body":"<h2>Resources I followed</h2>\n\n<p>I followed several howtos and questions on askubuntu:</p>\n\n<ul>\n<li><a href=\"https://help.ubuntu.com/community/Postfix\" rel=\"nofollow\">https://help.ubuntu.com/community/Postfix</a></li>\n<li><a href=\"http://askubuntu.com/questions/200835/how-to-configure-apache-php-postfix-website-emails-when-using-vhosts\">How to configure apache / php / postfix website emails when using vhosts?</a></li>\n<li><a href=\"http://askubuntu.com/questions/88117/sending-mails-with-php-lampp-and-postfix\">Sending mails with PHP, LAMPP and PostFix</a></li>\n</ul>\n\n<p>And it does not fix my issue.</p>\n\n<h2>Configuration</h2>\n\n<ul>\n<li>This is a Kimsufi server from OVH, quad core with 2 Gb of memory</li>\n<li>I just installed the basic Ubuntu 12.04 LTS server</li>\n<li>I then installed apache2, php-fpm, mysql, two custom cron scripts for backup</li>\n<li>I use it for a multisite Wordpress, where I manage my blog and blogs of family and friends, plus a few customers</li>\n</ul>\n\n<h2>Issue</h2>\n\n<p>Php-fpm cannot send email, even after following official community documention on Ubuntu wiki, and other tips and tricks I find.</p>\n\n<p>For PHP, it seems that the email is sent, but the test mail never come in my inbox...</p>\n\n<p>What do I miss ? Is there a very simple solution ? </p>\n\n<p>By the way, when this will be fixed, I would be happy to write a full howto about that.</p>\n\n<h2>/var/log/mail.log</h2>\n\n<p><a href=\"http://pastebin.com/8j7y1upw\" rel=\"nofollow\">http://pastebin.com/8j7y1upw</a></p>\n"},{"id":358706,"title":"ubuntu 12.04 lts secure lamp server","body":"<p>So ... i've been been unfortunate with my linux VPS server running 12.04.3 lts. I had a bad php script running that basically opened up for a mysql injection. And because of a stupid configuration from my side this mysql injection ended with a escalation exploit where the person gained access to everything.</p>\n\n<p>I managed to catch this in time and backed up my stuff and wiped the server.</p>\n\n<p>So, i've re-installed and re-evaluated everything i thought i knew and started from scratch.</p>\n\n<p>What do i have running ... well.</p>\n\n<ul>\n<li>apache2 2.2.22</li>\n<li>php5 5.3.10-1ubuntu3.8 with Suhosin Patch 0.9.10)</li>\n<li>mysql-server </li>\n<li>postfix </li>\n<li>ssh </li>\n<li>iptables</li>\n</ul>\n\n<p>I've installed all of these individually, i didn't do \"apt-get install lamp\". apt-get install ssh apache2 mysql-server php5 php5-mysql postfix iptables ... is pretty much it i think.</p>\n\n<p>For apache2, i've followed a few guides which i can't seem to find among my 300+ tabs in firefox. I'm sure there must be some more stuff i need to do to fully secure apache.</p>\n\n<p>For php5 i made sure i installed suhosin patch and i followed a guide or two where i edited the config. I'm sure there must be something here as well that i could do to protect myself.</p>\n\n<p>My mysql server is set up to only accept from localhost. I use ssh tunnel to be able to connect to it with navicat so i can do backups and such. I've made sure that all users besides root does not have any server privileges, this was what screwed the pooch the last time (yes i know, silly me ... i had completely forgotten that i had used a user in the past to remote connect then used that for something else which then let to the escalation exploit). And i've added a line in the config that stops mysql from being able to load local files into tables and such. Either way ... i feel that i've done what i can with mysql server for now.</p>\n\n<p>Postfix was a default install, i did nothing. I later uninstalled it because i did not find a suitable guide for it. And i saw so many said that postfix is a disaster to configure and if left in default state, you are begging for a hack. Or so they said... <em>shrugs</em></p>\n\n<p>What i've done so far is secured ssh by running it on a alternative port and i've used puttygen to generate a rsa key with 4096bit encryption with a passphrase. I've disabled root login via ssh config and pam. The only way to log in to ssh now is via the rsa pubkey using the key i generated. And this works really great. And i feel confident that ssh is secure now. No way in without the private key and the password as far as i understand.</p>\n\n<p>iptables, well, every server needs iptables. I have a bunch of ip's i've blocked. And probably more to be blocked in the future.</p>\n\n<p>Alright ... soo, now on my freshly installed server, i've managed to revert almost everything. I have removed the php page that was the entry point for the hacker and i've used a clean install of files for my SMF forum software. I've kept the attachments of the forum though as they were an important part of my forum. Basically i'm ready to boot up my forum with the old database and force all users to change passwords.</p>\n\n<p>Now, the hacker, is a former forum user on my forum. So i sort of know him. He saw hacking my server as a gift to me so i could clean up the security hole. Now this might be so ... it has indeed made me more security aware. So much so that i've spent almost 2 weeks non-stop reading up on the internet about how to secure these services that i am running.</p>\n\n<p>Now, with my freshly installed server, i get a private message over steam from the same guy (the hacker), stating he found another loop hole, but he's not going to tell me what it is this time because i iptabled him and his VPN.</p>\n\n<p>The guy feels that he should be rewarded for breaking into my server. Personally, if a person breaks in, you don't offer him cake and coffee. You break his legs ... then call the cops. <em>coughs</em></p>\n\n<p>Anyway, this brings me to postfix. I installed this because i don't want to pay for a mail delivery system for my forum when all i need to do is send a few emails a day. It's not a huge forum, so the odd chance is that the only times i will send a lot of emails is when i do newsletters to my 250+ members.</p>\n\n<p>I feel sure that apache, php5 and ssh are secure. And i feel secure that my wordpress frontpage and SMF forum are secure as well (i uninstalled almost all most and went with only the most basic mods). Like i said, all files are fresh but my attachments from the SMF forum.</p>\n\n<p>But i feel that i might be getting trolled here.\nThough i might be wrong ...</p>\n\n<p>I am in need of a postfix service tho, just so the forum can send mail. I don't need to recieve any. So i'm wondering, can i keep postfix with default settings? Or will these open me for attack?</p>\n\n<p>The guy, like i said, is either trolling me because he wants me to be more paranoid or he's telling me the truth.</p>\n\n<p>Could anyone shed some light here?\nI mean, apache, php, mysql and ssh seem secure. If there are more php files laying around that he can mysql intject into, then he at least won't get far as none of the users have grant, nor do they have server privileges. So i'm guessing the postfix is his entry point? Or am i just being trolled?</p>\n"},{"id":200835,"title":"How to configure apache / php / postfix website emails when using vhosts?","body":"<p>I have a LAMP webserver configured to serve multiple websites. Each virtual host has various PHP applications, mainly Wordpress.</p>\n\n<p>When users sign up to the Wordpress sites, email is sent by PHP through to postfix, and then on to the receiver. The problem is that postfix is identifying itself to the remote server with the contents of /etc/hostname, which is not a fully qualified domain name. Some mail servers reject this and the mail bounces.</p>\n\n<p>Additionally, the return path is being set to one of the vitual host domains, seemingly at random.</p>\n\n<p>I could set /etc/hostname to one of the website domain names, but then the emails from the other websites would have a wrong server in the headers, and this would not fix the return-path issue.</p>\n\n<p>Possibly related, apache2 says \"could not determine the server's fully qualified domain name\" on startup.</p>\n\n<p>How do I fix this so that each website can send email without revealing the other websites hosted on the server?</p>\n\n<p>Example error:</p>\n\n<pre><code>Oct 15 20:29:32 Ubuntu-1204-precise-64-minimal postfix/smtp[17214]: CD087E00DF6: to=&lt;*****@*******.**&gt;, relay=spool.mail.gandi.net[217.70.184.6]:25, delay=0.29, delays=0.12/0/0.09/0.07, dsn=5.5.2, status=bounced (host spool.mail.gandi.net[217.70.184.6] said: 504 5.5.2 &lt;Ubuntu-1204-precise-64-minimal&gt;: Helo command rejected: need fully-qualified hostname (in reply to RCPT TO command))\n</code></pre>\n\n<p>I have now set the FQDN in /etc/hosts and /etc/hostname, and restarted apache2 and postfix, and it still gives this same error. I don't even know where it is still getting the old hostname from as it is no longer stored anywhere on disk.</p>\n"},{"id":83456,"title":"How to get Postfix to send/forward/relay to a sub-domain located on another server?","body":"<p>I have a quick question. How do I setup postfix to send an email to another server (Exchange Server) when sending to an email address that has a sub-domain of our main server. For example, say our main server is mail.example.com and we have a Exchange server setup to receive emails from exchange.example.com. We have the MX records setup in our DNS and it receives correctly if we send from a GMail account. However, when we try to send an email from a @example.com account we get the following error:</p>\n\n<pre><code>Host or domain name not found. Name service error for name=exchange.example.com type=A: Host not found\n</code></pre>\n\n<p>I believe Postfix checks for local mailboxes first and if its setup with the domain it delivers to the local account, but in this case the sub-domain accounts are located in another server. Anyone have any thoughts on what I need to do within Postfix so it doesn't look locally for the exchange.example.com mailboxes?</p>\n\n<p>Thanks for your help.</p>\n"}]}]