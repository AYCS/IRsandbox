[{"id":715291,"title":"trying to connect ubuntu with windows xp using samba server","body":"<p>I am facing the following problems when I am using samba server to share folders between Ubuntu 14.04 and Windows XP.</p>\n\n<p>First, I create two folders in Ubuntu then share it to a local network by using samba share server as password protected.</p>\n\n<p>For example: let me create 2 folders A, B and I also have 2 users let user1 and user2. Now I provide folder A privilege to user1 and folder B privilege to user2.</p>\n\n<p>Now I go to the Windows XP Machine and access shared folders now what is happening here :</p>\n\n<p>When I access folder A by user2, it has not permitted the user2 to access folder A. Then I access folder B by user2, it was permissible to user2 to access folder B, OK that's fine. </p>\n\n<p>But now I go back and try to access folder A, it was allowing me to access folder A without login. </p>\n\n<p>How can I manage only valid users can access their folders.</p>\n\n<p>Please help me.</p>\n\n<p>Thanks !</p>\n","related_questions":[{"id":711037,"title":"Ubuntu Server joining an Active Directory Windows Domain","body":"<p>The gist of what I want to do is add some Ubuntu Server hosts to my Windows Active Directory (2008r2 level), limit access to each server via a group, then further limit the sudo permissions on the server per a different group. </p>\n\n<p>I also want to mount a cifs share as the domain users home directory, so all home directory files are stored on the Windows CIFS share and not on the server itself.</p>\n\n<p>Here is the current layout of servers I have: \n5x Windows Server 2008r2 VM's \n9x Ubuntu Server 14.04.3 VM's</p>\n\n<p>Of the 5 Windows Boxes here is their purpose: \n1x Windows AD Controller (2008r2 Level) \n1x Windows File Services (Hold the share for user homes) \n1x Windows Exchange 2013 Server \n2x App Servers</p>\n\n<p>Now I've played with PBIS Open and it works great, Its done everything I need EXCEPT mounting the CIFS share as the user home directory. I can control all the other access permissions ect.</p>\n\n<p>To be clear on the Ubuntu servers I want the home directories in /home/DOMAINNAME/remote/USER</p>\n\n<p>So I'd imagine I would want to mount the CIFS share on /home/DOMAINNAME/remote however I also want the share to be unmounted when the user logs out (SSH/Console/Whatever)</p>\n\n<p>I've seen posts on other websites ect where this is possible with PBIS but most refer to the enterprise side and using GPE which is not possible in the open version.</p>\n\n<p>Any assistance anyone could provide would be great, if you have any questions or don't understand anything I've said I can try to clarify.</p>\n\n<p>Thanks, \nDMehaffy</p>\n"},{"id":706587,"title":"Cannot write to Samba shared folder","body":"<p>This question has been asked several times, but reading the different answers did not get me to resolve my specific problem.\nUbuntu 14.04 is installed on my HTPC. I want to share over the LAN the entire content of 2 hard drives via 1 account in read and write. I need to access those shares from Android, mac os x and Windows 10.\nI was able to create 1 shared folder via Samba, but I cannot write to it. Authentication and read works. </p>\n\n<p>I ran out of ideas to explain why it does not work, and I request the community for help.</p>\n\n<p>Account that must have access: miguel. It is an admin account and I have created a different samba password for it.\nShared drive: bigstock</p>\n\n<p>/etc/fstab</p>\n\n<pre><code># /boot/efi was on /dev/sda1 during installation\nUUID=C2C2-B220  /boot/efi       vfat    defaults        0       1\n# swap was on /dev/sda3 during installation\nUUID=d20a7536-efe1-4ad4-b8a1-e36c9c5d7bc4 none            swap    sw              0       0\n#bigstock drive\nUUID=479a5442-ef4e-4266-a729-f1c188755ac7 /media/miguel/bigstock ext4 defaults 0 2\n#stock drive\nUUID=a0bdc1df-a568-4d26-82bb-cfd35aa3ab32 /media/miguel/stock ext4 defaults 0 2\n</code></pre>\n\n<p>ls -la /media</p>\n\n<pre><code>total 12\ndrwxr-xr-x   3 miguel miguel 4096 oct.  22 20:42 .\ndrwxr-xr-x  23 root   root   4096 déc.   6 11:58 ..\ndrwxr-xr-x+  4 miguel miguel 4096 nov.   7 17:43 miguel\n</code></pre>\n\n<p>ls -la /media/miguel</p>\n\n<pre><code>total 16\ndrwxr-xr-x+  4 miguel miguel 4096 nov.   7 17:43 .\ndrwxr-xr-x   3 miguel miguel 4096 oct.  22 20:42 ..\ndrwxr-xr-x  14 miguel miguel 4096 déc.   6 15:04 bigstock\ndrwxr-xr-x   4 miguel miguel 4096 nov.  26 12:40 stock\n</code></pre>\n\n<p>ls -la /media/miguel/bigstock</p>\n\n<pre><code>total 68\ndrwxr-xr-x  14 miguel miguel  4096 déc.   6 15:04 .\ndrwxr-xr-x+  4 miguel miguel  4096 nov.   7 17:43 ..\n</code></pre>\n\n<p>testparm -s</p>\n\n<pre><code>Load smb config files from /etc/samba/smb.conf\nrlimit_max: increasing rlimit_max (1024) to minimum Windows limit (16384)\nProcessing section \"[bigstock]\"\nLoaded services file OK.\nServer role: ROLE_STANDALONE\n[global]\n    server string = %h server (Samba, Ubuntu)\n    server role = standalone server\n    map to guest = Bad User\n    obey pam restrictions = Yes\n    pam password change = Yes\n    passwd program = /usr/bin/passwd %u\n    passwd chat = *Enter\\snew\\s*\\spassword:* %n\\n *Retype\\snew\\s*\\spassword:* %n\\n *password\\supdated\\ssuccessfully* .\n    unix password sync = Yes\n    syslog = 0\n    log file = /var/log/samba/log.%m\n    max log size = 1000\n    dns proxy = No\n    usershare allow guests = Yes\n    panic action = /usr/share/samba/panic-action %d\n    idmap config * : backend = tdb\n\n[bigstock]\n    path = /media/miguel/bigstock\n    valid users = miguel\n    read only = No\n</code></pre>\n\n<p>i have tried several other smb option like the 2 masks to 0700 but they had no effect.</p>\n"},{"id":702765,"title":"Samba - Client wont find server","body":"<p>I have two computers with Ubuntu Desktop on both.</p>\n\n<p>The folder i am trying to share on Computer no.1 can't be found by Computer no.2</p>\n\n<p>The really frustrating part is that i actually got it to work a couple of days ago. The thing is, i had to re-install Ubuntu-Desktop on Computer no.2. After the re-installation i cant find Computer no.1. In fact, i cant access the Windows Network whatsoever. </p>\n\n<p>When i am trying to access Computer no.1 via the \"Connect to Server\" options with smb://workgroup/ or smb://85.226.255.196/ i get error message :</p>\n\n<p><strong>\"Unhandled error message: Failed to retrieve share list from server: Connection refused\"</strong></p>\n\n<p>I have been trying to retrace my steps but without luck.</p>\n\n<p>What i have done so far:</p>\n\n<ul>\n<li>Restarted the router </li>\n<li>Changed permissions on the shared folder    </li>\n<li>Re-installed Samba </li>\n<li>Updated packages on Computer no.2</li>\n<li>Edited the smb.conf back and forth </li>\n</ul>\n\n<hr>\n\n<p>Here is my <a href=\"https://www.dropbox.com/s/niwgmb7szhxr3x0/smb.conf?dl=0\" rel=\"nofollow\" title=\"smb.conf\">smb.conf</a></p>\n\n<p>The changes i have done:</p>\n\n<blockquote>\n  <p>name resolve order = lmhosts host wins bcast <br />\n     security = user</p>\n  \n  <p>[exempel]<br />\n     comment = TEST<br />\n     path = /home/holm/Exempel<br />\n     guest ok = yes<br />\n     browseable = yes<br />\n     ready only = no<br />\n     create mask = 0755</p>\n</blockquote>\n\n<p>After that i did this to set the permissions:<br /></p>\n\n<blockquote>\n  <p>sudo mkdir -p /path<br /> \n  sudo chown nobody:nogroup /path\n  <br /></p>\n</blockquote>\n\n<hr>\n\n<p><br />The first time around (when i actually got it to work) i did exactly the same thing as i have described here. At first i was only able to see the shared folder but not access it, so i had to fix the permissions issue. But now i can't even seem to connect to the Windows Network.<br /></p>\n\n<p>It may be worth mentioning that i've got dynamic IP:s. I cant change it to Static IP either because my internetprovider have locked that option and it would cost me money to get it. \n<br />\nAlso, i have no firewalls</p>\n\n<hr>\n\n<p><br />\nAny ideas would be highly appreciated!</p>\n"},{"id":562088,"title":"Mount Windows File Share and acces them on ubuntu 14.04 server","body":"<p>I have created a windows file share windows server 2012 on one of the data centre and I want to access the file share in another data centre on Ubuntu server 14.04</p>\n\n<p>I am able to ping both the machines vice versa.\nI have installed <code>cifs-utils</code> on the Ubuntu machine and when I run the </p>\n\n<pre><code>$ mount.cifs //x.x.x.x/test /mnt/iweb -o user=Administrator\nPassword:\n</code></pre>\n\n<p>Windows Share is not getting mounted on the machine.\nCorrect me if am wrong on the same.</p>\n"},{"id":672709,"title":"Samba, windows domain sharing and management","body":"<p>I have setup ubuntu-server to take over as the main file server on my domain and successfully managed to get it recognising all the windows AD users and groups using Centrify express, I did try to add it to the local domain and access all the users and groups with Samba but had no luck after multiple attempts.</p>\n\n<p>I am now wondering what the best way to manage the share directory access is, should I use ACL ?</p>\n\n<p>I would like it so that if I have a directory structure for example</p>\n\n<pre><code>DIR1\n|----SUBDIR1\n|----SUBDIR2\n|----SUBDIR3\n|----SUBDIR4\n|----SUBDIR5\n|----SUBDIR6\n</code></pre>\n\n<p>Now if I wanted USER1 to only be able to see SUBDIR 1-4 but not 5 and 6 and USER2 to only see 5 and 6 but not 1-4, what would be the best way to achieve this please ?</p>\n\n<p>I know I could share each directory individually but I would prefer to only share the main DIR1 so as not to have multiple shares.</p>\n\n<p>Thank you in advance</p>\n"},{"id":600434,"title":"Samba shares grant access to all users: permissions not working","body":"<p>I'm using Samba to create protected shares on Ubuntu Server that should be accessible by Windows computers. It does prompt me for a user name &amp; password but one login grants access to all files, even those made for other users.\nWhat am I doing wrong here?</p>\n\n<p>So basically</p>\n\n<pre><code>su\ncd\nmkdir /files\nmkdir /files/user1\nmkdir /files/user2\nmkdir /files/user3\nchmod 777 /files/user1\nchmod 777 /files/user2\nchmod 777 /files/user3\n\nvi /etc/samba/smb.conf\n</code></pre>\n\n<p>Under [global] I add:</p>\n\n<pre><code>security = user\nwins support = yes\nname resolve order = lmhosts host wins bcast\n</code></pre>\n\n<p>At the bottom:</p>\n\n<pre><code>[User1's files]\ncomment = User1's Files\npath = /files/user1\nbrowseable = yes\nread only = no\nvalid user = user1\n\n[User2's files]\ncomment = User2's Files\npath = /files/user2\nbrowseable = yes\nread only = no\nvalid user = user2\n</code></pre>\n\n<p>And the same for user 3.</p>\n\n<pre><code>shutdown -r now\n</code></pre>\n\n<p>Now on the Windows PC logged in as user1 I try to access user2.\nIt prompts me for a username &amp; password.\nI enter the details for user1 and it grants me access, but it shouldn't do.\nIt then also grants me access to user3.\nWhat am I doing wrong?</p>\n\n<p>I tried adding</p>\n\n<pre><code>force user = user1\ncreate mask = 0640\ndirectory mask = 0750\n</code></pre>\n\n<p>but this didn't help.</p>\n\n<p>The user accounts are on both Windows &amp; the server.</p>\n"},{"id":612005,"title":"Samba mount through fstab but only with permissions for one user","body":"<p>I recently set up a server with samba file sharing. On the clients I would like to automount the server during boot using fstab. I read a few tutorials and ended up using this line in /etc/fstab</p>\n\n<pre><code>//server/share  /mnt/mountpoint cifs    username=user,password=password 0   0\n</code></pre>\n\n<p>After reboot the server is successfully mounted at the defined mountpoint but only one user (USER1) has read/write permissions. When the other user (USER2) tries to open mnt/mountpoint a popup window says that the curent user is not the owner of the folder and has no rights to read or write.</p>\n\n<p>When I look at the properties of the mounted folder it says that USER1 is the owner. When I log in as USER1 I can change the permissions for the first folder but all other folders inside this one are also the property of USER1 and connot be changed. So there is no way for USER2 to do anything inside the mounted server.</p>\n\n<p>Have I done something wrong? Do I have to set the permissions or the owner of the mounted folder in the fstab file sowhere? I already read about the options for fstab in the ubuntu wiki but couldnt find anything that seemed to be helpful with my situation.</p>\n\n<p>Im thankful for any kind of help.</p>\n\n<p>Oh and I have Ubuntu 14.04 LTS installed on all the machines (server and the clients) and both users have root rights</p>\n"},{"id":593912,"title":"samba server using active directory logons","body":"<p>there is plenty of information on samba, and accessing the server just by the user name and smbpasswd you created on samba.</p>\n\n<p>However, lets say I have a samba server and I joined it to the windows domain \"AD\"\ni have 100 users on windows AD.</p>\n\n<p>how would set credentials and permissions for all 100 users on my AD windows server instead of creating a user one by one on linux samba server so they can see my files without me having to create a user on ubuntu server samba?</p>\n"},{"id":546296,"title":"Samba Permissions not staying for all users on 14.04 Server","body":"<p>I have an Ubuntu 14.04 LTS Server with Samba so that MAC and PC machines can connect to it via a wired network.</p>\n\n<p>I have created a single share:</p>\n\n<pre><code>mkdir -p /mnt/TEST-NEW-SERVER\nchown -R root:users /mnt/TEST-NEW-SERVER\nchmod -R ug+rwx,o+rx-w /mnt/TEST-NEW-SERVER\n</code></pre>\n\n<p>Then in the Samba conf I made security: user</p>\n\n<p>Then added this at the end:</p>\n\n<pre><code>[TEST-NEW-SERVER]\n  comment = All Users\n  path = /mnt/TEST-NEW-SERVER\n  valid users = @users\n  force group = users\n  create mask = 0777\n  directory mask = 0777\n  writable = yes\n  browseable = yes\n</code></pre>\n\n<p>I have added all users and passwords making sure that they are the same username and password as their machine, by doing this:</p>\n\n<pre><code>useradd tom -m -G users\n\npasswd tom\n\nsmbpasswd -a tom\n</code></pre>\n\n<p>All works well until someone copies a folder or a file in from one of their machines, then only they have access permissions. Everyone can see the folder and its contents but cant put anything in the folder or open anything that is in the folder.</p>\n\n<p>If I run the command:</p>\n\n<pre><code>chown -R root:users /mnt/TEST-NEW-SERVER\nchmod -R ug+rwx,o+rx-w /mnt/TEST-NEW-SERVER\n</code></pre>\n\n<p>again, then everything is OK again and everyone has access to everything again, until the next time someone copies in a folder from outside.</p>\n\n<p>The MACs are everything from Snow Leopard (10.6) to Yosamite (10.10) and the two PCs are Win7</p>\n\n<p>Am I missing something here?</p>\n\n<p>Is there a way to make sure that all users have all permissions to everything that is copied into or created in this share, all the time, without continually running the chown and chmod everytime?</p>\n\n<p>Any help would be greatly appeciated.</p>\n\n<p>Thanks in advance\nAl.</p>\n"},{"id":546148,"title":"Ubuntu Server Samba Permissions best practice","body":"<p>I am having some problems accessing my Ubuntu Server 14.04 over Samba. I am trying to access from my Ubuntu Gnome 14.04 desktop and other Linux desktops. I would like to have fine access control in the server where some users can read and write to shares and other users can only read but not write/delete files. I am not sure that I am doing this the right way but I realize there are usually many ways to do something on Linux. I have created the folders through the command line and am using Samba through Webmin to share them.</p>\n\n<p>I believe that file level ACL is where my current problem is. For example I have two folders on the server one I can read and write to and one I cannot write to but can read.</p>\n\n<p>Getfacl lists their properties like this:</p>\n\n<blockquote>\n  <p>john@Server:~$ getfacl /exports/Stuff</p>\n  \n  <p>getfacl: Removing leading '/' from absolute path names</p>\n  \n  <p>file: exports/Stuff</p>\n  \n  <p>owner: root</p>\n  \n  <p>group: root</p>\n  \n  <p>user::rwx</p>\n  \n  <p>group::r-x</p>\n  \n  <p>other::r-x</p>\n  \n  <p>default:user::rwx</p>\n  \n  <p>default:user:john:rw-</p>\n  \n  <p>default:user:wife:rw-</p>\n  \n  <p>default:user:daughter:rw-</p>\n  \n  <p>default:group::r-x</p>\n  \n  <p>default:group:users:r--</p>\n  \n  <p>default:mask::rwx</p>\n  \n  <p>default:other::r-x</p>\n  \n  <p>john@Server:~$ getfacl /exports/Photos</p>\n  \n  <p>getfacl: Removing leading '/' from absolute path names</p>\n  \n  <p>file: exports/Photos</p>\n  \n  <p>owner: john</p>\n  \n  <p>group: root</p>\n  \n  <p>user::rwx</p>\n  \n  <p>group::r-x</p>\n  \n  <p>other::r-x</p>\n  \n  <p>default:user::rwx</p>\n  \n  <p>default:user:john:rw-</p>\n  \n  <p>default:user:wife:rw-</p>\n  \n  <p>default:group::r-x</p>\n  \n  <p>default:group:users:r--</p>\n  \n  <p>default:mask::rwx</p>\n  \n  <p>default:other::r-x</p>\n</blockquote>\n\n<p>Now I see that I am the owner of Photos and root is the owner of folder Stuff an that seems to be the largest difference between them. </p>\n\n<p>Another user on the network also using Ubuntu Gnome can access the Photos folder but cannot write, this is the behavior I wanted and I imagine Samba is controlling this as she is not listed in the ACL’s but is listed in Samba security.</p>\n\n<p>Would the best approach be to delete the file system acls with setfacl and then just use samba to control user access or should I set them to both match?</p>\n\n<p>Am I going about this in the right way? What is the best practice to handle something like this? All clients are on Linux so If you had shares that some would view and never write to, while others would read and write, how would you control access? </p>\n"}]}]