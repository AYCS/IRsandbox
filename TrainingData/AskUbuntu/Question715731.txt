[{"id":715731,"title":"how to proxy specific repo in apt","body":"<p>I recently switched to Ubuntu 15.10.</p>\n\n<p>I need to use a proxy to connect to external internet.And on my local internet there's a repo that doesn't require proxy to connect.</p>\n\n<p>So I wrote something like this in /etc/apt/apt.conf.d/proxy</p>\n\n<pre><code>Acquire::http::Proxy::google.com \"http://XXX:8087\";\nAcquire::http::Proxy::spotify.com \"http://XXX:8087\";\n</code></pre>\n\n<p>Unfortunately,this doesn't work, apt-get update says failed to connect google spotify.\nI also tried change it to this.</p>\n\n<pre><code>Acquire::http::Proxy \"http://XXX:8087\";\n</code></pre>\n\n<p>I can connect to google and spotify now, but I can't connect to my local repo.\n  Isn't there a better workaround?</p>\n","related_questions":[{"id":77449,"title":"How to configure proxy authentication to work with Ubuntu Software Center?","body":"<p>I have tried put in apt config Acquire::http::proxy, and in Network>Network proxy with and without user:password@server:port and using environment variables http_proxy and https_proxy. Nothing seems to work, not even a single proxy authentication popup window.</p>\n\n<p>The only proxy configuration working is within Firefox Edit> Preferences> Advanced> Network> Connection> Settings> Manual Proxy Configuration.</p>\n\n<ul>\n<li>Using gconf to manually set the proxy doesn't work</li>\n</ul>\n\n<p>Using Synaptic in previous Ubuntu versions was too simple.</p>\n"},{"id":615020,"title":"apt-get works via proxy, but nothing else does","body":"<p>This pertains to Ubuntu 14.04 behind a proxy server that requires authentication.</p>\n\n<p>I've managed to get apt-get working via proxy. My <code>/etc/apt/apt.conf</code> looks like this:</p>\n\n<pre><code>Acquire::http::proxy \"http://my_proxy_server:3128/\";\nAcquire::https::proxy \"https://my_proxy_server:3128/\";\nAcquire::ftp::proxy \"ftp://my_proxy_server:3128/\";\nAcquire::socks::proxy \"socks://my_proxy_server:3128/\";\n</code></pre>\n\n<p>My environment variables look the same - I have <code>http_proxy</code>, <code>https_proxy</code>, <code>ftp_proxy</code> and <code>socks_proxy</code> set.</p>\n\n<p>I've a bunch of questions:</p>\n\n<ol>\n<li><p>This proxy server needs authentication. I have not specified username and password for apt-get. However, I can still do <code>apt-get update</code> and it works just fine. Why?</p></li>\n<li><p><em>None</em> of the other programs work. For example, <code>pip install</code> would fail with the message that it can't fetch  <a href=\"https://pypi.python.org/simple\" rel=\"nofollow\">https://pypi.python.org/simple</a></p></li>\n</ol>\n\n<p>What is the right way to set up proxy?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I installed google-chrome-stable and tried to connect to the internet. It asked me for proxy authentication, which I provided. After this step, <code>wget</code> and <code>pip</code> seem to work fine! This is really strange. I'm guessing there's some configuration that chrome does which allows the other apps to connect as well.</p>\n\n<p>Now, the new question is, how do I configure it as root? for instance, I can do <code>pip install ...</code> and it can download the packages just fine, but if I do <code>sudo pip install ...</code>, it fails to connect to the pypi website.</p>\n"},{"id":598286,"title":"apt-key fails behind proxy","body":"<p>Our company uses a filtering proxy which is setup correctly in /etc/environment and apt.conf.d<br>\nRegular internet access via http and https work but if I try to import a pgp key from keyserver.ubuntu.com it fails.</p>\n\n<p><strong>Example:</strong>   </p>\n\n<pre><code>$ apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 36A1D7869245C8950F966E92D8576A8BA88D21E9\ngpg: requesting key A88D21E9 from hkp server keyserver.ubuntu.com  \ngpgkeys: key 36A1D7869245C8950F966E92D8576A8BA88D21E9 can't be retrieved   \ngpg: no valid OpenPGP data found   \n</code></pre>\n\n<p>Support says, that they found that the keyserver is not accepting a HTTP/1.0 header (see below) although the HTTP/1.0 is a valid request.<br>\nSo they say the problem is on the keyserver side and they are not willing to do anything on their side.<br>\nI cannot really judge if that is true and I can also not find any contact for the Ubuntu keyserver to get a statement from, so I am stuck. </p>\n\n<p><strong>Trace gotten from zscaler proxy support :</strong>  </p>\n\n<pre><code>GET /pks/lookup?op=get&amp;options=mr&amp;search=0x36A1D7869245C8950F966E92D8576A8BA88D21E9 HTTP/1.0  \nCache-Control: no-cache  \nPragma: no-cache  \nConnection: Close  \nX-Forwarded-For: 62.180.121.22*   \n</code></pre>\n\n<p>Although this request is valid from RFC point of view, the server is denying it with a <code>400 Bad Request</code> error</p>\n\n<pre><code>HTTP/1.0 400 Bad Request  \nServer: squid/3.1.19  \nMime-Version: 1.0  \nDate: Mon, 09 Mar 2015 09:39:47 GMT  \nContent-Type: text/html  \nContent-Length: 3346  \nX-Squid-Error: ERR_INVALID_URL 0  \nVary: Accept-Language  \nContent-Language: en  \nX-Cache: MISS from cassava.canonical.com  \nX-Cache-Lookup: NONE from cassava.canonical.com:11371  \nVia: 1.0 cassava.canonical.com (squid/3.1.19)  \nConnection: close*   \n</code></pre>\n"},{"id":554079,"title":"Limit apt repo to a certain arch?","body":"<p>I have several repositories that don't have armhf (for RPi cross-compiler) binaries, so it always gives me a carp ton of 404 errors on updating package lists. it also prevents me from running do-release-upgrade as it can't find armhf compiled system binaries, that it doesn't need and can't run anyways. I'm looking for a way to tell it to only search for specific arches in certain repositories so I can fix the massive wall of 404s on apt-get update. Google was no help, so as far as I know this isn't a dupe, and the one question that was possibly related was about GPG errors, of which I have none.</p>\n\n<p>sources.list: <a href=\"http://pastebin.com/3RTLat0m\" rel=\"nofollow\">http://pastebin.com/3RTLat0m</a><br>\noutput of apt-get update: <a href=\"http://pastebin.com/Yb1J2DYd\" rel=\"nofollow\">http://pastebin.com/Yb1J2DYd</a><br>\ndkpg arches: i386, amd64, armhf<br>\nI'm using an ARM cross compiler as raspberry pi is very slow to compile larger things, and crashes on some huge ones, even with a 4GB swapfile on an external drive</p>\n"},{"id":496013,"title":"Having some trouble authenticating via proxy in order to use apt-get successfully on a corporate network","body":"<p><em>Apologies if this is a basic question, I've recently taken ownership of our department's internal server so I'm having to deal with issues beyond my (very basic) knowledge.</em> </p>\n\n<hr>\n\n<p><strong>Context</strong></p>\n\n<p>Our server is on a corporate network which requires corporate proxy authentication (e.g. enter corporate username and password). This is not an issue on the Windows machines on that network - when a web browser is opened the user is prompted to authenticate. However, when using a browser on Linux the user is not prompted to authenticate, the browser simply shows a message saying authentication is required. </p>\n\n<hr>\n\n<p><strong>Problem 1 - Internet Access would be useful</strong> </p>\n\n<p>At the moment I have to walk to my desk on another floor if I need to look something up, because I cannot get Internet access from this machine since I cannot* (*do not know how to) authenticate. It would be useful to have the ability to authenticate so I can use a web browser. </p>\n\n<hr>\n\n<p><strong>Problem 2 - Packages cannot be updated</strong> </p>\n\n<p>When I attempt to perform updates using <code>sudo apt-get update</code> or <code>sudo apt-get install [package]</code>, there are errors which I believe are caused due to lack of authentication. </p>\n\n<p>After performing <code>sudo apt-get update</code>, I get errors like <code>W: Failed to fetch [link] 401 Authorization Required</code>. (For some reason some <a href=\"http://us.archive.ubuntu.com\" rel=\"nofollow\">http://us.archive.ubuntu.com</a> trusty/ sources work correctly, and some throw the same error). </p>\n\n<p>This is a major problem, as I need to be able to update packages on the server. </p>\n\n<hr>\n\n<p><strong>Steps Taken</strong> </p>\n\n<ul>\n<li>I have installed cntlm via <code>sudo apt-get install cntlm</code> (it works from one of the few ubuntu repositories that randomly work). </li>\n<li>I edited the configuration at <code>/etc/cntlm.conf</code> and added my username, the domain, and the proxy. </li>\n<li>I started the service (<code>sudo /etc/init.d/cntlm start</code>)</li>\n<li>I tested the service (<code>sudo cntlm -I -M http://www.google.com/</code>) and the response was <code>Config Profile 1/4... Auth not required (HTTP code: 307) Your proxy is open, you don't need another proxy.</code> </li>\n</ul>\n\n<hr>\n\n<ul>\n<li>I tried performing <code>sudo apt-get update</code> again and still receive the same error message. (<code>401 Authorization Required</code>) </li>\n<li><em>(Whoops! My mistake! I see I need to configure apt proxy settings manually...)</em> </li>\n<li>I added the line <code>Acquire::http::Proxy \"http://localhost:3128\";</code> to <code>/etc/apt/apt.conf</code>.</li>\n<li>I restarted <code>cntlm</code>. (<code>sudo /etc/init.d/cntlm stop</code>, <code>sudo /etc/init.d/cntlm start</code>)</li>\n</ul>\n\n<hr>\n\n<ul>\n<li>I performed <code>sudo apt-get update</code> ... and it hit <code>0% [Waiting for headers] [Waiting for headers] [Waiting for headers] [Waiting f</code> - and just stopped there.</li>\n<li>I performed <code>sudo apt-get clean</code> before performing <code>sudo apt-get update</code> - this started working and then stopped at <code>19% [Waiting for headers]</code></li>\n<li>I performed <code>sudo apt-get clean</code> again before performing <code>sudo apt-get update</code> - this started working and then stopped at <code>0% [Waiting for headers]</code> </li>\n<li>I tried this a third time (<code>sudo apt-get clean</code>, <code>sudo apt-get update</code>) and it stopped at <code>20% [Waiting for headers]</code> </li>\n</ul>\n\n<hr>\n\n<ul>\n<li>I researched this subsequent problem and found <a href=\"http://askubuntu.com/a/19811\">an answer on AskUbuntu</a> suggesting this may be an issue with IPv6 causing ICS to halt for a while when it receives concurrent connections.</li>\n<li>I checked the <code>/etc/sysctl.conf</code> file and discovered the IPv6 already appears to be disabled... (The lines <code>net.ipv6.conf.all.disable_ipv6 = 1</code>, <code>net.ipv6.conf.default.disable_ipv6 = 1</code>, and <code>net.ipv6.conf.lo.disable_ipv6 = 1</code> are already in the config file.) </li>\n<li><em>(I'm now drawing a bit of a blank! The symptoms match the hypothesized IPv6 issue however if it is already disabled that doesn't seem to be able to be the cause)</em> </li>\n<li>I performed <code>sudo apt-get clean</code> and <code>sudo apt-get update</code> a fourth time <em>(What the hell - why not?)</em> and it hung on <code>24% [Waiting for Headers]</code> this time, but first it hit a bunch of repositories. A repository which used to trigger errors did not do so now (<code>http://cran.rstudio.com trusty /</code>) but one which used to trigger errors now triggered a different error, <code>Received HTTP code 501 from proxy after CONNECT</code>. </li>\n</ul>\n"},{"id":89437,"title":"how to install packages with apt-get on a system connected via proxy?","body":"<p>I've got an Ubuntu 11.10 system connected via a proxy to the internet, and I would like to install packages via apt-get. When I try to do that I get this error message:</p>\n\n<pre><code>sudo apt-get install libboost-program-options-dev\n[...]\nErr http://gb.archive.ubuntu.com/ubuntu/ oneiric/main libboost1.46-dev i386 1.46.1-5ubuntu2\n407  Proxy Authentication Required\n</code></pre>\n\n<p>Any ideas?</p>\n"},{"id":436349,"title":"Apt keeps trying to connect to a non-existent proxy","body":"<p>I have an apt proxy on my home network which is running squid-deb-proxy, all my Ubuntu machines are linked to it with a 02proxy file in their apt directorys.</p>\n\n<p>The problem is one of my Ubuntu machines sometimes tries to connect to an IP which doesn't even exist on my network when installing or updating software.</p>\n\n<p>The IP address of my proxy machine is 10.1.1.31 yet the client Ubuntu machine sometimes (not always) tries to connect to 10.1.1.8, I have no idea what's causing it to do this.</p>\n\n<p>Any help is much appreciated.</p>\n"},{"id":364635,"title":"acquire::http::proxy for only specified repositories","body":"<p>Is there a way to use acquire::http::proxy for some repositories?</p>\n\n<p>I'm in a network that has a proxy server. So everybody has to update /etc/apt/apt.conf adding the lines like </p>\n\n<pre><code>Acquire::http::Proxy \"http://yourproxyaddress:proxyport\";\nAcquire::https::Proxy \"http://yourproxyaddress:proxyport\";\nAcquire::ftp::Proxy \"http://yourproxyaddress:proxyport\";\nAcquire::socks::Proxy \"http://yourproxyaddress:proxyport\";\n</code></pre>\n\n<p>Everything working ok with that.</p>\n\n<p>But now we have a LOT of ubuntu machines and I want to do a local ubuntu mirror.</p>\n\n<p>So we should erase those proxy lines.... except for external repositories.</p>\n\n<p>So, how do I configure something like that?</p>\n\n<p>In RH based distros you can have a global proxy setting for yum and then use individual proxy settings for each repository. But didn't found something similar un Ubuntu.</p>\n"},{"id":226009,"title":"Not able to add repo when APT is using a proxy connection","body":"<p>I have ubuntu 12.10 working on my system. I have tried many time to add repo but every time i tried i got the same error as in this case.</p>\n\n<pre><code>$ sudo add-apt-repository ppa:scopes-packagers/ppa\nCannot access PPA (https://launchpad.net/api/1.0/~scopes-packagers/+archive/ppa) to get PPA information, please check your internet connection.\n</code></pre>\n\n<p>my net is working fine. apt-get install is also working.</p>\n\n<p>so why is it giving error that check your internet connection? \n( i am working under proxy server with authentication)</p>\n\n<pre><code>$ cat /etc/apt/apt.conf file\n\nAcquire::http::proxy \"http://username:password@172.31.100.29:3128/\";\nAcquire::https::proxy \"https://username:password@172.31.100.29:3128/\";\nAcquire::ftp::proxy \"ftp://username:password@172.31.100.29:3128/\";\nAcquire::socks::proxy \"socks://username:password@172.31.100.29:3128/\";\n</code></pre>\n"},{"id":92464,"title":"add-apt-repository wont work on proxy","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://askubuntu.com/questions/23211/how-do-i-add-a-repository-from-behind-a-proxy\">How do I add a repository from behind a proxy?</a>  </p>\n</blockquote>\n\n\n\n<p>I would like to send an add-apt-repository command via the gnome-terminal on my Ubuntu 11.10 laptop that is connected through a proxy (with username/password).\nFollowing this answer, I edited my apt.conf file:<br>\n<a href=\"http://askubuntu.com/questions/89437/how-to-install-packages-with-apt-get-on-a-system-connected-via-proxy/89695#89695\">how to install packages with apt-get on a system connected via proxy?</a></p>\n\n<h3>/etc/apt/apt.conf</h3>\n\n<pre><code>Acquire::http::proxy \"http://&lt;username&gt;:&lt;password&gt;@&lt;proxy&gt;:&lt;port&gt;/\";\nAcquire::ftp::proxy \"ftp://&lt;username&gt;:&lt;password&gt;@&lt;proxy&gt;:&lt;port&gt;/\";\nAcquire::https::proxy \"https://&lt;username&gt;:&lt;password&gt;@&lt;proxy&gt;:&lt;port&gt;/\";\n</code></pre>\n\n<p>I can now run <code>apt-get install package-name</code> with no problem, but when I try <code>add-apt-repository</code>, it won't work. Any suggestions?</p>\n\n<pre><code>sudo add-apt-repository ppa:bumblebee/stable\n\nTraceback (most recent call last):\n  File \"/usr/bin/add-apt-repository\", line 88, in &lt;module&gt;\n    ppa_info = get_ppa_info_from_lp(user, ppa_name)\n  File \"/usr/lib/python2.7/dist-packages/softwareproperties/ppa.py\", line 65, in get_ppa_info_from_lp\n    lp_page = urlopen(req).read()\n  File \"/usr/lib/python2.7/urllib2.py\", line 126, in urlopen\n    return _opener.open(url, data, timeout)\n  File \"/usr/lib/python2.7/urllib2.py\", line 394, in open\n    response = self._open(req, data)\n  File \"/usr/lib/python2.7/urllib2.py\", line 412, in _open\n    '_open', req)\n  File \"/usr/lib/python2.7/urllib2.py\", line 372, in _call_chain\n    result = func(*args)\n  File \"/usr/lib/python2.7/urllib2.py\", line 1209, in https_open\n    return self.do_open(httplib.HTTPSConnection, req)\n  File \"/usr/lib/python2.7/urllib2.py\", line 1171, in do_open\n    raise URLError(err)\nurllib2.URLError: &lt;urlopen error [Errno 8] _ssl.c:503: EOF occurred in violation of protocol&gt;\n</code></pre>\n"}]}]